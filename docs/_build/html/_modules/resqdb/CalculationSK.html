
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>resqdb.CalculationSK &#8212; RES-Q package January, 2019 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for resqdb.CalculationSK</h1><div class="highlight"><pre>
<span></span><span class="c1">#### Filename: Connection.py</span>
<span class="c1">#### Version: v1.0</span>
<span class="c1">#### Author: Marie Jankujova</span>
<span class="c1">#### Date: March 4, 2019</span>
<span class="c1">#### Description: Connect to database and get atalaia dataframe.</span>

<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">configparser</span> <span class="k">import</span> <span class="n">ConfigParser</span>
<span class="kn">from</span> <span class="nn">resqdb.CheckData</span> <span class="k">import</span> <span class="n">CheckData</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">inf</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">import</span> <span class="nn">xlsxwriter</span>

<div class="viewcode-block" id="Connection"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.Connection">[docs]</a><span class="k">class</span> <span class="nc">Connection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A connection with one property: a section. </span>

<span class="sd">    To use:</span>
<span class="sd">    &gt;&gt;&gt; conn = Connection()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nprocess</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Create log file in the working folder</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;debug.log&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
                            <span class="n">filemode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">,</span><span class="si">%(msecs)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">,</span>
                            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connecting to datamix database!&#39;</span><span class="p">)</span>   

        <span class="c1"># Get absolute path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_ini</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;database.ini&#39;</span><span class="p">)</span>


        <span class="c1"># Set section</span>
        <span class="n">datamix</span> <span class="o">=</span> <span class="s1">&#39;datamix&#39;</span>
        <span class="c1"># Create empty dictionary</span>
        <span class="c1">#self.sqls = [&#39;SELECT * from slovakia&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SELECT * from slovakia&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT * from slovakia_2018&#39;</span><span class="p">]</span>
        <span class="c1"># List of dataframe names</span>
        <span class="c1">#self.names = [&#39;slovakia&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;slovakia&#39;</span><span class="p">,</span> <span class="s1">&#39;slovakia_2018&#39;</span><span class="p">]</span>
        <span class="c1"># Dictionary initialization - db dataframes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictdb_df</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Dictioanry initialization - prepared dataframes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_df</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">df_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datamix</span><span class="p">,</span> <span class="n">nprocess</span><span class="p">,</span> <span class="n">df_name</span><span class="o">=</span><span class="n">df_name</span><span class="p">)</span>

        <span class="n">df_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">datamix</span><span class="p">,</span> <span class="n">nprocess</span><span class="p">,</span> <span class="n">df_name</span><span class="o">=</span><span class="n">df_name</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dictdb_df</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
            <span class="c1">#print(self.dict_df[self.names[i]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection: </span><span class="si">{0}</span><span class="s2"> dataframe has been appended to the resulting dataframe!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="c1"># Get all country code in dataframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_countries</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="c1"># Get preprocessed data</span>
        <span class="c1"># self.preprocessed_data = self.check_data(df=self.df)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">tdelta</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;The conversion and merging run </span><span class="si">{0}</span><span class="s1"> minutes.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tdelta</span><span class="p">))</span>

    
<div class="viewcode-block" id="Connection.config"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.Connection.config">[docs]</a>    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read and parse the config database file. </span>
<span class="sd">        </span>
<span class="sd">        Raises: </span>
<span class="sd">            Exception: If the section couldn&#39;t be find in the database.ini file)</span>
<span class="sd">        Returns: </span>
<span class="sd">            The dictionary of parameters to enable connection to database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a parser object</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
        <span class="c1"># Read config file</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_ini</span><span class="p">)</span>

        <span class="c1"># Get section, default to postgresql</span>
        <span class="n">db</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">db</span><span class="p">[</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Connection: Section </span><span class="si">{0}</span><span class="s1"> not found in the </span><span class="si">{1}</span><span class="s1"> file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_ini</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Section </span><span class="si">{0}</span><span class="s1"> not found in the </span><span class="si">{1}</span><span class="s1"> file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_ini</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">db</span></div>

    
<div class="viewcode-block" id="Connection.connect"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.Connection.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">nprocess</span><span class="p">,</span> <span class="n">df_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Connects to the database specified in the databse.ini file.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            sql: The SQL query run to get dataframe from the database.</span>
<span class="sd">        Raises: </span>
<span class="sd">            Exception: If the connection was not successful. </span>
<span class="sd">        Returns: </span>
<span class="sd">            The new dataframe containing data from database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>    
        <span class="k">try</span><span class="p">:</span> 
            <span class="c1"># Read connection parameters</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

            <span class="c1"># Connect to the PostgreSQL server</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Process</span><span class="si">{0}</span><span class="s1">: Connecting to the PostgreSQL database... &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nprocess</span><span class="p">))</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

            <span class="c1"># Create dataframe for given sql query</span>
            <span class="k">if</span> <span class="n">df_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dictdb_df</span><span class="p">[</span><span class="n">df_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Process</span><span class="si">{0}</span><span class="s1">: Dataframe </span><span class="si">{1}</span><span class="s1"> has been created created.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nprocess</span><span class="p">,</span> <span class="n">df_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Process</span><span class="si">{0}</span><span class="s1">: Name of dataframe is missing.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nprocess</span><span class="p">))</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">conn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Process</span><span class="si">{0}</span><span class="s1">: Database connection has been closed.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nprocess</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_calculate_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ct_date</span><span class="p">,</span> <span class="n">hospital_date</span><span class="p">,</span> <span class="n">rec_date</span><span class="p">,</span> <span class="n">used_col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate needle time or groin time. &quot;&quot;&quot;</span>
        
        <span class="n">rec_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">hospital_date</span>
        <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">rec_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>
        <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;HOSPITAL_DATE&#39;</span>

        <span class="k">if</span> <span class="n">used_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tdeltamin</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">hospital_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">rec_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">):</span>
                        <span class="n">rec_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">ct_date</span>
                        <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">rec_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>
                        <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;CT_TIME&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">hospital_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">rec_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">):</span>
                            <span class="n">rec_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">hospital_date</span>
                            <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">rec_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>
                            <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;HOSPITAL_DATE&#39;</span>
                            <span class="k">if</span> <span class="n">tdeltamin</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">rec_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">ct_date</span>
                                <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">rec_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>
                                <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;CT_TIME&#39;</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">tdeltamin</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">tdeltamin</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">hosp_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">hospital_date</span>
                <span class="n">hosp_time_mins</span> <span class="o">=</span> <span class="n">hosp_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>        
                <span class="n">rec_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">ct_date</span>
                <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">rec_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>
                <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;CT_TIME&#39;</span>
                <span class="k">if</span> <span class="n">hosp_time_mins</span> <span class="o">&gt;</span> <span class="n">tdeltamin</span><span class="p">:</span>
                    <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">hosp_time_mins</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;HOSPITAL_DATE&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">used_col</span> <span class="o">==</span> <span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">:</span>
                <span class="n">rec_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">hospital_date</span>
                <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">rec_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>
            <span class="k">elif</span> <span class="n">used_col</span> <span class="o">==</span> <span class="s1">&#39;CT_TIME&#39;</span><span class="p">:</span>
                <span class="n">rec_time</span> <span class="o">=</span> <span class="n">rec_date</span> <span class="o">-</span> <span class="n">ct_date</span>
                <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">rec_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>

        <span class="k">return</span> <span class="n">tdeltamin</span><span class="p">,</span> <span class="n">used_col</span>

    <span class="k">def</span> <span class="nf">_calculate_ct_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hospital_date</span><span class="p">,</span> <span class="n">ct_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate CT/TIME and return 1 if CT under 1 hour else return 2. &quot;&quot;&quot;</span>

        <span class="n">ct_diff</span> <span class="o">=</span> <span class="n">ct_date</span> <span class="o">-</span> <span class="n">hospital_date</span>
        <span class="n">tdeltamin</span> <span class="o">=</span> <span class="n">ct_diff</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>

        <span class="k">if</span> <span class="n">tdeltamin</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tdeltamin</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
    
<div class="viewcode-block" id="Connection.prepare_df"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.Connection.prepare_df">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Rename column names and map values. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;slovakia&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># Remove _en suffix from column names</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">columns</span>

            <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;anonym&#39;</span><span class="p">:</span>
                    <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Protocol ID&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">:</span>
                    <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Subject ID&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

            <span class="n">res</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="n">new_cols</span><span class="p">)),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;NEEDLE_TIME_MIN&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_time</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;NEEDLE_TIME&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;NEEDLE_TIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span> <span class="k">else</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;GROIN_TIME_MIN&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_time</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;GROIN_TIME&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;GROIN_TIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span> <span class="k">else</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;CT_TIME_WITHIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_ct_time</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_MRI&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">res</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1">#res[&#39;CRF&#39;] = &#39;SLOVAKIA_2019&#39;</span>

            <span class="n">res</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_NEEDLE_OLD&#39;</span><span class="p">,</span> <span class="s1">&#39;NEEDLE_TIME_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">,</span> <span class="s1">&#39;DOOR_TO_GROIN&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_GROIN_OLD&#39;</span><span class="p">,</span> <span class="s1">&#39;GROIN_TIME_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_GROIN&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_TIME&#39;</span><span class="p">:</span> <span class="s1">&#39;CT_DATE&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_TIME_WITHIN&#39;</span><span class="p">:</span> <span class="s1">&#39;CT_TIME&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection: Column names in Slovakia were changed successfully.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dict_df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;slovakia_2018&#39;</span><span class="p">:</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># Remove _en suffix from column names</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">columns</span>

            <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;anonym&#39;</span><span class="p">:</span>
                    <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Protocol ID&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">:</span>
                    <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Subject ID&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

            <span class="n">res</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="n">new_cols</span><span class="p">)),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1">#print(list(res.columns))</span>

            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;NEEDLE_TIME_MIN&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_time</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;NEEDLE_TIME&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;NEEDLE_TIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span> <span class="k">else</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;GROIN_TIME_MIN&#39;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_time</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;GROIN_TIME&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;GROIN_TIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span> <span class="k">else</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;CT_TIME_WITHIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_ct_time</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;CT_MRI&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">res</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;USED_COL&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1">#res[&#39;CRF&#39;] = &#39;SLOVAKIA_2019&#39;</span>

            <span class="n">res</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_NEEDLE_OLD&#39;</span><span class="p">,</span> <span class="s1">&#39;NEEDLE_TIME_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">,</span> <span class="s1">&#39;DOOR_TO_GROIN&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_GROIN_OLD&#39;</span><span class="p">,</span> <span class="s1">&#39;GROIN_TIME_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;DOOR_TO_GROIN&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_TIME&#39;</span><span class="p">:</span> <span class="s1">&#39;CT_DATE&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_TIME_WITHIN&#39;</span><span class="p">:</span> <span class="s1">&#39;CT_TIME&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


            <span class="c1">#res[&#39;CRF&#39;] = &#39;SLOVAKIA_2018&#39;</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection: Column names in Slovakia_2018 were changed successfully.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dict_df</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span></div>

    
    <span class="k">def</span> <span class="nf">_get_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return list of countries present in the dataframe.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: The raw dataframe</span>
<span class="sd">        Returns:</span>
<span class="sd">            The list of country codes present in the dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">site_ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
        <span class="n">countriesSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">site_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">countriesList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">countriesSet</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data: Countries in the dataset: </span><span class="si">{0}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">countriesList</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">countriesList</span></div>
            

<div class="viewcode-block" id="FilterDataset"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.FilterDataset">[docs]</a><span class="k">class</span> <span class="nc">FilterDataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Filter dataset by country and the time period. </span>

<span class="sd">    Args:</span>
<span class="sd">        df: The preprocessed dataframe</span>
<span class="sd">        country: The country code of country which should be included in the resulted calculation (default: None)</span>
<span class="sd">        date1: The first daate included in the filtered dataframe (default: None)</span>
<span class="sd">        date2: The last date included in the filtered dataframe (default: None)</span>
<span class="sd">    Returns:</span>
<span class="sd">        The filtered dataframe. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Create log file in the working folder</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;debug.log&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
                            <span class="n">filemode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">,</span><span class="si">%(msecs)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">,</span>
                            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">country</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date1</span> <span class="o">=</span> <span class="n">date1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date2</span> <span class="o">=</span> <span class="n">date2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Append &quot;_&quot; to the country code, because e.g. ES_MD was included in dataset for MD as well.</span>
            <span class="n">country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> 

            <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_country</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="n">country</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FilterDataset: Data have been filtered for country </span><span class="si">{0}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="p">))</span> 
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">date1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_date</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FilterDataset: Data have been filtered for date </span><span class="si">{0}</span><span class="s1"> - </span><span class="si">{1}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">_filter_by_country</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">country</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return dataframe containing only rows for the given country. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            country: The changed country code.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The filtered dataframe. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_filter_by_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return dataframe containing only rows where discharge date is between these two dates. </span>

<span class="sd">        Args: </span>
<span class="sd">            date1: The first date included in the filtered dataframe</span>
<span class="sd">            date2: The last date included in the filtered dataframe</span>
<span class="sd">        Returns: </span>
<span class="sd">            The filtered dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DATE&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DATE&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="GeneratePreprocessedData"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.GeneratePreprocessedData">[docs]</a><span class="k">class</span> <span class="nc">GeneratePreprocessedData</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate preprocessed data as table. One sheet are preprocessed data, 2nd sheet are legend data.    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">split_sites</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">country_code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create object of preprocessed data. </span>

<span class="sd">        Args:</span>
<span class="sd">            df: preprocessed data in datafraem</span>
<span class="sd">            split_sites: True if preprocessed data has to be generated per site (default: False)</span>
<span class="sd">            site: Protocol ID of site (default: None)</span>
<span class="sd">            country_code: country code (default: None)</span>
<span class="sd">            report: type of the report, eg. quarter (default: None)</span>
<span class="sd">            period: type of the period, eg. H1_2018 (default: None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create log file in the working folder</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;debug.log&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
                            <span class="n">filemode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">,</span><span class="si">%(msecs)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">,</span>
                            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split_sites</span> <span class="o">=</span> <span class="n">split_sites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="n">report</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">=</span> <span class="n">quarter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="o">=</span> <span class="n">country_code</span>

        <span class="c1"># If Site is not None, filter dataset according to site code</span>
        <span class="k">if</span> <span class="n">site</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">site</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
            <span class="c1"># Generate preprocessed data for site</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_preprocessed_data</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">site_code</span><span class="o">=</span><span class="n">site</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Preprocessed data: The preprocessed data were generated for site </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="p">))</span>
        
        <span class="c1"># Generate formatted statistics per site + country as site is included</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">split_sites</span><span class="p">)</span> <span class="ow">and</span> <span class="n">site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Preprocessed data: Generate preprocessed data per site.&#39;</span><span class="p">)</span>
            <span class="c1"># Get set of all site ids</span>
            <span class="n">site_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="c1">#site_ids = set(site_ids)  </span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">site_ids</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_preprocessed_data</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">site_code</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Preprocessed data: The preprocessed data were generated for site </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_preprocessed_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">site_code</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Preprocessed data: The preprocessed data were generate for all data.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_preprocessed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">site_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate preprocessed data with legend. </span>

<span class="sd">        Keyword arguments: </span>
<span class="sd">            df = filtered dataframe</span>
<span class="sd">            site_code = code of site included in the dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">site_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">site_code</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;_preprocessed_data.xlsx&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;_preprocessed_data.xlsx&quot;</span>
        
        <span class="c1">#output_file = &quot;preprocessed_data.xlsx&quot;</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c1"># Convert dates to strings</span>
        <span class="n">dateformat</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span>
        <span class="n">timeformat</span> <span class="o">=</span> <span class="s2">&quot;%H:%M&quot;</span>
        <span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">datetime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">datetime</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">datetime</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
        
        
       <span class="c1"># if df[&#39;VISIT_DATE&#39;].dtype != np.object:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;VISIT_DATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert_to_string</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;VISIT_DATE&#39;</span><span class="p">],</span> <span class="n">dateformat</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
       <span class="c1"># if df[&#39;VISIT_DATE_OLD&#39;].dtype != np.object:</span>
        <span class="c1">#if df[&#39;VISIT_TIME&#39;].dtype != np.object:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;VISIT_TIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert_to_string</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;VISIT_TIME&#39;</span><span class="p">],</span> <span class="n">timeformat</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert_to_string</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DATE&#39;</span><span class="p">],</span> <span class="n">timestamp</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#if df[&#39;HOSPITAL_TIME&#39;].dtype != np.object:</span>
       <span class="c1"># df[&#39;HOSPITAL_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_TIME&#39;], timeformat), axis=1)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert_to_string</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DATE&#39;</span><span class="p">],</span> <span class="n">timestamp</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        

        <span class="c1"># Replace NAN values with 0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create workbook</span>
        <span class="n">workbook</span> <span class="o">=</span> <span class="n">xlsxwriter</span><span class="o">.</span><span class="n">Workbook</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Preprocessed data: The workbook was created.&#39;</span><span class="p">)</span>
        <span class="c1"># Create worksheets</span>
        <span class="n">preprocessed_data_sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="s1">&#39;Preprocessed_raw_data&#39;</span><span class="p">)</span>
        <span class="n">legend_sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="s1">&#39;Legend_v2.0&#39;</span><span class="p">)</span>
        <span class="n">additional_desc_sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="s1">&#39;Additional_description&#39;</span><span class="p">)</span>

        <span class="c1">### PREPROCESSED DATA</span>
        <span class="n">preprocessed_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Set width of columns</span>
        <span class="n">preprocessed_data_sheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="c1"># Number of columns/rows</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Create header</span>
        <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">preprocessed_data</span><span class="p">,</span>
                   <span class="s1">&#39;header_row&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                   <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="s1">&#39;Table Style Light 1&#39;</span>
                   <span class="p">}</span>
        <span class="n">preprocessed_data_sheet</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Preprocessed data: The sheet &quot;Preprocessed data&quot; was added.&#39;</span><span class="p">)</span>
    
        <span class="n">workbook</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="ComputeStats"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.ComputeStats">[docs]</a><span class="k">class</span> <span class="nc">ComputeStats</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module compute statistics from the raw data. </span>
<span class="sd">    </span>
<span class="sd">    Keyword arguments:</span>
<span class="sd">    df -- the raw dataframe</span>
<span class="sd">    country -- True if country should be included as site into results (default False)</span>
<span class="sd">    country_code -- the country code of country if data were filtered (default &quot;&quot;)</span>
<span class="sd">    comparison -- True if we are compare the data (e.g. countries between each other)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">country</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">country_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">comparison</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get short Protocol IDs - it means RESQ-v - PL_001 will be PL_001</span>
        <span class="k">def</span> <span class="nf">get_country_name</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;UZB&quot;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;UZ&#39;</span>
            <span class="n">country_name</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">country_names</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">country_name</span>

        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># uncomment if you want stats between countries and set comparison == True</span>
            <span class="c1">#self.df[&#39;Protocol ID&#39;] = self.df.apply(lambda x: x[&#39;Protocol ID&#39;].split(&quot;_&quot;)[0], axis=1)</span>
        <span class="c1">#print(set(list(self.df[&#39;Protocol ID&#39;])))</span>

        <span class="c1"># If you want to compare, instead of Site Names will be Country names. </span>
        <span class="k">if</span> <span class="n">comparison</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Site Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_country_name</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">get_country_name</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        
        <span class="k">if</span> <span class="p">(</span><span class="n">country</span><span class="p">):</span>
            <span class="n">country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">country_names</span><span class="p">[</span><span class="n">country_code</span><span class="p">]</span>
            <span class="n">country</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span>
            <span class="n">country</span><span class="p">[</span><span class="s1">&#39;Site Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">country</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Get Protocol IDs and Total Patients </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Total Patients&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;Site Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Site Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Patients&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get Protocol IDs and Total Patients </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Site Name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Total Patients&quot;</span><span class="p">)</span>

        <span class="c1"># Median age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;Median patient age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">AGE</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median patient age&#39;</span><span class="p">})[</span><span class="s1">&#39;Median patient age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (ISch) (1)</span>
        <span class="n">isch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">isch</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 2, 3, 5)</span>
        <span class="n">is_ich_tia_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich_tia_cvt</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), or cerebral venous thrombosis (CVT) (1, 2, 5)</span>
        <span class="n">is_ich_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich_cvt</span><span class="p">)</span>
        <span class="c1"># Get dataframe with patients who had ischemic stroke (IS) or intracerebral hemorrhage (ICH)</span>
        <span class="n">is_ich</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich</span><span class="p">)</span>
        <span class="c1"># get patietns with ischemic stroke (IS) and transient ischemic attack (TIA) (1, 3)</span>
        <span class="n">is_tia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_tia</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), subarrachnoid hemorrhage (SAH) or cerebral venous thrombosis (CVT) (1, 2, 4, 5)</span>
        <span class="n">is_ich_sah_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich_sah_cvt</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 3, 5)</span>
        <span class="n">is_tia_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_tia_cvt</span><span class="p">)</span>

        <span class="c1"># get patients with cerebral venous thrombosis (CVT) (5)</span>
        <span class="n">cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">cvt</span><span class="p">)</span>

        <span class="c1"># get patietns with intracerebral hemorrhage (ICH) and subarrachnoid hemorrhage (SAH) (2, 4)</span>
        <span class="n">ich_sah</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ich_sah</span><span class="p">)</span>
        
        <span class="c1"># get patietns with intracerebral hemorrhage (ICH) (2)</span>
        <span class="n">ich</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ich</span><span class="p">)</span>

        <span class="c1"># get patietns with subarrachnoid hemorrhage (SAH) (4)</span>
        <span class="n">sah</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">sah</span><span class="p">)</span>

        <span class="c1"># create subset with no referrals (RECANALIZATION_PROCEDURE != [5,6]) AND (HEMICRANIECTOMY != 3)</span>
        <span class="n">discharge_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">discharge_subset</span><span class="p">)</span>

        <span class="c1"># Create discharge subset alive</span>
        <span class="n">discharge_subset_alive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">discharge_subset_alive</span><span class="p">)</span>


        <span class="c1">##########</span>
        <span class="c1"># GENDER #</span>
        <span class="c1">##########</span>
        <span class="c1"># Get gender calculation in one table </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;GENDER&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get female patients </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;GENDER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients female&#39;</span><span class="p">)</span>

        <span class="c1"># Get only female patients in % out of total patients. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients female&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients female&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get male patients </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;GENDER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients male&#39;</span><span class="p">)</span>

        <span class="c1"># Get % of male patients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients male&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients male&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% patients female&#39;] + self.statsDf[&#39;% patients male&#39;] </span>
        <span class="c1">#self.statsDf[&#39;% patients female&#39;] = self.statsDf.apply(lambda x: x[&#39;% patients female&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% patients female&#39;], axis=1)</span>

        <span class="c1"># Drop tmp column </span>
        <span class="c1">#self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)</span>

        <span class="c1">###################</span>
        <span class="c1"># HOSPITALIZED IN #</span>
        <span class="c1">###################</span>
        <span class="c1"># Get hospitalized in one table </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;HOSPITALIZED_IN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients hospitalized in stroke unit / ICU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITALIZED_IN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients hospitalized in stroke unit / ICU&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients hospitalized in stroke unit / ICU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


        <span class="c1"># Get patients hospitalized in monitored bed with telemetry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITALIZED_IN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients hospitalized in monitored bed with telemetry&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients hospitalized in monitored bed with telemetry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in monitored bed with telemetry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in monitored bed with telemetry&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients hospitalized in standard bed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITALIZED_IN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients hospitalized in standard bed&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients hospitalized in standard bed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in standard bed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in standard bed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Check if sum of % is &gt; 100 (100.01)</span>
        <span class="c1">#self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] + self.statsDf[&#39;% patients hospitalized in monitored bed with telemetry&#39;] + self.statsDf[&#39;% patients hospitalized in standard bed&#39;]</span>
        <span class="c1">#self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] = self.statsDf.apply(lambda x: x[&#39;% patients hospitalized in stroke unit / ICU&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% patients hospitalized in stroke unit / ICU&#39;], axis=1)</span>

        <span class="c1"># Drop tmp column </span>
        <span class="c1">#self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)</span>

        <span class="c1">###############</span>
        <span class="c1"># STROKE TYPE #</span>
        <span class="c1">###############</span>
        <span class="c1"># Get stroke type in one table </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get stroke type - ischemic stroke</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - ischemic stroke&#39;</span><span class="p">)</span>

        <span class="c1"># Get % stroke type - ischemic stroke</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - ischemic stroke&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - ischemic stroke&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get stroke type - intracerebral hemorrhage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - intracerebral hemorrhage&#39;</span><span class="p">)</span>

        <span class="c1"># Get % stroke type - intracerebral hemorrhage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - intracerebral hemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - intracerebral hemorrhage&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get stroke type - transient ischemic attack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - transient ischemic attack&#39;</span><span class="p">)</span>

        <span class="c1"># Get % stroke type - transient ischemic attack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - transient ischemic attack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - transient ischemic attack&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get stroke type - subarrachnoid hemorrhage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - subarrachnoid hemorrhage&#39;</span><span class="p">)</span>

        <span class="c1"># Get % stroke type - subarrachnoid hemorrhage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - subarrachnoid hemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - subarrachnoid hemorrhage&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get stroke type - cerebral venous thrombosis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - cerebral venous thrombosis&#39;</span><span class="p">)</span>

        <span class="c1"># Get % stroke type - cerebral venous thrombosis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - cerebral venous thrombosis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - cerebral venous thrombosis&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get stroke type - undetermined stroke</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - undetermined stroke&#39;</span><span class="p">)</span>

        <span class="c1"># Get % stroke type - undetermined stroke</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - undetermined stroke&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - undetermined stroke&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########</span>
        <span class="c1"># NIHSS #</span>
        <span class="c1">#########</span>
        <span class="c1"># Get Median of NIHSS score</span>
        <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">is_ich_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">NIHSS_SCORE</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;NIHSS median score&#39;</span><span class="p">})</span>
        <span class="c1">#self.statsDf[&#39;NIHSS median score&#39;] = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})[&#39;NIHSS median score&#39;].tolist()</span>
        <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;NIHSS median score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">factorDf</span><span class="p">[</span><span class="s1">&#39;NIHSS median score&#39;</span><span class="p">]</span>

        <span class="c1">##########</span>
        <span class="c1"># CT/MRI #</span>
        <span class="c1">##########</span>
        <span class="c1"># Get CT/MRI in one table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich_tia_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_MRI&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients CT/MRI not performed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_MRI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - In other hospital&#39;</span><span class="p">)</span>

        <span class="c1"># Get % CT/MRI Not performed	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - In other hospital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - In other hospital&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>        

        <span class="c1"># Get patients CT/MRI performed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_MRI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">)</span>

        <span class="c1"># Get % CT/MRI performed	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - In other hospital&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - In other hospital&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients CT/MRI not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_MRI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - Not performed&#39;</span><span class="p">)</span>

        <span class="c1"># Get % CT/MRI not known	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - Not performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - Not performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - In other hospital&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - In other hospital&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="c1"># Get CT/MRI performed subset</span>
        <span class="n">ct_mri</span> <span class="o">=</span> <span class="n">is_ich_tia_cvt</span><span class="p">[</span><span class="n">is_ich_tia_cvt</span><span class="p">[</span><span class="s1">&#39;CT_MRI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>

        <span class="c1"># Get CT/MRI time in one table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">ct_mri</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_TIME&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1">#print(self.tmp)</span>

        <span class="c1"># Get patients CT/MRI within first hour after admission</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - Performed within 1 hour after admission&#39;</span><span class="p">)</span>

        <span class="c1"># Get % CT/MRI within first hour after admission	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - Performed within 1 hour after admission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - Performed within 1 hour after admission&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients CT/MRI within first hour after admission</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">)</span>

        <span class="c1"># Get % CT/MRI within first hour after admission	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        

        <span class="c1">#############################</span>
        <span class="c1"># RECANALIZATION PROCEDURES #</span>
        <span class="c1">#############################</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="n">isch</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">400</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">groin</span> <span class="o">=</span> <span class="n">isch</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;DOOR_TO_GROIN&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;DOOR_TO_GROIN&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">700</span><span class="p">))]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#indexes = isch.loc[((isch[&#39;DOOR_TO_NEEDLE&#39;] &lt; 0) &amp; (isch[&#39;DOOR_TO_NEEDLE&#39;] &gt; 400)) | ((isch[&#39;DOOR_TO_NEEDLE&#39;] == 0) &amp; (isch[&#39;DOOR_TO_GROIN&#39;] &lt; 0) &amp; (isch[&#39;DOOR_TO_GROIN&#39;] &gt; 700))].copy()</span>
        <span class="n">number_of_patients</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">needle</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">groin</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="c1">#print(&#39;Number of patients removed: {0}.&#39;.format(number_of_patients))</span>
        <span class="n">recan_tmp</span> <span class="o">=</span> <span class="n">isch</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">needle</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">recan_tmp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">groin</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">recan_tmp</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;recan_tmp.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">recan_tmp</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients recanalization procedures - Not done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Not done&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - Not done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Not done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Not done&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - IV tPa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - IV tPa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - IV tPa + endovascular treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - IV tPa + endovascular treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - Endovascular treatment alone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - Endovascular treatment alone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - IV tPa + referred to another centre for endovascular treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - IV tPa + referred to another centre for endovascular treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - Referred to another centre for endovascular treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - Referred to another centre for endovascular treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients recanalized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients recanalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients recanalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients recanalized&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="c1">##############</span>
        <span class="c1"># MEDIAN DTN #</span>
        <span class="c1">##############</span>
        <span class="c1"># Get patients receiving IV tpa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# IV tPa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients receiving IV tpa %</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% IV tPa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# IV tPa&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get only patients recanalized</span>
       <span class="c1"># recanalization_procedure_iv_tpa = isch.loc[(isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([2, 3, 5])) &amp; (isch[&#39;DOOR_TO_NEEDLE&#39;] &gt; 0) &amp; (isch[&#39;DOOR_TO_NEEDLE&#39;] &lt;= 400)]</span>
        <span class="n">recanalization_procedure_iv_tpa</span> <span class="o">=</span> <span class="n">isch</span><span class="p">[</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Replace NA values by 0</span>
        <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;DOOR_TO_NEEDLE&#39;</span><span class="p">]</span>
        <span class="c1">#print(recanalization_procedure_iv_tpa[&#39;IVTPA&#39;].tolist())</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">IVTPA</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median DTN (minutes)&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1">#print(tmp)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#self.statsDf = self.statsDf.merge(interval_vals_df, how=&#39;outer&#39;)</span>
        
        <span class="c1">##############</span>
        <span class="c1"># MEDIAN DTG #</span>
        <span class="c1">##############</span>
        <span class="c1"># Get patients receiving TBY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients receiving TBY %</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# TBY&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="c1"># Get only patients recanalized TBY</span>
        <span class="n">recanalization_procedure_tby_dtg</span> <span class="o">=</span> <span class="n">isch</span><span class="p">[</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#recanalization_procedure_tby_dtg = isch.loc[(isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3])) &amp; (isch[&#39;DOOR_TO_GROIN&#39;] &gt; 0) &amp; (isch[&#39;DOOR_TO_GROIN&#39;] &lt;= 700)]</span>
        <span class="n">recanalization_procedure_tby_dtg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get IVTPA in minutes</span>
        <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;DOOR_TO_GROIN&#39;</span><span class="p">]</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">TBY</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median DTG (minutes)&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1">#print(tmp)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#######################</span>
        <span class="c1"># DYPSHAGIA SCREENING #</span>
        <span class="c1">#######################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DYSPHAGIA_SCREENING&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients dysphagia screening - not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening - not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients dysphagia screening - Guss test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening - Guss test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients dysphagia screening - Other test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening - Other test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Other test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients dysphagia screening - Another centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening - Another centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients dysphagia screening - Not done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening - Not done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Not done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients dysphagia screening - Unable to test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Unable to test&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening - Unable to test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Unable to test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Unable to test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">############################</span>
        <span class="c1"># DYPSHAGIA SCREENING TIME #</span>
        <span class="c1">############################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DYSPHAGIA_SCREENING_TIME&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients dysphagia screening time - Within first 24 hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">)</span>

        <span class="c1"># Get patients dysphagia screening time - After first 24 hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening time - Within first 24 hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get % patients dysphagia screening time - After first 24 hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening time - After first 24 hours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">########</span>
        <span class="c1"># AFIB #</span>
        <span class="c1">########</span>
        <span class="c1"># patients not reffered </span>
        <span class="n">not_reffered</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="o">~</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">7</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;not_reffered_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">not_reffered</span><span class="p">)</span>

        <span class="c1"># patients referred to another hospital</span>
        <span class="n">reffered</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">7</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">reffered</span><span class="p">)</span>

        <span class="c1"># </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">not_reffered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients afib/flutter - Known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Known&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients afib/flutter - Known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

        <span class="c1"># Get patients afib/flutter - Newly-detected at admission</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Newly-detected at admission&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients afib/flutter - Newly-detected at admission</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Newly-detected at admission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Newly-detected at admission&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

        <span class="c1"># Get patients afib/flutter - Detected during hospitalization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Detected during hospitalization&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients afib/flutter - Detected during hospitalization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Detected during hospitalization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Detected during hospitalization&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="c1"># Get patients afib/flutter - Not detected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Not detected&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients afib/flutter - Not detected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Not detected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Not detected&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients afib/flutter - Not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Not known&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients afib/flutter - Not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">############################</span>
        <span class="c1"># CAROTID ARTERIES IMAGING #</span>
        <span class="c1">############################</span>
        <span class="c1"># </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_tia</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CAROTID_ARTERIES_IMAGING&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients carotid arteries imaging - Not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_ARTERIES_IMAGING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients carotid arteries imaging - Not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients carotid arteries imaging - Yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_ARTERIES_IMAGING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid arteries imaging - Yes&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients carotid arteries imaging - Yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients carotid arteries imaging - No</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_ARTERIES_IMAGING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid arteries imaging - No&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients carotid arteries imaging - No</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

       
        <span class="c1">###############################</span>
        <span class="c1"># ANTITHROMBOTICS WITHOUT CVT #</span>
        <span class="c1">###############################</span>
        <span class="c1"># Get patients with prescribed antithrombotics</span>
        <span class="k">def</span> <span class="nf">get_antithrombotics</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
            <span class="n">set_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">set_vals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">set_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">set_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>      

           <span class="c1"># print(set_vals, res)</span>
            <span class="k">return</span> <span class="n">res</span>


       <span class="c1"># is_tia[&#39;ANTITHROMBOTICS&#39;] = is_tia.apply(lambda x:  (x[&#39;UKON_WARFARIN&#39;] == 2 and x[&#39;UKON_DABIGATRAN&#39;] == 2 and x[&#39;UKON_RIVAROXABAN&#39;] == 2 and x[&#39;UKON_APIXABAN&#39;] == 2  and x[&#39;UKON_EDOXABAN&#39;] == 2 and x[&#39;UKON_LMW&#39;] == 2 and x[&#39;UKON_ANTIKOAGULANCIA&#39;] == 2  and x[&#39;UKON_HEPARIN_VTE&#39;] == 2 and x[&#39;UKON_ASA&#39;] == 2 and x[&#39;UKON_CLOPIDOGREL&#39;] == 2) else 1, axis=1)</span>

        <span class="n">is_tia</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_tia</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_antithrombotics</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_WARFARIN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_DABIGATRAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_RIVAROXABAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_APIXABAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_EDOXABAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_LMW&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_ANTIKOAGULANCIA&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_HEPARIN_VTE&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_ASA&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_CLOPIDOGREL&#39;</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#print(is_tia[&#39;ANTITHROMBOTICS&#39;])</span>

        <span class="c1"># filter not dead patient with ischemic and transient CMP</span>
        <span class="n">antithrombotics</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="o">~</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># calculate antithrombotics df patients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;antithrombotics_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">antithrombotics</span><span class="p">)</span>
        <span class="c1"># Filter dead patients with ischemic and transient CMP</span>
        <span class="n">ischemic_transient_dead</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Count patients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ischemic_transient_dead</span><span class="p">)</span>

        <span class="n">ischemic_transient_dead_prescribed</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients_prescribed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ischemic_transient_dead_prescribed</span><span class="p">)</span>
        

        <span class="c1"># Calculate antiplatelets (ASA and clopidogrel)</span>
        <span class="n">antithrombotics</span><span class="p">[</span><span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_ASA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_CLOPIDOGREL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients receiving antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIPLATELETS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving antiplatelets&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_WARFARIN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving Vit. K antagonist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_WARFARIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving Vit. K antagonist</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_DABIGATRAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving dabigatran</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_DABIGATRAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving dabigatran</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving dabigatran&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_RIVAROXABAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving rivaroxaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_RIVAROXABAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving rivaroxaban</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving rivaroxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_APIXABAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving apixaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_APIXABAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving apixaban</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving apixaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_EDOXABAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving edoxaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_EDOXABAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving edoxaban</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving edoxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_HEPARIN_VTE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving LMWH or heparin in prophylactic dose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_HEPARIN_VTE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving LMWH or heparin in prophylactic dose</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="n">antithrombotics</span><span class="p">[</span><span class="s1">&#39;UKON_LMW_ANTICOAGULACNI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_LMW&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_ANTIKOAGULANCIA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_LMW_ANTICOAGULACNI&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving LMWH or heparin in full anticoagulant dose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_LMW_ANTICOAGULACNI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving LMWH or heparin in full anticoagulant dose</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>
        
        <span class="c1"># Get patients not prescribed antithrombotics, but recommended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#self.statsDf = self._get_values_for_factors(column_name=&quot;ANTITHROMBOTICS&quot;, value=9, new_column_name=&#39;# patients not prescribed antithrombotics, but recommended&#39;)</span>

        <span class="c1"># Get % patients not prescribed antithrombotics, but recommended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients not prescribed antithrombotics, but recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients neither receiving antithrombotics nor recommended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients neither receiving antithrombotics nor recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#self.statsDf = self._get_values_for_factors(column_name=&quot;ANTITHROMBOTICS&quot;, value=10, new_column_name=&#39;# patients neither receiving antithrombotics nor recommended&#39;)</span>

        <span class="c1"># Get % patients neither receiving antithrombotics nor recommended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients neither receiving antithrombotics nor recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients neither receiving antithrombotics nor recommended&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">## ANTITHROMBOTICS - PATIENTS PRESCRIBED + RECOMMENDED</span>
        <span class="c1"># patients prescribed antithrombotics</span>
        <span class="c1">#self.statsDf.loc[:, &#39;# patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets&#39;] + x[&#39;# patients receiving Vit. K antagonist&#39;] + x[&#39;# patients receiving dabigatran&#39;] + x[&#39;# patients receiving rivaroxaban&#39;] + x[&#39;# patients receiving apixaban&#39;] + x[&#39;# patients receiving edoxaban&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;], axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients receiving antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed antithrombotics&#39;</span><span class="p">)</span>


        <span class="c1"># Get % patients prescribed antithrombotics</span>
        <span class="c1">#self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antithrombotics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="c1">#  patients prescribed or recommended antithrombotics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed or recommended antithrombotics&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients prescribed or recommended antithrombotics</span>
        <span class="c1"># From patients prescribed or recommended antithrombotics remove patient who had prescribed antithrombotics and were dead (nominator)</span>
        <span class="c1">#self.statsDf[&#39;% patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics&#39;] - x[&#39;ischemic_transient_dead_patients_prescribed&#39;])/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100, 2) if ((x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0) else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed or recommended antithrombotics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed or recommended antithrombotics&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients_prescribed&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">#.round(decimals=2)) </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">,</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">###########################################</span>
        <span class="c1"># ANTIPLATELETS - PRESCRIBED WITHOUT AFIB #</span>
        <span class="c1">###########################################</span>
        <span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_tia</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_antithrombotics</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_ASA&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_CLOPIDOGREL&#39;</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    
    
        <span class="c1"># patients not referred</span>
        <span class="n">afib_flutter_not_detected_or_not_known</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">)</span>

        <span class="n">afib_flutter_not_detected_or_not_known_dead</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_not_detected_or_not_known_dead</span><span class="p">)</span>

        <span class="n">prescribed_antiplatelets_no_afib</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">prescribed_antiplatelets_no_afib</span><span class="p">)</span>

        <span class="n">prescribed_antiplatelets_no_afib_dead</span> <span class="o">=</span> <span class="n">prescribed_antiplatelets_no_afib</span><span class="p">[</span><span class="n">prescribed_antiplatelets_no_afib</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">prescribed_antiplatelets_no_afib_dead</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="c1"># Get patients receiving antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIPLATELETS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed antiplatelets without aFib&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antiplatelets without aFib&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antiplatelets without aFib&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########################################</span>
        <span class="c1"># ANTICOAGULANTS - PRESCRIBED WITH AFIB #</span>
        <span class="c1">#########################################</span>
    
        <span class="c1"># patients not referred </span>
        <span class="n">afib_flutter_detected</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected</span><span class="p">)</span>

         <span class="c1"># Get patients with prescribed anticoagulants</span>
        <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTICOAGULANTS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_antithrombotics</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_WARFARIN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_DABIGATRAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_RIVAROXABAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_APIXABAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_EDOXABAN&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_LMW&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_ANTIKOAGULANCIA&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_HEPARIN_VTE&#39;</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">afib_flutter_detected_not_dead</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected_not_dead</span><span class="p">)</span>

        <span class="n">anticoagulants_prescribed</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTICOAGULANTS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients prescribed anticoagulants with aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_WARFARIN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Additional calculation </span>
        <span class="c1"># Get patients receiving Vit. K antagonist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_WARFARIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving Vit. K antagonist</span>
        <span class="c1">#self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/x[&#39;# patients prescribed anticoagulants with aFib&#39;]) * 100), 2) if x[&#39;# patients prescribed anticoagulants with aFib&#39;] &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving Vit. K antagonist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_DABIGATRAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving dabigatran</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_DABIGATRAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving dabigatran</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving dabigatran&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_RIVAROXABAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving rivaroxaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_RIVAROXABAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving rivaroxaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving rivaroxaban&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_APIXABAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving apixaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_APIXABAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving apixaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving apixaban&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_EDOXABAN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving edoxaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_EDOXABAN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving edoxaban</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving edoxaban&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_HEPARIN_VTE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving LMWH or heparin in prophylactic dose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_HEPARIN_VTE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving LMWH or heparin in prophylactic dose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="s1">&#39;UKON_LMW_ANTICOAGULACNI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_LMW&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;UKON_ANTIKOAGULANCIA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;UKON_LMW_ANTICOAGULACNI&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients receiving LMWH or heparin in full anticoagulant dose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;UKON_LMW_ANTICOAGULACNI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving LMWH or heparin in full anticoagulant dose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="c1">#anticoagulants_recommended = afib_flutter_detected[afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9])].copy()</span>
        <span class="c1">#self.statsDf[&#39;anticoagulants_recommended_patients&#39;] = self._count_patients(dataframe=anticoagulants_recommended)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;anticoagulants_recommended_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">afib_flutter_detected_dead</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected_dead</span><span class="p">)</span>

        <span class="c1"># Get % patients receiving antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed anticoagulants with aFib&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed anticoagulants with aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">##########################################</span>
        <span class="c1"># ANTITHROMBOTICS - PRESCRIBED WITH AFIB #</span>
        <span class="c1">##########################################</span>
        <span class="c1"># patients not reffered </span>
        <span class="n">antithrombotics_prescribed</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics with aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">antithrombotics_prescribed</span><span class="p">)</span>

        <span class="c1">#recommended_antithrombotics_with_afib_alive = afib_flutter_detected[afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9]) &amp; ~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()</span>
        <span class="c1">#self.statsDf[&#39;recommended_antithrombotics_with_afib_alive_patients&#39;] = self._count_patients(dataframe=recommended_antithrombotics_with_afib_alive)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Get % patients receiving antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antithrombotics with aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics with aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">###########</span>
        <span class="c1"># STATINS #</span>
        <span class="c1">###########</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_tia</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;STATIN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get patients prescribed statins - Yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - Yes&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients prescribed statins - Yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients prescribed statins - No</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - No&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients prescribed statins - No</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get patients prescribed statins - Not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - Not known&#39;</span><span class="p">)</span>

        <span class="c1"># Get % patients prescribed statins - Not known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########################</span>
        <span class="c1"># DISCHARGE DESTINATION #</span>
        <span class="c1">#########################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get discharge destination - Home</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Home&#39;</span><span class="p">)</span>

        <span class="c1"># Get % discharge destination - Home</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Home&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get discharge destination - Transferred within the same centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Transferred within the same centre&#39;</span><span class="p">)</span>

        <span class="c1"># Get % discharge destination - Transferred within the same centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Transferred within the same centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Transferred within the same centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get discharge destination - Transferred to another centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Transferred to another centre&#39;</span><span class="p">)</span>

        <span class="c1"># Get % discharge destination - Transferred to another centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Transferred to another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Transferred to another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get discharge destination - Social care facility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Social care facility&#39;</span><span class="p">)</span>

        <span class="c1"># Get % discharge destination - Social care facility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Social care facility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Social care facility&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get discharge destination - Dead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Dead&#39;</span><span class="p">)</span>

        <span class="c1"># Get % discharge destination - Dead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Dead&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Dead&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#######################################</span>
        <span class="c1"># DISCHARGE DESTINATION - SAME CENTRE #</span>
        <span class="c1">#######################################</span>
        <span class="n">discharge_subset_same_centre</span> <span class="o">=</span> <span class="n">discharge_subset</span><span class="p">[</span><span class="n">discharge_subset</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">discharge_subset_same_centre</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset_same_centre</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_SAME_FACILITY&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Get transferred within the same centre - Acute rehabilitation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_SAME_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred within the same centre - Acute rehabilitation&#39;</span><span class="p">)</span>

        <span class="c1"># Get % transferred within the same centre - Acute rehabilitation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred within the same centre - Acute rehabilitation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred within the same centre - Acute rehabilitation&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get transferred within the same centre - Post-care bed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_SAME_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred within the same centre - Post-care bed&#39;</span><span class="p">)</span>

        <span class="c1"># Get % transferred within the same centre - Post-care bed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred within the same centre - Post-care bed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred within the same centre - Post-care bed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get transferred within the same centre - Another department</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_SAME_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred within the same centre - Another department&#39;</span><span class="p">)</span>

        <span class="c1"># Get % transferred within the same centre - Another department</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred within the same centre - Another department&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred within the same centre - Another department&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">################</span>
        <span class="c1"># ANGEL AWARDS #</span>
        <span class="c1">################</span>
        <span class="c1">#### TOTAL PATIENTS #####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# total patients &gt;= 30&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">30</span>

        <span class="c1">#### DOOR TO THROMBOLYSIS THERAPY - MINUTES ####</span>
        <span class="c1">#self.statsDf.loc[:, &#39;patients_eligible_recanalization&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Not done&#39;] + x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;], axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#self.statsDf.loc[:, &#39;patients_eligible_recanalization&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;], axis=1)</span>

        <span class="c1"># patients treated with door to recanalization therapy &lt; 60 minutes</span>
        <span class="c1"># for tby, we are only looking at patients that have had ONLY tby, not tpa + tby, as we awould be counting those patients twice (penalizing twice)</span>
        <span class="n">recanalization_procedure_tby_only_dtg</span> <span class="o">=</span>  <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">])]</span>

        <span class="n">recanalization_procedure_iv_tpa_under_60</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)]</span>
        <span class="c1">#recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 60]</span>
        <span class="c1">#recanalization_procedure_iv_tpa_under_60 = recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt; 60]</span>

        <span class="n">recanalization_procedure_tby_only_dtg_under_60</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_only_dtg</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)]</span>
        <span class="c1">#recanalization_procedure_tby_only_dtg_under_60 = recanalization_procedure_tby_only_dtg[recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &lt;= 60]</span>
        <span class="c1">#recanalization_procedure_tby_only_dtg_under_60 = recanalization_procedure_tby_only_dtg[recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &lt; 60]</span>
        
        <span class="c1"># patients treated with door to recanalization therapy &lt; 60 minutes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to recanalization therapy &lt; 60 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_iv_tpa_under_60</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_tby_only_dtg_under_60</span><span class="p">)</span>
        <span class="c1">#self.statsDf[&#39;# patients treated with door to recanalization therapy &lt; 60 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_iv_tpa_under_60)</span>


        <span class="c1"># % patients treated with door to recanalization therapy &lt; 60 minutes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to recanalization therapy &lt; 60 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to recanalization therapy &lt; 60 minutes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">recanalization_procedure_iv_tpa_under_45</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">45</span><span class="p">)]</span>
        <span class="c1">#recanalization_procedure_iv_tpa_under_45 = recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 45]</span>
        <span class="n">recanalization_procedure_tby_only_dtg_under_45</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_only_dtg</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">45</span><span class="p">)]</span>
        <span class="c1">#recanalization_procedure_tby_only_dtg_under_45 = recanalization_procedure_tby_only_dtg[recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &lt;= 45]</span>

        <span class="c1"># patients treated with door to recanalization therapy &lt; 45 minutes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to recanalization therapy &lt; 45 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_iv_tpa_under_45</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_tby_only_dtg_under_45</span><span class="p">)</span>
        <span class="c1">#self.statsDf[&#39;# patients treated with door to recanalization therapy &lt; 45 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_iv_tpa_under_45)</span>

        <span class="c1"># % patients treated with door to recanalization therapy &lt; 45 minutes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to recanalization therapy &lt; 45 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to recanalization therapy &lt; 45 minutes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get % patients recanalized</span>
        <span class="c1">#self.statsDf[&#39;patient_recan_%&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;patients_eligible_recanalization&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Endovascular treatment alone&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]) &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;patient_recan_%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### RECANALIZATION RATE ####</span>
        <span class="c1"># recanalization rate out of total ischemic incidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# recanalization rate out of total ischemic incidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">]</span>

        <span class="c1"># % recanalization rate out of total ischemic incidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization rate out of total ischemic incidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;patient_recan_%&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;patient_recan_%&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### CT/MRI ####</span>
        <span class="c1"># suspected stroke patients undergoing CT/MRI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# suspected stroke patients undergoing CT/MRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span>

        <span class="c1"># % suspected stroke patients undergoing CT/MRI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">uspected stroke patients undergoing CT/MRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - performed&#39;</span><span class="p">]</span>

        <span class="c1">#### DYSPHAGIA SCREENING ####</span>
        <span class="c1"># all stroke patients undergoing dysphagia screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span>

        <span class="c1"># % all stroke patients undergoing dysphagia screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### ISCHEMIC STROKE + NO AFIB + ANTIPLATELETS ####</span>
        <span class="n">non_transferred_antiplatelets</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="p">[</span><span class="o">~</span><span class="n">antithrombotics</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])]</span>
        <span class="c1">#antithrombotics_discharged_home = antithrombotics[antithrombotics[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]</span>
        <span class="c1"># Get temporary dataframe with patients who have prescribed antithrombotics and ischemic stroke</span>
        <span class="n">antiplatelets</span> <span class="o">=</span> <span class="n">non_transferred_antiplatelets</span><span class="p">[</span><span class="n">non_transferred_antiplatelets</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1">#antiplatelets = antithrombotics[antithrombotics[&#39;STROKE_TYPE&#39;].isin([1])]</span>
        <span class="c1">#antiplatelets = antithrombotics_discharged_home[antithrombotics_discharged_home[&#39;STROKE_TYPE&#39;].isin([1])]</span>
        <span class="c1"># Filter temporary dataframe and get only patients who have not been detected or not known for aFib flutter. </span>
        <span class="n">antiplatelets</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="p">[</span><span class="n">antiplatelets</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="c1"># Get patients who have prescribed antithrombotics </span>
        <span class="n">except_recommended</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="p">[</span><span class="n">antiplatelets</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])]</span>

        <span class="c1"># Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">except_recommended</span><span class="p">)</span>
        <span class="c1"># Get temporary dataframe groupby protocol ID and antithrombotics column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># ischemic stroke patients discharged with antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIPLATELETS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">)</span>
        <span class="c1"># % ischemic stroke patients discharged with antiplatelets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># discharged home</span>
        <span class="n">antiplatelets_discharged_home</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="p">[</span><span class="n">antiplatelets</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">antiplatelets_discharged_home</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
            <span class="c1"># Get temporary dataframe groupby protocol ID and antithrombotics column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="c1"># ischemic stroke patients discharged with antiplatelets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIPLATELETS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">)</span>
            <span class="c1"># % ischemic stroke patients discharged with antiplatelets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get temporary dataframe groupby protocol ID and antithrombotics column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antiplatelets_discharged_home</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIPLATELETS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="c1"># Get patients who have prescribed antithrombotics </span>
            <span class="n">except_recommended_discharged_home</span> <span class="o">=</span> <span class="n">except_recommended</span><span class="p">[</span><span class="n">except_recommended</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>

            <span class="c1"># Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">except_recommended_discharged_home</span><span class="p">)</span>
            <span class="c1"># ischemic stroke patients discharged with antiplatelets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIPLATELETS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">)</span>
            <span class="c1"># % ischemic stroke patients discharged with antiplatelets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged (home) with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged (home) with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># afib patients discharged with anticoagulants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed</span><span class="p">)</span>
        <span class="c1"># Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics </span>
        <span class="c1">#afib_detected_discharged_home = afib_flutter_detected[(~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])) &amp; (afib_flutter_detected[&#39;ANTICOAGULANTS&#39;].isin([1]))]</span>
        <span class="n">afib_detected_discharged_home</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTICOAGULANTS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))]</span>
        <span class="c1"># Get afib patients discharged and not dead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_discharged_home</span><span class="p">)</span>
        <span class="c1"># % afib patients discharged with anticoagulants	</span>
        <span class="c1">#self.statsDf[&#39;% afib patients discharged with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged with anticoagulants&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged with anticoagulants&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Get temporary dataframe with patients who have prescribed anticoagulats and were discharged home </span>
        <span class="n">non_trasferred_anticoagulants</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="o">~</span><span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])]</span>
        <span class="n">anticoagulants_prescribed_discharged_home</span> <span class="o">=</span> <span class="n">non_trasferred_anticoagulants</span><span class="p">[</span><span class="n">non_trasferred_anticoagulants</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1">#anticoagulants_prescribed_discharged_home = anticoagulants_prescribed[anticoagulants_prescribed[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]</span>
        <span class="c1"># Get temporary dataframe with patients who have been discharge at home with detected aFib flutter and with prescribed antithrombotics</span>
        <span class="c1">#afib_detected_discharged_home = afib_flutter_detected[(afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([1])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9]))]</span>
        <span class="n">afib_detected_discharged_home</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[(</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTICOAGULANTS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]))]</span>

        <span class="c1"># Check if temporary dataframe is empty. If yes, the value is calculated not only for discharged home, but only dead patients are excluded</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">anticoagulants_prescribed_discharged_home</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
            <span class="c1"># afib patients discharged home with anticoagulants	</span>
            <span class="n">anticoagulants_prescribed_discharged_home</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="o">~</span><span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span>
            <span class="c1"># Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics </span>
            <span class="n">afib_detected_discharged_home</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTICOAGULANTS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))]</span>
            <span class="c1"># Get # afib patients discharged home with anticoagulants</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed_discharged_home</span><span class="p">)</span>
            <span class="c1"># Get afib patients discharged and not dead</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_discharged_home</span><span class="p">)</span>
            <span class="c1"># Get % afib patients discharge with anticoagulants and not dead</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get # afib patients discharged home with anticoagulants	</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed_discharged_home</span><span class="p">)</span>
            <span class="c1"># Get afib patients discharged home </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_discharged_home</span><span class="p">)</span>
            <span class="c1"># Get % afib patients discharged home with anticoagulants</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged (home) with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged (home) with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### STROKE UNIT ####</span>
        <span class="c1"># stroke patients treated in a dedicated stroke unit / ICU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# stroke patients treated in a dedicated stroke unit / ICU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span>

        <span class="c1"># % stroke patients treated in a dedicated stroke unit / ICU	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke patients treated in a dedicated stroke unit / ICU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span>

        <span class="c1"># % stroke patients treated in a dedicated stroke unit / ICU (2nd)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke patients treated in a dedicated stroke unit / ICU (2nd)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Protocol ID&quot;</span><span class="p">:</span> <span class="s2">&quot;Site ID&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save results into .csv</span>
        <span class="c1">#self.statsDf.to_csv(&#39;slovakia_results.csv&#39;, sep=&#39;,&#39;, index=False)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sites</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">)</span>    

    <span class="k">def</span> <span class="nf">_count_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the column with number of patients group by Protocol ID. </span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">            dataframe (dataframe): The dataframe with raw data. </span>

<span class="sd">        Returns:</span>
<span class="sd">            dataframe (dataframe): The column with number of patients. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count_patients&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span><span class="p">[</span><span class="s1">&#39;count_patients&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_values_only_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the column with number of patients group by Protocol ID. </span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">            column_name (string): The name of column for which we are want calculate number of patients. </span>
<span class="sd">            dataframe (dataframe): The dataframe with raw data. </span>
<span class="sd">            value (int): The integers value represents specific value from the dataframe[column_name]. </span>

<span class="sd">        Returns:</span>
<span class="sd">            dataframe (dataframe): The column with number of patients. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">dataframe</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
        <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_values_for_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the column with number of patients group by Protocol ID. </span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">            column_name (str): The name of column for which we are want calculate number of patients. </span>
<span class="sd">            value (int): The integers value represents specific value from the dataframe[column_name]. </span>
<span class="sd">            new_column_name (str): The name of new column name. </span>

<span class="sd">        Returns:</span>
<span class="sd">            dataframe (dataframe): The statsDf to which new created column was appended. </span>
<span class="sd">        &quot;&quot;&quot;</span>		
        <span class="c1">#if df is None:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="n">tmpDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
        <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        else:</span>
<span class="sd">            if (df[column_name].dtype != np.number):</span>
<span class="sd">                value = str(value)</span>
<span class="sd">            else:</span>
<span class="sd">                value = value </span>

<span class="sd">            tmpDf = df[df[column_name] == value].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]</span>
<span class="sd">            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)</span>
<span class="sd">            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)</span>
<span class="sd">            factorDf.fillna(0, inplace=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">factorDf</span>

    <span class="k">def</span> <span class="nf">_get_values_for_factors_more_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the column with number of patients group by Protocol ID. </span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">            column_name (str): The name of column for which we are want calculate number of patients. </span>
<span class="sd">            value (list): The list of integers representing specific values from the dataframe[column_name]. </span>
<span class="sd">            new_column_name (str): The name of new column name. </span>

<span class="sd">        Returns:</span>
<span class="sd">            dataframe (dataframe): The statsDf to which new created column was appended. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span>

    <span class="k">def</span> <span class="nf">_get_values_for_factors_containing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the column with number of patients group by Protocol ID. </span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">            column_name (str): The name of column for which we are want calculate number of patients. </span>
<span class="sd">            value (str): The str of integers representing specific values from the dataframe[column_name]. </span>
<span class="sd">            new_column_name (str): The name of new column name. </span>

<span class="sd">        Returns:</span>
<span class="sd">            dataframe (dataframe): The statsDf to which new created column was appended. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span>

    <span class="k">def</span> <span class="nf">_get_ctmri_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hosp_time</span><span class="p">,</span> <span class="n">ct_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate differnce between two times. </span>

<span class="sd">        Args:</span>
<span class="sd">            hospital_time: The time of hospitalization</span>
<span class="sd">            ct_time: The time when CT has been perfrmed. </span>
<span class="sd">        Returns:</span>
<span class="sd">            The calculated difference in minutes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timeformat</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S&#39;</span>

        <span class="c1">#print(&#39;Hosp time: {0}/{1}, CT_TIME: {2}/{3}&#39;.format(hosp_time, type(hosp_time), ct_time, type(ct_time)))</span>
        <span class="c1"># print(ct_time, hosp_time)</span>
        <span class="c1"># Check if both time are not None if yes, return 0 else return tdelta</span>
        <span class="k">if</span> <span class="n">hosp_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ct_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">ct_time</span><span class="p">):</span>
            <span class="n">tdeltaMin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">hosp_time</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ct_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tdeltaMin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">ct_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">hosp_time</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">ct_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span>	
            <span class="n">tdeltaMin</span> <span class="o">=</span> <span class="n">tdelta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>

        <span class="k">if</span> <span class="n">tdeltaMin</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">tdeltaMin</span> <span class="o">&lt;=</span> <span class="mi">60</span> <span class="ow">and</span> <span class="n">tdeltaMin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">res</span>

    
    <span class="k">def</span> <span class="nf">_return_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the raw dataframe.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>

    <span class="k">def</span> <span class="nf">_return_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the dataframe with calculated statistics.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span>

    <span class="k">def</span> <span class="nf">_get_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return list of sites in the dataframes.&quot;&quot;&quot;</span>

        <span class="n">site_ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Site ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">siteSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">site_ids</span><span class="p">)</span>
        <span class="n">siteList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">siteSet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">siteList</span>

    <span class="k">def</span> <span class="nf">_return_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span>           </div>
                
<div class="viewcode-block" id="GenerateFormattedStats"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.CalculationSK.GenerateFormattedStats">[docs]</a><span class="k">class</span> <span class="nc">GenerateFormattedStats</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class generate formatted statistics in .xslx file. For angel awards are set colored conditions. </span>
<span class="sd">    </span>
<span class="sd">    Keyword arguments:</span>
<span class="sd">        df: the dataframe with statistcs</span>
<span class="sd">        country: True if country should be included as site (default: False)</span>
<span class="sd">        country_code: the code of country (default: None)</span>
<span class="sd">        split_sites: True if you want to generate individual file fo each site (default: False)</span>
<span class="sd">        site: the site code (default: None)</span>
<span class="sd">        report: the report name (default: None)</span>
<span class="sd">        quarter: the quarter name (default: None)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">country_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">split_sites</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_unformatted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="o">=</span> <span class="n">country_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="n">report</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">=</span> <span class="n">quarter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>

        <span class="k">def</span> <span class="nf">delete_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">i</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Drop tmp column </span>
        <span class="n">delete_columns</span><span class="p">([</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;is_ich_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;is_tia_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;cvt_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;ich_patients&#39;</span><span class="p">,</span>  <span class="s1">&#39;sah_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">,</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;not_reffered_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;reffered_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_not_detected_or_not_known_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;antithrombotics_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;prescribed_antiplatelets_no_afib_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;anticoagulants_recommended_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;patients_eligible_recanalization&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients having stroke in the hospital - No&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients having stroke in the hospital - No&#39;</span><span class="p">,</span> <span class="s1">&#39;# recurrent stroke - No&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecurrent stroke - No&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients assessed for rehabilitation - Not known&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients assessed for rehabilitation - Not known&#39;</span><span class="p">,</span> <span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% le</span><span class="s1">vel of consciousness - not known&#39;</span><span class="p">,</span> <span class="s1">&#39;# CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">,</span> <span class="s1">&#39;% CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients put on ventilator - Not known&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients put on ventilator - No&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients put on ventilator - No&#39;</span><span class="p">,</span> <span class="s1">&#39;# IV tPa&#39;</span><span class="p">,</span> <span class="s1">&#39;% IV tPa&#39;</span><span class="p">,</span> <span class="s1">&#39;# TBY&#39;</span><span class="p">,</span> <span class="s1">&#39;% TBY&#39;</span><span class="p">,</span> <span class="s1">&#39;# DIDO TBY&#39;</span><span class="p">,</span> <span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - not known&#39;</span><span class="p">,</span> <span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening time - After first 24 hours&#39;</span><span class="p">,</span> <span class="s1">&#39;# other afib detection method - Not detected or not known&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">ther afib detection method - Not detected or not known&#39;</span><span class="p">,</span> <span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - Not known&#39;</span><span class="p">,</span> <span class="s1">&#39;# carotid arteries imaging - No&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - No&#39;</span><span class="p">,</span> <span class="s1">&#39;vascular_imaging_cta_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;vascular_imaging_mra_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;vascular_imaging_dsa_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;vascular_imaging_none_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;bleeding_arterial_hypertension_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;bleeding_aneurysm_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;bleeding_arterio_venous_malformation_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;bleeding_anticoagulation_therapy_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;bleeding_amyloid_angiopathy_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;bleeding_other_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;intervention_endovascular_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;intervention_neurosurgical_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;intervention_other_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;intervention_referred_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;intervention_none_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;vt_treatment_anticoagulation_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;vt_treatment_thrombectomy_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;vt_treatment_local_thrombolysis_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;vt_treatment_local_neurological_treatment_perc_norm&#39;</span><span class="p">,</span> <span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening done&#39;</span><span class="p">,</span> <span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">,</span> <span class="s1">&#39;alert_all&#39;</span><span class="p">,</span> <span class="s1">&#39;alert_all_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;drowsy_all&#39;</span><span class="p">,</span> <span class="s1">&#39;drowsy_all_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;comatose_all&#39;</span><span class="p">,</span> <span class="s1">&#39;comatose_all_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;antithrombotics_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving antiplatelets with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving antiplatelets with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving Vit. K antagonist with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving Vit. K antagonist with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving dabigatran with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving dabigatran with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving rivaroxaban with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving rivaroxaban with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving apixaban with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving apixaban with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving edoxaban with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving edoxaban with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving LMWH or heparin in prophylactic dose with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients neither receiving antithrombotics nor recommended with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients prescribed antithrombotics with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients prescribed antithrombotics with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients prescribed or recommended antithrombotics with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients prescribed or recommended antithrombotics with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;prescribed_antiplatelets_no_afib_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients prescribed antiplatelets without aFib with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients prescribed antiplatelets without aFib with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_detected_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients prescribed anticoagulants with aFib with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;anticoagulants_recommended_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_detected_dead_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients prescribed anticoagulants with aFib with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients prescribed antithrombotics with aFib with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients prescribed antithrombotics with aFib with CVT&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">,</span> <span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;afib_detected_discharged_patients&#39;</span><span class="p">,</span> <span class="s1">&#39;ischemic_transient_dead_patients_prescribed&#39;</span><span class="p">,</span> <span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">])</span>

        <span class="c1"># Connect to database and get country name according to country code.</span>
        <span class="k">def</span> <span class="nf">select_country</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">country_name</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">country_names</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">country_name</span>

        <span class="c1"># If country is used as site, the country name is selected from countries dictionary by country code. :) </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">country</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;UZB&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="o">=</span> <span class="s1">&#39;UZ&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span> <span class="o">=</span> <span class="n">select_country</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">country_code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If split_sites is True, then go through dataframe and generate graphs for each site (the country will be included as site in each file).</span>
        <span class="n">site_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Site ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Delete country name from side ids list.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">site_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">country_name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
       
        <span class="k">if</span> <span class="n">site</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Site ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">site</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df_unformatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_unformatted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_unformatted</span><span class="p">[</span><span class="s1">&#39;Site ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">site</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_formatted_statistics</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">df_tmp</span><span class="o">=</span><span class="n">df_unformatted</span><span class="p">,</span> <span class="n">site_code</span><span class="o">=</span><span class="n">site</span><span class="p">)</span>

        <span class="c1"># Generate formatted statistics for all sites individualy + country as site is included</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">split_sites</span><span class="p">)</span> <span class="ow">and</span> <span class="n">site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">site_ids</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Site ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df_unformatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_unformatted</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_unformatted</span><span class="p">[</span><span class="s1">&#39;Site ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_formatted_statistics</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">df_tmp</span><span class="o">=</span><span class="n">df_unformatted</span><span class="p">,</span> <span class="n">site_code</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    
        <span class="c1"># Produce formatted statistics for all sites + country as site</span>
        <span class="k">if</span> <span class="n">site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_formatted_statistics</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">df_tmp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_unformatted</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_formatted_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">df_tmp</span><span class="p">,</span> <span class="n">site_code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate formatted statistics in xlsx file.</span>
<span class="sd">        </span>
<span class="sd">        Keyword arguments:</span>
<span class="sd">            df: the dataframe with statistics containing only necessary columns</span>
<span class="sd">            df_tmp: the dataframe with statistics containing all calculation</span>
<span class="sd">            site_code: the code of site (default: NOne)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">site_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_of_unformatted_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
            <span class="n">name_of_output_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span>
        <span class="k">elif</span> <span class="n">site_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_of_unformatted_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
            <span class="n">name_of_output_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_code</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.report + &quot;_&quot; + site_code + &quot;_&quot; + self.quarter + &quot;.csv&quot;</span>
            <span class="c1"># self.report + &quot;_&quot; + site_code + &quot;_&quot; + self.quarter + &quot;.xlsx&quot;</span>
            <span class="n">name_of_unformatted_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">site_code</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
            <span class="n">name_of_output_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">site_code</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span>

        <span class="n">df_tmp</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">name_of_unformatted_stats</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">workbook1</span> <span class="o">=</span> <span class="n">xlsxwriter</span><span class="o">.</span><span class="n">Workbook</span><span class="p">(</span><span class="n">name_of_output_file</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;strings_to_numbers&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="c1"># create worksheet</span>
        <span class="n">worksheet</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">()</span>

        <span class="c1"># set width of columns</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="c1"># number of columns</span>
        
        <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
       <span class="c1"># print(ncol)</span>

        <span class="c1"># number of rows</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Proposed Award&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># if (i &gt;= 2):</span>
            <span class="c1">#    tmp[&#39;total_function&#39;: &#39;sum&#39;]</span>
            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="c1">#df = statistics[0:nrow]</span>
        <span class="c1"># print(statistics)</span>

        <span class="n">statistics</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1">########################</span>
        <span class="c1"># DICTIONARY OF COLORS #</span>
        <span class="c1">########################</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;gender&quot;</span><span class="p">:</span> <span class="s2">&quot;#477187&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stroke_hosp&quot;</span><span class="p">:</span> <span class="s2">&quot;#535993&quot;</span><span class="p">,</span>
            <span class="s2">&quot;recurrent_stroke&quot;</span><span class="p">:</span> <span class="s2">&quot;#D4B86A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;department_type&quot;</span><span class="p">:</span> <span class="s2">&quot;#D4A46A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hospitalization&quot;</span><span class="p">:</span> <span class="s2">&quot;#D4916A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rehab&quot;</span><span class="p">:</span> <span class="s2">&quot;#D4BA6A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stroke&quot;</span><span class="p">:</span> <span class="s2">&quot;#565595&quot;</span><span class="p">,</span>
            <span class="s2">&quot;consciousness&quot;</span><span class="p">:</span> <span class="s2">&quot;#468B78&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gcs&quot;</span><span class="p">:</span> <span class="s2">&quot;#B9D6C1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nihss&quot;</span><span class="p">:</span> <span class="s2">&quot;#C5D068&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ct_mri&quot;</span><span class="p">:</span> <span class="s2">&quot;#AA8739&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vasc_img&quot;</span><span class="p">:</span> <span class="s2">&quot;#277650&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ventilator&quot;</span><span class="p">:</span> <span class="s2">&quot;#AA5039&quot;</span><span class="p">,</span>
            <span class="s2">&quot;recanalization_procedure&quot;</span><span class="p">:</span> <span class="s2">&quot;#7F4C91&quot;</span><span class="p">,</span>
            <span class="s2">&quot;median_times&quot;</span><span class="p">:</span> <span class="s2">&quot;#BEBCBC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dysphagia&quot;</span><span class="p">:</span> <span class="s2">&quot;#F49B5B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hemicraniectomy&quot;</span><span class="p">:</span> <span class="s2">&quot;#A3E4D7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;neurosurgery&quot;</span><span class="p">:</span> <span class="s2">&quot;#F8C471&quot;</span><span class="p">,</span>
            <span class="s2">&quot;neurosurgery_type&quot;</span><span class="p">:</span> <span class="s2">&quot;#CACFD2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bleeding_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;#CB4335&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bleeding_source&quot;</span><span class="p">:</span> <span class="s2">&quot;#9B59B6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;intervention&quot;</span><span class="p">:</span> <span class="s2">&quot;#5DADE2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vt_treatment&quot;</span><span class="p">:</span> <span class="s2">&quot;#F5CBA7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;afib&quot;</span><span class="p">:</span> <span class="s2">&quot;#A2C3F3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;carot&quot;</span><span class="p">:</span> <span class="s2">&quot;#F1C40F&quot;</span><span class="p">,</span>
            <span class="s2">&quot;antithrombotics&quot;</span><span class="p">:</span> <span class="s2">&quot;#B5E59F&quot;</span><span class="p">,</span>
            <span class="s2">&quot;statin&quot;</span><span class="p">:</span> <span class="s2">&quot;#28B463&quot;</span><span class="p">,</span>
            <span class="s2">&quot;carotid_stenosis&quot;</span><span class="p">:</span> <span class="s2">&quot;#B9D6C1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;carot_foll&quot;</span><span class="p">:</span> <span class="s2">&quot;#BFC9CA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;antihypertensive&quot;</span><span class="p">:</span> <span class="s2">&quot;#7C7768&quot;</span><span class="p">,</span>
            <span class="s2">&quot;smoking&quot;</span><span class="p">:</span> <span class="s2">&quot;#F9C991&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cerebrovascular&quot;</span><span class="p">:</span> <span class="s2">&quot;#91C09E&quot;</span><span class="p">,</span>
            <span class="s2">&quot;discharge_destination&quot;</span><span class="p">:</span> <span class="s2">&quot;#C0EFF5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;discharge_destination_same_centre&quot;</span><span class="p">:</span> <span class="s2">&quot;#56A3A6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;discharge_destination_another_centre&quot;</span><span class="p">:</span> <span class="s2">&quot;#E8DF9C&quot;</span><span class="p">,</span>
            <span class="s2">&quot;discharge_destination_within_another_centre&quot;</span><span class="p">:</span> <span class="s2">&quot;#538083&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angel_awards&quot;</span><span class="p">:</span> <span class="s2">&quot;#B87333&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angel_resq_awards&quot;</span><span class="p">:</span> <span class="s2">&quot;#341885&quot;</span><span class="p">,</span>
            <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="s2">&quot;#3378B8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;#A1CCA1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;orange&quot;</span><span class="p">:</span> <span class="s2">&quot;#DF7401&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gold&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFDF00&quot;</span><span class="p">,</span>
            <span class="s2">&quot;platinum&quot;</span><span class="p">:</span> <span class="s2">&quot;#c0c0c0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;black&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;#F45D5D&quot;</span>
        <span class="p">}</span>

        <span class="c1">#statistics = statistics[1:nrow]</span>

        <span class="c1">################</span>
        <span class="c1"># angel awards #</span>
        <span class="c1">################</span>
        <span class="n">awards</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span>
            <span class="s1">&#39;bold&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;vcenter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fg_color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;angel_awards&quot;</span><span class="p">)})</span>

        <span class="n">awards_color</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span>
            <span class="s1">&#39;fg_color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;angel_awards&quot;</span><span class="p">)})</span>

        <span class="n">worksheet</span><span class="o">.</span><span class="n">merge_range</span><span class="p">(</span><span class="s1">&#39;EB1:FB1&#39;</span><span class="p">,</span> <span class="s1">&#39;ESO ANGELS AWARDS&#39;</span><span class="p">,</span> <span class="n">awards</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EB2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EC2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ED2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EE2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EF2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EG2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EH2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EI2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EJ2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EK2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EL2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EM2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EN2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EO2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EP2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EQ2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ER2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ES2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ET2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EU2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EV2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EW2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EX2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EY2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EZ2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FA2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FB2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">awards_color</span><span class="p">)</span>
        <span class="c1"># worksheet.write(&#39;LU2&#39;, &#39;&#39;, awards_color)</span>


        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EC:EC&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="c1"># orksheet.set_column(&#39;LC:LC&#39;, None, None, {&#39;hidden&#39;: True})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EE:EE&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="c1"># worksheet.set_column(&#39;LE:LE&#39;, None, None, {&#39;hidden&#39;: True})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EG:EG&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="c1"># worksheet.set_column(&#39;LG:LG&#39;, None, None, {&#39;hidden&#39;: True})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EI:EI&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="c1"># worksheet.set_column(&#39;LI:LI&#39;, None, None, {&#39;hidden&#39;: True})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EK:EK&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="c1"># worksheet.set_column(&#39;LK:LK&#39;, None, None, {&#39;hidden&#39;: True})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EM:EM&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EN:EN&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EO:EO&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EP:EP&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EQ:EQ&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="c1">#worksheet.set_column(&#39;LQ:LQ&#39;, None, None, {&#39;hidden&#39;: True})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;ES:ES&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;ET:ET&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EU:EU&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EV:EV&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EW:EW&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EY:EY&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">worksheet</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s1">&#39;EZ:EZ&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

        <span class="c1"># format for green color</span>
        <span class="n">green</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span>
            <span class="s1">&#39;bold&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;vcenter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bg_color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)})</span>

        <span class="c1"># format for gold color</span>
        <span class="n">gold</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span>
            <span class="s1">&#39;bold&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;vcenter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bg_color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gold&quot;</span><span class="p">)})</span>

        <span class="c1"># format for platinum color</span>
        <span class="n">plat</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span>
            <span class="s1">&#39;bold&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;vcenter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bg_color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;platinum&quot;</span><span class="p">)})</span>

        <span class="c1"># format for gold black</span>
        <span class="n">black</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span>
            <span class="s1">&#39;bold&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;vcenter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bg_color&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)})</span>

        <span class="c1"># format for red color</span>
        <span class="n">red</span> <span class="o">=</span> <span class="n">workbook1</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span>
            <span class="s1">&#39;bold&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;vcenter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bg_color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)})</span>


        <span class="c1"># add table into worksheet</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">statistics</span><span class="p">,</span>
                   <span class="s1">&#39;header_row&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                   <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="s1">&#39;Table Style Light 8&#39;</span>
                   <span class="p">}</span>
        <span class="c1">#worksheet.set_column(&#39;E:V&#39;, 100)</span>

        <span class="n">worksheet</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="c1"># total number of rows</span>
        <span class="n">number_of_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statistics</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="c1"># column where angels awards starts</span>
        <span class="n">coln</span> <span class="o">=</span> <span class="mi">131</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">:</span>    
            <span class="c1"># if cell contain TRUE in column &gt; 30 patients (DR) it will be colored to green</span>
            <span class="n">awards</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">nrow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cell_n</span> <span class="o">=</span> <span class="s1">&#39;EB&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;containing&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">green</span><span class="p">})</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>            
                    <span class="n">awards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;NONE&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">awards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TRUE&quot;</span><span class="p">)</span>


            <span class="k">def</span> <span class="nf">angels_awards_ivt_60</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">coln</span><span class="o">=</span><span class="n">coln</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Add conditional formatting to angels awards for ivt &lt; 60.&quot;&quot;&quot;</span>
                <span class="n">coln</span> <span class="o">=</span> <span class="n">coln</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;minimum&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                                                        <span class="s1">&#39;maximum&#39;</span><span class="p">:</span> <span class="mf">74.99</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">gold</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">black</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">74.99</span><span class="p">):</span>
                            <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">):</span>
                            <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>


            <span class="n">angels_awards_ivt_60</span><span class="p">(</span><span class="s1">&#39;ED&#39;</span><span class="p">)</span>


            <span class="k">def</span> <span class="nf">angels_awards_ivt_45</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">coln</span><span class="o">=</span><span class="n">coln</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Add conditional formatting to angels awards for ivt &lt; 45.&quot;&quot;&quot;</span>
                <span class="n">coln</span> <span class="o">=</span> <span class="n">coln</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">49.99</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">plat</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">black</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">49.99</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;GOLD&quot;</span> <span class="ow">or</span> <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;GOLD&quot;</span><span class="p">):</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>


            <span class="n">angels_awards_ivt_45</span><span class="p">(</span><span class="s1">&#39;EF&#39;</span><span class="p">)</span>


            <span class="c1"># setting colors of cells according to their values</span>
            <span class="k">def</span> <span class="nf">angels_awards_recan</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">coln</span><span class="o">=</span><span class="n">coln</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Add conditional formatting to angels awards for recaalization procedures.&quot;&quot;&quot;</span>
                <span class="n">coln</span> <span class="o">=</span> <span class="n">coln</span> <span class="o">+</span> <span class="mi">6</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;minimum&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                                                        <span class="s1">&#39;maximum&#39;</span><span class="p">:</span> <span class="mf">14.99</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">gold</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;minimum&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                                                        <span class="s1">&#39;maximum&#39;</span><span class="p">:</span> <span class="mf">24.99</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">plat</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">black</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">14.99</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">15</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">24.99</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>


            <span class="n">angels_awards_recan</span><span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">)</span>


            <span class="k">def</span> <span class="nf">angels_awards_processes</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">coln</span><span class="o">=</span><span class="n">coln</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Add conditional formatting to angels awards for processes.&quot;&quot;&quot;</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">n</span>
                <span class="n">coln</span> <span class="o">=</span> <span class="n">coln</span> <span class="o">+</span> <span class="n">num</span>
                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;minimum&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                                                        <span class="s1">&#39;maximum&#39;</span><span class="p">:</span> <span class="mf">84.99</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">gold</span><span class="p">})</span>

                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;minimum&#39;</span><span class="p">:</span> <span class="mi">85</span><span class="p">,</span>
                                                        <span class="s1">&#39;maximum&#39;</span><span class="p">:</span> <span class="mf">89.99</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">plat</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">black</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">count</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">84.99</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                    <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
                            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">85</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">89.99</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                    <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
                            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                    <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>


            <span class="n">angels_awards_processes</span><span class="p">(</span><span class="s1">&#39;EJ&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">angels_awards_processes</span><span class="p">(</span><span class="s1">&#39;EL&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">angels_awards_processes</span><span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">angels_awards_processes</span><span class="p">(</span><span class="s1">&#39;EX&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>

            <span class="c1"># setting colors of cells according to their values</span>
            <span class="k">def</span> <span class="nf">angels_awards_hosp</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">coln</span><span class="o">=</span><span class="n">coln</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Add conditional formatting to angels awards for hospitalization.&quot;&quot;&quot;</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">n</span>
                <span class="n">coln</span> <span class="o">=</span> <span class="n">coln</span> <span class="o">+</span> <span class="n">num</span>
                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">plat</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">number_of_rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cell_n</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span>
                                                        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">black</span><span class="p">})</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                for row in range(nrow - 2):</span>
<span class="sd">                    if (awards[row] != &quot;NONE&quot;):</span>
<span class="sd">                        if (float(statistics[row][coln]) &lt; 80):</span>
<span class="sd">                            if (awards[row] == &quot;DIAMOND&quot;):</span>
<span class="sd">                                awards[row] = &quot;PLATINUM&quot;</span>
<span class="sd">                        elif (float(statistics[row][coln]) &gt;= 80):</span>
<span class="sd">                            if (awards[row] == &quot;DIAMOND&quot;):</span>
<span class="sd">                                awards[row] = &quot;DIAMOND&quot;</span>
<span class="sd">                        else:</span>
<span class="sd">                            awards[row] = &quot;NONE&quot;</span>

<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">0.99</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">coln</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                                <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">awards</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

            <span class="n">angels_awards_hosp</span><span class="p">(</span><span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

            <span class="n">coln</span> <span class="o">=</span> <span class="n">coln</span> <span class="o">+</span> <span class="mi">26</span>
            <span class="n">worksheet</span><span class="o">.</span><span class="n">write_column</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">coln</span><span class="p">,</span> <span class="n">awards</span><span class="p">)</span>

            <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">nrow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cell_n</span> <span class="o">=</span> <span class="s1">&#39;FB&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;containing&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;NONE&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">green</span><span class="p">})</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">nrow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cell_n</span> <span class="o">=</span> <span class="s1">&#39;FB&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;containing&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;GOLD&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">gold</span><span class="p">})</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">nrow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cell_n</span> <span class="o">=</span> <span class="s1">&#39;FB&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;containing&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;PLATINUM&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">plat</span><span class="p">})</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">row</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">while</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">nrow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cell_n</span> <span class="o">=</span> <span class="s1">&#39;FB&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">worksheet</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span><span class="n">cell_n</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;containing&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;DIAMOND&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">black</span><span class="p">})</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">workbook1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">RES-Q package</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Marie Jankujova.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>