
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>resqdb.Calculation &#8212; RES-Q package January, 2019 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for resqdb.Calculation</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Jul 09 13:28:05 2017</span>

<span class="sd">@author: Marie Jankujova</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">inf</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">sem</span><span class="p">,</span> <span class="n">t</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">mean</span>



<div class="viewcode-block" id="FilterDataset"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.Calculation.FilterDataset">[docs]</a><span class="k">class</span> <span class="nc">FilterDataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; The class filtrating the dataframe by date or by country. </span>

<span class="sd">    :param df: the dataframe containing preprocessed data</span>
<span class="sd">    :type df: dataframe</span>
<span class="sd">    :param country: the country code to be included in the data</span>
<span class="sd">    :type country: str</span>
<span class="sd">    :param date1: the first date included in the filtered dataframe</span>
<span class="sd">    :type date1: date</span>
<span class="sd">    :param date2: the last date included in the filtered dataframe</span>
<span class="sd">    :type date2: date</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">debug</span> <span class="o">=</span> <span class="s1">&#39;debug_&#39;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span> 
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
                            <span class="n">filemode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">,</span><span class="si">%(msecs)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">,</span>
                            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">country</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date1</span> <span class="o">=</span> <span class="n">date1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date2</span> <span class="o">=</span> <span class="n">date2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Append &quot;_&quot; to the country code, because e.g. ES_MD was included in dataset for MD as well.</span>
            <span class="n">country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> 

            <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_country</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FilterDataset: Data have been filtered for country </span><span class="si">{0}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="p">))</span> 
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">date1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_date</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FilterDataset: Data have been filtered for date </span><span class="si">{0}</span><span class="s1"> - </span><span class="si">{1}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">_filter_by_country</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function filtering dataframe by country. </span>

<span class="sd">        :returns: df -- the dataframe including only rows containing in Protocol ID the country code</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_filter_by_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function filtering dataframe by discharge date.</span>
<span class="sd">        </span>
<span class="sd">        :returns: df -- the dataframe including only rows where discharge date is in the period (date1, date2)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date1</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date1</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date2</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DATE&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DATE&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="ComputeStats"><a class="viewcode-back" href="../../source/resqdb.html#resqdb.Calculation.ComputeStats">[docs]</a><span class="k">class</span> <span class="nc">ComputeStats</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; The class calculating the general statistics from the preprocessed and filtered data. </span>

<span class="sd">    :param df: the dataframe containing preprocessed data</span>
<span class="sd">    :type df: dataframe</span>
<span class="sd">    :param country: the results for whole country included in the statistics</span>
<span class="sd">    :type country: bool</span>
<span class="sd">    :param country_code: the country code used in the names of output files</span>
<span class="sd">    :type country_code: str</span>
<span class="sd">    :param comparison: the value saying if it is comparative statistics</span>
<span class="sd">    :type comparison: bool</span>
<span class="sd">    :param patient_limit: the number of patients used as limit when evaluating angels awards</span>
<span class="sd">    :type patiet_limit: int</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">country</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">country_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">comparison</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">patient_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient_limit</span> <span class="o">=</span> <span class="n">patient_limit</span>

        <span class="k">def</span> <span class="nf">get_country_name</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; The function returning the country name based on country code. </span>
<span class="sd">            </span>
<span class="sd">            :returns: country_name -- name of the country</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;UZB&quot;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;UZ&#39;</span>
            <span class="n">country_name</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">country_names</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">country_name</span>

        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># uncomment if you want stats between countries and set comparison == True</span>
            <span class="c1"># self.df[&#39;Protocol ID&#39;] = self.df.apply(lambda x: x[&#39;Protocol ID&#39;].split(&quot;_&quot;)[0], axis=1)</span>

        <span class="c1"># If you want to compare, instead of Site Names will be Country names. </span>
        <span class="k">if</span> <span class="n">comparison</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Site Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_country_name</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">get_country_name</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">country</span><span class="p">):</span>
            <span class="n">country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">country_names</span><span class="p">[</span><span class="n">country_code</span><span class="p">]</span>
            <span class="n">country</span><span class="p">[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span>
            <span class="n">country</span><span class="p">[</span><span class="s1">&#39;Site Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">country</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Site Name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Total Patients&quot;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;Site Name&#39;] = </span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Site Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Patients&#39;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;Median patient age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">AGE</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median patient age&#39;</span><span class="p">})[</span><span class="s1">&#39;Median patient age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># get patietns with ischemic stroke (ISch) (1)</span>
        <span class="n">isch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">isch</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 2, 3, 5)</span>
        <span class="n">is_ich_tia_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich_tia_cvt</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), or cerebral venous thrombosis (CVT) (1, 2, 5)</span>
        <span class="n">is_ich_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich_cvt</span><span class="p">)</span>

        <span class="c1"># Get dataframe with patients who had ischemic stroke (IS) or intracerebral hemorrhage (ICH)</span>
        <span class="n">is_ich</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS) and transient ischemic attack (TIA) (1, 3)</span>
        <span class="n">is_tia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_tia</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), subarrachnoid hemorrhage (SAH) or cerebral venous thrombosis (CVT) (1, 2, 4, 5)</span>
        <span class="n">is_ich_sah_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_ich_sah_cvt</span><span class="p">)</span>

        <span class="c1"># get patietns with ischemic stroke (IS), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 3, 5)</span>
        <span class="n">is_tia_cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_tia_cvt</span><span class="p">)</span>

        <span class="c1"># get patients with cerebral venous thrombosis (CVT) (5)</span>
        <span class="n">cvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">cvt</span><span class="p">)</span>

        <span class="c1"># get patietns with intracerebral hemorrhage (ICH) and subarrachnoid hemorrhage (SAH) (2, 4)</span>
        <span class="n">ich_sah</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ich_sah</span><span class="p">)</span>
        
        <span class="c1"># get patietns with intracerebral hemorrhage (ICH) (2)</span>
        <span class="n">ich</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ich</span><span class="p">)</span>

        <span class="c1"># get patietns with subarrachnoid hemorrhage (SAH) (4)</span>
        <span class="n">sah</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">sah</span><span class="p">)</span>

        <span class="c1"># create subset with no referrals (RECANALIZATION_PROCEDURE != [5,6]) AND (HEMICRANIECTOMY != 3)</span>
        <span class="n">discharge_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;HEMICRANIECTOMY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">discharge_subset</span><span class="p">)</span>

        <span class="c1"># Create discharge subset alive</span>
        <span class="n">discharge_subset_alive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">discharge_subset_alive</span><span class="p">)</span>


        <span class="c1">##########</span>
        <span class="c1"># GENDER #</span>
        <span class="c1">##########</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;GENDER&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;GENDER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients female&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients female&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients female&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;GENDER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients male&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients male&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients male&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


        <span class="c1">######################</span>
        <span class="c1"># STROKE IN HOSPITAL #</span>
        <span class="c1">######################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;HOSPITAL_STROKE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITAL_STROKE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients having stroke in the hospital - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients having stroke in the hospital - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients having stroke in the hospital - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITAL_STROKE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients having stroke in the hospital - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients having stroke in the hospital - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients having stroke in the hospital - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">####################</span>
        <span class="c1"># RECURRENT STROKE #</span>
        <span class="c1">####################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;RECURRENT_STROKE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECURRENT_STROKE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECURRENT_STROKE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recurrent stroke - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecurrent stroke - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recurrent stroke - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECURRENT_STROKE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recurrent stroke - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecurrent stroke - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recurrent stroke - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###################</span>
        <span class="c1"># DEPARTMENT TYPE #</span>
        <span class="c1">###################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DEPARTMENT_TYPE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># Get patients from old version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DEPARTMENT_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DEPARTMENT_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# department type - neurology&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment type - neurology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department type - neurology&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DEPARTMENT_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# department type - neurosurgery&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment type - neurosurgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department type - neurosurgery&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DEPARTMENT_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# department type - anesthesiology/resuscitation/critical care&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment type - anesthesiology/resuscitation/critical care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department type - anesthesiology/resuscitation/critical care&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DEPARTMENT_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# department type - internal medicine&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment type - internal medicine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department type - internal medicine&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DEPARTMENT_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# department type - geriatrics&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment type - geriatrics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department type - geriatrics&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DEPARTMENT_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# department type - Other&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment type - Other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department type - Other&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###################</span>
        <span class="c1"># HOSPITALIZED IN #</span>
        <span class="c1">###################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;HOSPITALIZED_IN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITALIZED_IN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients hospitalized in stroke unit / ICU&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITALIZED_IN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients hospitalized in monitored bed with telemetry&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in monitored bed with telemetry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in monitored bed with telemetry&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HOSPITALIZED_IN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients hospitalized in standard bed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in standard bed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in standard bed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###############################</span>
        <span class="c1"># ASSESSED FOR REHABILITATION #</span>
        <span class="c1">###############################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ASSESSED_FOR_REHAB&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ASSESSED_FOR_REHAB&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients assessed for rehabilitation - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients assessed for rehabilitation - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients assessed for rehabilitation - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ASSESSED_FOR_REHAB&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients assessed for rehabilitation - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients assessed for rehabilitation - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients assessed for rehabilitation - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients assessed for rehabilitation - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients assessed for rehabilitation - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ASSESSED_FOR_REHAB&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients assessed for rehabilitation - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients assessed for rehabilitation - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients assessed for rehabilitation - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients assessed for rehabilitation - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients assessed for rehabilitation - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###############</span>
        <span class="c1"># STROKE TYPE #</span>
        <span class="c1">###############</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - ischemic stroke&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - ischemic stroke&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - ischemic stroke&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - intracerebral hemorrhage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - intracerebral hemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - intracerebral hemorrhage&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - transient ischemic attack&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - transient ischemic attack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - transient ischemic attack&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - subarrachnoid hemorrhage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - subarrachnoid hemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - subarrachnoid hemorrhage&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - cerebral venous thrombosis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - cerebral venous thrombosis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - cerebral venous thrombosis&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STROKE_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# stroke type - undetermined stroke&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke type - undetermined stroke&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# stroke type - undetermined stroke&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#######################</span>
        <span class="c1"># CONSCIOUSNESS LEVEL #</span>
        <span class="c1">#######################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich_sah_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSCIOUSNESS_LEVEL&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CONSCIOUSNESS_LEVEL&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% le</span><span class="s1">vel of consciousness - not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CONSCIOUSNESS_LEVEL&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# level of consciousness - alert&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% le</span><span class="s1">vel of consciousness - alert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - alert&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CONSCIOUSNESS_LEVEL&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# level of consciousness - drowsy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% le</span><span class="s1">vel of consciousness - drowsy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - drowsy&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CONSCIOUSNESS_LEVEL&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# level of consciousness - comatose&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% le</span><span class="s1">vel of consciousness - comatose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - comatose&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CONSCIOUSNESS_LEVEL&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# level of consciousness - GCS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% le</span><span class="s1">vel of consciousness - GCS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - GCS&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#######</span>
        <span class="c1"># GCS #</span>
        <span class="c1">#######</span>
        <span class="c1"># Get temporary dataframe with the level of consciousness - GCS</span>
        <span class="n">gcs</span> <span class="o">=</span> <span class="n">is_ich_sah_cvt</span><span class="p">[</span><span class="n">is_ich_sah_cvt</span><span class="p">[</span><span class="s1">&#39;CONSCIOUSNESS_LEVEL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Calculate total number of patients with GCS level of consciousness per site</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">gcs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;GCS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;GCS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# GCS - 15-13&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% G</span><span class="s1">CS - 15-13&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# GCS - 15-13&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;GCS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# GCS - 12-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% G</span><span class="s1">CS - 12-8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# GCS - 12-8&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;GCS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# GCS - &lt;8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% G</span><span class="s1">CS - &lt;8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# GCS - &lt;8&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;gcs_patients&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># GCS is mapped to the consciousness level. GCS 15-13 is mapped to alert, GCS 12-8 to drowsy and GCS &lt; 8 to comatose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;alert_all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - alert&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# GCS - 15-13&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;alert_all_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;alert_all&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;drowsy_all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - drowsy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# GCS - 12-8&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;drowsy_all_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;drowsy_all&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;comatose_all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - comatose&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# GCS - &lt;8&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;comatose_all_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;comatose_all&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_sah_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# level of consciousness - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########</span>
        <span class="c1"># NIHSS #</span>
        <span class="c1">#########</span>
        <span class="c1"># Seperate calculation for CZ </span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NIHSS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# NIHSS - Not performed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% NIHSS - Not performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# NIHSS - Not performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NIHSS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# NIHSS - Performed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% NIHSS - Performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# NIHSS - Performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NIHSS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# NIHSS - Not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% NIHSS - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# NIHSS - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Create temporary dataframe with patient who had performed NIHSS (NIHSS = 2)</span>
            <span class="n">nihss</span> <span class="o">=</span> <span class="n">is_ich</span><span class="p">[</span><span class="n">is_ich</span><span class="p">[</span><span class="s1">&#39;NIHSS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">nihss</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">NIHSS_SCORE</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;NIHSS median score&#39;</span><span class="p">})</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;NIHSS median score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">factorDf</span><span class="p">[</span><span class="s1">&#39;NIHSS median score&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NIHSS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# NIHSS - Not performed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% NIHSS - Not performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# NIHSS - Not performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NIHSS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# NIHSS - Performed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% NIHSS - Performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# NIHSS - Performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NIHSS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# NIHSS - Not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% NIHSS - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# NIHSS - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Create temporary dataframe with patient who had performed NIHSS (NIHSS = 2)</span>
            <span class="n">nihss</span> <span class="o">=</span> <span class="n">is_ich_cvt</span><span class="p">[</span><span class="n">is_ich_cvt</span><span class="p">[</span><span class="s1">&#39;NIHSS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">nihss</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">NIHSS_SCORE</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;NIHSS median score&#39;</span><span class="p">})</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;NIHSS median score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">factorDf</span><span class="p">[</span><span class="s1">&#39;NIHSS median score&#39;</span><span class="p">]</span>

        <span class="c1">##########</span>
        <span class="c1"># CT/MRI #</span>
        <span class="c1">##########</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich_tia_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_MRI&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_MRI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - Not performed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - Not performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - Not performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_MRI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - performed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_MRI&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Create temporary dataframe with patients who had performed CT/MRI (CT_MRI = 2)</span>
        <span class="n">ct_mri</span> <span class="o">=</span> <span class="n">is_ich_tia_cvt</span><span class="p">[</span><span class="n">is_ich_tia_cvt</span><span class="p">[</span><span class="s1">&#39;CT_MRI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>
        <span class="n">ct_mri</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">ct_mri</span><span class="p">[</span><span class="s1">&#39;CT_TIME&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">ct_mri</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CT_TIME&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - Performed within 1 hour after admission&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - Performed within 1 hour after admission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - Performed within 1 hour after admission&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CT_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - Performed later than 1 hour after admission&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">####################</span>
        <span class="c1"># VASCULAR IMAGING #</span>
        <span class="c1">####################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">ich_sah</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CTA_MRA_DSA&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_more_values</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CTA_MRA_DSA&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1,2&#39;</span><span class="p">,</span> <span class="s1">&#39;1,3&#39;</span><span class="p">},</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# vascular imaging - CTA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - CTA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# vascular imaging - CTA&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_more_values</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CTA_MRA_DSA&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1,2&#39;</span><span class="p">,</span> <span class="s1">&#39;2,3&#39;</span><span class="p">},</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# vascular imaging - MRA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - MRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# vascular imaging - MRA&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_more_values</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CTA_MRA_DSA&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;1,3&#39;</span><span class="p">,</span> <span class="s1">&#39;2,3&#39;</span><span class="p">},</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# vascular imaging - DSA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - DSA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# vascular imaging - DSA&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_more_values</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CTA_MRA_DSA&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;4&#39;</span><span class="p">},</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# vascular imaging - None&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - None&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# vascular imaging - None&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_more_values</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CTA_MRA_DSA&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1,2&#39;</span><span class="p">,</span> <span class="s1">&#39;1,3&#39;</span><span class="p">,</span> <span class="s1">&#39;2,3&#39;</span><span class="p">},</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# vascular imaging - two modalities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - two modalities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# vascular imaging - two modalities&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_sah_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">### DATA NORMLAIZATION</span>
        <span class="n">norm_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[[</span><span class="s1">&#39;% vascular imaging - CTA&#39;</span><span class="p">,</span> <span class="s1">&#39;% vascular imaging - MRA&#39;</span><span class="p">,</span> <span class="s1">&#39;% vascular imaging - DSA&#39;</span><span class="p">,</span> <span class="s1">&#39;% vascular imaging - None&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">norm_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;rowsums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vascular_imaging_cta_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - CTA&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vascular_imaging_mra_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - MRA&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vascular_imaging_dsa_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - DSA&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vascular_imaging_none_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% vascular imaging - None&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1">##############</span>
        <span class="c1"># VENTILATOR #</span>
        <span class="c1">##############</span>
        <span class="c1"># Seperate calculation for CZ (difference in the stroke types)</span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;VENTILATOR&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="c1"># Get number of patients from the old version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients put on ventilator - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients put on ventilator - Yes&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients put on ventilator - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients put on ventilator - No&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients put on ventilator - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;VENTILATOR&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="c1"># Get number of patients from the old version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients put on ventilator - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients put on ventilator - Yes&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients put on ventilator - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VENTILATOR&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients put on ventilator - No&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients put on ventilator - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients put on ventilator - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#############################</span>
        <span class="c1"># RECANALIZATION PROCEDURES #</span>
        <span class="c1">#############################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">isch</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Not done&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Not done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Not done&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;RECANALIZATION_PROCEDURES&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get recanalization procedure differently for CZ, they are taking the possible values differently</span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="c1"># self.statsDf[&#39;# patients recanalized&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] +  x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]  + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients recanalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1">#self.statsDf[&#39;% patients recanalized&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients recanalized&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]) &gt; 0 else 0, axis=1)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients recanalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients recanalized&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients recanalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients recanalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients recanalized&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="c1">##############</span>
        <span class="c1"># MEDIAN DTN #</span>
        <span class="c1">##############</span>
        <span class="k">def</span> <span class="nf">_median_confidence_interval</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; The function calculating median confidence interval. </span>

<span class="sd">            :param confidence: the value of confidence interval</span>
<span class="sd">            :type confidence: int/float</span>
<span class="sd">            :returns: rv.median(), rv.interval(confidence)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># create custom discrete random variable from data set</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">rv_discrete</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="o">/</span><span class="n">w</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>

            <span class="k">return</span> <span class="n">rv</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">rv</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>
            
        <span class="k">def</span> <span class="nf">_mean_confidence_interval</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; The function calculating mean confidence interval. </span>

<span class="sd">            :param confidence: the value of confidence interval</span>
<span class="sd">            :type confidence: int/float</span>
<span class="sd">            :returns: m, m-h, m+h</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">std_err</span> <span class="o">=</span> <span class="n">sem</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">std_err</span> <span class="o">*</span> <span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">confidence</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="n">h</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# IV tPa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% IV tPa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# IV tPa&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Create temporary dataframe with the patients who has been treated with thrombolysis</span>
        <span class="n">recanalization_procedure_iv_tpa</span> <span class="o">=</span> <span class="n">isch</span><span class="p">[</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Create one column with times of door to thrombolysis </span>
        <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVT_ONLY_NEEDLE_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVT_ONLY_NEEDLE_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_NEEDLE_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_NEEDLE_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_REFER_NEEDLE_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_REFER_NEEDLE_TIME_MIN&#39;</span><span class="p">]</span>

        
        <span class="c1"># sites_ids = recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;].tolist()</span>
        <span class="c1"># sites_ids = set(sites_ids)</span>
        <span class="c1"># interval_vals = {}		</span>
        <span class="c1"># for idx, val in enumerate(sites_ids): </span>
        <span class="c1">#     meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())</span>
        <span class="c1">#     medianv, interval_median = _median_confidence_interval(recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())</span>
        <span class="c1">#     interval_vals[str(idx)] = [val, &quot;({0:.2f},{1:.2f})&quot;.format(lbound, ubound), &quot;{0}&quot;.format(interval_median)]</span>

        <span class="c1">#     #interval_vals.append(&quot;{0}: ({1}-{2})&quot;.format(i, lowb, upb))</span>
        <span class="c1"># #print(interval_vals)</span>
        <span class="c1"># interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTN (Mean)&#39;, &#39;Confidence interval DTN (Median)&#39;])</span>
        
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">IVTPA</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median DTN (minutes)&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># self.statsDf = self.statsDf.merge(interval_vals_df, how=&#39;outer&#39;)</span>
        
        <span class="c1">##############</span>
        <span class="c1"># MEDIAN DTG #</span>
        <span class="c1">##############</span>
        <span class="c1"># Seperate calculation of TBY for CZ</span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="c1"># self.statsDf.loc[:, &#39;# TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# TBY&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Create temporary dataframe with the patients who has been treated with thrombectomy</span>
            <span class="c1"># recanalization_procedure_tby_dtg = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3, 6, 7, 8])].copy()</span>
            <span class="n">recanalization_procedure_tby_dtg</span> <span class="o">=</span> <span class="n">isch</span><span class="p">[</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">recanalization_procedure_tby_dtg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Get IVTPA in minutes</span>
            <span class="c1"># recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_ALL_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_LIM_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_ALL_GROIN_PUNCTURE_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_LIM_GROIN_PUNCTURE_TIME_MIN&#39;]</span>
            <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY_ONLY_GROIN_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_GROIN_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_GROIN_TIME_MIN&#39;</span><span class="p">]</span>
           
            <span class="c1"># sites_ids = recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;].tolist()</span>
            <span class="c1"># sites_ids = set(sites_ids)</span>
            <span class="c1"># interval_vals = {}		</span>
            <span class="c1"># for idx, val in enumerate(sites_ids): </span>
            <span class="c1">#     meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;TBY&#39;].tolist())</span>
            <span class="c1">#     medianv, interval_median = _median_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;TBY&#39;].tolist())</span>
            <span class="c1">#     interval_vals[str(idx)] = [val, &quot;({0:.2f}-{1:.2f})&quot;.format(lbound, ubound), &quot;{0}&quot;.format(interval_median)]</span>

            <span class="c1"># interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTG (Mean)&#39;, &#39;Confidence interval DTG (Median)&#39;])</span>
            
            <span class="c1"># recanalization_procedure_tby[&#39;TBY&#39;] = recanalization_procedure_tby.loc[:, [&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;, &#39;TBY_ONLY_GROIN_PUNCTURE_TIME_MIN&#39;, &#39;IVT_TBY_GROIN_TIME&#39;, &#39;IVT_TBY_GROIN_TIME_MIN&#39;]].sum(1).reset_index()[0].tolist()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# TBY&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Create temporary dataframe with the patients who has been treated with thrombectomy</span>
            <span class="n">recanalization_procedure_tby_dtg</span> <span class="o">=</span> <span class="n">isch</span><span class="p">[</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">recanalization_procedure_tby_dtg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Create one column with times of door to thrombectomy </span>
            <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY_ONLY_GROIN_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_GROIN_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_GROIN_TIME_MIN&#39;</span><span class="p">]</span>

            <span class="c1"># sites_ids = recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;].tolist()</span>
            <span class="c1"># sites_ids = set(sites_ids)</span>
            <span class="c1"># interval_vals = {}		</span>
            <span class="c1"># for idx, val in enumerate(sites_ids): </span>
            <span class="c1">#     meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())</span>
            <span class="c1">#     medianv, interval_median = _median_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())</span>
            <span class="c1">#     interval_vals[str(idx)] = [val, &quot;({0:.2f}-{1:.2f})&quot;.format(lbound, ubound), &quot;{0}&quot;.format(interval_median)]</span>
            
            <span class="c1"># interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTG (Mean)&#39;, &#39;Confidence interval DTG (Median)&#39;])</span>
            
            <span class="c1"># recanalization_procedure_tby[&#39;TBY&#39;] = recanalization_procedure_tby.loc[:, [&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;, &#39;TBY_ONLY_GROIN_PUNCTURE_TIME_MIN&#39;, &#39;IVT_TBY_GROIN_TIME&#39;, &#39;IVT_TBY_GROIN_TIME_MIN&#39;]].sum(1).reset_index()[0].tolist()</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">TBY</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median DTG (minutes)&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># self.statsDf = self.statsDf.merge(interval_vals_df, how=&#39;outer&#39;)</span>

        <span class="c1">###############</span>
        <span class="c1"># MEDIAN DIDO #</span>
        <span class="c1">###############</span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="c1"># self.statsDf.loc[:, &#39;# DIDO TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;], axis=1)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# DIDO TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># self.statsDf[&#39;% DIDO TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# DIDO TBY&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;]) &gt; 0 else 0, axis=1)</span>
            
            <span class="c1"># Get only patients recanalized TBY</span>
            <span class="c1"># recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6, 7, 8])].copy()</span>

            <span class="c1"># For CZ remove referred for endovascular treatment from DIDO time because they are taking it as the patient was referred to them for TBY</span>
            <span class="c1"># recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6])].copy()</span>
            
            <span class="c1"># Create temporary dataframe with the patients who has been transferred for recanalization procedures</span>
            <span class="n">recanalization_procedure_tby_dido</span> <span class="o">=</span> <span class="n">isch</span><span class="p">[</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">recanalization_procedure_tby_dido</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Get DIDO in minutes</span>
            <span class="c1"># recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;]</span>
            <span class="c1"># recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;]</span>

            <span class="c1"># Create one column with times of door-in door-out time </span>
            <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;DIDO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_REFER_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_DIDO_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_ALL_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_LIM_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;</span><span class="p">]</span>

            <span class="n">tmp</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dido</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">DIDO</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median TBY DIDO (minutes)&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# DIDO TBY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># self.statsDf[&#39;% DIDO TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# DIDO TBY&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;]) &gt; 0 else 0, axis=1)</span>

            <span class="c1"># Create temporary dataframe with the patients who has been transferred for recanalization procedures</span>
            <span class="n">recanalization_procedure_tby_dido</span> <span class="o">=</span> <span class="n">isch</span><span class="p">[</span><span class="n">isch</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">recanalization_procedure_tby_dido</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Create one column with times of door-in door-out time </span>
            <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;DIDO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_REFER_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_DIDO_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_ALL_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_LIM_DIDO_TIME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">recanalization_procedure_tby_dido</span><span class="p">[</span><span class="s1">&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;</span><span class="p">]</span>

            <span class="n">tmp</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dido</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">DIDO</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median TBY DIDO (minutes)&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        

        <span class="c1">#######################</span>
        <span class="c1"># DYPSHAGIA SCREENING #</span>
        <span class="c1">#######################</span>
        <span class="c1"># For CZ exclude CVT from the calculation </span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DYSPHAGIA_SCREENING&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Other test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Not done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Unable to test&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Unable to test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Unable to test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># self.statsDf[&#39;# dysphagia screening done&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;] + self.statsDf[&#39;# dysphagia screening - Another centre&#39;]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span>
            <span class="c1"># self.statsDf[&#39;% dysphagia screening done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening done&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_ich_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DYSPHAGIA_SCREENING&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Other test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Not done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening - Unable to test&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening - Unable to test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Unable to test&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Another centre&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening done&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_ich_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">############################</span>
        <span class="c1"># DYPSHAGIA SCREENING TIME #</span>
        <span class="c1">############################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DYSPHAGIA_SCREENING_TIME&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DYSPHAGIA_SCREENING_TIME&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ysphagia screening time - After first 24 hours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - Within first 24 hours&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening time - After first 24 hours&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###################</span>
        <span class="c1"># HEMICRANIECTOMY #</span>
        <span class="c1">###################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">isch</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;HEMICRANIECTOMY&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HEMICRANIECTOMY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# hemicraniectomy - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% he</span><span class="s1">micraniectomy - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# hemicraniectomy - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HEMICRANIECTOMY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# hemicraniectomy - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% he</span><span class="s1">micraniectomy - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# hemicraniectomy - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;HEMICRANIECTOMY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# hemicraniectomy - Referred to another centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% he</span><span class="s1">micraniectomy - Referred to another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# hemicraniectomy - Referred to another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;isch_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">################</span>
        <span class="c1"># NEUROSURGERY #</span>
        <span class="c1">################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">ich</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;NEUROSURGERY&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NEUROSURGERY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# neurosurgery - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NEUROSURGERY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# neurosurgery - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NEUROSURGERY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# neurosurgery - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#####################</span>
        <span class="c1"># NEUROSURGERY TYPE #</span>
        <span class="c1">#####################</span>
        <span class="c1"># Create temporary dataframe of patients who have undergone neurosurgery </span>
        <span class="n">neurosurgery</span> <span class="o">=</span> <span class="n">ich</span><span class="p">[</span><span class="n">ich</span><span class="p">[</span><span class="s1">&#39;NEUROSURGERY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">neurosurgery</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># If no data available set 0 to all variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - intracranial hematoma evacuation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - intracranial hematoma evacuation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - external ventricular drainage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - external ventricular drainage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - decompressive craniectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - decompressive craniectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - Referred to another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - Referred to another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">neurosurgery</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;NEUROSURGERY_TYPE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">neurosurgery</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NEUROSURGERY_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# neurosurgery type - intracranial hematoma evacuation&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - intracranial hematoma evacuation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - intracranial hematoma evacuation&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NEUROSURGERY_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# neurosurgery type - external ventricular drainage&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - external ventricular drainage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - external ventricular drainage&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NEUROSURGERY_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# neurosurgery type - decompressive craniectomy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - decompressive craniectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - decompressive craniectomy&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;NEUROSURGERY_TYPE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# neurosurgery type - Referred to another centre&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% neurosurgery type - Referred to another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# neurosurgery type - Referred to another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;neurosurgery_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###################</span>
        <span class="c1"># BLEEDING REASON #</span>
        <span class="c1">###################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">ich</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;BLEEDING_REASON&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;BLEEDING_REASON&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;BLEEDING_REASON&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="c1"># Get number of patients entered in older form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;-999&#39;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding reason - arterial hypertension&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - arterial hypertension&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding reason - arterial hypertension&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding reason - aneurysm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - aneurysm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding reason - aneurysm&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding reason - arterio-venous malformation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - arterio-venous malformation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding reason - arterio-venous malformation&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding reason - anticoagulation therapy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - anticoagulation therapy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding reason - anticoagulation therapy&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding reason - amyloid angiopathy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - amyloid angiopathy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding reason - amyloid angiopathy&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding reason - Other&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - Other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding reason - Other&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">### DATA NORMALIZATION</span>
        <span class="n">norm_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[[</span><span class="s1">&#39;% bleeding reason - arterial hypertension&#39;</span><span class="p">,</span> <span class="s1">&#39;% bleeding reason - aneurysm&#39;</span><span class="p">,</span> <span class="s1">&#39;% bleeding reason - arterio-venous malformation&#39;</span><span class="p">,</span> <span class="s1">&#39;% bleeding reason - anticoagulation therapy&#39;</span><span class="p">,</span> <span class="s1">&#39;% bleeding reason - amyloid angiopathy&#39;</span><span class="p">,</span> <span class="s1">&#39;% bleeding reason - Other&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">norm_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rowsums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;bleeding_arterial_hypertension_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - arterial hypertension&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;bleeding_aneurysm_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - aneurysm&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;bleeding_arterio_venous_malformation_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - arterio-venous malformation&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;bleeding_anticoagulation_therapy_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - anticoagulation therapy&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;bleeding_amyloid_angiopathy_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - amyloid angiopathy&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;bleeding_other_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - Other&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># MORE THAN ONE POSIBILITY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_REASON&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding reason - more than one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding reason - more than one&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding reason - more than one&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ich_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###################</span>
        <span class="c1"># BLEEDING SOURCE #</span>
        <span class="c1">###################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">sah</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;BLEEDING_SOURCE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;BLEEDING_SOURCE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;BLEEDING_SOURCE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="c1"># Get number of patients entered in older form</span>
        <span class="c1"># self.statsDf = self._get_values_for_factors(column_name=&quot;BLEEDING_SOURCE&quot;, value=&#39;-999&#39;, new_column_name=&#39;tmp&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_SOURCE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;-999&#39;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf = self._get_values_for_factors(column_name=&quot;BLEEDING_SOURCE&quot;, value=&#39;1&#39;, new_column_name=&#39;# bleeding source - Known&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_SOURCE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding source - Known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding source - Known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding source - Known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># self.statsDf = self._get_values_for_factors(column_name=&quot;BLEEDING_SOURCE&quot;, value=&#39;2&#39;, new_column_name=&#39;# bleeding source - Not known&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;BLEEDING_SOURCE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# bleeding source - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% bleeding source - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# bleeding source - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">################</span>
        <span class="c1"># INTERVENTION #</span>
        <span class="c1">################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">sah</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;INTERVENTION&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;INTERVENTION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;INTERVENTION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="c1"># Get number of patients entered in older form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;INTERVENTION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;INTERVENTION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# intervention - endovascular (coiling)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - endovascular (coiling)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# intervention - endovascular (coiling)&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;INTERVENTION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# intervention - neurosurgical (clipping)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - neurosurgical (clipping)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# intervention - neurosurgical (clipping)&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;INTERVENTION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# intervention - Other neurosurgical treatment (decompression, drainage)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - Other neurosurgical treatment (decompression, drainage)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# intervention - Other neurosurgical treatment (decompression, drainage)&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;INTERVENTION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# intervention - Referred to another hospital for intervention&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - Referred to another hospital for intervention&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# intervention - Referred to another hospital for intervention&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;INTERVENTION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;5|6&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# intervention - None / no intervention&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - None / no intervention&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# intervention - None / no intervention&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

        <span class="c1">### DATA NORMALIZATION</span>
        <span class="n">norm_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - endovascular (coiling)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - neurosurgical (clipping)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - Other neurosurgical treatment (decompression, drainage)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - Referred to another hospital for intervention&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - None / no intervention&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">norm_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rowsums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;intervention_endovascular_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - endovascular (coiling)&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;intervention_neurosurgical_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - neurosurgical (clipping)&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;intervention_other_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - Other neurosurgical treatment (decompression, drainage)&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;intervention_referred_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - Referred to another hospital for intervention&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;intervention_none_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - None / no intervention&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;INTERVENTION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# intervention - more than one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">ntervention - more than one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# intervention - more than one&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sah_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">################</span>
        <span class="c1"># VT TREATMENT #</span>
        <span class="c1">################</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;VT_TREATMENT&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cvt</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="n">cvt</span><span class="p">[</span><span class="s1">&#39;VT_TREATMENT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;VT_TREATMENT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[[</span><span class="s1">&#39;VT_TREATMENT&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[[</span><span class="s1">&#39;VT_TREATMENT&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VT_TREATMENT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# VT treatment - anticoagulation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% VT treatment - anticoagulation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# VT treatment - anticoagulation&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VT_TREATMENT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# VT treatment - thrombectomy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% VT treatment - thrombectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# VT treatment - thrombectomy&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VT_TREATMENT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# VT treatment - local thrombolysis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% VT treatment - local thrombolysis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# VT treatment - local thrombolysis&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VT_TREATMENT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# VT treatment - local neurological treatment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% VT treatment - local neurological treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# VT treatment - local neurological treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;VT_TREATMENT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# VT treatment - more than one treatment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% VT treatment - more than one treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# VT treatment - more than one treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;cvt_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">### DATA NORMALIZATION</span>
        <span class="n">norm_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[[</span><span class="s1">&#39;% VT treatment - anticoagulation&#39;</span><span class="p">,</span> <span class="s1">&#39;% VT treatment - thrombectomy&#39;</span><span class="p">,</span> <span class="s1">&#39;% VT treatment - local thrombolysis&#39;</span><span class="p">,</span> <span class="s1">&#39;% VT treatment - local neurological treatment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">norm_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rowsums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vt_treatment_anticoagulation_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% VT treatment - anticoagulation&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vt_treatment_thrombectomy_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% VT treatment - thrombectomy&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vt_treatment_local_thrombolysis_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% VT treatment - local thrombolysis&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;vt_treatment_local_neurological_treatment_perc_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;% VT treatment - local neurological treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">norm_tmp</span><span class="p">[</span><span class="s1">&#39;rowsums&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1">########</span>
        <span class="c1"># AFIB #</span>
        <span class="c1">########</span>
        <span class="n">not_reffered</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="o">~</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">7</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;not_reffered_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">not_reffered</span><span class="p">)</span>

        <span class="c1"># Create dataframe with the patients referred to another hospital</span>
        <span class="n">reffered</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">7</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">reffered</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">not_reffered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Newly-detected at admission&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Newly-detected at admission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Newly-detected at admission&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Detected during hospitalization&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Detected during hospitalization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Detected during hospitalization&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Not detected&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Not detected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Not detected&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_FLUTTER&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib/flutter - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib/flutter - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib/flutter - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;reffered_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########################</span>
        <span class="c1"># AFIB DETECTION METHOD #</span>
        <span class="c1">#########################</span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="n">afib_detected_during_hospitalization</span> <span class="o">=</span> <span class="n">not_reffered</span><span class="p">[</span><span class="n">not_reffered</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_during_hospitalization</span><span class="p">)</span>
            <span class="n">afib_detected_during_hospitalization</span><span class="p">[</span><span class="s1">&#39;AFIB_DETECTION_METHOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afib_detected_during_hospitalization</span><span class="p">[</span><span class="s1">&#39;AFIB_DETECTION_METHOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="c1"># Convert values to string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">afib_detected_during_hospitalization</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;AFIB_DETECTION_METHOD&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - Holter-type monitoring&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - Holter-type monitoring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - Holter-type monitoring&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors_containing</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">afib_detected_during_hospitalization</span> <span class="o">=</span> <span class="n">not_reffered</span><span class="p">[</span><span class="n">not_reffered</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_during_hospitalization</span><span class="p">)</span>
            <span class="n">afib_detected_during_hospitalization</span><span class="p">[</span><span class="s1">&#39;AFIB_DETECTION_METHOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">afib_detected_during_hospitalization</span><span class="p">[</span><span class="s1">&#39;AFIB_DETECTION_METHOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">afib_detected_during_hospitalization</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;AFIB_DETECTION_METHOD&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - Holter-type monitoring&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - Holter-type monitoring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - Holter-type monitoring&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_DETECTION_METHOD&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_during_hospitalization_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">###############################</span>
        <span class="c1"># AFIB OTHER DETECTION METHOD #</span>
        <span class="c1">###############################</span>
        <span class="n">afib_not_detected_or_not_known</span> <span class="o">=</span> <span class="n">not_reffered</span><span class="p">[</span><span class="n">not_reffered</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_not_detected_or_not_known</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">afib_not_detected_or_not_known</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;AFIB_OTHER_RECS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_OTHER_RECS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# other afib detection method - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">ther afib detection method - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# other afib detection method - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_not_detected_or_not_known_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;AFIB_OTHER_RECS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# other afib detection method - Not detected or not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">ther afib detection method - Not detected or not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# other afib detection method - Not detected or not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_not_detected_or_not_known_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">############################</span>
        <span class="c1"># CAROTID ARTERIES IMAGING #</span>
        <span class="c1">############################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_tia</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CAROTID_ARTERIES_IMAGING&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_ARTERIES_IMAGING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_ARTERIES_IMAGING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid arteries imaging - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_ARTERIES_IMAGING&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid arteries imaging - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid arteries imaging - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid arteries imaging - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">############################</span>
        <span class="c1"># ANTITHROMBOTICS WITH CVT #</span>
        <span class="c1">############################</span>
        <span class="c1"># Create dataframe with dead patients excluded</span>
        <span class="n">antithrombotics_with_cvt</span> <span class="o">=</span> <span class="n">is_tia_cvt</span><span class="p">[</span><span class="o">~</span><span class="n">is_tia_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;antithrombotics_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">antithrombotics_with_cvt</span><span class="p">)</span>
        <span class="n">ischemic_transient_cerebral_dead</span> <span class="o">=</span> <span class="n">is_tia_cvt</span><span class="p">[</span><span class="n">is_tia_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ischemic_transient_cerebral_dead</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics_with_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving antiplatelets with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving antiplatelets with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving antiplatelets with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving Vit. K antagonist with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving Vit. K antagonist with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving Vit. K antagonist with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving dabigatran with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving dabigatran with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving dabigatran with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving rivaroxaban with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving rivaroxaban with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving rivaroxaban with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving apixaban with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving apixaban with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving apixaban with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving edoxaban with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving edoxaban with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving edoxaban with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving LMWH or heparin in prophylactic dose with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients neither receiving antithrombotics nor recommended with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">## ANTITHROMBOTICS - PATIENTS PRESCRIBED + RECOMMENDED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# patients prescribed antithrombotics with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving antiplatelets with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving Vit. K antagonist with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving dabigatran with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving rivaroxaban with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving apixaban with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving edoxaban with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antithrombotics with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# patients prescribed or recommended antithrombotics with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving antiplatelets with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving Vit. K antagonist with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving dabigatran with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving rivaroxaban with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving apixaban with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving edoxaban with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed or recommended antithrombotics with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed or recommended antithrombotics with CVT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_cvt_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_cerebral_dead_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">###########################################</span>
        <span class="c1"># ANTIPLATELETS - PRESCRIBED WITHOUT AFIB #</span>
        <span class="c1">###########################################</span>
        <span class="n">afib_flutter_not_detected_or_not_known_with_cvt</span> <span class="o">=</span> <span class="n">is_tia_cvt</span><span class="p">[</span><span class="n">is_tia_cvt</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_not_detected_or_not_known_with_cvt</span><span class="p">)</span>

        <span class="n">afib_flutter_not_detected_or_not_known_with_cvt_dead</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known_with_cvt</span><span class="p">[</span><span class="n">afib_flutter_not_detected_or_not_known_with_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_not_detected_or_not_known_with_cvt_dead</span><span class="p">)</span>

        <span class="n">prescribed_antiplatelets_no_afib_with_cvt</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known_with_cvt</span><span class="p">[</span><span class="n">afib_flutter_not_detected_or_not_known_with_cvt</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">prescribed_antiplatelets_no_afib_with_cvt</span><span class="p">)</span>

        <span class="n">prescribed_antiplatelets_no_afib_dead_with_cvt</span> <span class="o">=</span> <span class="n">prescribed_antiplatelets_no_afib_with_cvt</span><span class="p">[</span><span class="n">prescribed_antiplatelets_no_afib_with_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">prescribed_antiplatelets_no_afib_dead_with_cvt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known_with_cvt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed antiplatelets without aFib with CVT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antiplatelets without aFib with CVT&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antiplatelets without aFib with CVT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########################################</span>
        <span class="c1"># ANTICOAGULANTS - PRESCRIBED WITH AFIB #</span>
        <span class="c1">#########################################       </span>
        <span class="n">afib_flutter_detected_with_cvt</span> <span class="o">=</span> <span class="n">is_tia_cvt</span><span class="p">[</span><span class="n">is_tia_cvt</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">)</span>

        <span class="n">anticoagulants_prescribed_with_cvt</span> <span class="o">=</span> <span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="o">~</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients prescribed anticoagulants with aFib with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed_with_cvt</span><span class="p">)</span>
        
        <span class="n">anticoagulants_recommended_with_cvt</span> <span class="o">=</span> <span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">9</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;anticoagulants_recommended_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_recommended_with_cvt</span><span class="p">)</span>

        <span class="n">afib_flutter_detected_dead_with</span> <span class="o">=</span> <span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected_dead_with</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed anticoagulants with aFib with CVT&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed anticoagulants with aFib with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients_with_cvt&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients_with_cvt&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">##########################################</span>
        <span class="c1"># ANTITHROMBOTICS - PRESCRIBED WITH AFIB #</span>
        <span class="c1">##########################################</span>
        <span class="n">antithrombotics_prescribed_with_cvt</span> <span class="o">=</span> <span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="o">~</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics with aFib with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">antithrombotics_prescribed_with_cvt</span><span class="p">)</span>

        <span class="n">recommended_antithrombotics_with_afib_alive_with_cvt</span> <span class="o">=</span> <span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">9</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected_with_cvt</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recommended_antithrombotics_with_afib_alive_with_cvt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antithrombotics with aFib with CVT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics with aFib with CVT&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients_with_cvt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        
        <span class="c1">###############################</span>
        <span class="c1"># ANTITHROMBOTICS WITHOUT CVT #</span>
        <span class="c1">###############################</span>
        <span class="n">antithrombotics</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="o">~</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;antithrombotics_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">antithrombotics</span><span class="p">)</span>

        <span class="n">ischemic_transient_dead</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ischemic_transient_dead</span><span class="p">)</span>

        <span class="n">ischemic_transient_dead_prescribed</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">10</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients_prescribed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">ischemic_transient_dead_prescribed</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving antiplatelets&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving dabigatran&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving rivaroxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving apixaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving edoxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients not prescribed antithrombotics, but recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients neither receiving antithrombotics nor recommended&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients neither receiving antithrombotics nor recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients neither receiving antithrombotics nor recommended&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">## ANTITHROMBOTICS - PATIENTS PRESCRIBED + RECOMMENDED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# patients prescribed antithrombotics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving antiplatelets&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antithrombotics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# patients prescribed or recommended antithrombotics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving antiplatelets&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients not prescribed antithrombotics, but recommended&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># From patients prescribed or recommended antithrombotics remove patient who had prescribed antithrombotics and were dead (nominator)</span>
        <span class="c1"># self.statsDf[&#39;% patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics&#39;] - x[&#39;ischemic_transient_dead_patients_prescribed&#39;])/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100, 2) if ((x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0) else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed or recommended antithrombotics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed or recommended antithrombotics&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients_prescribed&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ischemic_transient_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Drop the redundant columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">,</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">###########################################</span>
        <span class="c1"># ANTIPLATELETS - PRESCRIBED WITHOUT AFIB #</span>
        <span class="c1">###########################################</span>
        <span class="n">afib_flutter_not_detected_or_not_known</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">)</span>

        <span class="n">afib_flutter_not_detected_or_not_known_dead</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_not_detected_or_not_known_dead</span><span class="p">)</span>

        <span class="n">prescribed_antiplatelets_no_afib</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="n">afib_flutter_not_detected_or_not_known</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">prescribed_antiplatelets_no_afib</span><span class="p">)</span>

        <span class="n">prescribed_antiplatelets_no_afib_dead</span> <span class="o">=</span> <span class="n">prescribed_antiplatelets_no_afib</span><span class="p">[</span><span class="n">prescribed_antiplatelets_no_afib</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">prescribed_antiplatelets_no_afib_dead</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">afib_flutter_not_detected_or_not_known</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed antiplatelets without aFib&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antiplatelets without aFib&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antiplatelets without aFib&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########################################</span>
        <span class="c1"># ANTICOAGULANTS - PRESCRIBED WITH AFIB #</span>
        <span class="c1">#########################################</span>
        <span class="n">afib_flutter_detected</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected</span><span class="p">)</span>

        <span class="n">afib_flutter_detected_not_dead</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected_not_dead</span><span class="p">)</span>

        <span class="n">anticoagulants_prescribed</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients prescribed anticoagulants with aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="c1"># Additional calculation </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">)</span>
        <span class="c1"># self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/x[&#39;# patients prescribed anticoagulants with aFib&#39;]) * 100), 2) if x[&#39;# patients prescribed anticoagulants with aFib&#39;] &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving Vit. K antagonist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving Vit. K antagonist&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving dabigatran&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving dabigatran&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving rivaroxaban&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving rivaroxaban&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving apixaban&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving apixaban&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving edoxaban&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving edoxaban&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients_not_dead&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">anticoagulants_recommended</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">9</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;anticoagulants_recommended_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_recommended</span><span class="p">)</span>

        <span class="n">afib_flutter_detected_dead</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_flutter_detected_dead</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed anticoagulants with aFib&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed anticoagulants with aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">##########################################</span>
        <span class="c1"># ANTITHROMBOTICS - PRESCRIBED WITH AFIB #</span>
        <span class="c1">##########################################</span>
        <span class="n">antithrombotics_prescribed</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics with aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">antithrombotics_prescribed</span><span class="p">)</span>

        <span class="n">recommended_antithrombotics_with_afib_alive</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">9</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recommended_antithrombotics_with_afib_alive</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed antithrombotics with aFib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed antithrombotics with aFib&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_flutter_detected_dead_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommended_antithrombotics_with_afib_alive_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">###########</span>
        <span class="c1"># STATINS #</span>
        <span class="c1">###########</span>
        <span class="c1"># For CZ only patients discharged home included</span>
        <span class="k">if</span> <span class="n">country_code</span> <span class="o">==</span> <span class="s1">&#39;CZ&#39;</span><span class="p">:</span>
            <span class="n">is_tia_discharged_home</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">is_tia_discharged_home</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_tia_discharged_home</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;STATIN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - Yes&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - No&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - Not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_tia</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;STATIN&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
           
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - Yes&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - No&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;STATIN&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# patients prescribed statins - Not known&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients prescribed statins - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients prescribed statins - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">####################</span>
        <span class="c1"># CAROTID STENOSIS #</span>
        <span class="c1">####################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">is_tia</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CAROTID_STENOSIS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis - 50</span><span class="si">%-70%</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis - 50</span><span class="si">%-70%</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis - 50</span><span class="si">%-70%</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis - &gt;70%&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis - &gt;70%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis - &gt;70%&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">##############################</span>
        <span class="c1"># CAROTID STENOSIS FOLLOW-UP #</span>
        <span class="c1">##############################</span>
        <span class="c1"># Create temporary dataframe if carotid stenosis was 50-70% or &gt; 70%</span>
        <span class="n">carotid_stenosis</span> <span class="o">=</span> <span class="n">is_tia</span><span class="p">[</span><span class="n">is_tia</span><span class="p">[</span><span class="s1">&#39;CAROTID_STENOSIS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">carotid_stenosis</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CAROTID_STENOSIS_FOLLOWUP&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS_FOLLOWUP&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis followup - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis followup - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis followup - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS_FOLLOWUP&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis followup - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis followup - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis followup - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS_FOLLOWUP&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis followup - No, but planned later&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis followup - No, but planned later&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis followup - No, but planned later&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Create temporary dataframe if carotid stenosis was followed up or planned to follow up later</span>
        <span class="n">carotid_stenosis_followup</span> <span class="o">=</span> <span class="n">carotid_stenosis</span><span class="p">[</span><span class="n">carotid_stenosis</span><span class="p">[</span><span class="s1">&#39;CAROTID_STENOSIS_FOLLOWUP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis followup - Yes, but planned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">carotid_stenosis_followup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis followup - Yes, but planned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis followup - Yes, but planned&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CAROTID_STENOSIS_FOLLOWUP&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# carotid stenosis followup - Referred to another centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">arotid stenosis followup - Referred to another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# carotid stenosis followup - Referred to another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_tia_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#####################</span>
        <span class="c1"># ANTIHYPERTENSIVES #</span>
        <span class="c1">#####################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset_alive</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIHYPERTENSIVE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIHYPERTENSIVE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# prescribed antihypertensives - Not known&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% prescribed antihypertensives - Not known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# prescribed antihypertensives - Not known&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIHYPERTENSIVE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# prescribed antihypertensives - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% prescribed antihypertensives - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# prescribed antihypertensives - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# prescribed antihypertensives - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# prescribed antihypertensives - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTIHYPERTENSIVE&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# prescribed antihypertensives - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% prescribed antihypertensives - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# prescribed antihypertensives - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# prescribed antihypertensives - Not known&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# prescribed antihypertensives - Not known&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#####################</span>
        <span class="c1"># SMOKING CESSATION #</span>
        <span class="c1">#####################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset_alive</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;SMOKING_CESSATION&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;SMOKING_CESSATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recommended to a smoking cessation program - not a smoker&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecommended to a smoking cessation program - not a smoker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a smoking cessation program - not a smoker&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;SMOKING_CESSATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recommended to a smoking cessation program - Yes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecommended to a smoking cessation program - Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a smoking cessation program - Yes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;SMOKING_CESSATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recommended to a smoking cessation program - No&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecommended to a smoking cessation program - No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a smoking cessation program - No&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">##########################</span>
        <span class="c1"># CEREBROVASCULAR EXPERT #</span>
        <span class="c1">##########################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset_alive</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CEREBROVASCULAR_EXPERT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Claculate number of patients entered to the old form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CEREBROVASCULAR_EXPERT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CEREBROVASCULAR_EXPERT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecommended to a cerebrovascular expert - Recommended, and appointment was made&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CEREBROVASCULAR_EXPERT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecommended to a cerebrovascular expert - Recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Recommended&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;CEREBROVASCULAR_EXPERT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Not recommended&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecommended to a cerebrovascular expert - Not recommended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recommended to a cerebrovascular expert - Not recommended&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_alive_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########################</span>
        <span class="c1"># DISCHARGE DESTINATION #</span>
        <span class="c1">#########################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Home&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Home&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Transferred within the same centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Transferred within the same centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Transferred within the same centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Transferred to another centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Transferred to another centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Transferred to another centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Social care facility&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Social care facility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Social care facility&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_DESTINATION&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# discharge destination - Dead&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">ischarge destination - Dead&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# discharge destination - Dead&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#######################################</span>
        <span class="c1"># DISCHARGE DESTINATION - SAME CENTRE #</span>
        <span class="c1">#######################################</span>
        <span class="n">discharge_subset_same_centre</span> <span class="o">=</span> <span class="n">discharge_subset</span><span class="p">[</span><span class="n">discharge_subset</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">discharge_subset_same_centre</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset_same_centre</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_SAME_FACILITY&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_SAME_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred within the same centre - Acute rehabilitation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred within the same centre - Acute rehabilitation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred within the same centre - Acute rehabilitation&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_SAME_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred within the same centre - Post-care bed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred within the same centre - Post-care bed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred within the same centre - Post-care bed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_SAME_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred within the same centre - Another department&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred within the same centre - Another department&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred within the same centre - Another department&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_same_centre_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">############################################</span>
        <span class="c1"># DISCHARGE DESTINATION - ANOTHER FACILITY #</span>
        <span class="c1">############################################</span>
        <span class="n">discharge_subset_another_centre</span> <span class="o">=</span> <span class="n">discharge_subset</span><span class="p">[</span><span class="n">discharge_subset</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">discharge_subset_another_centre</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset_another_centre</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_OTHER_FACILITY&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Calculate number of patients entered to the old form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred to another centre - Stroke centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred to another centre - Stroke centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred to another centre - Stroke centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred to another centre - Comprehensive stroke centre&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred to another centre - Comprehensive stroke centre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred to another centre - Comprehensive stroke centre&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# transferred to another centre - Another hospital&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% transferred to another centre - Another hospital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# transferred to another centre - Another hospital&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#########################################################</span>
        <span class="c1"># DISCHARGE DESTINATION - ANOTHER FACILITY - DEPARTMENT #</span>
        <span class="c1">#########################################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">discharge_subset_another_centre</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_OTHER_FACILITY_O1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">tmp_o2</span> <span class="o">=</span> <span class="n">discharge_subset_another_centre</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_OTHER_FACILITY_O2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">tmp_o3</span> <span class="o">=</span> <span class="n">discharge_subset_another_centre</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCHARGE_OTHER_FACILITY_O3&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Calculate number of patients entered to the old form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Acute rehabilitation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O3&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment transferred to within another centre - Acute rehabilitation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Acute rehabilitation&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Post-care bed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O3&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment transferred to within another centre - Post-care bed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Post-care bed&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Neurology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O3&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment transferred to within another centre - Neurology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Neurology&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Another department&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_only_columns</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;DISCHARGE_OTHER_FACILITY_O3&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="n">tmp_o3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">epartment transferred to within another centre - Another department&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# department transferred to within another centre - Another department&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;discharge_subset_another_centre_patients&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">############################################</span>
        <span class="c1"># DISCHARGE DESTINATION - ANOTHER FACILITY #</span>
        <span class="c1">############################################</span>
        <span class="n">discharge_subset</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">discharge_subset_mrs</span> <span class="o">=</span> <span class="n">discharge_subset</span><span class="p">[</span><span class="o">~</span><span class="n">discharge_subset</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_MRS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#discharge_subset_mrs[&#39;DISCHARGE_MRS&#39;] = discharge_subset_mrs[&#39;DISCHARGE_MRS&#39;].astype(float)</span>

        <span class="k">def</span> <span class="nf">convert_mrs_on_discharge</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; The function calculating mRS on discharge. Options: 1 (unknown/derivate), 2 = 0, 3 = 1, 4 = 2, 5 = 3, 6 = 4, 7 = 5, 8 = 6.</span>

<span class="sd">            :param x: the mRS value from the dropdown</span>
<span class="sd">            :type x: int</span>
<span class="sd">            :returns: x -- value converted to score</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> 

            <span class="k">return</span> <span class="n">x</span>

        <span class="k">if</span> <span class="n">discharge_subset_mrs</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;Median discharge mRS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">discharge_subset_mrs</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_MRS_ADJUSTED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">discharge_subset_mrs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">convert_mrs_on_discharge</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_MRS&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">discharge_subset_mrs</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_MRS_ADDED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">discharge_subset_mrs</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_MRS_ADJUSTED&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">discharge_subset_mrs</span><span class="p">[</span><span class="s1">&#39;D_MRS_SCORE&#39;</span><span class="p">]</span>
            <span class="n">discharge_subset_mrs</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">discharge_subset_mrs</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">DISCHARGE_MRS_ADDED</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median discharge mRS&#39;</span><span class="p">})[</span><span class="s1">&#39;Median discharge mRS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">########################</span>
        <span class="c1"># MEDIAN HOSPITAL STAY #</span>
        <span class="c1">########################</span>
        <span class="n">positive_hospital_days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;HOSPITAL_DAYS&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">positive_hospital_days</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">HOSPITAL_DAYS</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="s1">&#39;Median hospital stay (days)&#39;</span><span class="p">})[</span><span class="s1">&#39;Median hospital stay (days)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">wrong_ivtpa</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;wrong_ivtpa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">wrong_ivtpa</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# patients eligible thrombolysis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;wrong_ivtpa&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;wrong_ivtpa&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">wrong_tby</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;wrong_tby&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">wrong_tby</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;# patients eligible thrombectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# recanalization procedures - Endovascular treatment alone&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;wrong_tby&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;wrong_tby&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">################</span>
        <span class="c1"># ANGEL AWARDS #</span>
        <span class="c1">################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_patient_column</span> <span class="o">=</span> <span class="s1">&#39;# total patients &gt;= </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_patient_column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;Total Patients&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_limit</span>

        <span class="c1">#### DOOR TO THROMBOLYSIS THERAPY - MINUTES ####</span>
        <span class="c1"># If thrombectomy done not at all, take the possible lowest award they can get</span>

        <span class="c1"># Create temporary dataframe only with rows where thrombolysis was performed under 60 minute</span>
        <span class="n">recanalization_procedure_iv_tpa_under_60</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)]</span>
        <span class="c1"># Create temporary dataframe only with rows where thrombolysis was performed under 45 minute</span>
        <span class="n">recanalization_procedure_iv_tpa_under_45</span> <span class="o">=</span> <span class="n">recanalization_procedure_iv_tpa</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_iv_tpa</span><span class="p">[</span><span class="s1">&#39;IVTPA&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">45</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_iv_tpa_under_60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombolysis&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombolysis&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_iv_tpa_under_45</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombolysis&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombolysis&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># for tby, we are only looking at patients that have had ONLY tby, not tpa + tby, as we awould be counting those patients twice (penalizing twice)</span>
        <span class="n">recanalization_procedure_tby_only_dtg</span> <span class="o">=</span>  <span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="n">recanalization_procedure_tby_dtg</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])]</span>

        <span class="c1"># Create temporary dataframe only with rows where trombectomy was performed under 90 minutes</span>
        <span class="n">recanalization_procedure_tby_only_dtg_under_90</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_only_dtg</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)]</span>
        <span class="c1"># Create temporary dataframe only with rows where trombectomy was performed under 60 minutes</span>
        <span class="n">recanalization_procedure_tby_only_dtg_under_60</span> <span class="o">=</span> <span class="n">recanalization_procedure_tby_only_dtg</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">recanalization_procedure_tby_only_dtg</span><span class="p">[</span><span class="s1">&#39;TBY&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_tby_only_dtg_under_90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombectomy&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombectomy&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">recanalization_procedure_tby_only_dtg_under_60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombectomy&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombectomy&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### RECANALIZATION RATE ####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# recanalization rate out of total ischemic incidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients recanalized&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization rate out of total ischemic incidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients recanalized&#39;</span><span class="p">]</span>

        <span class="c1">#### CT/MRI ####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# suspected stroke patients undergoing CT/MRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# CT/MRI - performed&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">uspected stroke patients undergoing CT/MRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% CT/MRI - performed&#39;</span><span class="p">]</span>

        <span class="c1">#### DYSPHAGIA SCREENING ####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Guss test&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Other test&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# dysphagia screening - Not done&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### ISCHEMIC STROKE + NO AFIB + ANTIPLATELETS ####</span>
        <span class="c1"># Exclude patients referred for recanalization procedure</span>
        <span class="n">non_transferred_antiplatelets</span> <span class="o">=</span> <span class="n">antithrombotics</span><span class="p">[</span><span class="o">~</span><span class="n">antithrombotics</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])]</span>
        <span class="c1"># Get temporary dataframe with patients who have prescribed antithrombotics and ischemic stroke</span>
        <span class="n">antiplatelets</span> <span class="o">=</span> <span class="n">non_transferred_antiplatelets</span><span class="p">[</span><span class="n">non_transferred_antiplatelets</span><span class="p">[</span><span class="s1">&#39;STROKE_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1"># Filter temporary dataframe and get only patients who have not been detected or not known for aFib flutter. </span>
        <span class="n">antiplatelets</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="p">[</span><span class="n">antiplatelets</span><span class="p">[</span><span class="s1">&#39;AFIB_FLUTTER&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
        <span class="c1"># Get patients who have prescribed antithrombotics </span>
        <span class="n">except_recommended</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="p">[</span><span class="o">~</span><span class="n">antiplatelets</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">9</span><span class="p">])]</span>

        <span class="c1"># Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">except_recommended</span><span class="p">)</span>
        <span class="c1"># Get temporary dataframe groupby protocol ID and antithrombotics column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># discharged home</span>
        <span class="n">antiplatelets_discharged_home</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="p">[</span><span class="n">antiplatelets</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">antiplatelets_discharged_home</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antiplatelets</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_patients&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">antiplatelets_discharged_home</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="c1"># Get patients who have prescribed antithrombotics </span>
            <span class="n">except_recommended_discharged_home</span> <span class="o">=</span> <span class="n">except_recommended</span><span class="p">[</span><span class="n">except_recommended</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>

            <span class="c1"># Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">except_recommended_discharged_home</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_for_factors</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;ANTITHROMBOTICS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;except_recommended_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Comapre number of ischemic stroke patients discharged with antiplatelets to the discharged home with antiplatelets and select the higher value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged (home) with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# ischemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged (home) with antiplatelets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged with antiplatelets&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged home with antiplatelets&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### ISCHEMIC STROKE + AFIB + ANTICOAGULANTS ####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed</span><span class="p">)</span>
        <span class="c1"># Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics or with nothign (ANTITHROMBOTICS = 10)</span>
        <span class="n">afib_detected_discharged_home</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))]</span>
        <span class="c1"># Get afib patients discharged and not dead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_discharged_home</span><span class="p">)</span>

        <span class="c1"># self.statsDf[&#39;% afib patients discharged with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged with anticoagulants&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;]) &gt; 0 else 0, axis=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged with anticoagulants&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_patients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Get temporary dataframe with patients who have prescribed anticoagulats and were discharged home </span>
        <span class="n">non_trasferred_anticoagulants</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="o">~</span><span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])]</span>
        <span class="n">anticoagulants_prescribed_discharged_home</span> <span class="o">=</span> <span class="n">non_trasferred_anticoagulants</span><span class="p">[</span><span class="n">non_trasferred_anticoagulants</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1"># anticoagulants_prescribed_discharged_home = anticoagulants_prescribed[anticoagulants_prescribed[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]</span>
        <span class="c1"># Get temporary dataframe with patients who have been discharge at home with detected aFib flutter and with prescribed antithrombotics</span>
        <span class="c1"># afib_detected_discharged_home = afib_flutter_detected[(afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([1])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9]))]</span>
        <span class="n">afib_detected_discharged_home</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[(</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;RECANALIZATION_PROCEDURES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]))]</span>

        <span class="c1"># Check if temporary dataframe is empty. If yes, the value is calculated not only for discharged home, but only dead patients are excluded</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">anticoagulants_prescribed_discharged_home</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
            <span class="c1"># afib patients discharged home with anticoagulants	</span>
            <span class="n">anticoagulants_prescribed_discharged_home</span> <span class="o">=</span> <span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="o">~</span><span class="n">anticoagulants_prescribed</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">])]</span>
            <span class="c1"># Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics </span>
            <span class="n">afib_detected_discharged_home</span> <span class="o">=</span> <span class="n">afib_flutter_detected</span><span class="p">[(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;DISCHARGE_DESTINATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">afib_flutter_detected</span><span class="p">[</span><span class="s1">&#39;ANTITHROMBOTICS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">]))]</span>
            <span class="c1"># Get # afib patients discharged home with anticoagulants</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed_discharged_home</span><span class="p">)</span>
            <span class="c1"># Get afib patients discharged and not dead</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_discharged_home</span><span class="p">)</span>
            <span class="c1"># Get % afib patients discharge with anticoagulants and not dead</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">anticoagulants_prescribed_discharged_home</span><span class="p">)</span>
            <span class="c1"># Get afib patients discharged home </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_patients</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">afib_detected_discharged_home</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;afib_detected_discharged_home_patients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged (home) with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# afib patients discharged home with anticoagulants&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged (home) with anticoagulants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged with anticoagulants&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged home with anticoagulants&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#### STROKE UNIT ####</span>
        <span class="c1"># stroke patients treated in a dedicated stroke unit / ICU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# stroke patients treated in a dedicated stroke unit / ICU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;# patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span>

        <span class="c1"># % stroke patients treated in a dedicated stroke unit / ICU	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke patients treated in a dedicated stroke unit / ICU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;% patients hospitalized in stroke unit / ICU&#39;</span><span class="p">]</span>

        <span class="c1"># Create temporary dataframe to calculate final award </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angels_awards_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_patient_column</span><span class="p">,</span> <span class="s1">&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization rate out of total ischemic incidence&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% s</span><span class="s1">uspected stroke patients undergoing CT/MRI&#39;</span><span class="p">,</span> <span class="s1">&#39;% all stroke patients undergoing dysphagia screening&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged (home) with antiplatelets&#39;</span><span class="p">,</span> <span class="s1">&#39;% afib patients discharged (home) with anticoagulants&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke patients treated in a dedicated stroke unit / ICU&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients eligible thrombectomy&#39;</span><span class="p">,</span> <span class="s1">&#39;# patients eligible thrombolysis&#39;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">angels_awards_tmp</span><span class="p">[</span><span class="s1">&#39;Proposed Award&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angels_awards_tmp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_final_award</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">[</span><span class="s1">&#39;Proposed Award&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angels_awards_tmp</span><span class="p">[</span><span class="s1">&#39;Proposed Award&#39;</span><span class="p">]</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Protocol ID&quot;</span><span class="p">:</span> <span class="s2">&quot;Site ID&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sites</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_final_award</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function calculating the proposed award. </span>

<span class="sd">        :param x: the row from temporary dataframe</span>
<span class="sd">        :type x: pandas series</span>
<span class="sd">        :returns: award -- the proposed award</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_patient_column</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;TRUE&quot;</span>

        <span class="n">thrombolysis_pts</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombolysis&#39;</span><span class="p">]</span>
        
        <span class="n">thrombolysis_therapy_lt_60min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;</span><span class="p">]</span>
        
        <span class="c1"># Calculate award for thrombolysis, if no patients were eligible for thrombolysis and number of total patients was greater than minimum than the award is set to DIAMOND </span>
        <span class="k">if</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thrombolysis_pts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombolysis_therapy_lt_60min</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">thrombolysis_therapy_lt_60min</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">74.99</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombolysis_therapy_lt_60min</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="n">thrombolysis_therapy_lt_45min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thrombolysis_pts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombolysis_therapy_lt_45min</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">49.99</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;GOLD&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                        <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombolysis_therapy_lt_45min</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;GOLD&quot;</span><span class="p">):</span>
                        <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="c1"># Calculate award for thrombectomy, if no patients were eligible for thrombectomy and number of total patients was greater than minimum than the award is set to the possible proposed award (eg. if in thrombolysis step award was set to GOLD then the award will be GOLD)</span>
        <span class="n">thrombectomy_pts</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;# patients eligible thrombectomy&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">thrombectomy_pts</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">thrombectomy_therapy_lt_90min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombectomy_therapy_lt_90min</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">thrombectomy_therapy_lt_90min</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">74.99</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                        <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombectomy_therapy_lt_90min</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                        <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

            <span class="n">thrombectomy_therapy_lt_60min</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombectomy_therapy_lt_60min</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">49.99</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;GOLD&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                        <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">thrombectomy_therapy_lt_60min</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                        <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="n">recan_rate</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% r</span><span class="s1">ecanalization rate out of total ischemic incidence&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">recan_rate</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">recan_rate</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">14.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">recan_rate</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">15</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">recan_rate</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">24.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">recan_rate</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="n">ct_mri</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">uspected stroke patients undergoing CT/MRI&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ct_mri</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">ct_mri</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">84.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ct_mri</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">85</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">ct_mri</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">89.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ct_mri</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="n">dysphagia_screening</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% all stroke patients undergoing dysphagia screening&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dysphagia_screening</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">dysphagia_screening</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">84.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dysphagia_screening</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">85</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">dysphagia_screening</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">89.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dysphagia_screening</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="n">discharged_with_antiplatelets_final</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% i</span><span class="s1">schemic stroke patients discharged (home) with antiplatelets&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_antiplatelets_final</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_antiplatelets_final</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">84.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_antiplatelets_final</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">85</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_antiplatelets_final</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">89.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_antiplatelets_final</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="n">discharged_with_anticoagulants_final</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;% afib patients discharged (home) with anticoagulants&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_anticoagulants_final</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_anticoagulants_final</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">84.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;PLATINUM&quot;</span> <span class="ow">or</span> <span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;GOLD&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_anticoagulants_final</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">85</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_anticoagulants_final</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">89.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">discharged_with_anticoagulants_final</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="n">stroke_unit</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% s</span><span class="s1">troke patients treated in a dedicated stroke unit / ICU&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">award</span> <span class="o">!=</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">stroke_unit</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.99</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;PLATINUM&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">stroke_unit</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">award</span> <span class="o">==</span> <span class="s2">&quot;DIAMOND&quot;</span><span class="p">):</span>
                    <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;DIAMOND&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">award</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>

        <span class="k">return</span> <span class="n">award</span>

    <span class="k">def</span> <span class="nf">_count_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function calculating the number of patients per site. </span>

<span class="sd">        :param dataframe: the dataframe with the raw data</span>
<span class="sd">        :type dataframe: dataframe</span>
<span class="sd">        :returns: the column with number of patients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count_patients&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span><span class="p">[</span><span class="s1">&#39;count_patients&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_values_only_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function calculating the numbeer of patients per site for the given value from the temporary dataframe. </span>

<span class="sd">        :param column_name: the name of column name the number of patients should be calculated</span>
<span class="sd">        :type column_name: str</span>
<span class="sd">        :param value: the value for which we would like to get number of patients from the specific column</span>
<span class="sd">        :type value: int</span>
<span class="sd">        :param dataframe: the dataframe with the raw data</span>
<span class="sd">        :type dataframe: pandas dataframe</span>
<span class="sd">        :returns: the column with the number of patients</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">dataframe</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
        <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_values_for_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function calculating the numbeer of patients per site for the given value from the temporary dataframe. </span>

<span class="sd">        :param column_name: the name of column name the number of patients should be calculated</span>
<span class="sd">        :type column_name: str</span>
<span class="sd">        :param value: the value for which we would like to get number of patients from the specific column</span>
<span class="sd">        :type value: int</span>
<span class="sd">        :param new_column_name: to this value will be renamed the created column containing the number of patients</span>
<span class="sd">        :type new_column_name: str</span>
<span class="sd">        :param df: the dataframe with the raw data</span>
<span class="sd">        :type df: pandas dataframe</span>
<span class="sd">        :returns: the dataframe with calculated statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if type of column name is type of number, if not convert value into string</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> 

        <span class="n">tmpDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
        <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span>

    <span class="k">def</span> <span class="nf">_get_values_for_factors_more_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function calculating the number of patients per site for the given value from the temporary dataframe. </span>

<span class="sd">        :param column_name: the name of column name the number of patients should be calculated</span>
<span class="sd">        :type column_name: str</span>
<span class="sd">        :param value: the list of values for which we would like to get number of patients from the specific column</span>
<span class="sd">        :type value: list</span>
<span class="sd">        :param new_column_name: to this value will be renamed the created column containing the number of patients</span>
<span class="sd">        :type new_column_name: str</span>
<span class="sd">        :param df: the dataframe with the raw data</span>
<span class="sd">        :type df: pandas dataframe</span>
<span class="sd">        :returns: the dataframe with calculated statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span>

    <span class="k">def</span> <span class="nf">_get_values_for_factors_containing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function calculating the number of patients per site for the given value from the temporary dataframe. </span>

<span class="sd">        :param column_name: the name of column name the number of patients should be calculated</span>
<span class="sd">        :type column_name: str</span>
<span class="sd">        :param value: the value of string type for which we would like to get number of patients from the specific column</span>
<span class="sd">        :type value: str</span>
<span class="sd">        :param new_column_name: to this value will be renamed the created column containing the number of patients</span>
<span class="sd">        :type new_column_name: str</span>
<span class="sd">        :param df: the dataframe with the raw data</span>
<span class="sd">        :type df: pandas dataframe</span>
<span class="sd">        :returns: the dataframe with calculated statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span>
            <span class="n">tmpDf</span> <span class="o">=</span> <span class="n">tmpDf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Protocol ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">factorDf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmpDf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">new_column_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">factorDf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">factorDf</span>

    <span class="k">def</span> <span class="nf">_get_ctmri_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hosp_time</span><span class="p">,</span> <span class="n">ct_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function calculating the difference between two times in minutes. </span>

<span class="sd">        :param hosp_time: the time of hospitalization</span>
<span class="sd">        :type hosp_time: time</span>
<span class="sd">        :param ct_time: the time when CT/MRI was performed</span>
<span class="sd">        :type ct_time: time</span>
<span class="sd">        :returns: tdelta between two times in minutes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">timeformat</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S&#39;</span>

        <span class="c1"># Check if both time are not None if yes, return 0 else return tdelta</span>
        <span class="k">if</span> <span class="n">hosp_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ct_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">ct_time</span><span class="p">):</span>
            <span class="n">tdeltaMin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">hosp_time</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ct_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tdeltaMin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">ct_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">hosp_time</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">ct_time</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">ct_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">hosp_time</span><span class="p">,</span> <span class="n">timeformat</span><span class="p">)</span>	
            <span class="n">tdeltaMin</span> <span class="o">=</span> <span class="n">tdelta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">60.0</span>

        <span class="k">if</span> <span class="n">tdeltaMin</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">tdeltaMin</span> <span class="o">&lt;=</span> <span class="mi">60</span> <span class="ow">and</span> <span class="n">tdeltaMin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">res</span>

    
    <span class="k">def</span> <span class="nf">_return_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function returning dataframe. &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>

    <span class="k">def</span> <span class="nf">_return_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function returning the dataframe with the calculated statistics! </span>
<span class="sd">        </span>
<span class="sd">        :returns: the dataframe with the statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statsDf</span>

    <span class="k">def</span> <span class="nf">_get_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The function returning the list of sites in the preprocessed data. </span>
<span class="sd">        </span>
<span class="sd">        :returns: the list of sites</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">site_ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Site ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">site_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">site_ids</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">site_list</span></div>









        



        

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">RES-Q package</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Marie Jankujova.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>