<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.6.2" />
<title>resqdb.Calculation API documentation</title>
<meta name="description" content="Created on Thu Jul 09 13:28:05 2017 â€¦" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>resqdb.Calculation</code></h1>
</header>
<section id="section-intro">
<p>Created on Thu Jul 09 13:28:05 2017</p>
<p>@author: Marie Jankujova</p>
<details class="source">
<summary>Source code</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
&#34;&#34;&#34;
Created on Thu Jul 09 13:28:05 2017

@author: Marie Jankujova
&#34;&#34;&#34;

import sys
import os
from datetime import datetime, time, date
import sqlite3
import pandas as pd
import numpy as np
from numpy import inf
import pytz
import logging
import scipy.stats as st
from scipy.stats import sem, t
from scipy import mean



class FilterDataset:
    &#34;&#34;&#34; Filter dataset by country and the time period. 

    Args:
        df: The preprocessed dataframe
        country: The country code of country which should be included in the resulted calculation (default: None)
        date1: The first daate included in the filtered dataframe (default: None)
        date2: The last date included in the filtered dataframe (default: None)
    Returns:
        The filtered dataframe. 
    &#34;&#34;&#34;

    def __init__(self, df, country=None, date1=None, date2=None):

        # Create log file in the working folder
        log_file = os.path.join(os.getcwd(), &#39;debug.log&#39;)
        logging.basicConfig(filename=log_file,
                            filemode=&#39;a&#39;,
                            format=&#39;%(asctime)s,%(msecs)d %(name)s %(levelname)s %(message)s&#39;,
                            datefmt=&#39;%H:%M:%S&#39;,
                            level=logging.DEBUG)

        self.fdf = df.copy()
        self.country = country
        self.date1 = date1
        self.date2 = date2

        if self.country is not None:
            # Append &#34;_&#34; to the country code, because e.g. ES_MD was included in dataset for MD as well.
            country = self.country + &#34;_&#34; 

            self.fdf = self._filter_by_country(country=country)
            logging.info(&#39;FilterDataset: Data have been filtered for country {0}!&#39;.format(self.country)) 
        
        if self.date1 is not None and self.date2 is not None:

            self.fdf = self._filter_by_date()
            logging.info(&#39;FilterDataset: Data have been filtered for date {0} - {1}!&#39;.format(self.date1, self.date2))
        
        
    def _filter_by_country(self, country):
        &#34;&#34;&#34; Return dataframe containing only rows for the given country. 
        
        Args:
            country: The changed country code.
        Returns:
            The filtered dataframe. 
        &#34;&#34;&#34;
        df = self.fdf[self.fdf[&#39;Protocol ID&#39;].str.startswith(self.country) == True]

        return df

    def _filter_by_date(self):
        &#34;&#34;&#34; Return dataframe containing only rows where discharge date is between these two dates. 

        Args: 
            date1: The first date included in the filtered dataframe
            date2: The last date included in the filtered dataframe
        Returns: 
            The filtered dataframe
        &#34;&#34;&#34;
        if isinstance(self.date1, datetime):
            self.date1 = self.date1.date()
        if isinstance(self.date2, datetime):
            self.date2 = self.date2.date()

        df = self.fdf[(self.fdf[&#39;DISCHARGE_DATE&#39;] &gt;= self.date1) &amp; (self.fdf[&#39;DISCHARGE_DATE&#39;] &lt;= self.date2)]

        return df


class ComputeStats:

    &#34;&#34;&#34;
    This module compute statistics from the raw data. 
    
    Keyword arguments:
    df -- the raw dataframe
    country -- True if country should be included as site into results (default False)
    country_code -- the country code of country if data were filtered (default &#34;&#34;)
    comparison -- True if we are compare the data (e.g. countries between each other)
    &#34;&#34;&#34;

    def __init__(self, df, country = False, country_code = &#34;&#34;, comparison=False, patient_limit=0):

        self.df = df.copy()
        self.df.fillna(0, inplace=True)
        self.patient_limit = patient_limit

        # Get short Protocol IDs - it means RESQ-v - PL_001 will be PL_001
        def get_country_name(value):
            if value == &#34;UZB&#34;:
                value = &#39;UZ&#39;
            country_name = pytz.country_names[value]
            return country_name

        if comparison == False:
            self.df[&#39;Protocol ID&#39;] = self.df.apply(lambda row: row[&#39;Protocol ID&#39;].split()[2] if (len(row[&#39;Protocol ID&#39;].split()) == 3) else row[&#39;Protocol ID&#39;].split()[0], axis=1)
            # uncomment if you want stats between countries and set comparison == True
            #self.df[&#39;Protocol ID&#39;] = self.df.apply(lambda x: x[&#39;Protocol ID&#39;].split(&#34;_&#34;)[0], axis=1)
        #print(set(list(self.df[&#39;Protocol ID&#39;])))

        # If you want to compare, instead of Site Names will be Country names. 
        if comparison:
            if self.df[&#39;Protocol ID&#39;].dtype == np.object:
                self.df[&#39;Site Name&#39;] = self.df.apply(lambda x: get_country_name(x[&#39;Protocol ID&#39;]) if get_country_name(x[&#39;Protocol ID&#39;]) != &#34;&#34; else x[&#39;Protocol ID&#39;], axis=1)
        
        
        if (country):
            country = self.df.copy()
            self.country_name = pytz.country_names[country_code]
            country[&#39;Protocol ID&#39;] = self.country_name
            country[&#39;Site Name&#39;] = self.country_name
            self.df = pd.concat([self.df, country])
        else:
            self.country_name = &#34;&#34;
        
        # Get Protocol IDs and Total Patients 
        self.statsDf = self.df.groupby([&#39;Protocol ID&#39;, &#39;Site Name&#39;]).size().reset_index(name=&#34;Total Patients&#34;)
        #self.statsDf[&#39;Site Name&#39;] = 

        self.statsDf = self.statsDf[[&#39;Protocol ID&#39;, &#39;Site Name&#39;, &#39;Total Patients&#39;]]

        # Median age
        self.statsDf[&#39;Median patient age&#39;] = self.df.groupby([&#39;Protocol ID&#39;]).AGE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median patient age&#39;})[&#39;Median patient age&#39;].tolist()

        # get patietns with ischemic stroke (ISch) (1)
        isch = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1])]
        self.statsDf[&#39;isch_patients&#39;] = self._count_patients(dataframe=isch)

        # get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 2, 3, 5)
        is_ich_tia_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 2, 3, 5])]
        self.statsDf[&#39;is_ich_tia_cvt_patients&#39;] = self._count_patients(dataframe=is_ich_tia_cvt)

        # get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), or cerebral venous thrombosis (CVT) (1, 2, 5)
        is_ich_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 2, 5])]
        self.statsDf[&#39;is_ich_cvt_patients&#39;] = self._count_patients(dataframe=is_ich_cvt)
        # Get dataframe with patients who had ischemic stroke (IS) or intracerebral hemorrhage (ICH)
        is_ich = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1,2])]
        self.statsDf[&#39;is_ich_patients&#39;] = self._count_patients(dataframe=is_ich)
        # get patietns with ischemic stroke (IS) and transient ischemic attack (TIA) (1, 3)
        is_tia = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 3])]
        self.statsDf[&#39;is_tia_patients&#39;] = self._count_patients(dataframe=is_tia)

        # get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), subarrachnoid hemorrhage (SAH) or cerebral venous thrombosis (CVT) (1, 2, 4, 5)
        is_ich_sah_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 2, 4, 5])]
        self.statsDf[&#39;is_ich_sah_cvt_patients&#39;] = self._count_patients(dataframe=is_ich_sah_cvt)

        # get patietns with ischemic stroke (IS), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 3, 5)
        is_tia_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 3, 5])]
        self.statsDf[&#39;is_tia_cvt_patients&#39;] = self._count_patients(dataframe=is_tia_cvt)

        # get patients with cerebral venous thrombosis (CVT) (5)
        cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([5])]
        self.statsDf[&#39;cvt_patients&#39;] = self._count_patients(dataframe=cvt)

        # get patietns with intracerebral hemorrhage (ICH) and subarrachnoid hemorrhage (SAH) (2, 4)
        ich_sah = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([2, 4])]
        self.statsDf[&#39;ich_sah_patients&#39;] = self._count_patients(dataframe=ich_sah)
        
        # get patietns with intracerebral hemorrhage (ICH) (2)
        ich = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([2])]
        self.statsDf[&#39;ich_patients&#39;] = self._count_patients(dataframe=ich)

        # get patietns with subarrachnoid hemorrhage (SAH) (4)
        sah = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([4])]
        self.statsDf[&#39;sah_patients&#39;] = self._count_patients(dataframe=sah)

        # create subset with no referrals (RECANALIZATION_PROCEDURE != [5,6]) AND (HEMICRANIECTOMY != 3)
        discharge_subset = self.df[~self.df[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6]) &amp; ~self.df[&#39;HEMICRANIECTOMY&#39;].isin([3])]
        self.statsDf[&#39;discharge_subset_patients&#39;] = self._count_patients(dataframe=discharge_subset)

        # Create discharge subset alive
        discharge_subset_alive = self.df[~self.df[&#39;DISCHARGE_DESTINATION&#39;].isin([5])]
        self.statsDf[&#39;discharge_subset_alive_patients&#39;] = self._count_patients(dataframe=discharge_subset_alive)


        ##########
        # GENDER #
        ##########
        # Get gender calculation in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;GENDER&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get female patients 
        self.statsDf = self._get_values_for_factors(column_name=&#34;GENDER&#34;, value=2, new_column_name=&#39;# patients female&#39;)

        # Get only female patients in % out of total patients. 
        self.statsDf[&#39;% patients female&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients female&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get male patients 
        self.statsDf = self._get_values_for_factors(column_name=&#34;GENDER&#34;, value=1, new_column_name=&#39;# patients male&#39;)

        # Get % of male patients
        self.statsDf[&#39;% patients male&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients male&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% patients female&#39;] + self.statsDf[&#39;% patients male&#39;] 
        #self.statsDf[&#39;% patients female&#39;] = self.statsDf.apply(lambda x: x[&#39;% patients female&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% patients female&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)


        ######################
        # STROKE IN HOSPITAL #
        ######################
        # Get hospital stoke in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;HOSPITAL_STROKE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients having stroke in the hospital - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITAL_STROKE&#34;, value=1, new_column_name=&#39;# patients having stroke in the hospital - Yes&#39;)

        # Get % patients having stroke in the hospital - Yes
        self.statsDf[&#39;% patients having stroke in the hospital - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients having stroke in the hospital - Yes&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients having stroke in the hospital - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITAL_STROKE&#34;, value=2, new_column_name=&#39;# patients having stroke in the hospital - No&#39;)

        # Get % patients having stroke in the hospital - Yes
        self.statsDf[&#39;% patients having stroke in the hospital - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients having stroke in the hospital - No&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        ####################
        # RECURRENT STROKE #
        ####################
        # Get recurrent stoke in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;RECURRENT_STROKE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECURRENT_STROKE&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get patients having recurrent stroke - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECURRENT_STROKE&#34;, value=1, new_column_name=&#39;# recurrent stroke - Yes&#39;)

        # Get % patients having recurrent stroke - Yes
        self.statsDf[&#39;% recurrent stroke - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recurrent stroke - Yes&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get ppatients having recurrent stroke - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECURRENT_STROKE&#34;, value=2, new_column_name=&#39;# recurrent stroke - No&#39;)

        # Get % patients having recurrent stroke - No
        self.statsDf[&#39;% recurrent stroke - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recurrent stroke - No&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ###################
        # DEPARTMENT TYPE #
        ###################
        # Get department type in one dataframe
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;DEPARTMENT_TYPE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get patients in neurology
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=1, new_column_name=&#39;# department type - neurology&#39;)

        # Get % patients in neurology
        self.statsDf[&#39;% department type - neurology&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - neurology&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in neurosurgery
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=2, new_column_name=&#39;# department type - neurosurgery&#39;)

        # Get % patients in neurosurgery
        self.statsDf[&#39;% department type - neurosurgery&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - neurosurgery&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in anesthesiology/resuscitation/critical care
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=3, new_column_name=&#39;# department type - anesthesiology/resuscitation/critical care&#39;)

        # Get % patients in anesthesiology/resuscitation/critical care
        self.statsDf[&#39;% department type - anesthesiology/resuscitation/critical care&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - anesthesiology/resuscitation/critical care&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in internal medicine
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=4, new_column_name=&#39;# department type - internal medicine&#39;)

        # Get % patients in internal medicine
        self.statsDf[&#39;% department type - internal medicine&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - internal medicine&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in geriatrics
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=5, new_column_name=&#39;# department type - geriatrics&#39;)

        # Get % patients in geriatrics
        self.statsDf[&#39;% department type - geriatrics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - geriatrics&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in Other
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=6, new_column_name=&#39;# department type - Other&#39;)

        # Get % patients in Other
        self.statsDf[&#39;% department type - Other&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - Other&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ###################
        # HOSPITALIZED IN #
        ###################
        # Get hospitalized in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;HOSPITALIZED_IN&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients hospitalized in stroke unit / ICU
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITALIZED_IN&#34;, value=1, new_column_name=&#39;# patients hospitalized in stroke unit / ICU&#39;)

        # Get % patients hospitalized in stroke unit / ICU
        self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients hospitalized in stroke unit / ICU&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)


        # Get patients hospitalized in monitored bed with telemetry
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITALIZED_IN&#34;, value=2, new_column_name=&#39;# patients hospitalized in monitored bed with telemetry&#39;)

        # Get % patients hospitalized in monitored bed with telemetry
        self.statsDf[&#39;% patients hospitalized in monitored bed with telemetry&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients hospitalized in monitored bed with telemetry&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients hospitalized in standard bed
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITALIZED_IN&#34;, value=3, new_column_name=&#39;# patients hospitalized in standard bed&#39;)

        # Get % patients hospitalized in standard bed
        self.statsDf[&#39;% patients hospitalized in standard bed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients hospitalized in standard bed&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Check if sum of % is &gt; 100 (100.01)
        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] + self.statsDf[&#39;% patients hospitalized in monitored bed with telemetry&#39;] + self.statsDf[&#39;% patients hospitalized in standard bed&#39;]
        #self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] = self.statsDf.apply(lambda x: x[&#39;% patients hospitalized in stroke unit / ICU&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% patients hospitalized in stroke unit / ICU&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)


        ###############################
        # ASSESSED FOR REHABILITATION #
        ###############################
        # Get assessed for rehabilitation in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;ASSESSED_FOR_REHAB&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients assessed for rehabilitation - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;ASSESSED_FOR_REHAB&#34;, value=3, new_column_name=&#39;# patients assessed for rehabilitation - Not known&#39;)

        # Get % patients assessed for rehabilitation - Not known
        self.statsDf[&#39;% patients assessed for rehabilitation - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients assessed for rehabilitation - Not known&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients assessed for rehabilitation - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;ASSESSED_FOR_REHAB&#34;, value=1, new_column_name=&#39;# patients assessed for rehabilitation - Yes&#39;)

        # Get % patients assessed for rehabilitation - Yes
        self.statsDf[&#39;% patients assessed for rehabilitation - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients assessed for rehabilitation - Yes&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;]) &gt; 0 else 0, axis=1)

        # Get patients assessed for rehabilitation - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;ASSESSED_FOR_REHAB&#34;, value=2, new_column_name=&#39;# patients assessed for rehabilitation - No&#39;)

        # Get % patients assessed for rehabilitation - No
        self.statsDf[&#39;% patients assessed for rehabilitation - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients assessed for rehabilitation - No&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;]) &gt; 0 else 0, axis=1)

        ###############
        # STROKE TYPE #
        ###############
        # Get stroke type in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;STROKE_TYPE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get stroke type - ischemic stroke
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=1, new_column_name=&#39;# stroke type - ischemic stroke&#39;)

        # Get % stroke type - ischemic stroke
        self.statsDf[&#39;% stroke type - ischemic stroke&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - ischemic stroke&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - intracerebral hemorrhage
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=2, new_column_name=&#39;# stroke type - intracerebral hemorrhage&#39;)

        # Get % stroke type - intracerebral hemorrhage
        self.statsDf[&#39;% stroke type - intracerebral hemorrhage&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - intracerebral hemorrhage&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - transient ischemic attack
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=3, new_column_name=&#39;# stroke type - transient ischemic attack&#39;)

        # Get % stroke type - transient ischemic attack
        self.statsDf[&#39;% stroke type - transient ischemic attack&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - transient ischemic attack&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - subarrachnoid hemorrhage
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=4, new_column_name=&#39;# stroke type - subarrachnoid hemorrhage&#39;)

        # Get % stroke type - subarrachnoid hemorrhage
        self.statsDf[&#39;% stroke type - subarrachnoid hemorrhage&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - subarrachnoid hemorrhage&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - cerebral venous thrombosis
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=5, new_column_name=&#39;# stroke type - cerebral venous thrombosis&#39;)

        # Get % stroke type - cerebral venous thrombosis
        self.statsDf[&#39;% stroke type - cerebral venous thrombosis&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - cerebral venous thrombosis&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - undetermined stroke
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=6, new_column_name=&#39;# stroke type - undetermined stroke&#39;)

        # Get % stroke type - undetermined stroke
        self.statsDf[&#39;% stroke type - undetermined stroke&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - undetermined stroke&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        #######################
        # CONSCIOUSNESS LEVEL #
        #######################
        # Get consciousness level in one table 
        self.tmp = is_ich_sah_cvt.groupby([&#39;Protocol ID&#39;, &#39;CONSCIOUSNESS_LEVEL&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get level of consciousness - not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=5, new_column_name=&#39;# level of consciousness - not known&#39;)

        # Get % level of consciousness - not known
        self.statsDf[&#39;% level of consciousness - not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - not known&#39;]/x[&#39;is_ich_sah_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_sah_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get level of consciousness - alert
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=1, new_column_name=&#39;# level of consciousness - alert&#39;)

        # Get % level of consciousness - alert
        self.statsDf[&#39;% level of consciousness - alert&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - alert&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        # Get level of consciousness - drowsy
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=2, new_column_name=&#39;# level of consciousness - drowsy&#39;)

        # Get % level of consciousness - drowsy
        self.statsDf[&#39;% level of consciousness - drowsy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - drowsy&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        # Get level of consciousness - comatose
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=3, new_column_name=&#39;# level of consciousness - comatose&#39;)

        # Get % level of consciousness - comatose
        self.statsDf[&#39;% level of consciousness - comatose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - comatose&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        # Get level of consciousness - GCS
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=4, new_column_name=&#39;# level of consciousness - GCS&#39;)

        # Get % level of consciousness - GCS
        self.statsDf[&#39;% level of consciousness - GCS&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - GCS&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        #######
        # GCS #
        #######
        # GCS subset
        gcs = is_ich_sah_cvt[is_ich_sah_cvt[&#39;CONSCIOUSNESS_LEVEL&#39;].isin([4])].copy()

        # Get GCS patients
        self.statsDf[&#39;gcs_patients&#39;] = self._count_patients(dataframe=gcs)

        # Get GCS in one table 
        self.tmp = gcs.groupby([&#39;Protocol ID&#39;, &#39;GCS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get GCS - 15-13
        self.statsDf = self._get_values_for_factors(column_name=&#34;GCS&#34;, value=1, new_column_name=&#39;# GCS - 15-13&#39;)

        # Get % GCS - 15-13
        self.statsDf[&#39;% GCS - 15-13&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# GCS - 15-13&#39;]/x[&#39;gcs_patients&#39;]) * 100), 2) if x[&#39;gcs_patients&#39;] &gt; 0 else 0, axis=1)

        # Get GCS - 12-8
        self.statsDf = self._get_values_for_factors(column_name=&#34;GCS&#34;, value=2, new_column_name=&#39;# GCS - 12-8&#39;)

        # Get % GCS - 12-8
        self.statsDf[&#39;% GCS - 12-8&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# GCS - 12-8&#39;]/x[&#39;gcs_patients&#39;]) * 100), 2) if x[&#39;gcs_patients&#39;] &gt; 0 else 0, axis=1)
        
        # Get GCS - &lt;8
        self.statsDf = self._get_values_for_factors(column_name=&#34;GCS&#34;, value=3, new_column_name=&#39;# GCS - &lt;8&#39;)

        # Get % GCS - &lt;8
        self.statsDf[&#39;% GCS - &lt;8&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# GCS - &lt;8&#39;]/x[&#39;gcs_patients&#39;]) * 100), 2) if x[&#39;gcs_patients&#39;] &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;gcs_patients&#39;], inplace=True, axis=1)

        # GCS is mapped to the consciousness level. GCS 15-13 is mapped to alert
        self.statsDf[&#39;alert_all&#39;] = self.statsDf[&#39;# level of consciousness - alert&#39;] + self.statsDf[&#39;# GCS - 15-13&#39;]

        self.statsDf[&#39;alert_all_perc&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;alert_all&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)
        #  12-8 to drowsy 
        self.statsDf[&#39;drowsy_all&#39;] = self.statsDf[&#39;# level of consciousness - drowsy&#39;] + self.statsDf[&#39;# GCS - 12-8&#39;]

        self.statsDf[&#39;drowsy_all_perc&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;drowsy_all&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)
        # &lt;8 to comatose. 
        self.statsDf[&#39;comatose_all&#39;] = self.statsDf[&#39;# level of consciousness - comatose&#39;] + self.statsDf[&#39;# GCS - &lt;8&#39;]

        self.statsDf[&#39;comatose_all_perc&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;comatose_all&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;alert_all_perc&#39;] + self.statsDf[&#39;drowsy_all_perc&#39;] + self.statsDf[&#39;comatose_all_perc&#39;]
        #self.statsDf[&#39;alert_all_perc&#39;] = self.statsDf.apply(lambda x: x[&#39;alert_all_perc&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;alert_all_perc&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)

        #########
        # NIHSS #
        #########
        if country_code == &#39;CZ&#39;:
            # Get NIHSS patients
            # Get nihss in one table 
            self.tmp = is_ich.groupby([&#39;Protocol ID&#39;, &#39;NIHSS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get Not performed 
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=1, new_column_name=&#39;# NIHSS - Not performed&#39;)

            # Get % Not performed   
            self.statsDf[&#39;% NIHSS - Not performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not performed&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Prformed  
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=2, new_column_name=&#39;# NIHSS - Performed&#39;)

            # Get % Performed   
            self.statsDf[&#39;% NIHSS - Performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Performed&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Not known 
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=3, new_column_name=&#39;# NIHSS - Not known&#39;)

            # Get % Not known   
            self.statsDf[&#39;% NIHSS - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not known&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get NIHSS performed subset
            nihss = is_ich[is_ich[&#39;NIHSS&#39;].isin([2])]

            # Get Median of NIHSS score
            tmpDf = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})
            #self.statsDf[&#39;NIHSS median score&#39;] = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})[&#39;NIHSS median score&#39;].tolist()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;, left_on=&#39;Protocol ID&#39;, right_on=&#39;Protocol ID&#39;)
            factorDf.fillna(0, inplace=True)
            self.statsDf[&#39;NIHSS median score&#39;] = factorDf[&#39;NIHSS median score&#39;]
        else:
            # Get NIHSS patients
            # Get nihss in one table 
            self.tmp = is_ich_cvt.groupby([&#39;Protocol ID&#39;, &#39;NIHSS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get Not performed 
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=1, new_column_name=&#39;# NIHSS - Not performed&#39;)

            # Get % Not performed       
            self.statsDf[&#39;% NIHSS - Not performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not performed&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Prformed      
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=2, new_column_name=&#39;# NIHSS - Performed&#39;)

            # Get % Performed   
            self.statsDf[&#39;% NIHSS - Performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Performed&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Not known     
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=3, new_column_name=&#39;# NIHSS - Not known&#39;)

            # Get % Not known   
            self.statsDf[&#39;% NIHSS - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not known&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get NIHSS performed subset
            nihss = is_ich_cvt[is_ich_cvt[&#39;NIHSS&#39;].isin([2])]

            # Get Median of NIHSS score
            tmpDf = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})
            #self.statsDf[&#39;NIHSS median score&#39;] = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})[&#39;NIHSS median score&#39;].tolist()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;, left_on=&#39;Protocol ID&#39;, right_on=&#39;Protocol ID&#39;)
            factorDf.fillna(0, inplace=True)
            self.statsDf[&#39;NIHSS median score&#39;] = factorDf[&#39;NIHSS median score&#39;]

        ##########
        # CT/MRI #
        ##########
        # Get CT/MRI in one table
        self.tmp = is_ich_tia_cvt.groupby([&#39;Protocol ID&#39;, &#39;CT_MRI&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients CT/MRI not performed
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_MRI&#34;, value=1, new_column_name=&#39;# CT/MRI - Not performed&#39;)

        # Get % CT/MRI Not performed    
        self.statsDf[&#39;% CT/MRI - Not performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Not performed&#39;]/x[&#39;is_ich_tia_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_tia_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients CT/MRI performed
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_MRI&#34;, value=2, new_column_name=&#39;# CT/MRI - performed&#39;)

        # Get % CT/MRI performed        
        self.statsDf[&#39;% CT/MRI - performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - performed&#39;]/x[&#39;is_ich_tia_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_tia_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients CT/MRI not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_MRI&#34;, value=3, new_column_name=&#39;# CT/MRI - Not known&#39;)

        # Get % CT/MRI not known        
        self.statsDf[&#39;% CT/MRI - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Not known&#39;]/x[&#39;is_ich_tia_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_tia_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get CT/MRI performed subset
        ct_mri = is_ich_tia_cvt[is_ich_tia_cvt[&#39;CT_MRI&#39;].isin([2])]

        # Get CT/MRI time in one table
        ct_mri[&#39;CT_TIME&#39;] = pd.to_numeric(ct_mri[&#39;CT_TIME&#39;])
        self.tmp = ct_mri.groupby([&#39;Protocol ID&#39;, &#39;CT_TIME&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        #print(self.tmp)

        # Get patients CT/MRI within first hour after admission

        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_TIME&#34;, value=1, new_column_name=&#39;# CT/MRI - Performed within 1 hour after admission&#39;)

        # Get % CT/MRI within first hour after admission        
        self.statsDf[&#39;% CT/MRI - Performed within 1 hour after admission&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Performed within 1 hour after admission&#39;]/x[&#39;# CT/MRI - performed&#39;]) * 100), 2) if x[&#39;# CT/MRI - performed&#39;] &gt; 0 else 0, axis=1)

        # Get patients CT/MRI within first hour after admission
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_TIME&#34;, value=2, new_column_name=&#39;# CT/MRI - Performed later than 1 hour after admission&#39;)

        # Get % CT/MRI within first hour after admission        
        self.statsDf[&#39;% CT/MRI - Performed later than 1 hour after admission&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Performed later than 1 hour after admission&#39;]/x[&#39;# CT/MRI - performed&#39;]) * 100), 2) if x[&#39;# CT/MRI - performed&#39;] &gt; 0 else 0, axis=1)

        ####################
        # VASCULAR IMAGING #
        ####################
        
        self.tmp = ich_sah.groupby([&#39;Protocol ID&#39;, &#39;CTA_MRA_DSA&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        
        # Get patients with vascular imaging - CTA
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;1&#39;, &#39;1,2&#39;, &#39;1,3&#39;}, new_column_name=&#39;# vascular imaging - CTA&#39;)

        # Get % patients with vascular imaging - CTA
        self.statsDf[&#39;% vascular imaging - CTA&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - CTA&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - MRA
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;2&#39;, &#39;1,2&#39;, &#39;2,3&#39;}, new_column_name=&#39;# vascular imaging - MRA&#39;)

        # Get % patients with vascular imaging - MRA
        self.statsDf[&#39;% vascular imaging - MRA&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - MRA&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - DSA
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;3&#39;, &#39;1,3&#39;, &#39;2,3&#39;}, new_column_name=&#39;# vascular imaging - DSA&#39;)

        # Get % patients with vascular imaging - DSA
        self.statsDf[&#39;% vascular imaging - DSA&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - DSA&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - None
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;4&#39;}, new_column_name=&#39;# vascular imaging - None&#39;)

        # Get % patients with vascular imaging - None   
        self.statsDf[&#39;% vascular imaging - None&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - None&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - two modalities
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;1,2&#39;, &#39;1,3&#39;, &#39;2,3&#39;}, new_column_name=&#39;# vascular imaging - two modalities&#39;)

        # Get % patients with vascular imaging - two modalities
        self.statsDf[&#39;% vascular imaging - two modalities&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - two modalities&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% vascular imaging - CTA&#39;, &#39;% vascular imaging - MRA&#39;, &#39;% vascular imaging - DSA&#39;, &#39;% vascular imaging - None&#39;]].copy()

        norm_tmp.loc[:,&#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;vascular_imaging_cta_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - CTA&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vascular_imaging_mra_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - MRA&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vascular_imaging_dsa_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - DSA&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vascular_imaging_none_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - None&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)
        
        ##############
        # VENTILATOR #
        ##############
        if country_code == &#39;CZ&#39;:
            self.tmp = is_ich.groupby([&#39;Protocol ID&#39;, &#39;VENTILATOR&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients from old version
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=-999, new_column_name=&#39;tmp&#39;)

            # Get patients put on ventilator - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=3, new_column_name=&#39;# patients put on ventilator - Not known&#39;)

            # Get % patients put on ventilator - Not known  
            self.statsDf[&#39;% patients put on ventilator - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Not known&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=1, new_column_name=&#39;# patients put on ventilator - Yes&#39;)

            # Get % patients put on ventilator - Yes    
            self.statsDf[&#39;% patients put on ventilator - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Yes&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=2, new_column_name=&#39;# patients put on ventilator - No&#39;)

            # Get % patients put on ventilator - No 
            self.statsDf[&#39;% patients put on ventilator - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - No&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Drop tmp column 
            self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)
        else:
            self.tmp = is_ich_cvt.groupby([&#39;Protocol ID&#39;, &#39;VENTILATOR&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients from old version
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=-999, new_column_name=&#39;tmp&#39;)

            # Get patients put on ventilator - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=3, new_column_name=&#39;# patients put on ventilator - Not known&#39;)

            # Get % patients put on ventilator - Not known      
            self.statsDf[&#39;% patients put on ventilator - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Not known&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=1, new_column_name=&#39;# patients put on ventilator - Yes&#39;)

            # Get % patients put on ventilator - Yes    
            self.statsDf[&#39;% patients put on ventilator - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Yes&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=2, new_column_name=&#39;# patients put on ventilator - No&#39;)

            # Get % patients put on ventilator - No     
            self.statsDf[&#39;% patients put on ventilator - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - No&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Drop tmp column 
            self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        #############################
        # RECANALIZATION PROCEDURES #
        #############################
        self.tmp = isch.groupby([&#39;Protocol ID&#39;, &#39;RECANALIZATION_PROCEDURES&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients recanalization procedures - Not done
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=1, new_column_name=&#39;# recanalization procedures - Not done&#39;)

        # Get % patients recanalization procedures - Not done
        self.statsDf[&#39;% recanalization procedures - Not done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Not done&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - IV tPa
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=2, new_column_name=&#39;# recanalization procedures - IV tPa&#39;)

        # Get % patients recanalization procedures - IV tPa
        self.statsDf[&#39;% recanalization procedures - IV tPa&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - IV tPa&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - IV tPa + endovascular treatment
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=3, new_column_name=&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;)

        # Get % patients recanalization procedures - IV tPa + endovascular treatment
        self.statsDf[&#39;% recanalization procedures - IV tPa + endovascular treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Endovascular treatment alone
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=4, new_column_name=&#39;# recanalization procedures - Endovascular treatment alone&#39;)

        # Get % patients recanalization procedures - Endovascular treatment alone
        self.statsDf[&#39;% recanalization procedures - Endovascular treatment alone&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - IV tPa + referred to another centre for endovascular treatment
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=5, new_column_name=&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;)

        # Get % patients recanalization procedures - IV tPa + referred to another centre for endovascular treatment
        self.statsDf[&#39;% recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Referred to another centre for endovascular treatment
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=6, new_column_name=&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;)

        # Get % patients recanalization procedures - Referred to another centre for endovascular treatment
        self.statsDf[&#39;% recanalization procedures - Referred to another centre for endovascular treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=7, new_column_name=&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;)

        # Get % patients recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre
        self.statsDf[&#39;% recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=8, new_column_name=&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;)

        # Get % patients recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre
        self.statsDf[&#39;% recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=9, new_column_name=&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;)

        # Get % patients recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre
        self.statsDf[&#39;% recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        if country_code == &#39;CZ&#39;:
            # Get patients recanalized
            #self.statsDf[&#39;# patients recanalized&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] +  x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]  + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)
            self.statsDf[&#39;# patients recanalized&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] +  x[&#39;# recanalization procedures - Endovascular treatment alone&#39;], axis=1)

            # Get % patients recanalized
            #self.statsDf[&#39;% patients recanalized&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients recanalized&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]) &gt; 0 else 0, axis=1)
            self.statsDf[&#39;% patients recanalized&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients recanalized&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]) &gt; 0 else 0, axis=1)
        else:
            # Get patients recanalized
            self.statsDf[&#39;# patients recanalized&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] +  x[&#39;# recanalization procedures - Endovascular treatment alone&#39;], axis=1)

            # Get % patients recanalized
            self.statsDf[&#39;% patients recanalized&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients recanalized&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]) &gt; 0 else 0, axis=1)

        
        ##############
        # MEDIAN DTN #
        ##############
        def _median_confidence_interval(data, confidence=0.95):

            a = np.array(data)
            w = a + 1

            # create custom discrete random variable from data set
            rv = st.rv_discrete(values=(data, w/w.sum()))

            return rv.median(), rv.interval(confidence)
            
        def _mean_confidence_interval(data, confidence=0.95):

            n = len(data)
            m = mean(data)
            std_err = sem(data)
            h = std_err * t.ppf((1 + confidence) / 2, n - 1)
            return m, m-h, m+h


        # Get patients receiving IV tpa
        self.statsDf.loc[:, &#39;# IV tPa&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;], axis=1)

        # Get patients receiving IV tpa %
        self.statsDf[&#39;% IV tPa&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# IV tPa&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get only patients recanalized
        recanalization_procedure_iv_tpa = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([2, 3, 5])].copy()

        # Replace NA values by 0
        recanalization_procedure_iv_tpa.fillna(0, inplace=True)
        recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] = recanalization_procedure_iv_tpa[&#39;IVT_ONLY_NEEDLE_TIME&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_ONLY_NEEDLE_TIME_MIN&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_NEEDLE_TIME&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_NEEDLE_TIME_MIN&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_REFER_NEEDLE_TIME&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_REFER_NEEDLE_TIME_MIN&#39;]
        #print(recanalization_procedure_iv_tpa[&#39;IVTPA&#39;].tolist())

        &#34;&#34;&#34;
        sites_ids = recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;].tolist()
        sites_ids = set(sites_ids)
        interval_vals = {}              
        for idx, val in enumerate(sites_ids): 
            meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
            medianv, interval_median = _median_confidence_interval(recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
            interval_vals[str(idx)] = [val, &#34;({0:.2f},{1:.2f})&#34;.format(lbound, ubound), &#34;{0}&#34;.format(interval_median)]

            #interval_vals.append(&#34;{0}: ({1}-{2})&#34;.format(i, lowb, upb))
        #print(interval_vals)
        interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTN (Mean)&#39;, &#39;Confidence interval DTN (Median)&#39;])
        &#34;&#34;&#34;
        tmp = recanalization_procedure_iv_tpa.groupby([&#39;Protocol ID&#39;]).IVTPA.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median DTN (minutes)&#39;}).reset_index()
        #print(tmp)
        self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
        self.statsDf.fillna(0, inplace=True)

        #self.statsDf = self.statsDf.merge(interval_vals_df, how=&#39;outer&#39;)
        
        ##############
        # MEDIAN DTG #
        ##############
        if country_code == &#39;CZ&#39;:
            # Get patients receiving TBY
            #self.statsDf.loc[:, &#39;# TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)
            self.statsDf.loc[:, &#39;# TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;], axis=1)


            # Get patients receiving TBY %
            self.statsDf[&#39;% TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# TBY&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

            
            # Get only patients recanalized TBY
            #recanalization_procedure_tby_dtg = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3, 6, 7, 8])].copy()
            recanalization_procedure_tby_dtg = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3])].copy()
            recanalization_procedure_tby_dtg.fillna(0, inplace=True)

            # Get IVTPA in minutes
            # recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg
            #recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_ALL_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_LIM_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_ALL_GROIN_PUNCTURE_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_LIM_GROIN_PUNCTURE_TIME_MIN&#39;]
            recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME_MIN&#39;]
            #print(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;TBY&#39;] &gt; 0][&#39;TBY&#39;].tolist())

            &#34;&#34;&#34;
            sites_ids = recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;].tolist()
            sites_ids = set(sites_ids)
            interval_vals = {}          
            for idx, val in enumerate(sites_ids): 
                meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;TBY&#39;].tolist())
                medianv, interval_median = _median_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;TBY&#39;].tolist())
                interval_vals[str(idx)] = [val, &#34;({0:.2f}-{1:.2f})&#34;.format(lbound, ubound), &#34;{0}&#34;.format(interval_median)]

            interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTG (Mean)&#39;, &#39;Confidence interval DTG (Median)&#39;])
            &#34;&#34;&#34;
            #recanalization_procedure_tby[&#39;TBY&#39;] = recanalization_procedure_tby.loc[:, [&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;, &#39;TBY_ONLY_GROIN_PUNCTURE_TIME_MIN&#39;, &#39;IVT_TBY_GROIN_TIME&#39;, &#39;IVT_TBY_GROIN_TIME_MIN&#39;]].sum(1).reset_index()[0].tolist()
        else:
            # Get patients receiving TBY
            self.statsDf.loc[:, &#39;# TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;], axis=1)

            # Get patients receiving TBY %
            self.statsDf[&#39;% TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# TBY&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

            
            # Get only patients recanalized TBY
            recanalization_procedure_tby_dtg = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3])].copy()
            recanalization_procedure_tby_dtg.fillna(0, inplace=True)

            # Get IVTPA in minutes
            recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME_MIN&#39;]


            #print(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;TBY&#39;] &gt; 0][&#39;TBY&#39;].tolist())
            &#34;&#34;&#34;
            sites_ids = recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;].tolist()
            sites_ids = set(sites_ids)
            interval_vals = {}          
            for idx, val in enumerate(sites_ids): 
                meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
                medianv, interval_median = _median_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
                interval_vals[str(idx)] = [val, &#34;({0:.2f}-{1:.2f})&#34;.format(lbound, ubound), &#34;{0}&#34;.format(interval_median)]
            
            interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTG (Mean)&#39;, &#39;Confidence interval DTG (Median)&#39;])
            &#34;&#34;&#34;
            #recanalization_procedure_tby[&#39;TBY&#39;] = recanalization_procedure_tby.loc[:, [&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;, &#39;TBY_ONLY_GROIN_PUNCTURE_TIME_MIN&#39;, &#39;IVT_TBY_GROIN_TIME&#39;, &#39;IVT_TBY_GROIN_TIME_MIN&#39;]].sum(1).reset_index()[0].tolist()

        tmp = recanalization_procedure_tby_dtg.groupby([&#39;Protocol ID&#39;]).TBY.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median DTG (minutes)&#39;}).reset_index()
        #print(tmp)
        self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
        self.statsDf.fillna(0, inplace=True)

        #self.statsDf = self.statsDf.merge(interval_vals_df, how=&#39;outer&#39;)

        ###############
        # MEDIAN DIDO #
        ###############
        if country_code == &#39;CZ&#39;:
            # Get patients receiving dido
            #self.statsDf.loc[:, &#39;# DIDO TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;], axis=1)
            self.statsDf.loc[:, &#39;# DIDO TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)

            # Get patients receiving TBY %
            #self.statsDf[&#39;% DIDO TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# DIDO TBY&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;]) &gt; 0 else 0, axis=1)
            

            # Get only patients recanalized TBY
            # recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6, 7, 8])].copy()
            # For CZ remove referred for endovascular treatment from DIDO time because they are taking it as the patient was referred to them for TBY
            #recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6])].copy()
            recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6, 7, 8])].copy()
            recanalization_procedure_tby_dido.fillna(0, inplace=True)

            # Get DIDO in minutes
            #recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;]
            #recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;]
            recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;]


            # Create temporary dataframe with calculated median value
            tmp = recanalization_procedure_tby_dido.groupby([&#39;Protocol ID&#39;]).DIDO.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median TBY DIDO (minutes)&#39;}).reset_index()
            self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
            self.statsDf.fillna(0, inplace=True)
        else:
            # Get patients receiving dido
            self.statsDf.loc[:, &#39;# DIDO TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)

            # Get patients receiving TBY %
            #self.statsDf[&#39;% DIDO TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# DIDO TBY&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;]) &gt; 0 else 0, axis=1)

            # Get only patients recanalized TBY
            recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6, 7, 8])].copy()
            recanalization_procedure_tby_dido.fillna(0, inplace=True)

            # Get DIDO in minutes
            # 
            recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;]

            # Create temporary dataframe with calculated median value
            tmp = recanalization_procedure_tby_dido.groupby([&#39;Protocol ID&#39;]).DIDO.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median TBY DIDO (minutes)&#39;}).reset_index()
            self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
            self.statsDf.fillna(0, inplace=True)
        

        #######################
        # DYPSHAGIA SCREENING #
        #######################
        if country_code == &#39;CZ&#39;:
            self.tmp = is_ich.groupby([&#39;Protocol ID&#39;, &#39;DYSPHAGIA_SCREENING&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients dysphagia screening - not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=6, new_column_name=&#39;# dysphagia screening - not known&#39;)

            # Get % patients dysphagia screening - not known
            self.statsDf[&#39;% dysphagia screening - not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - not known&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Guss test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=1, new_column_name=&#39;# dysphagia screening - Guss test&#39;)

            # Get % patients dysphagia screening - Guss test
            self.statsDf[&#39;% dysphagia screening - Guss test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Guss test&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Other test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=2, new_column_name=&#39;# dysphagia screening - Other test&#39;)

            # Get % patients dysphagia screening - Other test
            self.statsDf[&#39;% dysphagia screening - Other test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Other test&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Another centre
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=3, new_column_name=&#39;# dysphagia screening - Another centre&#39;)

            # Get % patients dysphagia screening - Another centre
            self.statsDf[&#39;% dysphagia screening - Another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Another centre&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Not done
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=4, new_column_name=&#39;# dysphagia screening - Not done&#39;)

            # Get % patients dysphagia screening - Not done
            self.statsDf[&#39;% dysphagia screening - Not done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Not done&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Unable to test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=5, new_column_name=&#39;# dysphagia screening - Unable to test&#39;)

            # Get % patients dysphagia screening - Unable to test
            self.statsDf[&#39;% dysphagia screening - Unable to test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Unable to test&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            #self.statsDf[&#39;# dysphagia screening done&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;] + self.statsDf[&#39;# dysphagia screening - Another centre&#39;]
            self.statsDf[&#39;# dysphagia screening done&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;]
            #self.statsDf[&#39;% dysphagia screening done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening done&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)
            self.statsDf[&#39;% dysphagia screening done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening done&#39;]/(x[&#39;# dysphagia screening done&#39;] + x[&#39;# dysphagia screening - Not done&#39;])) * 100), 2) if (x[&#39;# dysphagia screening done&#39;] + x[&#39;# dysphagia screening - Not done&#39;]) &gt; 0 else 0, axis=1)
        else:
            self.tmp = is_ich_cvt.groupby([&#39;Protocol ID&#39;, &#39;DYSPHAGIA_SCREENING&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients dysphagia screening - not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=6, new_column_name=&#39;# dysphagia screening - not known&#39;)

            # Get % patients dysphagia screening - not known
            self.statsDf[&#39;% dysphagia screening - not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - not known&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Guss test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=1, new_column_name=&#39;# dysphagia screening - Guss test&#39;)

            # Get % patients dysphagia screening - Guss test
            self.statsDf[&#39;% dysphagia screening - Guss test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Guss test&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Other test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=2, new_column_name=&#39;# dysphagia screening - Other test&#39;)

            # Get % patients dysphagia screening - Other test
            self.statsDf[&#39;% dysphagia screening - Other test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Other test&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Another centre
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=3, new_column_name=&#39;# dysphagia screening - Another centre&#39;)

            # Get % patients dysphagia screening - Another centre
            self.statsDf[&#39;% dysphagia screening - Another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Another centre&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Not done
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=4, new_column_name=&#39;# dysphagia screening - Not done&#39;)

            # Get % patients dysphagia screening - Not done
            self.statsDf[&#39;% dysphagia screening - Not done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Not done&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Unable to test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=5, new_column_name=&#39;# dysphagia screening - Unable to test&#39;)

            # Get % patients dysphagia screening - Unable to test
            self.statsDf[&#39;% dysphagia screening - Unable to test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Unable to test&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            self.statsDf[&#39;# dysphagia screening done&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;] + self.statsDf[&#39;# dysphagia screening - Another centre&#39;]
            self.statsDf[&#39;% dysphagia screening done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening done&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

        ############################
        # DYPSHAGIA SCREENING TIME #
        ############################
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;DYSPHAGIA_SCREENING_TIME&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients dysphagia screening time - Within first 24 hours
        self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING_TIME&#34;, value=1, new_column_name=&#39;# dysphagia screening time - Within first 24 hours&#39;)

        # Get patients dysphagia screening time - After first 24 hours
        self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING_TIME&#34;, value=2, new_column_name=&#39;# dysphagia screening time - After first 24 hours&#39;)

        # Get % patients dysphagia screening time - Within first 24 hours
        self.statsDf[&#39;% dysphagia screening time - Within first 24 hours&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening time - Within first 24 hours&#39;]/(x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;])) * 100), 2) if (x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;]) &gt; 0 else 0, axis=1)

        # Get % patients dysphagia screening time - After first 24 hours
        self.statsDf[&#39;% dysphagia screening time - After first 24 hours&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening time - After first 24 hours&#39;]/(x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;])) * 100), 2) if (x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;]) &gt; 0 else 0, axis=1)

        ###################
        # HEMICRANIECTOMY #
        ###################
        self.tmp = isch.groupby([&#39;Protocol ID&#39;, &#39;HEMICRANIECTOMY&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients hemicraniectomy - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;HEMICRANIECTOMY&#34;, value=1, new_column_name=&#39;# hemicraniectomy - Yes&#39;)
    
        # Get % patients hemicraniectomy - Yes
        self.statsDf[&#39;% hemicraniectomy - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# hemicraniectomy - Yes&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients hemicraniectomy - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;HEMICRANIECTOMY&#34;, value=2, new_column_name=&#39;# hemicraniectomy - No&#39;)
    
        # Get % patients hemicraniectomy - No
        self.statsDf[&#39;% hemicraniectomy - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# hemicraniectomy - No&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients hemicraniectomy - Referred to another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;HEMICRANIECTOMY&#34;, value=3, new_column_name=&#39;# hemicraniectomy - Referred to another centre&#39;)
    
        # Get % patients hemicraniectomy - Referred to another centre
        self.statsDf[&#39;% hemicraniectomy - Referred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# hemicraniectomy - Referred to another centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        ################
        # NEUROSURGERY #
        ################
        self.tmp = ich.groupby([&#39;Protocol ID&#39;, &#39;NEUROSURGERY&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        #print(self.tmp)

        # Get patients neurosurgery - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY&#34;, value=3, new_column_name=&#39;# neurosurgery - Not known&#39;)
    
        # Get % patients neurosurgery - Not known
        self.statsDf[&#39;% neurosurgery - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery - Not known&#39;]/x[&#39;ich_patients&#39;]) * 100), 2) if x[&#39;ich_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients neurosurgery - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY&#34;, value=1, new_column_name=&#39;# neurosurgery - Yes&#39;)
    
        # Get % patients neurosurgery - Yes
        self.statsDf[&#39;% neurosurgery - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery - Yes&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;]) &gt; 0 else 0, axis=1)

        # Get patients neurosurgery - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY&#34;, value=2, new_column_name=&#39;# neurosurgery - No&#39;)
    
        # Get % patients neurosurgery - No
        self.statsDf[&#39;% neurosurgery - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery - No&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;]) &gt; 0 else 0, axis=1)

        #####################
        # NEUROSURGERY TYPE #
        #####################
        # Get temporary dataframe of patients who have undergone neurosurgery 
        neurosurgery = ich[ich[&#39;NEUROSURGERY&#39;].isin([1])].copy()

        if neurosurgery.empty:
            # Get neurosurgery patients
            self.statsDf[&#39;neurosurgery_patients&#39;] = 0
        
            # Get # patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf[&#39;# neurosurgery type - intracranial hematoma evacuation&#39;] = 0

            # Get % patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf[&#39;% neurosurgery type - intracranial hematoma evacuation&#39;] = 0

            # Get # patients neurosurgery type - external ventricular drainage
            self.statsDf[&#39;# neurosurgery type - external ventricular drainage&#39;] = 0

            # Get % patients neurosurgery type - external ventricular drainage
            self.statsDf[&#39;% neurosurgery type - external ventricular drainage&#39;] = 0

            # Get # patients neurosurgery type - decompressive craniectomy
            self.statsDf[&#39;# neurosurgery type - decompressive craniectomy&#39;] = 0

            # Get % patients neurosurgery type - decompressive craniectomy
            self.statsDf[&#39;% neurosurgery type - decompressive craniectomy&#39;] = 0
        
            # Get # patients neurosurgery type - Referred to another centre
            self.statsDf[&#39;# neurosurgery type - Referred to another centre&#39;] = 0

            # Get % patients neurosurgery type - Referred to another centre
            self.statsDf[&#39;% neurosurgery type - Referred to another centre&#39;] = 0
        else:
            self.tmp = neurosurgery.groupby([&#39;Protocol ID&#39;, &#39;NEUROSURGERY_TYPE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get neurosurgery patients
            self.statsDf[&#39;neurosurgery_patients&#39;] = self._count_patients(dataframe=neurosurgery)

            # Get patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=1, new_column_name=&#39;# neurosurgery type - intracranial hematoma evacuation&#39;)
        
            # Get % patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf[&#39;% neurosurgery type - intracranial hematoma evacuation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - intracranial hematoma evacuation&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients neurosurgery type - external ventricular drainage
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=2, new_column_name=&#39;# neurosurgery type - external ventricular drainage&#39;)
        
            # Get % patients neurosurgery type - external ventricular drainage
            self.statsDf[&#39;% neurosurgery type - external ventricular drainage&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - external ventricular drainage&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients neurosurgery type - decompressive craniectomy
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=3, new_column_name=&#39;# neurosurgery type - decompressive craniectomy&#39;)
        
            # Get % patients neurosurgery type - decompressive craniectomy
            self.statsDf[&#39;% neurosurgery type - decompressive craniectomy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - decompressive craniectomy&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients neurosurgery type - Referred to another centre
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=4, new_column_name=&#39;# neurosurgery type - Referred to another centre&#39;)
        
            # Get % patients neurosurgery type - Referred to another centre
            self.statsDf[&#39;% neurosurgery type - Referred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - Referred to another centre&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

        ###################
        # BLEEDING REASON #
        ###################
        self.tmp = ich.groupby([&#39;Protocol ID&#39;, &#39;BLEEDING_REASON&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[&#39;BLEEDING_REASON&#39;] = self.tmp[&#39;BLEEDING_REASON&#39;].astype(str)

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_REASON&#34;, value=&#39;-999&#39;, new_column_name=&#39;tmp&#39;)

        # Get patients bleeding reason - arterial hypertension
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#39;1&#39;, new_column_name=&#39;# bleeding reason - arterial hypertension&#39;)

        # Get % patients bleeding reason - arterial hypertension
        self.statsDf[&#39;% bleeding reason - arterial hypertension&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - arterial hypertension&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - aneurysm
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;2&#34;, new_column_name=&#39;# bleeding reason - aneurysm&#39;)

        # Get % patients bleeding reason - aneurysm
        self.statsDf[&#39;% bleeding reason - aneurysm&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - aneurysm&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - arterio-venous malformation
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;3&#34;, new_column_name=&#39;# bleeding reason - arterio-venous malformation&#39;)

        # Get % patients bleeding reason - arterio-venous malformation
        self.statsDf[&#39;% bleeding reason - arterio-venous malformation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - arterio-venous malformation&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - anticoagulation therapy
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;4&#34;, new_column_name=&#39;# bleeding reason - anticoagulation therapy&#39;)

        # Get % patients bleeding reason - anticoagulation therapy
        self.statsDf[&#39;% bleeding reason - anticoagulation therapy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - anticoagulation therapy&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - amyloid angiopathy
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;5&#34;, new_column_name=&#39;# bleeding reason - amyloid angiopathy&#39;)

        # Get % patients bleeding reason - amyloid angiopathy
        self.statsDf[&#39;% bleeding reason - amyloid angiopathy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - amyloid angiopathy&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - Other
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;6&#34;, new_column_name=&#39;# bleeding reason - Other&#39;)

        # Get % patients bleeding reason - Other
        self.statsDf[&#39;% bleeding reason - Other&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - Other&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% bleeding reason - arterial hypertension&#39;, &#39;% bleeding reason - aneurysm&#39;, &#39;% bleeding reason - arterio-venous malformation&#39;, &#39;% bleeding reason - anticoagulation therapy&#39;, &#39;% bleeding reason - amyloid angiopathy&#39;, &#39;% bleeding reason - Other&#39;]].copy()

        norm_tmp.loc[:, &#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;bleeding_arterial_hypertension_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - arterial hypertension&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_aneurysm_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - aneurysm&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_arterio_venous_malformation_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - arterio-venous malformation&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_anticoagulation_therapy_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - anticoagulation therapy&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_amyloid_angiopathy_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - amyloid angiopathy&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_other_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - Other&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        # MORE THAN ONE POSIBILITY
        # Get patients bleeding reason - more than one
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;,&#34;, new_column_name=&#39;# bleeding reason - more than one&#39;)

        # Get % patients bleeding reason - more than one
        self.statsDf[&#39;% bleeding reason - more than one&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - more than one&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ###################
        # BLEEDING SOURCE #
        ###################

        self.tmp = sah.groupby([&#39;Protocol ID&#39;, &#39;BLEEDING_SOURCE&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[&#39;BLEEDING_SOURCE&#39;] = self.tmp[&#39;BLEEDING_SOURCE&#39;].astype(str)

        # Get patients from old version
        #self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;-999&#39;, new_column_name=&#39;tmp&#39;)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;-999&#39;, new_column_name=&#39;tmp&#39;)

        # Get patients bleeding source - known
        #self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;1&#39;, new_column_name=&#39;# bleeding source - Known&#39;)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;1&#39;, new_column_name=&#39;# bleeding source - Known&#39;)


        # Get % patients bleeding source - known
        self.statsDf[&#39;% bleeding source - Known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding source - Known&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding source - Not known
        #self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;2&#39;, new_column_name=&#39;# bleeding source - Not known&#39;)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;2&#39;, new_column_name=&#39;# bleeding source - Not known&#39;)
        
        # Get % patients bleeding source - Not known
        self.statsDf[&#39;% bleeding source - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding source - Not known&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ################
        # INTERVENTION #
        ################
        self.tmp = sah.groupby([&#39;Protocol ID&#39;, &#39;INTERVENTION&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[&#39;INTERVENTION&#39;] = self.tmp[&#39;INTERVENTION&#39;].astype(str)

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;INTERVENTION&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get patients intervention - endovascular (coiling)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;1&#34;, new_column_name=&#39;# intervention - endovascular (coiling)&#39;)

        # Get % patients intervention - endovascular (coiling)
        self.statsDf[&#39;% intervention - endovascular (coiling)&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - endovascular (coiling)&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - neurosurgical (clipping)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;2&#34;, new_column_name=&#39;# intervention - neurosurgical (clipping)&#39;)

        # Get % patients intervention - neurosurgical (clipping)
        self.statsDf[&#39;% intervention - neurosurgical (clipping)&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - neurosurgical (clipping)&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - Other neurosurgical treatment (decompression, drainage)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;3&#34;, new_column_name=&#39;# intervention - Other neurosurgical treatment (decompression, drainage)&#39;)

        # Get % patients intervention - Other neurosurgical treatment (decompression, drainage)
        self.statsDf[&#39;% intervention - Other neurosurgical treatment (decompression, drainage)&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - Other neurosurgical treatment (decompression, drainage)&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - Referred to another hospital for intervention
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;4&#34;, new_column_name=&#39;# intervention - Referred to another hospital for intervention&#39;)

        # Get % patients intervention - Referred to another hospital for intervention
        self.statsDf[&#39;% intervention - Referred to another hospital for intervention&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - Referred to another hospital for intervention&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - None/no intervention
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;5|6&#34;, new_column_name=&#39;# intervention - None / no intervention&#39;)

        # Get % patients intervention - None/no intervention
        self.statsDf[&#39;% intervention - None / no intervention&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - None / no intervention&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% intervention - endovascular (coiling)&#39;, &#39;% intervention - neurosurgical (clipping)&#39;, &#39;% intervention - Other neurosurgical treatment (decompression, drainage)&#39;, &#39;% intervention - Referred to another hospital for intervention&#39;, &#39;% intervention - None / no intervention&#39;]].copy()

        norm_tmp.loc[:, &#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;intervention_endovascular_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - endovascular (coiling)&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_neurosurgical_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - neurosurgical (clipping)&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_other_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - Other neurosurgical treatment (decompression, drainage)&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_referred_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - Referred to another hospital for intervention&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_none_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - None / no intervention&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        # Get patients intervention - more than one
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;,&#34;, new_column_name=&#39;# intervention - more than one&#39;)

        # Get % patients intervention - more than one
        self.statsDf[&#39;% intervention - more than one&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - more than one&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ################
        # VT TREATMENT #
        ################
        if (&#39;VT_TREATMENT&#39; not in cvt.columns):
            cvt[&#39;VT_TREATMENT&#39;] = np.nan
            
        self.tmp = cvt.groupby([&#39;Protocol ID&#39;, &#39;VT_TREATMENT&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[[&#39;VT_TREATMENT&#39;]] = self.tmp[[&#39;VT_TREATMENT&#39;]].astype(str)

        # Get patients VT treatment - anticoagulation
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;1&#34;, new_column_name=&#39;# VT treatment - anticoagulation&#39;)

        # Get % patients VT treatment - anticoagulation
        self.statsDf[&#39;% VT treatment - anticoagulation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - anticoagulation&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - thrombectomy
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;2&#34;, new_column_name=&#39;# VT treatment - thrombectomy&#39;)

        # Get % patients VT treatment - thrombectomy
        self.statsDf[&#39;% VT treatment - thrombectomy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - thrombectomy&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - local thrombolysis
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;3&#34;, new_column_name=&#39;# VT treatment - local thrombolysis&#39;)

        # Get % patients VT treatment - local thrombolysis
        self.statsDf[&#39;% VT treatment - local thrombolysis&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - local thrombolysis&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - local neurological treatment
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;4&#34;, new_column_name=&#39;# VT treatment - local neurological treatment&#39;)

        # Get % patients VT treatment - local neurological treatment
        self.statsDf[&#39;% VT treatment - local neurological treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - local neurological treatment&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - more than one treatment
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;,&#34;, new_column_name=&#39;# VT treatment - more than one treatment&#39;)

        # Get % patients VT treatment - more than one treatment
        self.statsDf[&#39;% VT treatment - more than one treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - more than one treatment&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% VT treatment - anticoagulation&#39;, &#39;% VT treatment - thrombectomy&#39;, &#39;% VT treatment - local thrombolysis&#39;, &#39;% VT treatment - local neurological treatment&#39;]].copy()

        norm_tmp.loc[:, &#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;vt_treatment_anticoagulation_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - anticoagulation&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vt_treatment_thrombectomy_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - thrombectomy&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vt_treatment_local_thrombolysis_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - local thrombolysis&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vt_treatment_local_neurological_treatment_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - local neurological treatment&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)


        ########
        # AFIB #
        ########
        # patients not reffered 
        not_reffered = is_tia[~is_tia[&#39;RECANALIZATION_PROCEDURES&#39;].isin([7])].copy()
        self.statsDf[&#39;not_reffered_patients&#39;] = self._count_patients(dataframe=not_reffered)

        # patients referred to another hospital
        reffered = is_tia[is_tia[&#39;RECANALIZATION_PROCEDURES&#39;].isin([7])].copy()
        self.statsDf[&#39;reffered_patients&#39;] = self._count_patients(dataframe=reffered)

        # 
        self.tmp = not_reffered.groupby([&#39;Protocol ID&#39;, &#39;AFIB_FLUTTER&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients afib/flutter - Known
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=1, new_column_name=&#39;# afib/flutter - Known&#39;)

        # Get % patients afib/flutter - Known
        self.statsDf[&#39;% afib/flutter - Known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Known&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients afib/flutter - Newly-detected at admission
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=2, new_column_name=&#39;# afib/flutter - Newly-detected at admission&#39;)

        # Get % patients afib/flutter - Newly-detected at admission
        self.statsDf[&#39;% afib/flutter - Newly-detected at admission&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Newly-detected at admission&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients afib/flutter - Detected during hospitalization
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=3, new_column_name=&#39;# afib/flutter - Detected during hospitalization&#39;)

        # Get % patients afib/flutter - Detected during hospitalization
        self.statsDf[&#39;% afib/flutter - Detected during hospitalization&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Detected during hospitalization&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1) 
        # Get patients afib/flutter - Not detected
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=4, new_column_name=&#39;# afib/flutter - Not detected&#39;)

        # Get % patients afib/flutter - Not detected
        self.statsDf[&#39;% afib/flutter - Not detected&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Not detected&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients afib/flutter - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=5, new_column_name=&#39;# afib/flutter - Not known&#39;)

        # Get % patients afib/flutter - Not known
        self.statsDf[&#39;% afib/flutter - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Not known&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1)

        #########################
        # AFIB DETECTION METHOD #
        #########################
        if country_code == &#39;CZ&#39;:
            # patients referred to another hospital
            afib_detected_during_hospitalization = not_reffered[not_reffered[&#39;AFIB_FLUTTER&#39;].isin([3])].copy()
            self.statsDf[&#39;afib_detected_during_hospitalization_patients&#39;] = self._count_patients(dataframe=afib_detected_during_hospitalization)

            afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;] = afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;].astype(str)
            # 
            self.tmp = afib_detected_during_hospitalization.groupby([&#39;Protocol ID&#39;, &#39;AFIB_DETECTION_METHOD&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;1&#34;, new_column_name=&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;2&#34;, new_column_name=&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Holter-type monitoring
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;3&#34;, new_column_name=&#39;# afib detection method - Holter-type monitoring&#39;)

            # Get % patients afib detection method - Holter-type monitoring
            self.statsDf[&#39;% afib detection method - Holter-type monitoring&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Holter-type monitoring&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;4&#34;, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;)

            # Get % patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;5&#34;, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;)
            
            # Get % patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)
        else:
            # patients referred to another hospital
            afib_detected_during_hospitalization = not_reffered[not_reffered[&#39;AFIB_FLUTTER&#39;].isin([3])].copy()
            self.statsDf[&#39;afib_detected_during_hospitalization_patients&#39;] = self._count_patients(dataframe=afib_detected_during_hospitalization)

            afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;] = afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;].astype(str)
            # 
            self.tmp = afib_detected_during_hospitalization.groupby([&#39;Protocol ID&#39;, &#39;AFIB_DETECTION_METHOD&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=1, new_column_name=&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=2, new_column_name=&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Holter-type monitoring
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=3, new_column_name=&#39;# afib detection method - Holter-type monitoring&#39;)

            # Get % patients afib detection method - Holter-type monitoring
            self.statsDf[&#39;% afib detection method - Holter-type monitoring&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Holter-type monitoring&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=4, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;)

            # Get % patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=5, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;)
            
            # Get % patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

        ###############################
        # AFIB OTHER DETECTION METHOD #
        ###############################
        # patients referred to another hospital
        afib_not_detected_or_not_known = not_reffered[not_reffered[&#39;AFIB_FLUTTER&#39;].isin([4, 5])].copy()
        self.statsDf[&#39;afib_not_detected_or_not_known_patients&#39;] = self._count_patients(dataframe=afib_not_detected_or_not_known)

        # 
        self.tmp = afib_not_detected_or_not_known.groupby([&#39;Protocol ID&#39;, &#39;AFIB_OTHER_RECS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients other afib detection method - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_OTHER_RECS&#34;, value=1, new_column_name=&#39;# other afib detection method - Yes&#39;)

        # Get % patients other afib detection method - Yes
        self.statsDf[&#39;% other afib detection method - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# other afib detection method - Yes&#39;]/x[&#39;afib_not_detected_or_not_known_patients&#39;]) * 100), 2) if x[&#39;afib_not_detected_or_not_known_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients other afib detection method - Not detected or not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_OTHER_RECS&#34;, value=2, new_column_name=&#39;# other afib detection method - Not detected or not known&#39;)

        # Get % patients other afib detection method - Not detected or not known
        self.statsDf[&#39;% other afib detection method - Not detected or not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# other afib detection method - Not detected or not known&#39;]/x[&#39;afib_not_detected_or_not_known_patients&#39;]) * 100), 2) if x[&#39;afib_not_detected_or_not_known_patients&#39;] &gt; 0 else 0, axis=1)

        ############################
        # CAROTID ARTERIES IMAGING #
        ############################
        # 
        self.tmp = is_tia.groupby([&#39;Protocol ID&#39;, &#39;CAROTID_ARTERIES_IMAGING&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients carotid arteries imaging - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_ARTERIES_IMAGING&#34;, value=3, new_column_name=&#39;# carotid arteries imaging - Not known&#39;)

        # Get % patients carotid arteries imaging - Not known
        self.statsDf[&#39;% carotid arteries imaging - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid arteries imaging - Not known&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients carotid arteries imaging - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_ARTERIES_IMAGING&#34;, value=1, new_column_name=&#39;# carotid arteries imaging - Yes&#39;)

        # Get % patients carotid arteries imaging - Yes
        self.statsDf[&#39;% carotid arteries imaging - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid arteries imaging - Yes&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;]) &gt; 0 else 0, axis=1)

        # Get patients carotid arteries imaging - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_ARTERIES_IMAGING&#34;, value=2, new_column_name=&#39;# carotid arteries imaging - No&#39;)

        # Get % patients carotid arteries imaging - No
        self.statsDf[&#39;% carotid arteries imaging - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid arteries imaging - No&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;]) &gt; 0 else 0, axis=1)

        ############################
        # ANTITHROMBOTICS WITH CVT #
        ############################

        # patients not referred 
        antithrombotics_with_cvt = is_tia_cvt[~is_tia_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;antithrombotics_patients_with_cvt&#39;] = self._count_patients(dataframe=antithrombotics_with_cvt)

        ischemic_transient_cerebral_dead = is_tia_cvt[is_tia_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;ischemic_transient_cerebral_dead_patients&#39;] = self._count_patients(dataframe=ischemic_transient_cerebral_dead)

        self.tmp = antithrombotics_with_cvt.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        

        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients receiving antiplatelets with CVT&#39;)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients receiving antiplatelets with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving antiplatelets with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving Vit. K antagonist
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=2, new_column_name=&#39;# patients receiving Vit. K antagonist with CVT&#39;)

        # Get % patients receiving Vit. K antagonist
        self.statsDf[&#39;% patients receiving Vit. K antagonist with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving dabigatran
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=3, new_column_name=&#39;# patients receiving dabigatran with CVT&#39;)

        # Get % patients receiving dabigatran
        self.statsDf[&#39;% patients receiving dabigatran with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving rivaroxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=4, new_column_name=&#39;# patients receiving rivaroxaban with CVT&#39;)

        # Get % patients receiving rivaroxaban
        self.statsDf[&#39;% patients receiving rivaroxaban with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving apixaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=5, new_column_name=&#39;# patients receiving apixaban with CVT&#39;)

        # Get % patients receiving apixaban
        self.statsDf[&#39;% patients receiving apixaban with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving edoxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=6, new_column_name=&#39;# patients receiving edoxaban with CVT&#39;)

        # Get % patients receiving edoxaban
        self.statsDf[&#39;% patients receiving edoxaban with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in prophylactic dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=7, new_column_name=&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;)

        # Get % patients receiving LMWH or heparin in prophylactic dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=8, new_column_name=&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;)

        # Get % patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients not prescribed antithrombotics, but recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=9, new_column_name=&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;)

        # Get % patients not prescribed antithrombotics, but recommended
        self.statsDf[&#39;% patients not prescribed antithrombotics, but recommended with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients neither receiving antithrombotics nor recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=10, new_column_name=&#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;)

        # Get % patients neither receiving antithrombotics nor recommended
        self.statsDf[&#39;% patients neither receiving antithrombotics nor recommended with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        ## ANTITHROMBOTICS - PATIENTS PRESCRIBED + RECOMMENDED
        # patients prescribed antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets with CVT&#39;] + x[&#39;# patients receiving Vit. K antagonist with CVT&#39;] + x[&#39;# patients receiving dabigatran with CVT&#39;] + x[&#39;# patients receiving rivaroxaban with CVT&#39;] + x[&#39;# patients receiving apixaban with CVT&#39;] + x[&#39;# patients receiving edoxaban with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;], axis=1)

        # Get % patients prescribed antithrombotics
        #self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% patients prescribed antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        #  patients prescribed or recommended antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed or recommended antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets with CVT&#39;] + x[&#39;# patients receiving Vit. K antagonist with CVT&#39;] + x[&#39;# patients receiving dabigatran with CVT&#39;] + x[&#39;# patients receiving rivaroxaban with CVT&#39;] + x[&#39;# patients receiving apixaban with CVT&#39;] + x[&#39;# patients receiving edoxaban with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;] + x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;], axis=1)

        # Get % patients prescribed or recommended antithrombotics
        self.statsDf[&#39;% patients prescribed or recommended antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics with CVT&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;])) * 100, 2) if ((x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;]) &gt; 0) else 0, axis=1)

        #.round(decimals=2)) 

        self.statsDf.fillna(0, inplace=True)

        ###########################################
        # ANTIPLATELETS - PRESCRIBED WITHOUT AFIB #
        ###########################################
    
        # patients not referred                         
        afib_flutter_not_detected_or_not_known_with_cvt = is_tia_cvt[is_tia_cvt[&#39;AFIB_FLUTTER&#39;].isin([4, 5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known_with_cvt)

        afib_flutter_not_detected_or_not_known_with_cvt_dead = afib_flutter_not_detected_or_not_known_with_cvt[afib_flutter_not_detected_or_not_known_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known_with_cvt_dead)

        prescribed_antiplatelets_no_afib_with_cvt = afib_flutter_not_detected_or_not_known_with_cvt[afib_flutter_not_detected_or_not_known_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([1])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_patients_with_cvt&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib_with_cvt)

        prescribed_antiplatelets_no_afib_dead_with_cvt = prescribed_antiplatelets_no_afib_with_cvt[prescribed_antiplatelets_no_afib_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib_dead_with_cvt)

        self.tmp = afib_flutter_not_detected_or_not_known_with_cvt.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        
        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients prescribed antiplatelets without aFib with CVT&#39;)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antiplatelets without aFib with CVT&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antiplatelets without aFib with CVT&#39;] - x[&#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;])/(x[&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;])) * 100, 2) if ((x[&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;]) &gt; 0) else 0, axis=1)

        #########################################
        # ANTICOAGULANTS - PRESCRIBED WITH AFIB #
        #########################################
        # patients not referred 
        
        afib_flutter_detected_with_cvt = is_tia_cvt[is_tia_cvt[&#39;AFIB_FLUTTER&#39;].isin([1, 2, 3])].copy()
        self.statsDf[&#39;afib_flutter_detected_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_detected_with_cvt)

        anticoagulants_prescribed_with_cvt = afib_flutter_detected_with_cvt[~afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([1, 10, 9]) &amp; ~afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed anticoagulants with aFib with CVT&#39;] = self._count_patients(dataframe=anticoagulants_prescribed_with_cvt)
        
        anticoagulants_recommended_with_cvt = afib_flutter_detected_with_cvt[afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([9])].copy()
        self.statsDf[&#39;anticoagulants_recommended_patients_with_cvt&#39;] = self._count_patients(dataframe=anticoagulants_recommended_with_cvt)

        afib_flutter_detected_dead_with = afib_flutter_detected_with_cvt[afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_detected_dead_with)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed anticoagulants with aFib with CVT&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed anticoagulants with aFib with CVT&#39;]/(x[&#39;afib_flutter_detected_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;]) &gt; 0 else 0, axis=1)

        ##########################################
        # ANTITHROMBOTICS - PRESCRIBED WITH AFIB #
        ##########################################
    
        # patients not referred 
        antithrombotics_prescribed_with_cvt = afib_flutter_detected_with_cvt[~afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([9, 10]) &amp; ~afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed antithrombotics with aFib with CVT&#39;] = self._count_patients(dataframe=antithrombotics_prescribed_with_cvt)

        recommended_antithrombotics_with_afib_alive_with_cvt = afib_flutter_detected_with_cvt[afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([9]) &amp; ~afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;] = self._count_patients(dataframe=recommended_antithrombotics_with_afib_alive_with_cvt)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antithrombotics with aFib with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics with aFib with CVT&#39;]/(x[&#39;afib_flutter_detected_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;]) &gt; 0 else 0, axis=1)
        
        
        ###############################
        # ANTITHROMBOTICS WITHOUT CVT #
        ###############################
        # patients not reffered
        antithrombotics = is_tia[~is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;antithrombotics_patients&#39;] = self._count_patients(dataframe=antithrombotics)

        ischemic_transient_dead = is_tia[is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;ischemic_transient_dead_patients&#39;] = self._count_patients(dataframe=ischemic_transient_dead)

        ischemic_transient_dead_prescribed = is_tia[is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([5]) &amp; ~is_tia[&#39;ANTITHROMBOTICS&#39;].isin([10])].copy()
        self.statsDf[&#39;ischemic_transient_dead_patients_prescribed&#39;] = self._count_patients(dataframe=ischemic_transient_dead_prescribed)
        
        self.tmp = antithrombotics.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients receiving antiplatelets&#39;)

        
        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients receiving antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving antiplatelets&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        
        # Get patients receiving Vit. K antagonist
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=2, new_column_name=&#39;# patients receiving Vit. K antagonist&#39;)

        # Get % patients receiving Vit. K antagonist
        #self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving dabigatran
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=3, new_column_name=&#39;# patients receiving dabigatran&#39;)

        # Get % patients receiving dabigatran
        #self.statsDf[&#39;% patients receiving dabigatran&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving rivaroxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=4, new_column_name=&#39;# patients receiving rivaroxaban&#39;)

        # Get % patients receiving rivaroxaban
        #self.statsDf[&#39;% patients receiving rivaroxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving apixaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=5, new_column_name=&#39;# patients receiving apixaban&#39;)

        # Get % patients receiving apixaban
        #self.statsDf[&#39;% patients receiving apixaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving edoxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=6, new_column_name=&#39;# patients receiving edoxaban&#39;)

        # Get % patients receiving edoxaban
        #self.statsDf[&#39;% patients receiving edoxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in prophylactic dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=7, new_column_name=&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;)

        # Get % patients receiving LMWH or heparin in prophylactic dose
        #self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=8, new_column_name=&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;)

        # Get % patients receiving LMWH or heparin in full anticoagulant dose
        #self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)
        
        # Get patients not prescribed antithrombotics, but recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=9, new_column_name=&#39;# patients not prescribed antithrombotics, but recommended&#39;)

        # Get % patients not prescribed antithrombotics, but recommended
        self.statsDf[&#39;% patients not prescribed antithrombotics, but recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients neither receiving antithrombotics nor recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=10, new_column_name=&#39;# patients neither receiving antithrombotics nor recommended&#39;)

        # Get % patients neither receiving antithrombotics nor recommended
        self.statsDf[&#39;% patients neither receiving antithrombotics nor recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients neither receiving antithrombotics nor recommended&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        ## ANTITHROMBOTICS - PATIENTS PRESCRIBED + RECOMMENDED
        # patients prescribed antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets&#39;] + x[&#39;# patients receiving Vit. K antagonist&#39;] + x[&#39;# patients receiving dabigatran&#39;] + x[&#39;# patients receiving rivaroxaban&#39;] + x[&#39;# patients receiving apixaban&#39;] + x[&#39;# patients receiving edoxaban&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;], axis=1)

        # Get % patients prescribed antithrombotics
        #self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        
        #  patients prescribed or recommended antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets&#39;] + x[&#39;# patients receiving Vit. K antagonist&#39;] + x[&#39;# patients receiving dabigatran&#39;] + x[&#39;# patients receiving rivaroxaban&#39;] + x[&#39;# patients receiving apixaban&#39;] + x[&#39;# patients receiving edoxaban&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;] + x[&#39;# patients not prescribed antithrombotics, but recommended&#39;], axis=1)

        # Get % patients prescribed or recommended antithrombotics
        # From patients prescribed or recommended antithrombotics remove patient who had prescribed antithrombotics and were dead (nominator)
        #self.statsDf[&#39;% patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics&#39;] - x[&#39;ischemic_transient_dead_patients_prescribed&#39;])/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100, 2) if ((x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0) else 0, axis=1)
        self.statsDf[&#39;% patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics&#39;] - x[&#39;ischemic_transient_dead_patients_prescribed&#39;])/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100, 2) if ((x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0) else 0, axis=1)
        
        #.round(decimals=2)) 
        self.statsDf.drop([&#39;# patients receiving Vit. K antagonist&#39;, &#39;# patients receiving dabigatran&#39;, &#39;# patients receiving rivaroxaban&#39;, &#39;# patients receiving apixaban&#39;, &#39;# patients receiving edoxaban&#39;, &#39;# patients receiving LMWH or heparin in prophylactic dose&#39;,&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;], axis=1, inplace=True)

        self.statsDf.fillna(0, inplace=True)
        ###########################################
        # ANTIPLATELETS - PRESCRIBED WITHOUT AFIB #
        ###########################################
        
        # patients not referred
        afib_flutter_not_detected_or_not_known = is_tia[is_tia[&#39;AFIB_FLUTTER&#39;].isin([4, 5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_patients&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known)

        afib_flutter_not_detected_or_not_known_dead = afib_flutter_not_detected_or_not_known[afib_flutter_not_detected_or_not_known[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known_dead)

        prescribed_antiplatelets_no_afib = afib_flutter_not_detected_or_not_known[afib_flutter_not_detected_or_not_known[&#39;ANTITHROMBOTICS&#39;].isin([1])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_patients&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib)

        prescribed_antiplatelets_no_afib_dead = prescribed_antiplatelets_no_afib[prescribed_antiplatelets_no_afib[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib_dead)

        self.tmp = afib_flutter_not_detected_or_not_known.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        
        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients prescribed antiplatelets without aFib&#39;)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antiplatelets without aFib&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antiplatelets without aFib&#39;] - x[&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;])/(x[&#39;afib_flutter_not_detected_or_not_known_patients&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;])) * 100, 2) if ((x[&#39;afib_flutter_not_detected_or_not_known_patients&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;]) &gt; 0) else 0, axis=1)

        #########################################
        # ANTICOAGULANTS - PRESCRIBED WITH AFIB #
        #########################################
    
        # patients not referred 
        afib_flutter_detected = is_tia[is_tia[&#39;AFIB_FLUTTER&#39;].isin([1, 2, 3])].copy()
        self.statsDf[&#39;afib_flutter_detected_patients&#39;] = self._count_patients(dataframe=afib_flutter_detected)

        afib_flutter_detected_not_dead = afib_flutter_detected[~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_detected_patients_not_dead&#39;] = self._count_patients(dataframe=afib_flutter_detected_not_dead)

        anticoagulants_prescribed = afib_flutter_detected[~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1, 10, 9]) &amp; ~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed anticoagulants with aFib&#39;] = self._count_patients(dataframe=anticoagulants_prescribed)

        self.tmp = anticoagulants_prescribed.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        # Additional calculation 
        # Get patients receiving Vit. K antagonist
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=2, new_column_name=&#39;# patients receiving Vit. K antagonist&#39;)

        # Get % patients receiving Vit. K antagonist
        #self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/x[&#39;# patients prescribed anticoagulants with aFib&#39;]) * 100), 2) if x[&#39;# patients prescribed anticoagulants with aFib&#39;] &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving dabigatran
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=3, new_column_name=&#39;# patients receiving dabigatran&#39;)

        # Get % patients receiving dabigatran
        self.statsDf[&#39;% patients receiving dabigatran&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving rivaroxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=4, new_column_name=&#39;# patients receiving rivaroxaban&#39;)

        # Get % patients receiving rivaroxaban
        self.statsDf[&#39;% patients receiving rivaroxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving apixaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=5, new_column_name=&#39;# patients receiving apixaban&#39;)

        # Get % patients receiving apixaban
        self.statsDf[&#39;% patients receiving apixaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving edoxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=6, new_column_name=&#39;# patients receiving edoxaban&#39;)

        # Get % patients receiving edoxaban
        self.statsDf[&#39;% patients receiving edoxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)
        # Get patients receiving LMWH or heparin in prophylactic dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=7, new_column_name=&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;)

        # Get % patients receiving LMWH or heparin in prophylactic dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=8, new_column_name=&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;)

        # Get % patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        
        anticoagulants_recommended = afib_flutter_detected[afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9])].copy()
        self.statsDf[&#39;anticoagulants_recommended_patients&#39;] = self._count_patients(dataframe=anticoagulants_recommended)

        afib_flutter_detected_dead = afib_flutter_detected[afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_detected_dead_patients&#39;] = self._count_patients(dataframe=afib_flutter_detected_dead)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed anticoagulants with aFib&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed anticoagulants with aFib&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        ##########################################
        # ANTITHROMBOTICS - PRESCRIBED WITH AFIB #
        ##########################################
        # patients not reffered 
        antithrombotics_prescribed = afib_flutter_detected[~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9, 10]) &amp; ~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed antithrombotics with aFib&#39;] = self._count_patients(dataframe=antithrombotics_prescribed)

        recommended_antithrombotics_with_afib_alive = afib_flutter_detected[afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9]) &amp; ~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;recommended_antithrombotics_with_afib_alive_patients&#39;] = self._count_patients(dataframe=recommended_antithrombotics_with_afib_alive)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antithrombotics with aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics with aFib&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients&#39;]) &gt; 0 else 0, axis=1)
        
        ###########
        # STATINS #
        ###########
        if country_code == &#39;CZ&#39;:
            is_tia_discharged_home = is_tia[is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([1])].copy()
            self.statsDf[&#39;is_tia_discharged_home_patients&#39;] = self._count_patients(dataframe=is_tia_discharged_home)
            
            self.tmp = is_tia_discharged_home.groupby([&#39;Protocol ID&#39;, &#39;STATIN&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients prescribed statins - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=1, new_column_name=&#39;# patients prescribed statins - Yes&#39;)

            # Get % patients prescribed statins - Yes
            self.statsDf[&#39;% patients prescribed statins - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Yes&#39;]/x[&#39;is_tia_discharged_home_patients&#39;]) * 100), 2) if x[&#39;is_tia_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=2, new_column_name=&#39;# patients prescribed statins - No&#39;)

            # Get % patients prescribed statins - No
            self.statsDf[&#39;% patients prescribed statins - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - No&#39;]/x[&#39;is_tia_discharged_home_patients&#39;]) * 100), 2) if x[&#39;is_tia_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=3, new_column_name=&#39;# patients prescribed statins - Not known&#39;)

            # Get % patients prescribed statins - Not known
            self.statsDf[&#39;% patients prescribed statins - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Not known&#39;]/x[&#39;is_tia_discharged_home_patients&#39;]) * 100), 2) if x[&#39;is_tia_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)
        else:
            self.tmp = is_tia.groupby([&#39;Protocol ID&#39;, &#39;STATIN&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients prescribed statins - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=1, new_column_name=&#39;# patients prescribed statins - Yes&#39;)

            # Get % patients prescribed statins - Yes
            self.statsDf[&#39;% patients prescribed statins - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Yes&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=2, new_column_name=&#39;# patients prescribed statins - No&#39;)

            # Get % patients prescribed statins - No
            self.statsDf[&#39;% patients prescribed statins - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - No&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=3, new_column_name=&#39;# patients prescribed statins - Not known&#39;)

            # Get % patients prescribed statins - Not known
            self.statsDf[&#39;% patients prescribed statins - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Not known&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        ####################
        # CAROTID STENOSIS #
        ####################
        self.tmp = is_tia.groupby([&#39;Protocol ID&#39;, &#39;CAROTID_STENOSIS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get carotid stenosis - 50%-70%
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=1, new_column_name=&#39;# carotid stenosis - 50%-70%&#39;)

        # Get % carotid stenosis - 50%-70%
        self.statsDf[&#39;% carotid stenosis - 50%-70%&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - 50%-70%&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis - &gt;70%
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=2, new_column_name=&#39;# carotid stenosis - &gt;70%&#39;)

        # Get % carotid stenosis - &gt;70%
        self.statsDf[&#39;% carotid stenosis - &gt;70%&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - &gt;70%&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=3, new_column_name=&#39;# carotid stenosis - No&#39;)

        # Get % carotid stenosis - No
        self.statsDf[&#39;% carotid stenosis - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - No&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=4, new_column_name=&#39;# carotid stenosis - Not known&#39;)

        # Get % carotid stenosis - Not known
        self.statsDf[&#39;% carotid stenosis - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - Not known&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        ##############################
        # CAROTID STENOSIS FOLLOW-UP #
        ##############################
        #carotid_stenosis = is_tia[is_tia[&#39;CAROTID_STENOSIS&#39;].isin([1, 2])]
        # Change to &gt;70% patients
        carotid_stenosis = is_tia[is_tia[&#39;CAROTID_STENOSIS&#39;].isin([1, 2])] 

        self.tmp = carotid_stenosis.groupby([&#39;Protocol ID&#39;, &#39;CAROTID_STENOSIS_FOLLOWUP&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get carotid stenosis followup - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=1, new_column_name=&#39;# carotid stenosis followup - Yes&#39;)

        # Get % carotid stenosis followup - Yes
        self.statsDf[&#39;% carotid stenosis followup - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - Yes&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=2, new_column_name=&#39;# carotid stenosis followup - No&#39;)

        # Get % carotid stenosis followup - No
        self.statsDf[&#39;% carotid stenosis followup - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - No&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - No, but planned later
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=3, new_column_name=&#39;# carotid stenosis followup - No, but planned later&#39;)

        # Get % carotid stenosis followup - No, but planned later
        self.statsDf[&#39;% carotid stenosis followup - No, but planned later&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - No, but planned later&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - Yes, but planned
        carotid_stenosis_followup = carotid_stenosis[carotid_stenosis[&#39;CAROTID_STENOSIS_FOLLOWUP&#39;].isin([1, 3])].copy()
        self.statsDf[&#39;# carotid stenosis followup - Yes, but planned&#39;] = self._count_patients(dataframe=carotid_stenosis_followup)

        # Get % carotid stenosis followup - Yes, but planned
        self.statsDf[&#39;% carotid stenosis followup - Yes, but planned&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - Yes, but planned&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - Referred to another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=4, new_column_name=&#39;# carotid stenosis followup - Referred to another centre&#39;)

        # Get % carotid stenosis followup - Referred to another centre
        self.statsDf[&#39;% carotid stenosis followup - Referred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - Referred to another centre&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        #####################
        # ANTIHYPERTENSIVES #
        #####################
        self.tmp = discharge_subset_alive.groupby([&#39;Protocol ID&#39;, &#39;ANTIHYPERTENSIVE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get prescribed antihypertensives - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTIHYPERTENSIVE&#34;, value=3, new_column_name=&#39;# prescribed antihypertensives - Not known&#39;)

        # Get % prescribed antihypertensives - Not known
        self.statsDf[&#39;% prescribed antihypertensives - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# prescribed antihypertensives - Not known&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        # Get prescribed antihypertensives - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTIHYPERTENSIVE&#34;, value=1, new_column_name=&#39;# prescribed antihypertensives - Yes&#39;)

        # Get % prescribed antihypertensives - Yes
        self.statsDf[&#39;% prescribed antihypertensives - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# prescribed antihypertensives - Yes&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;]) &gt; 0 else 0, axis=1)
        
        # Get prescribed antihypertensives - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTIHYPERTENSIVE&#34;, value=2, new_column_name=&#39;# prescribed antihypertensives - No&#39;)

        # Get % prescribed antihypertensives - No
        self.statsDf[&#39;% prescribed antihypertensives - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# prescribed antihypertensives - No&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;]) &gt; 0 else 0, axis=1)

        #####################
        # SMOKING CESSATION #
        #####################
        self.tmp = discharge_subset_alive.groupby([&#39;Protocol ID&#39;, &#39;SMOKING_CESSATION&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get recommended to a smoking cessation program - not a smoker
        self.statsDf = self._get_values_for_factors(column_name=&#34;SMOKING_CESSATION&#34;, value=3, new_column_name=&#39;# recommended to a smoking cessation program - not a smoker&#39;)

        # Get % recommended to a smoking cessation program - not a smoker
        self.statsDf[&#39;% recommended to a smoking cessation program - not a smoker&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a smoking cessation program - not a smoker&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        # Get recommended to a smoking cessation program - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;SMOKING_CESSATION&#34;, value=1, new_column_name=&#39;# recommended to a smoking cessation program - Yes&#39;)

        # Get % recommended to a smoking cessation program - Yes
        self.statsDf[&#39;% recommended to a smoking cessation program - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a smoking cessation program - Yes&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        # Get recommended to a smoking cessation program - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;SMOKING_CESSATION&#34;, value=2, new_column_name=&#39;# recommended to a smoking cessation program - No&#39;)

        # Get % recommended to a smoking cessation program - No
        self.statsDf[&#39;% recommended to a smoking cessation program - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a smoking cessation program - No&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        ##########################
        # CEREBROVASCULAR EXPERT #
        ##########################
        self.tmp = discharge_subset_alive.groupby([&#39;Protocol ID&#39;, &#39;CEREBROVASCULAR_EXPERT&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get recommended to a cerebrovascular expert - Recommended, and appointment was made
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=1, new_column_name=&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;)

        # Get % recommended to a cerebrovascular expert - Recommended, and appointment was made
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get recommended to a cerebrovascular expert - Recommended, but appointment was not made
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=2, new_column_name=&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;)

        # Get % recommended to a cerebrovascular expert - Recommended, but appointment was not made
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get recommended to a cerebrovascular expert - Recommended
        self.statsDf.loc[:, &#39;# recommended to a cerebrovascular expert - Recommended&#39;] = self.statsDf.apply(lambda x: x[&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;] + x[&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;], axis=1)

        # Get % recommended to a cerebrovascular expert - Recommended
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Recommended&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get recommended to a cerebrovascular expert - Not recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=3, new_column_name=&#39;# recommended to a cerebrovascular expert - Not recommended&#39;)

        # Get % recommended to a cerebrovascular expert - Not recommended
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Not recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Not recommended&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        #########################
        # DISCHARGE DESTINATION #
        #########################
        self.tmp = discharge_subset.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_DESTINATION&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get discharge destination - Home
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=1, new_column_name=&#39;# discharge destination - Home&#39;)

        # Get % discharge destination - Home
        self.statsDf[&#39;% discharge destination - Home&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Home&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Transferred within the same centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=2, new_column_name=&#39;# discharge destination - Transferred within the same centre&#39;)

        # Get % discharge destination - Transferred within the same centre
        self.statsDf[&#39;% discharge destination - Transferred within the same centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Transferred within the same centre&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Transferred to another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=3, new_column_name=&#39;# discharge destination - Transferred to another centre&#39;)

        # Get % discharge destination - Transferred to another centre
        self.statsDf[&#39;% discharge destination - Transferred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Transferred to another centre&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Social care facility
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=4, new_column_name=&#39;# discharge destination - Social care facility&#39;)

        # Get % discharge destination - Social care facility
        self.statsDf[&#39;% discharge destination - Social care facility&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Social care facility&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Dead
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=5, new_column_name=&#39;# discharge destination - Dead&#39;)

        # Get % discharge destination - Dead
        self.statsDf[&#39;% discharge destination - Dead&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Dead&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        #######################################
        # DISCHARGE DESTINATION - SAME CENTRE #
        #######################################
        discharge_subset_same_centre = discharge_subset[discharge_subset[&#39;DISCHARGE_DESTINATION&#39;].isin([2])].copy()
        self.statsDf[&#39;discharge_subset_same_centre_patients&#39;] = self._count_patients(dataframe=discharge_subset_same_centre)

        self.tmp = discharge_subset_same_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_SAME_FACILITY&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get transferred within the same centre - Acute rehabilitation
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_SAME_FACILITY&#34;, value=1, new_column_name=&#39;# transferred within the same centre - Acute rehabilitation&#39;)

        # Get % transferred within the same centre - Acute rehabilitation
        self.statsDf[&#39;% transferred within the same centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred within the same centre - Acute rehabilitation&#39;]/x[&#39;discharge_subset_same_centre_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_same_centre_patients&#39;] &gt; 0 else 0, axis=1)

        # Get transferred within the same centre - Post-care bed
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_SAME_FACILITY&#34;, value=2, new_column_name=&#39;# transferred within the same centre - Post-care bed&#39;)

        # Get % transferred within the same centre - Post-care bed
        self.statsDf[&#39;% transferred within the same centre - Post-care bed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred within the same centre - Post-care bed&#39;]/x[&#39;discharge_subset_same_centre_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_same_centre_patients&#39;] &gt; 0 else 0, axis=1)

        # Get transferred within the same centre - Another department
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_SAME_FACILITY&#34;, value=3, new_column_name=&#39;# transferred within the same centre - Another department&#39;)

        # Get % transferred within the same centre - Another department
        self.statsDf[&#39;% transferred within the same centre - Another department&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred within the same centre - Another department&#39;]/x[&#39;discharge_subset_same_centre_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_same_centre_patients&#39;] &gt; 0 else 0, axis=1)

        # Check if sum of % is &gt; 100 (100.01)
        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% transferred within the same centre - Acute rehabilitation&#39;] + self.statsDf[&#39;% transferred within the same centre - Post-care bed&#39;] + self.statsDf[&#39;% transferred within the same centre - Another department&#39;]
        #self.statsDf[&#39;% transferred within the same centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: x[&#39;% transferred within the same centre - Acute rehabilitation&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% transferred within the same centre - Acute rehabilitation&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)

        ############################################
        # DISCHARGE DESTINATION - ANOTHER FACILITY #
        ############################################
        discharge_subset_another_centre = discharge_subset[discharge_subset[&#39;DISCHARGE_DESTINATION&#39;].isin([3])].copy()
        self.statsDf[&#39;discharge_subset_another_centre_patients&#39;] = self._count_patients(dataframe=discharge_subset_another_centre)

        self.tmp = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get transferred to another centre - Stroke centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=1, new_column_name=&#39;# transferred to another centre - Stroke centre&#39;)

        # Get % transferred to another centre - Stroke centre
        self.statsDf[&#39;% transferred to another centre - Stroke centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred to another centre - Stroke centre&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get transferred to another centre - Comprehensive stroke centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=2, new_column_name=&#39;# transferred to another centre - Comprehensive stroke centre&#39;)

        # Get % transferred to another centre - Comprehensive stroke centre
        self.statsDf[&#39;% transferred to another centre - Comprehensive stroke centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred to another centre - Comprehensive stroke centre&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get transferred to another centre - Another hospital
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=3, new_column_name=&#39;# transferred to another centre - Another hospital&#39;)

        # Get % transferred to another centre - Another hospital
        self.statsDf[&#39;% transferred to another centre - Another hospital&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred to another centre - Another hospital&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        #########################################################
        # DISCHARGE DESTINATION - ANOTHER FACILITY - DEPARTMENT #
        #########################################################
        self.tmp = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY_O1&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        tmp_o2 = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY_O2&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        tmp_o3 = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY_O3&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get department transferred to within another centre - Acute rehabilitation
        self.statsDf[&#39;# department transferred to within another centre - Acute rehabilitation&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=1, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=1, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=1, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Acute rehabilitation
        self.statsDf[&#39;% department transferred to within another centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Acute rehabilitation&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get department transferred to within another centre - Post-care bed
        self.statsDf[&#39;# department transferred to within another centre - Post-care bed&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=2, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=2, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=2, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Post-care bed
        self.statsDf[&#39;% department transferred to within another centre - Post-care bed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Post-care bed&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get department transferred to within another centre - Neurology
        self.statsDf[&#39;# department transferred to within another centre - Neurology&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=3, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=3, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=3, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Neurology
        self.statsDf[&#39;% department transferred to within another centre - Neurology&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Neurology&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get department transferred to within another centre - Another department
        self.statsDf[&#39;# department transferred to within another centre - Another department&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=4, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=4, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=4, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Another department
        self.statsDf[&#39;% department transferred to within another centre - Another department&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Another department&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        # Check if sum of % is &gt; 100 (100.01)
        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% department transferred to within another centre - Acute rehabilitation&#39;] + self.statsDf[&#39;% department transferred to within another centre - Post-care bed&#39;] + self.statsDf[&#39;% department transferred to within another centre - Neurology&#39;] + self.statsDf[&#39;% department transferred to within another centre - Another department&#39;]
        #self.statsDf[&#39;% department transferred to within another centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: x[&#39;% department transferred to within another centre - Acute rehabilitation&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% department transferred to within another centre - Acute rehabilitation&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)

        ############################################
        # DISCHARGE DESTINATION - ANOTHER FACILITY #
        ############################################
        discharge_subset.fillna(0, inplace=True)
        discharge_subset_mrs = discharge_subset[~discharge_subset[&#39;DISCHARGE_MRS&#39;].isin([0])].copy()
        #discharge_subset_mrs[&#39;DISCHARGE_MRS&#39;] = discharge_subset_mrs[&#39;DISCHARGE_MRS&#39;].astype(float)

        def function(x):
            x = float(x)
            if (x == 1):
                x = x - 1
            else: 
                x = x - 2 

            return x

        if discharge_subset_mrs.empty:
            self.statsDf[&#39;Median discharge mRS&#39;] = 0
            self.statsDf.fillna(0, inplace=True)
        else: 
            discharge_subset_mrs[&#39;DISCHARGE_MRS_ADJUSTED&#39;] = discharge_subset_mrs.apply(lambda row: function(row[&#39;DISCHARGE_MRS&#39;]), axis=1)
            discharge_subset_mrs[&#39;DISCHARGE_MRS_ADDED&#39;] = discharge_subset_mrs[&#39;DISCHARGE_MRS_ADJUSTED&#39;] + discharge_subset_mrs[&#39;D_MRS_SCORE&#39;]
            discharge_subset_mrs.fillna(0, inplace=True)

            self.statsDf = self.statsDf.merge(discharge_subset_mrs.groupby([&#39;Protocol ID&#39;]).DISCHARGE_MRS_ADDED.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median discharge mRS&#39;})[&#39;Median discharge mRS&#39;].reset_index(), how=&#39;outer&#39;)
            self.statsDf.fillna(0, inplace=True)

        ########################
        # MEDIAN HOSPITAL STAY #
        ########################
        positive_hospital_days = self.df[self.df[&#39;HOSPITAL_DAYS&#39;] &gt; 0]
        self.statsDf = self.statsDf.merge(positive_hospital_days.groupby([&#39;Protocol ID&#39;]).HOSPITAL_DAYS.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median hospital stay (days)&#39;})[&#39;Median hospital stay (days)&#39;].reset_index(), how=&#39;outer&#39;)
        self.statsDf.fillna(0, inplace=True)

        wrong_ivtpa = recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 0]

        self.statsDf[&#39;wrong_ivtpa&#39;] = self._count_patients(dataframe=wrong_ivtpa)
        #print(self.statsDf[&#39;wrong_ivtpa&#39;])

        self.statsDf.loc[:, &#39;# patients eligible thrombolysis&#39;] = self.statsDf.apply(lambda x: (x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;]) - x[&#39;wrong_ivtpa&#39;], axis=1)
        self.statsDf.drop([&#39;wrong_ivtpa&#39;], inplace=True, axis=1)

        wrong_tby = recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;TBY&#39;] &lt;= 0]

        self.statsDf[&#39;wrong_tby&#39;] = self._count_patients(dataframe=wrong_tby)

        self.statsDf.loc[:, &#39;# patients eligible thrombectomy&#39;] = self.statsDf.apply(lambda x: (x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]) - x[&#39;wrong_tby&#39;], axis=1)
        self.statsDf.drop([&#39;wrong_tby&#39;], inplace=True, axis=1)

        ################
        # ANGEL AWARDS #
        ################
        #### TOTAL PATIENTS #####
        self.total_patient_column = &#39;# total patients &gt;= {0}&#39;.format(self.patient_limit)
        self.statsDf[self.total_patient_column] = self.statsDf[&#39;Total Patients&#39;] &gt;= self.patient_limit

        #### DOOR TO THROMBOLYSIS THERAPY - MINUTES ####
        # TO DO:
        # THROMBOLYSIS - UNDER 60
        # THROMBOLYSIS - UNDER 45
        # THROMBECTOMY - UNDER 90
        # THROMBECTOMY - UNDER 60
        # If thrombectomy done not at all, take the possible lowest award they can get
        # Create temporary dataframe only with rows where thrombolysis was performed under 60 minute
        recanalization_procedure_iv_tpa_under_60 = recanalization_procedure_iv_tpa.loc[(recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &gt; 0) &amp; (recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 60)]
        # Create temporary dataframe only with rows where thrombolysis was performed under 45 minute
        recanalization_procedure_iv_tpa_under_45 = recanalization_procedure_iv_tpa.loc[(recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &gt; 0) &amp; (recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 45)]

        self.statsDf[&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_iv_tpa_under_60)

        self.statsDf[&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;]/x[&#39;# patients eligible thrombolysis&#39;]) * 100), 2) if x[&#39;# patients eligible thrombolysis&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_iv_tpa_under_45)

        self.statsDf[&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;]/x[&#39;# patients eligible thrombolysis&#39;]) * 100), 2) if x[&#39;# patients eligible thrombolysis&#39;] &gt; 0 else 0, axis=1)

        # for tby, we are only looking at patients that have had ONLY tby, not tpa + tby, as we awould be counting those patients twice (penalizing twice)
        recanalization_procedure_tby_only_dtg =  recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;RECANALIZATION_PROCEDURES&#39;].isin([3, 4])]

        # Create temporary dataframe only with rows where trombectomy was performed under 90 minutes
        recanalization_procedure_tby_only_dtg_under_90 = recanalization_procedure_tby_only_dtg.loc[(recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &gt; 0) &amp; (recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &lt;= 90)]
        # Create temporary dataframe only with rows where trombectomy was performed under 60 minutes
        recanalization_procedure_tby_only_dtg_under_60 = recanalization_procedure_tby_only_dtg.loc[(recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &gt; 0) &amp; (recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &lt;= 60)]
        
        self.statsDf[&#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_tby_only_dtg_under_90)

        self.statsDf[&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;]/x[&#39;# patients eligible thrombectomy&#39;]) * 100), 2) if x[&#39;# patients eligible thrombectomy&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_tby_only_dtg_under_60)

        self.statsDf[&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;]/x[&#39;# patients eligible thrombectomy&#39;]) * 100), 2) if x[&#39;# patients eligible thrombectomy&#39;] &gt; 0 else 0, axis=1)

        #### RECANALIZATION RATE ####
        # recanalization rate out of total ischemic incidence
        self.statsDf[&#39;# recanalization rate out of total ischemic incidence&#39;] = self.statsDf[&#39;# patients recanalized&#39;]

        # % recanalization rate out of total ischemic incidence
        self.statsDf[&#39;% recanalization rate out of total ischemic incidence&#39;] = self.statsDf[&#39;% patients recanalized&#39;]

        #### CT/MRI ####
        # suspected stroke patients undergoing CT/MRI
        self.statsDf[&#39;# suspected stroke patients undergoing CT/MRI&#39;] = self.statsDf[&#39;# CT/MRI - performed&#39;]

        # % suspected stroke patients undergoing CT/MRI
        self.statsDf[&#39;% suspected stroke patients undergoing CT/MRI&#39;] = self.statsDf[&#39;% CT/MRI - performed&#39;]

        #### DYSPHAGIA SCREENING ####
        # all stroke patients undergoing dysphagia screening
        self.statsDf[&#39;# all stroke patients undergoing dysphagia screening&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;]

        # % all stroke patients undergoing dysphagia screening
        self.statsDf[&#39;% all stroke patients undergoing dysphagia screening&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# all stroke patients undergoing dysphagia screening&#39;]/(x[&#39;# all stroke patients undergoing dysphagia screening&#39;] + x[&#39;# dysphagia screening - Not done&#39;])) * 100), 2) if (x[&#39;# all stroke patients undergoing dysphagia screening&#39;] + x[&#39;# dysphagia screening - Not done&#39;]) &gt; 0 else 0, axis=1)

        #### ISCHEMIC STROKE + NO AFIB + ANTIPLATELETS ####
        non_transferred_antiplatelets = antithrombotics[~antithrombotics[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5,6])]
        #antithrombotics_discharged_home = antithrombotics[antithrombotics[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        # Get temporary dataframe with patients who have prescribed antithrombotics and ischemic stroke
        antiplatelets = non_transferred_antiplatelets[non_transferred_antiplatelets[&#39;STROKE_TYPE&#39;].isin([1])]
        #antiplatelets = antithrombotics[antithrombotics[&#39;STROKE_TYPE&#39;].isin([1])]
        #antiplatelets = antithrombotics_discharged_home[antithrombotics_discharged_home[&#39;STROKE_TYPE&#39;].isin([1])]
        # Filter temporary dataframe and get only patients who have not been detected or not known for aFib flutter. 
        antiplatelets = antiplatelets[antiplatelets[&#39;AFIB_FLUTTER&#39;].isin([4, 5])]
        # Get patients who have prescribed antithrombotics 
        except_recommended = antiplatelets[~antiplatelets[&#39;ANTITHROMBOTICS&#39;].isin([9])]

        # Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.
        self.statsDf[&#39;except_recommended_patients&#39;] = self._count_patients(dataframe=except_recommended)
        # Get temporary dataframe groupby protocol ID and antithrombotics column
        self.tmp = antiplatelets.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        # ischemic stroke patients discharged with antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# ischemic stroke patients discharged with antiplatelets&#39;)
        # % ischemic stroke patients discharged with antiplatelets
        self.statsDf[&#39;% ischemic stroke patients discharged with antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# ischemic stroke patients discharged with antiplatelets&#39;]/x[&#39;except_recommended_patients&#39;]) * 100), 2) if x[&#39;except_recommended_patients&#39;] &gt; 0 else 0, axis=1)

        # discharged home
        antiplatelets_discharged_home = antiplatelets[antiplatelets[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        
        if (antiplatelets_discharged_home.empty):
            # Get temporary dataframe groupby protocol ID and antithrombotics column
            self.tmp = antiplatelets.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
            # ischemic stroke patients discharged with antiplatelets
            self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# ischemic stroke patients discharged home with antiplatelets&#39;)
            # % ischemic stroke patients discharged with antiplatelets
            self.statsDf[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;]/x[&#39;except_recommended_patients&#39;]) * 100), 2) if x[&#39;except_recommended_patients&#39;] &gt; 0 else 0, axis=1)
            self.statsDf[&#39;except_recommended_discharged_home_patients&#39;] = self.statsDf[&#39;except_recommended_patients&#39;]
        else:
            # Get temporary dataframe groupby protocol ID and antithrombotics column
            self.tmp = antiplatelets_discharged_home.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
            # Get patients who have prescribed antithrombotics 
            except_recommended_discharged_home = except_recommended[except_recommended[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]

            # Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.
            self.statsDf[&#39;except_recommended_discharged_home_patients&#39;] = self._count_patients(dataframe=except_recommended_discharged_home)
            # ischemic stroke patients discharged with antiplatelets
            self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# ischemic stroke patients discharged home with antiplatelets&#39;)
            # % ischemic stroke patients discharged with antiplatelets
            self.statsDf[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;]/x[&#39;except_recommended_discharged_home_patients&#39;]) * 100), 2) if x[&#39;except_recommended_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# ischemic stroke patients discharged (home) with antiplatelets&#39;] = self.statsDf.apply(lambda x: x[&#39;# ischemic stroke patients discharged with antiplatelets&#39;] if x[&#39;# ischemic stroke patients discharged with antiplatelets&#39;] &gt; x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;] else x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;], axis=1)
        self.statsDf[&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;] = self.statsDf.apply(lambda x: x[&#39;% ischemic stroke patients discharged with antiplatelets&#39;] if x[&#39;% ischemic stroke patients discharged with antiplatelets&#39;] &gt; x[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;] else x[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;], axis=1)

        # afib patients discharged with anticoagulants
        self.statsDf[&#39;# afib patients discharged with anticoagulants&#39;] = self._count_patients(dataframe=anticoagulants_prescribed)
        # Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics or with nothign (ANTITHROMBOTICS = 10)
        afib_detected_discharged_home = afib_flutter_detected[(~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1, 9]))]
        # Get afib patients discharged and not dead
        self.statsDf[&#39;afib_detected_discharged_patients&#39;] = self._count_patients(dataframe=afib_detected_discharged_home)
        # % afib patients discharged with anticoagulants        
        #self.statsDf[&#39;% afib patients discharged with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged with anticoagulants&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;]) &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% afib patients discharged with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged with anticoagulants&#39;]/x[&#39;afib_detected_discharged_patients&#39;]) * 100), 2) if (x[&#39;afib_detected_discharged_patients&#39;]) &gt; 0 else 0, axis=1)
        
        # Get temporary dataframe with patients who have prescribed anticoagulats and were discharged home 
        non_trasferred_anticoagulants = anticoagulants_prescribed[~anticoagulants_prescribed[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5,6])]
        anticoagulants_prescribed_discharged_home = non_trasferred_anticoagulants[non_trasferred_anticoagulants[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        #anticoagulants_prescribed_discharged_home = anticoagulants_prescribed[anticoagulants_prescribed[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        # Get temporary dataframe with patients who have been discharge at home with detected aFib flutter and with prescribed antithrombotics
        #afib_detected_discharged_home = afib_flutter_detected[(afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([1])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9]))]
        afib_detected_discharged_home = afib_flutter_detected[(afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([1])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1,9])) &amp; (~afib_flutter_detected[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5,6]))]

        # Check if temporary dataframe is empty. If yes, the value is calculated not only for discharged home, but only dead patients are excluded
        if (anticoagulants_prescribed_discharged_home.empty):
            # afib patients discharged home with anticoagulants 
            anticoagulants_prescribed_discharged_home = anticoagulants_prescribed[~anticoagulants_prescribed[&#39;DISCHARGE_DESTINATION&#39;].isin([5])]
            # Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics 
            afib_detected_discharged_home = afib_flutter_detected[(~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1,9]))]
            # Get # afib patients discharged home with anticoagulants
            self.statsDf[&#39;# afib patients discharged home with anticoagulants&#39;] = self._count_patients(dataframe=anticoagulants_prescribed_discharged_home)
            # Get afib patients discharged and not dead
            self.statsDf[&#39;afib_detected_discharged_home_patients&#39;] = self._count_patients(dataframe=afib_detected_discharged_home)
            # Get % afib patients discharge with anticoagulants and not dead
            self.statsDf[&#39;% afib patients discharged home with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged home with anticoagulants&#39;]/x[&#39;afib_detected_discharged_home_patients&#39;]) * 100), 2) if x[&#39;afib_detected_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)
        else:
            # Get # afib patients discharged home with anticoagulants   
            self.statsDf[&#39;# afib patients discharged home with anticoagulants&#39;] = self._count_patients(dataframe=anticoagulants_prescribed_discharged_home)
            # Get afib patients discharged home 
            self.statsDf[&#39;afib_detected_discharged_home_patients&#39;] = self._count_patients(dataframe=afib_detected_discharged_home)
            # Get % afib patients discharged home with anticoagulants
            self.statsDf[&#39;% afib patients discharged home with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged home with anticoagulants&#39;]/x[&#39;afib_detected_discharged_home_patients&#39;]) * 100), 2) if x[&#39;afib_detected_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# afib patients discharged (home) with anticoagulants&#39;] = self.statsDf.apply(lambda x: x[&#39;# afib patients discharged with anticoagulants&#39;] if x[&#39;% afib patients discharged with anticoagulants&#39;] &gt; x[&#39;% afib patients discharged home with anticoagulants&#39;] else x[&#39;# afib patients discharged home with anticoagulants&#39;], axis=1)
        self.statsDf[&#39;% afib patients discharged (home) with anticoagulants&#39;] = self.statsDf.apply(lambda x: x[&#39;% afib patients discharged with anticoagulants&#39;] if x[&#39;% afib patients discharged with anticoagulants&#39;] &gt; x[&#39;% afib patients discharged home with anticoagulants&#39;] else x[&#39;% afib patients discharged home with anticoagulants&#39;], axis=1)

        #### STROKE UNIT ####
        # stroke patients treated in a dedicated stroke unit / ICU
        self.statsDf[&#39;# stroke patients treated in a dedicated stroke unit / ICU&#39;] = self.statsDf[&#39;# patients hospitalized in stroke unit / ICU&#39;]

        # % stroke patients treated in a dedicated stroke unit / ICU    
        self.statsDf[&#39;% stroke patients treated in a dedicated stroke unit / ICU&#39;] = self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;]

        # % stroke patients treated in a dedicated stroke unit / ICU (2nd)
        self.statsDf[&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;] = self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;]

        # Create temporary dataframe to calculate final award 
        self.angels_awards_tmp = self.statsDf[[self.total_patient_column, &#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;, &#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;, &#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;, &#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;, &#39;% recanalization rate out of total ischemic incidence&#39;, &#39;% suspected stroke patients undergoing CT/MRI&#39;, &#39;% all stroke patients undergoing dysphagia screening&#39;, &#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;, &#39;% afib patients discharged (home) with anticoagulants&#39;, &#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;, &#39;# patients eligible thrombectomy&#39;, &#39;# patients eligible thrombolysis&#39;]]
        self.statsDf.fillna(0, inplace=True)

        self.angels_awards_tmp[&#39;Proposed Award&#39;] = self.angels_awards_tmp.apply(lambda x: self._get_final_award(x), axis=1)
        self.statsDf[&#39;Proposed Award&#39;] = self.angels_awards_tmp[&#39;Proposed Award&#39;] 

        self.statsDf.rename(columns={&#34;Protocol ID&#34;: &#34;Site ID&#34;}, inplace=True)

        self.sites = self._get_sites(self.statsDf)

    def _get_final_award(self, x):
        &#39;&#39;&#39; Get the final award. Based on values in the given columns calculate the proposed award for each row in the resulted statistics. 
        
        Args:
            x: the row from the dataframe (self.angels_awards_tmp)
        Returns:
            award: the proposed award (NONE, DIAMOND, PLATINUM, GOLD)
        &#39;&#39;&#39;
        # Check if site gets some award
        if x[self.total_patient_column] == False:
            award = &#34;NONE&#34;
        else:
            award = &#34;TRUE&#34;

        thrombolysis_pts = x[&#39;# patients eligible thrombolysis&#39;]
        
        thrombolysis_therapy_lt_60min = x[&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;]
        

        if award == &#34;TRUE&#34;:
            if thrombolysis_pts == 0:
                award = &#34;DIAMOND&#34;
            else:
                if (float(thrombolysis_therapy_lt_60min) &gt;= 50 and float(thrombolysis_therapy_lt_60min) &lt;= 74.99):
                    award = &#34;GOLD&#34;
                elif (float(thrombolysis_therapy_lt_60min) &gt;= 75):
                    award = &#34;DIAMOND&#34;
                else: 
                    award = &#34;NONE&#34;

        thrombolysis_therapy_lt_45min = x[&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;]

        if award != &#34;NONE&#34;:
            if thrombolysis_pts == 0:
                award = &#34;DIAMOND&#34;
            else:
                if (float(thrombolysis_therapy_lt_45min) &lt;= 49.99):
                    if (award != &#34;GOLD&#34; or award == &#34;DIAMOND&#34;):
                        award = &#34;PLATINUM&#34;
                elif (float(thrombolysis_therapy_lt_45min) &gt;= 50):
                    if (award != &#34;GOLD&#34;):
                        award = &#34;DIAMOND&#34;
                else:
                    award = &#34;NONE&#34;

        thrombectomy_pts = x[&#39;# patients eligible thrombectomy&#39;]
        if thrombectomy_pts != 0:
            thrombectomy_therapy_lt_90min = x[&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;]
            if award != &#34;NONE&#34;:
                if (float(thrombectomy_therapy_lt_90min) &gt;= 50 and float(thrombectomy_therapy_lt_90min) &lt;= 74.99):
                    if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                        award = &#34;GOLD&#34;
                elif (float(thrombectomy_therapy_lt_90min) &gt;= 75):
                    if (award == &#34;DIAMOND&#34;):
                        award = &#34;DIAMOND&#34;
                else: 
                    award = &#34;NONE&#34;

            thrombectomy_therapy_lt_60min = x[&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;]
            if award != &#34;NONE&#34;:
                if (float(thrombectomy_therapy_lt_60min) &lt;= 49.99):
                    if (award != &#34;GOLD&#34; or award == &#34;DIAMOND&#34;):
                        award = &#34;PLATINUM&#34;
                elif (float(thrombectomy_therapy_lt_60min) &gt;= 50):
                    if (award == &#34;DIAMOND&#34;):
                        award = &#34;DIAMOND&#34;
                else:
                    award = &#34;NONE&#34;

        recan_rate = x[&#39;% recanalization rate out of total ischemic incidence&#39;]
        if award != &#34;NONE&#34;:
            if (float(recan_rate) &gt;= 5 and float(recan_rate) &lt;= 14.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(recan_rate) &gt;= 15 and float(recan_rate) &lt;= 24.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(recan_rate) &gt;= 25):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        ct_mri = x[&#39;% suspected stroke patients undergoing CT/MRI&#39;]
        if award != &#34;NONE&#34;:
            if (float(ct_mri) &gt;= 80 and float(ct_mri) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(ct_mri) &gt;= 85 and float(ct_mri) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(ct_mri) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        dysphagia_screening = x[&#39;% all stroke patients undergoing dysphagia screening&#39;]
        if award != &#34;NONE&#34;:
            if (float(dysphagia_screening) &gt;= 80 and float(dysphagia_screening) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(dysphagia_screening) &gt;= 85 and float(dysphagia_screening) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(dysphagia_screening) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        discharged_with_antiplatelets_final = x[&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;]
        if award != &#34;NONE&#34;:
            if (float(discharged_with_antiplatelets_final) &gt;= 80 and float(discharged_with_antiplatelets_final) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(discharged_with_antiplatelets_final) &gt;= 85 and float(discharged_with_antiplatelets_final) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(discharged_with_antiplatelets_final) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        discharged_with_anticoagulants_final = x[&#39;% afib patients discharged (home) with anticoagulants&#39;]
        if award != &#34;NONE&#34;:
            if (float(discharged_with_anticoagulants_final) &gt;= 80 and float(discharged_with_anticoagulants_final) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(discharged_with_anticoagulants_final) &gt;= 85 and float(discharged_with_anticoagulants_final) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(discharged_with_anticoagulants_final) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        stroke_unit = x[&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;]
        if award != &#34;NONE&#34;:
            if (float(stroke_unit) &lt;= 0.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(stroke_unit) &gt;= 1):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        return award

    def _count_patients(self, dataframe):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            dataframe (dataframe): The dataframe with raw data. 

        Returns:
            dataframe (dataframe): The column with number of patients. 
        &#34;&#34;&#34;

        tmpDf = dataframe.groupby([&#39;Protocol ID&#39;]).size().reset_index(name=&#39;count_patients&#39;)
        factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
        factorDf.fillna(0, inplace=True)

        return factorDf[&#39;count_patients&#39;]

    def _get_values_only_columns(self, column_name, value, dataframe):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (string): The name of column for which we are want calculate number of patients. 
            dataframe (dataframe): The dataframe with raw data. 
            value (int): The integers value represents specific value from the dataframe[column_name]. 

        Returns:
            dataframe (dataframe): The column with number of patients. 
        &#34;&#34;&#34;

        tmpDf = dataframe[dataframe[column_name] == value].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
        factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
        factorDf.fillna(0, inplace=True)

        return factorDf[&#39;count&#39;]

    def _get_values_for_factors(self, column_name, value, new_column_name, df=None):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (str): The name of column for which we are want calculate number of patients. 
            value (int): The integers value represents specific value from the dataframe[column_name]. 
            new_column_name (str): The name of new column name. 

        Returns:
            dataframe (dataframe): The statsDf to which new created column was appended. 
        &#34;&#34;&#34;             
        if (self.tmp[column_name].dtype != np.number):
            value = str(value)
        else:
            value = value 

        tmpDf = self.tmp[self.tmp[column_name] == value].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
        factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
        factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
        factorDf.fillna(0, inplace=True)

        &#34;&#34;&#34;
        else:
            if (df[column_name].dtype != np.number):
                value = str(value)
            else:
                value = value 

            tmpDf = df[df[column_name] == value].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)
        &#34;&#34;&#34;
        return factorDf

    def _get_values_for_factors_more_values(self, column_name, value, new_column_name, df=None):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (str): The name of column for which we are want calculate number of patients. 
            value (list): The list of integers representing specific values from the dataframe[column_name]. 
            new_column_name (str): The name of new column name. 

        Returns:
            dataframe (dataframe): The statsDf to which new created column was appended. 
        &#34;&#34;&#34;
        if df is None:
            tmpDf = self.tmp[self.tmp[column_name].isin(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)
        else:
            tmpDf = df[df[column_name].isin(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)

        return factorDf

    def _get_values_for_factors_containing(self, column_name, value, new_column_name, df=None):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (str): The name of column for which we are want calculate number of patients. 
            value (str): The str of integers representing specific values from the dataframe[column_name]. 
            new_column_name (str): The name of new column name. 

        Returns:
            dataframe (dataframe): The statsDf to which new created column was appended. 
        &#34;&#34;&#34;
        if df is None:
            tmpDf = self.tmp[self.tmp[column_name].str.contains(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)
        else:
            tmpDf = df[df[column_name].str.contains(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)

        return factorDf

    def _get_ctmri_delta(self, hosp_time, ct_time):
        &#34;&#34;&#34; Calculate difference between two times. 

        Args:
            hospital_time: The time of hospitalization
            ct_time: The time when CT has been perfrmed. 
        Returns:
            The calculated difference in minutes.
        &#34;&#34;&#34;
        timeformat = &#39;%H:%M:%S&#39;

        #print(&#39;Hosp time: {0}/{1}, CT_TIME: {2}/{3}&#39;.format(hosp_time, type(hosp_time), ct_time, type(ct_time)))
        # print(ct_time, hosp_time)
        # Check if both time are not None if yes, return 0 else return tdelta
        if hosp_time is None or ct_time is None or pd.isnull(hosp_time) or pd.isnull(ct_time):
            tdeltaMin = 0
        elif hosp_time == 0 or ct_time == 0:
            tdeltaMin = 0
        else:
            if isinstance(ct_time, time) and isinstance(hosp_time, time):
                tdelta = datetime.combine(date.today(), ct_time) - datetime.combine(date.today(), hosp_time)
            elif isinstance(ct_time, time):
                tdelta = datetime.combine(date.today(), ct_time) - datetime.strptime(hosp_time, timeformat)
            elif isinstance(hosp_time, time):
                tdelta = datetime.strptime(ct_time, timeformat) - datetime.strptime(hosp_time, timeformat)
            else:
                tdelta = datetime.strptime(ct_time, timeformat) - datetime.strptime(hosp_time, timeformat)      
            tdeltaMin = tdelta.total_seconds()/60.0

        if tdeltaMin &gt; 60:
            res = 2
        elif tdeltaMin &lt;= 60 and tdeltaMin &gt; 0:
            res = 1
        else:
            res = -2
        return res

    
    def _return_dataset(self):
        &#34;&#34;&#34;Return the raw dataframe.&#34;&#34;&#34;

        return self.df

    def _return_stats(self):
        &#34;&#34;&#34;Return the dataframe with calculated statistics.&#34;&#34;&#34;

        return self.statsDf

    def _get_sites(self, df):
        &#34;&#34;&#34;Return list of sites in the dataframes.&#34;&#34;&#34;

        site_ids = df[&#39;Site ID&#39;].tolist()
        siteSet = set(site_ids)
        siteList = list(siteSet)
        return siteList

    def _return_sites(self):

        return self.sites









        



        </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="resqdb.Calculation.ComputeStats"><code class="flex name class">
<span>class <span class="ident">ComputeStats</span></span>
<span>(</span><span>df, country=False, country_code='', comparison=False, patient_limit=0)</span>
</code></dt>
<dd>
<section class="desc"><p>This module compute statistics from the raw data. </p>
<p>Keyword arguments:
df &ndash; the raw dataframe
country &ndash; True if country should be included as site into results (default False)
country_code &ndash; the country code of country if data were filtered (default "")
comparison &ndash; True if we are compare the data (e.g. countries between each other)</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class ComputeStats:

    &#34;&#34;&#34;
    This module compute statistics from the raw data. 
    
    Keyword arguments:
    df -- the raw dataframe
    country -- True if country should be included as site into results (default False)
    country_code -- the country code of country if data were filtered (default &#34;&#34;)
    comparison -- True if we are compare the data (e.g. countries between each other)
    &#34;&#34;&#34;

    def __init__(self, df, country = False, country_code = &#34;&#34;, comparison=False, patient_limit=0):

        self.df = df.copy()
        self.df.fillna(0, inplace=True)
        self.patient_limit = patient_limit

        # Get short Protocol IDs - it means RESQ-v - PL_001 will be PL_001
        def get_country_name(value):
            if value == &#34;UZB&#34;:
                value = &#39;UZ&#39;
            country_name = pytz.country_names[value]
            return country_name

        if comparison == False:
            self.df[&#39;Protocol ID&#39;] = self.df.apply(lambda row: row[&#39;Protocol ID&#39;].split()[2] if (len(row[&#39;Protocol ID&#39;].split()) == 3) else row[&#39;Protocol ID&#39;].split()[0], axis=1)
            # uncomment if you want stats between countries and set comparison == True
            #self.df[&#39;Protocol ID&#39;] = self.df.apply(lambda x: x[&#39;Protocol ID&#39;].split(&#34;_&#34;)[0], axis=1)
        #print(set(list(self.df[&#39;Protocol ID&#39;])))

        # If you want to compare, instead of Site Names will be Country names. 
        if comparison:
            if self.df[&#39;Protocol ID&#39;].dtype == np.object:
                self.df[&#39;Site Name&#39;] = self.df.apply(lambda x: get_country_name(x[&#39;Protocol ID&#39;]) if get_country_name(x[&#39;Protocol ID&#39;]) != &#34;&#34; else x[&#39;Protocol ID&#39;], axis=1)
        
        
        if (country):
            country = self.df.copy()
            self.country_name = pytz.country_names[country_code]
            country[&#39;Protocol ID&#39;] = self.country_name
            country[&#39;Site Name&#39;] = self.country_name
            self.df = pd.concat([self.df, country])
        else:
            self.country_name = &#34;&#34;
        
        # Get Protocol IDs and Total Patients 
        self.statsDf = self.df.groupby([&#39;Protocol ID&#39;, &#39;Site Name&#39;]).size().reset_index(name=&#34;Total Patients&#34;)
        #self.statsDf[&#39;Site Name&#39;] = 

        self.statsDf = self.statsDf[[&#39;Protocol ID&#39;, &#39;Site Name&#39;, &#39;Total Patients&#39;]]

        # Median age
        self.statsDf[&#39;Median patient age&#39;] = self.df.groupby([&#39;Protocol ID&#39;]).AGE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median patient age&#39;})[&#39;Median patient age&#39;].tolist()

        # get patietns with ischemic stroke (ISch) (1)
        isch = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1])]
        self.statsDf[&#39;isch_patients&#39;] = self._count_patients(dataframe=isch)

        # get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 2, 3, 5)
        is_ich_tia_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 2, 3, 5])]
        self.statsDf[&#39;is_ich_tia_cvt_patients&#39;] = self._count_patients(dataframe=is_ich_tia_cvt)

        # get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), or cerebral venous thrombosis (CVT) (1, 2, 5)
        is_ich_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 2, 5])]
        self.statsDf[&#39;is_ich_cvt_patients&#39;] = self._count_patients(dataframe=is_ich_cvt)
        # Get dataframe with patients who had ischemic stroke (IS) or intracerebral hemorrhage (ICH)
        is_ich = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1,2])]
        self.statsDf[&#39;is_ich_patients&#39;] = self._count_patients(dataframe=is_ich)
        # get patietns with ischemic stroke (IS) and transient ischemic attack (TIA) (1, 3)
        is_tia = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 3])]
        self.statsDf[&#39;is_tia_patients&#39;] = self._count_patients(dataframe=is_tia)

        # get patietns with ischemic stroke (IS), intracerebral hemorrhage (ICH), subarrachnoid hemorrhage (SAH) or cerebral venous thrombosis (CVT) (1, 2, 4, 5)
        is_ich_sah_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 2, 4, 5])]
        self.statsDf[&#39;is_ich_sah_cvt_patients&#39;] = self._count_patients(dataframe=is_ich_sah_cvt)

        # get patietns with ischemic stroke (IS), transient ischemic attack (TIA) or cerebral venous thrombosis (CVT) (1, 3, 5)
        is_tia_cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([1, 3, 5])]
        self.statsDf[&#39;is_tia_cvt_patients&#39;] = self._count_patients(dataframe=is_tia_cvt)

        # get patients with cerebral venous thrombosis (CVT) (5)
        cvt = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([5])]
        self.statsDf[&#39;cvt_patients&#39;] = self._count_patients(dataframe=cvt)

        # get patietns with intracerebral hemorrhage (ICH) and subarrachnoid hemorrhage (SAH) (2, 4)
        ich_sah = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([2, 4])]
        self.statsDf[&#39;ich_sah_patients&#39;] = self._count_patients(dataframe=ich_sah)
        
        # get patietns with intracerebral hemorrhage (ICH) (2)
        ich = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([2])]
        self.statsDf[&#39;ich_patients&#39;] = self._count_patients(dataframe=ich)

        # get patietns with subarrachnoid hemorrhage (SAH) (4)
        sah = self.df[self.df[&#39;STROKE_TYPE&#39;].isin([4])]
        self.statsDf[&#39;sah_patients&#39;] = self._count_patients(dataframe=sah)

        # create subset with no referrals (RECANALIZATION_PROCEDURE != [5,6]) AND (HEMICRANIECTOMY != 3)
        discharge_subset = self.df[~self.df[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6]) &amp; ~self.df[&#39;HEMICRANIECTOMY&#39;].isin([3])]
        self.statsDf[&#39;discharge_subset_patients&#39;] = self._count_patients(dataframe=discharge_subset)

        # Create discharge subset alive
        discharge_subset_alive = self.df[~self.df[&#39;DISCHARGE_DESTINATION&#39;].isin([5])]
        self.statsDf[&#39;discharge_subset_alive_patients&#39;] = self._count_patients(dataframe=discharge_subset_alive)


        ##########
        # GENDER #
        ##########
        # Get gender calculation in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;GENDER&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get female patients 
        self.statsDf = self._get_values_for_factors(column_name=&#34;GENDER&#34;, value=2, new_column_name=&#39;# patients female&#39;)

        # Get only female patients in % out of total patients. 
        self.statsDf[&#39;% patients female&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients female&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get male patients 
        self.statsDf = self._get_values_for_factors(column_name=&#34;GENDER&#34;, value=1, new_column_name=&#39;# patients male&#39;)

        # Get % of male patients
        self.statsDf[&#39;% patients male&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients male&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% patients female&#39;] + self.statsDf[&#39;% patients male&#39;] 
        #self.statsDf[&#39;% patients female&#39;] = self.statsDf.apply(lambda x: x[&#39;% patients female&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% patients female&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)


        ######################
        # STROKE IN HOSPITAL #
        ######################
        # Get hospital stoke in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;HOSPITAL_STROKE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients having stroke in the hospital - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITAL_STROKE&#34;, value=1, new_column_name=&#39;# patients having stroke in the hospital - Yes&#39;)

        # Get % patients having stroke in the hospital - Yes
        self.statsDf[&#39;% patients having stroke in the hospital - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients having stroke in the hospital - Yes&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients having stroke in the hospital - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITAL_STROKE&#34;, value=2, new_column_name=&#39;# patients having stroke in the hospital - No&#39;)

        # Get % patients having stroke in the hospital - Yes
        self.statsDf[&#39;% patients having stroke in the hospital - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients having stroke in the hospital - No&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        ####################
        # RECURRENT STROKE #
        ####################
        # Get recurrent stoke in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;RECURRENT_STROKE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECURRENT_STROKE&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get patients having recurrent stroke - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECURRENT_STROKE&#34;, value=1, new_column_name=&#39;# recurrent stroke - Yes&#39;)

        # Get % patients having recurrent stroke - Yes
        self.statsDf[&#39;% recurrent stroke - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recurrent stroke - Yes&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get ppatients having recurrent stroke - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECURRENT_STROKE&#34;, value=2, new_column_name=&#39;# recurrent stroke - No&#39;)

        # Get % patients having recurrent stroke - No
        self.statsDf[&#39;% recurrent stroke - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recurrent stroke - No&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ###################
        # DEPARTMENT TYPE #
        ###################
        # Get department type in one dataframe
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;DEPARTMENT_TYPE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get patients in neurology
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=1, new_column_name=&#39;# department type - neurology&#39;)

        # Get % patients in neurology
        self.statsDf[&#39;% department type - neurology&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - neurology&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in neurosurgery
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=2, new_column_name=&#39;# department type - neurosurgery&#39;)

        # Get % patients in neurosurgery
        self.statsDf[&#39;% department type - neurosurgery&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - neurosurgery&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in anesthesiology/resuscitation/critical care
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=3, new_column_name=&#39;# department type - anesthesiology/resuscitation/critical care&#39;)

        # Get % patients in anesthesiology/resuscitation/critical care
        self.statsDf[&#39;% department type - anesthesiology/resuscitation/critical care&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - anesthesiology/resuscitation/critical care&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in internal medicine
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=4, new_column_name=&#39;# department type - internal medicine&#39;)

        # Get % patients in internal medicine
        self.statsDf[&#39;% department type - internal medicine&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - internal medicine&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in geriatrics
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=5, new_column_name=&#39;# department type - geriatrics&#39;)

        # Get % patients in geriatrics
        self.statsDf[&#39;% department type - geriatrics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - geriatrics&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients in Other
        self.statsDf = self._get_values_for_factors(column_name=&#34;DEPARTMENT_TYPE&#34;, value=6, new_column_name=&#39;# department type - Other&#39;)

        # Get % patients in Other
        self.statsDf[&#39;% department type - Other&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department type - Other&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ###################
        # HOSPITALIZED IN #
        ###################
        # Get hospitalized in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;HOSPITALIZED_IN&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients hospitalized in stroke unit / ICU
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITALIZED_IN&#34;, value=1, new_column_name=&#39;# patients hospitalized in stroke unit / ICU&#39;)

        # Get % patients hospitalized in stroke unit / ICU
        self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients hospitalized in stroke unit / ICU&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)


        # Get patients hospitalized in monitored bed with telemetry
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITALIZED_IN&#34;, value=2, new_column_name=&#39;# patients hospitalized in monitored bed with telemetry&#39;)

        # Get % patients hospitalized in monitored bed with telemetry
        self.statsDf[&#39;% patients hospitalized in monitored bed with telemetry&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients hospitalized in monitored bed with telemetry&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients hospitalized in standard bed
        self.statsDf = self._get_values_for_factors(column_name=&#34;HOSPITALIZED_IN&#34;, value=3, new_column_name=&#39;# patients hospitalized in standard bed&#39;)

        # Get % patients hospitalized in standard bed
        self.statsDf[&#39;% patients hospitalized in standard bed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients hospitalized in standard bed&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Check if sum of % is &gt; 100 (100.01)
        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] + self.statsDf[&#39;% patients hospitalized in monitored bed with telemetry&#39;] + self.statsDf[&#39;% patients hospitalized in standard bed&#39;]
        #self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;] = self.statsDf.apply(lambda x: x[&#39;% patients hospitalized in stroke unit / ICU&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% patients hospitalized in stroke unit / ICU&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)


        ###############################
        # ASSESSED FOR REHABILITATION #
        ###############################
        # Get assessed for rehabilitation in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;ASSESSED_FOR_REHAB&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients assessed for rehabilitation - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;ASSESSED_FOR_REHAB&#34;, value=3, new_column_name=&#39;# patients assessed for rehabilitation - Not known&#39;)

        # Get % patients assessed for rehabilitation - Not known
        self.statsDf[&#39;% patients assessed for rehabilitation - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients assessed for rehabilitation - Not known&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients assessed for rehabilitation - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;ASSESSED_FOR_REHAB&#34;, value=1, new_column_name=&#39;# patients assessed for rehabilitation - Yes&#39;)

        # Get % patients assessed for rehabilitation - Yes
        self.statsDf[&#39;% patients assessed for rehabilitation - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients assessed for rehabilitation - Yes&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;]) &gt; 0 else 0, axis=1)

        # Get patients assessed for rehabilitation - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;ASSESSED_FOR_REHAB&#34;, value=2, new_column_name=&#39;# patients assessed for rehabilitation - No&#39;)

        # Get % patients assessed for rehabilitation - No
        self.statsDf[&#39;% patients assessed for rehabilitation - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients assessed for rehabilitation - No&#39;]/(x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;])) * 100), 2) if (x[&#39;Total Patients&#39;] - x[&#39;# patients assessed for rehabilitation - Not known&#39;]) &gt; 0 else 0, axis=1)

        ###############
        # STROKE TYPE #
        ###############
        # Get stroke type in one table 
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;STROKE_TYPE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get stroke type - ischemic stroke
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=1, new_column_name=&#39;# stroke type - ischemic stroke&#39;)

        # Get % stroke type - ischemic stroke
        self.statsDf[&#39;% stroke type - ischemic stroke&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - ischemic stroke&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - intracerebral hemorrhage
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=2, new_column_name=&#39;# stroke type - intracerebral hemorrhage&#39;)

        # Get % stroke type - intracerebral hemorrhage
        self.statsDf[&#39;% stroke type - intracerebral hemorrhage&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - intracerebral hemorrhage&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - transient ischemic attack
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=3, new_column_name=&#39;# stroke type - transient ischemic attack&#39;)

        # Get % stroke type - transient ischemic attack
        self.statsDf[&#39;% stroke type - transient ischemic attack&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - transient ischemic attack&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - subarrachnoid hemorrhage
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=4, new_column_name=&#39;# stroke type - subarrachnoid hemorrhage&#39;)

        # Get % stroke type - subarrachnoid hemorrhage
        self.statsDf[&#39;% stroke type - subarrachnoid hemorrhage&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - subarrachnoid hemorrhage&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - cerebral venous thrombosis
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=5, new_column_name=&#39;# stroke type - cerebral venous thrombosis&#39;)

        # Get % stroke type - cerebral venous thrombosis
        self.statsDf[&#39;% stroke type - cerebral venous thrombosis&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - cerebral venous thrombosis&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        # Get stroke type - undetermined stroke
        self.statsDf = self._get_values_for_factors(column_name=&#34;STROKE_TYPE&#34;, value=6, new_column_name=&#39;# stroke type - undetermined stroke&#39;)

        # Get % stroke type - undetermined stroke
        self.statsDf[&#39;% stroke type - undetermined stroke&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# stroke type - undetermined stroke&#39;]/x[&#39;Total Patients&#39;]) * 100), 2) if x[&#39;Total Patients&#39;] &gt; 0 else 0, axis=1)

        #######################
        # CONSCIOUSNESS LEVEL #
        #######################
        # Get consciousness level in one table 
        self.tmp = is_ich_sah_cvt.groupby([&#39;Protocol ID&#39;, &#39;CONSCIOUSNESS_LEVEL&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get level of consciousness - not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=5, new_column_name=&#39;# level of consciousness - not known&#39;)

        # Get % level of consciousness - not known
        self.statsDf[&#39;% level of consciousness - not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - not known&#39;]/x[&#39;is_ich_sah_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_sah_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get level of consciousness - alert
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=1, new_column_name=&#39;# level of consciousness - alert&#39;)

        # Get % level of consciousness - alert
        self.statsDf[&#39;% level of consciousness - alert&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - alert&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        # Get level of consciousness - drowsy
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=2, new_column_name=&#39;# level of consciousness - drowsy&#39;)

        # Get % level of consciousness - drowsy
        self.statsDf[&#39;% level of consciousness - drowsy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - drowsy&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        # Get level of consciousness - comatose
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=3, new_column_name=&#39;# level of consciousness - comatose&#39;)

        # Get % level of consciousness - comatose
        self.statsDf[&#39;% level of consciousness - comatose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - comatose&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        # Get level of consciousness - GCS
        self.statsDf = self._get_values_for_factors(column_name=&#34;CONSCIOUSNESS_LEVEL&#34;, value=4, new_column_name=&#39;# level of consciousness - GCS&#39;)

        # Get % level of consciousness - GCS
        self.statsDf[&#39;% level of consciousness - GCS&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# level of consciousness - GCS&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        #######
        # GCS #
        #######
        # GCS subset
        gcs = is_ich_sah_cvt[is_ich_sah_cvt[&#39;CONSCIOUSNESS_LEVEL&#39;].isin([4])].copy()

        # Get GCS patients
        self.statsDf[&#39;gcs_patients&#39;] = self._count_patients(dataframe=gcs)

        # Get GCS in one table 
        self.tmp = gcs.groupby([&#39;Protocol ID&#39;, &#39;GCS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get GCS - 15-13
        self.statsDf = self._get_values_for_factors(column_name=&#34;GCS&#34;, value=1, new_column_name=&#39;# GCS - 15-13&#39;)

        # Get % GCS - 15-13
        self.statsDf[&#39;% GCS - 15-13&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# GCS - 15-13&#39;]/x[&#39;gcs_patients&#39;]) * 100), 2) if x[&#39;gcs_patients&#39;] &gt; 0 else 0, axis=1)

        # Get GCS - 12-8
        self.statsDf = self._get_values_for_factors(column_name=&#34;GCS&#34;, value=2, new_column_name=&#39;# GCS - 12-8&#39;)

        # Get % GCS - 12-8
        self.statsDf[&#39;% GCS - 12-8&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# GCS - 12-8&#39;]/x[&#39;gcs_patients&#39;]) * 100), 2) if x[&#39;gcs_patients&#39;] &gt; 0 else 0, axis=1)
        
        # Get GCS - &lt;8
        self.statsDf = self._get_values_for_factors(column_name=&#34;GCS&#34;, value=3, new_column_name=&#39;# GCS - &lt;8&#39;)

        # Get % GCS - &lt;8
        self.statsDf[&#39;% GCS - &lt;8&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# GCS - &lt;8&#39;]/x[&#39;gcs_patients&#39;]) * 100), 2) if x[&#39;gcs_patients&#39;] &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;gcs_patients&#39;], inplace=True, axis=1)

        # GCS is mapped to the consciousness level. GCS 15-13 is mapped to alert
        self.statsDf[&#39;alert_all&#39;] = self.statsDf[&#39;# level of consciousness - alert&#39;] + self.statsDf[&#39;# GCS - 15-13&#39;]

        self.statsDf[&#39;alert_all_perc&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;alert_all&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)
        #  12-8 to drowsy 
        self.statsDf[&#39;drowsy_all&#39;] = self.statsDf[&#39;# level of consciousness - drowsy&#39;] + self.statsDf[&#39;# GCS - 12-8&#39;]

        self.statsDf[&#39;drowsy_all_perc&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;drowsy_all&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)
        # &lt;8 to comatose. 
        self.statsDf[&#39;comatose_all&#39;] = self.statsDf[&#39;# level of consciousness - comatose&#39;] + self.statsDf[&#39;# GCS - &lt;8&#39;]

        self.statsDf[&#39;comatose_all_perc&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;comatose_all&#39;]/(x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;])) * 100), 2) if (x[&#39;is_ich_sah_cvt_patients&#39;] - x[&#39;# level of consciousness - not known&#39;]) &gt; 0 else 0, axis=1)

        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;alert_all_perc&#39;] + self.statsDf[&#39;drowsy_all_perc&#39;] + self.statsDf[&#39;comatose_all_perc&#39;]
        #self.statsDf[&#39;alert_all_perc&#39;] = self.statsDf.apply(lambda x: x[&#39;alert_all_perc&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;alert_all_perc&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)

        #########
        # NIHSS #
        #########
        if country_code == &#39;CZ&#39;:
            # Get NIHSS patients
            # Get nihss in one table 
            self.tmp = is_ich.groupby([&#39;Protocol ID&#39;, &#39;NIHSS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get Not performed 
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=1, new_column_name=&#39;# NIHSS - Not performed&#39;)

            # Get % Not performed   
            self.statsDf[&#39;% NIHSS - Not performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not performed&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Prformed  
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=2, new_column_name=&#39;# NIHSS - Performed&#39;)

            # Get % Performed   
            self.statsDf[&#39;% NIHSS - Performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Performed&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Not known 
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=3, new_column_name=&#39;# NIHSS - Not known&#39;)

            # Get % Not known   
            self.statsDf[&#39;% NIHSS - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not known&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get NIHSS performed subset
            nihss = is_ich[is_ich[&#39;NIHSS&#39;].isin([2])]

            # Get Median of NIHSS score
            tmpDf = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})
            #self.statsDf[&#39;NIHSS median score&#39;] = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})[&#39;NIHSS median score&#39;].tolist()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;, left_on=&#39;Protocol ID&#39;, right_on=&#39;Protocol ID&#39;)
            factorDf.fillna(0, inplace=True)
            self.statsDf[&#39;NIHSS median score&#39;] = factorDf[&#39;NIHSS median score&#39;]
        else:
            # Get NIHSS patients
            # Get nihss in one table 
            self.tmp = is_ich_cvt.groupby([&#39;Protocol ID&#39;, &#39;NIHSS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get Not performed 
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=1, new_column_name=&#39;# NIHSS - Not performed&#39;)

            # Get % Not performed       
            self.statsDf[&#39;% NIHSS - Not performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not performed&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Prformed      
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=2, new_column_name=&#39;# NIHSS - Performed&#39;)

            # Get % Performed   
            self.statsDf[&#39;% NIHSS - Performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Performed&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get Not known     
            self.statsDf = self._get_values_for_factors(column_name=&#34;NIHSS&#34;, value=3, new_column_name=&#39;# NIHSS - Not known&#39;)

            # Get % Not known   
            self.statsDf[&#39;% NIHSS - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# NIHSS - Not known&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get NIHSS performed subset
            nihss = is_ich_cvt[is_ich_cvt[&#39;NIHSS&#39;].isin([2])]

            # Get Median of NIHSS score
            tmpDf = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})
            #self.statsDf[&#39;NIHSS median score&#39;] = nihss.groupby([&#39;Protocol ID&#39;]).NIHSS_SCORE.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;NIHSS median score&#39;})[&#39;NIHSS median score&#39;].tolist()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;, left_on=&#39;Protocol ID&#39;, right_on=&#39;Protocol ID&#39;)
            factorDf.fillna(0, inplace=True)
            self.statsDf[&#39;NIHSS median score&#39;] = factorDf[&#39;NIHSS median score&#39;]

        ##########
        # CT/MRI #
        ##########
        # Get CT/MRI in one table
        self.tmp = is_ich_tia_cvt.groupby([&#39;Protocol ID&#39;, &#39;CT_MRI&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients CT/MRI not performed
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_MRI&#34;, value=1, new_column_name=&#39;# CT/MRI - Not performed&#39;)

        # Get % CT/MRI Not performed    
        self.statsDf[&#39;% CT/MRI - Not performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Not performed&#39;]/x[&#39;is_ich_tia_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_tia_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients CT/MRI performed
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_MRI&#34;, value=2, new_column_name=&#39;# CT/MRI - performed&#39;)

        # Get % CT/MRI performed        
        self.statsDf[&#39;% CT/MRI - performed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - performed&#39;]/x[&#39;is_ich_tia_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_tia_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients CT/MRI not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_MRI&#34;, value=3, new_column_name=&#39;# CT/MRI - Not known&#39;)

        # Get % CT/MRI not known        
        self.statsDf[&#39;% CT/MRI - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Not known&#39;]/x[&#39;is_ich_tia_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_tia_cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get CT/MRI performed subset
        ct_mri = is_ich_tia_cvt[is_ich_tia_cvt[&#39;CT_MRI&#39;].isin([2])]

        # Get CT/MRI time in one table
        ct_mri[&#39;CT_TIME&#39;] = pd.to_numeric(ct_mri[&#39;CT_TIME&#39;])
        self.tmp = ct_mri.groupby([&#39;Protocol ID&#39;, &#39;CT_TIME&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        #print(self.tmp)

        # Get patients CT/MRI within first hour after admission

        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_TIME&#34;, value=1, new_column_name=&#39;# CT/MRI - Performed within 1 hour after admission&#39;)

        # Get % CT/MRI within first hour after admission        
        self.statsDf[&#39;% CT/MRI - Performed within 1 hour after admission&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Performed within 1 hour after admission&#39;]/x[&#39;# CT/MRI - performed&#39;]) * 100), 2) if x[&#39;# CT/MRI - performed&#39;] &gt; 0 else 0, axis=1)

        # Get patients CT/MRI within first hour after admission
        self.statsDf = self._get_values_for_factors(column_name=&#34;CT_TIME&#34;, value=2, new_column_name=&#39;# CT/MRI - Performed later than 1 hour after admission&#39;)

        # Get % CT/MRI within first hour after admission        
        self.statsDf[&#39;% CT/MRI - Performed later than 1 hour after admission&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# CT/MRI - Performed later than 1 hour after admission&#39;]/x[&#39;# CT/MRI - performed&#39;]) * 100), 2) if x[&#39;# CT/MRI - performed&#39;] &gt; 0 else 0, axis=1)

        ####################
        # VASCULAR IMAGING #
        ####################
        
        self.tmp = ich_sah.groupby([&#39;Protocol ID&#39;, &#39;CTA_MRA_DSA&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        
        # Get patients with vascular imaging - CTA
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;1&#39;, &#39;1,2&#39;, &#39;1,3&#39;}, new_column_name=&#39;# vascular imaging - CTA&#39;)

        # Get % patients with vascular imaging - CTA
        self.statsDf[&#39;% vascular imaging - CTA&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - CTA&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - MRA
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;2&#39;, &#39;1,2&#39;, &#39;2,3&#39;}, new_column_name=&#39;# vascular imaging - MRA&#39;)

        # Get % patients with vascular imaging - MRA
        self.statsDf[&#39;% vascular imaging - MRA&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - MRA&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - DSA
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;3&#39;, &#39;1,3&#39;, &#39;2,3&#39;}, new_column_name=&#39;# vascular imaging - DSA&#39;)

        # Get % patients with vascular imaging - DSA
        self.statsDf[&#39;% vascular imaging - DSA&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - DSA&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - None
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;4&#39;}, new_column_name=&#39;# vascular imaging - None&#39;)

        # Get % patients with vascular imaging - None   
        self.statsDf[&#39;% vascular imaging - None&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - None&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients with vascular imaging - two modalities
        self.statsDf = self._get_values_for_factors_more_values(column_name=&#34;CTA_MRA_DSA&#34;, value={&#39;1,2&#39;, &#39;1,3&#39;, &#39;2,3&#39;}, new_column_name=&#39;# vascular imaging - two modalities&#39;)

        # Get % patients with vascular imaging - two modalities
        self.statsDf[&#39;% vascular imaging - two modalities&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# vascular imaging - two modalities&#39;]/x[&#39;ich_sah_patients&#39;]) * 100), 2) if x[&#39;ich_sah_patients&#39;] &gt; 0 else 0, axis=1)

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% vascular imaging - CTA&#39;, &#39;% vascular imaging - MRA&#39;, &#39;% vascular imaging - DSA&#39;, &#39;% vascular imaging - None&#39;]].copy()

        norm_tmp.loc[:,&#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;vascular_imaging_cta_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - CTA&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vascular_imaging_mra_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - MRA&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vascular_imaging_dsa_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - DSA&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vascular_imaging_none_norm&#39;] = ((norm_tmp[&#39;% vascular imaging - None&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)
        
        ##############
        # VENTILATOR #
        ##############
        if country_code == &#39;CZ&#39;:
            self.tmp = is_ich.groupby([&#39;Protocol ID&#39;, &#39;VENTILATOR&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients from old version
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=-999, new_column_name=&#39;tmp&#39;)

            # Get patients put on ventilator - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=3, new_column_name=&#39;# patients put on ventilator - Not known&#39;)

            # Get % patients put on ventilator - Not known  
            self.statsDf[&#39;% patients put on ventilator - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Not known&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=1, new_column_name=&#39;# patients put on ventilator - Yes&#39;)

            # Get % patients put on ventilator - Yes    
            self.statsDf[&#39;% patients put on ventilator - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Yes&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=2, new_column_name=&#39;# patients put on ventilator - No&#39;)

            # Get % patients put on ventilator - No 
            self.statsDf[&#39;% patients put on ventilator - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - No&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Drop tmp column 
            self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)
        else:
            self.tmp = is_ich_cvt.groupby([&#39;Protocol ID&#39;, &#39;VENTILATOR&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients from old version
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=-999, new_column_name=&#39;tmp&#39;)

            # Get patients put on ventilator - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=3, new_column_name=&#39;# patients put on ventilator - Not known&#39;)

            # Get % patients put on ventilator - Not known      
            self.statsDf[&#39;% patients put on ventilator - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Not known&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=1, new_column_name=&#39;# patients put on ventilator - Yes&#39;)

            # Get % patients put on ventilator - Yes    
            self.statsDf[&#39;% patients put on ventilator - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - Yes&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients put on ventilator - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;VENTILATOR&#34;, value=2, new_column_name=&#39;# patients put on ventilator - No&#39;)

            # Get % patients put on ventilator - No     
            self.statsDf[&#39;% patients put on ventilator - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients put on ventilator - No&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;tmp&#39;] - x[&#39;# patients put on ventilator - Not known&#39;]) &gt; 0 else 0, axis=1)

            # Drop tmp column 
            self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        #############################
        # RECANALIZATION PROCEDURES #
        #############################
        self.tmp = isch.groupby([&#39;Protocol ID&#39;, &#39;RECANALIZATION_PROCEDURES&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients recanalization procedures - Not done
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=1, new_column_name=&#39;# recanalization procedures - Not done&#39;)

        # Get % patients recanalization procedures - Not done
        self.statsDf[&#39;% recanalization procedures - Not done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Not done&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - IV tPa
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=2, new_column_name=&#39;# recanalization procedures - IV tPa&#39;)

        # Get % patients recanalization procedures - IV tPa
        self.statsDf[&#39;% recanalization procedures - IV tPa&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - IV tPa&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - IV tPa + endovascular treatment
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=3, new_column_name=&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;)

        # Get % patients recanalization procedures - IV tPa + endovascular treatment
        self.statsDf[&#39;% recanalization procedures - IV tPa + endovascular treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Endovascular treatment alone
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=4, new_column_name=&#39;# recanalization procedures - Endovascular treatment alone&#39;)

        # Get % patients recanalization procedures - Endovascular treatment alone
        self.statsDf[&#39;% recanalization procedures - Endovascular treatment alone&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - IV tPa + referred to another centre for endovascular treatment
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=5, new_column_name=&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;)

        # Get % patients recanalization procedures - IV tPa + referred to another centre for endovascular treatment
        self.statsDf[&#39;% recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Referred to another centre for endovascular treatment
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=6, new_column_name=&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;)

        # Get % patients recanalization procedures - Referred to another centre for endovascular treatment
        self.statsDf[&#39;% recanalization procedures - Referred to another centre for endovascular treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=7, new_column_name=&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;)

        # Get % patients recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre
        self.statsDf[&#39;% recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=8, new_column_name=&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;)

        # Get % patients recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre
        self.statsDf[&#39;% recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;RECANALIZATION_PROCEDURES&#34;, value=9, new_column_name=&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;)

        # Get % patients recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre
        self.statsDf[&#39;% recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        if country_code == &#39;CZ&#39;:
            # Get patients recanalized
            #self.statsDf[&#39;# patients recanalized&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] +  x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]  + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)
            self.statsDf[&#39;# patients recanalized&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] +  x[&#39;# recanalization procedures - Endovascular treatment alone&#39;], axis=1)

            # Get % patients recanalized
            #self.statsDf[&#39;% patients recanalized&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients recanalized&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]) &gt; 0 else 0, axis=1)
            self.statsDf[&#39;% patients recanalized&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients recanalized&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]) &gt; 0 else 0, axis=1)
        else:
            # Get patients recanalized
            self.statsDf[&#39;# patients recanalized&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] +  x[&#39;# recanalization procedures - Endovascular treatment alone&#39;], axis=1)

            # Get % patients recanalized
            self.statsDf[&#39;% patients recanalized&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients recanalized&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] - x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] - x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;]) &gt; 0 else 0, axis=1)

        
        ##############
        # MEDIAN DTN #
        ##############
        def _median_confidence_interval(data, confidence=0.95):

            a = np.array(data)
            w = a + 1

            # create custom discrete random variable from data set
            rv = st.rv_discrete(values=(data, w/w.sum()))

            return rv.median(), rv.interval(confidence)
            
        def _mean_confidence_interval(data, confidence=0.95):

            n = len(data)
            m = mean(data)
            std_err = sem(data)
            h = std_err * t.ppf((1 + confidence) / 2, n - 1)
            return m, m-h, m+h


        # Get patients receiving IV tpa
        self.statsDf.loc[:, &#39;# IV tPa&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;], axis=1)

        # Get patients receiving IV tpa %
        self.statsDf[&#39;% IV tPa&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# IV tPa&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get only patients recanalized
        recanalization_procedure_iv_tpa = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([2, 3, 5])].copy()

        # Replace NA values by 0
        recanalization_procedure_iv_tpa.fillna(0, inplace=True)
        recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] = recanalization_procedure_iv_tpa[&#39;IVT_ONLY_NEEDLE_TIME&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_ONLY_NEEDLE_TIME_MIN&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_NEEDLE_TIME&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_NEEDLE_TIME_MIN&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_REFER_NEEDLE_TIME&#39;] + recanalization_procedure_iv_tpa[&#39;IVT_TBY_REFER_NEEDLE_TIME_MIN&#39;]
        #print(recanalization_procedure_iv_tpa[&#39;IVTPA&#39;].tolist())

        &#34;&#34;&#34;
        sites_ids = recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;].tolist()
        sites_ids = set(sites_ids)
        interval_vals = {}              
        for idx, val in enumerate(sites_ids): 
            meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
            medianv, interval_median = _median_confidence_interval(recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
            interval_vals[str(idx)] = [val, &#34;({0:.2f},{1:.2f})&#34;.format(lbound, ubound), &#34;{0}&#34;.format(interval_median)]

            #interval_vals.append(&#34;{0}: ({1}-{2})&#34;.format(i, lowb, upb))
        #print(interval_vals)
        interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTN (Mean)&#39;, &#39;Confidence interval DTN (Median)&#39;])
        &#34;&#34;&#34;
        tmp = recanalization_procedure_iv_tpa.groupby([&#39;Protocol ID&#39;]).IVTPA.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median DTN (minutes)&#39;}).reset_index()
        #print(tmp)
        self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
        self.statsDf.fillna(0, inplace=True)

        #self.statsDf = self.statsDf.merge(interval_vals_df, how=&#39;outer&#39;)
        
        ##############
        # MEDIAN DTG #
        ##############
        if country_code == &#39;CZ&#39;:
            # Get patients receiving TBY
            #self.statsDf.loc[:, &#39;# TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)
            self.statsDf.loc[:, &#39;# TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;], axis=1)


            # Get patients receiving TBY %
            self.statsDf[&#39;% TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# TBY&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

            
            # Get only patients recanalized TBY
            #recanalization_procedure_tby_dtg = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3, 6, 7, 8])].copy()
            recanalization_procedure_tby_dtg = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3])].copy()
            recanalization_procedure_tby_dtg.fillna(0, inplace=True)

            # Get IVTPA in minutes
            # recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg
            #recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_ALL_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_LIM_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_ALL_GROIN_PUNCTURE_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_REFER_LIM_GROIN_PUNCTURE_TIME_MIN&#39;]
            recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME_MIN&#39;]
            #print(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;TBY&#39;] &gt; 0][&#39;TBY&#39;].tolist())

            &#34;&#34;&#34;
            sites_ids = recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;].tolist()
            sites_ids = set(sites_ids)
            interval_vals = {}          
            for idx, val in enumerate(sites_ids): 
                meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;TBY&#39;].tolist())
                medianv, interval_median = _median_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;TBY&#39;].tolist())
                interval_vals[str(idx)] = [val, &#34;({0:.2f}-{1:.2f})&#34;.format(lbound, ubound), &#34;{0}&#34;.format(interval_median)]

            interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTG (Mean)&#39;, &#39;Confidence interval DTG (Median)&#39;])
            &#34;&#34;&#34;
            #recanalization_procedure_tby[&#39;TBY&#39;] = recanalization_procedure_tby.loc[:, [&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;, &#39;TBY_ONLY_GROIN_PUNCTURE_TIME_MIN&#39;, &#39;IVT_TBY_GROIN_TIME&#39;, &#39;IVT_TBY_GROIN_TIME_MIN&#39;]].sum(1).reset_index()[0].tolist()
        else:
            # Get patients receiving TBY
            self.statsDf.loc[:, &#39;# TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - Endovascular treatment alone&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;], axis=1)

            # Get patients receiving TBY %
            self.statsDf[&#39;% TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# TBY&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

            
            # Get only patients recanalized TBY
            recanalization_procedure_tby_dtg = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([4, 3])].copy()
            recanalization_procedure_tby_dtg.fillna(0, inplace=True)

            # Get IVTPA in minutes
            recanalization_procedure_tby_dtg[&#39;TBY&#39;] = recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;TBY_ONLY_GROIN_TIME_MIN&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME&#39;] + recanalization_procedure_tby_dtg[&#39;IVT_TBY_GROIN_TIME_MIN&#39;]


            #print(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;TBY&#39;] &gt; 0][&#39;TBY&#39;].tolist())
            &#34;&#34;&#34;
            sites_ids = recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;].tolist()
            sites_ids = set(sites_ids)
            interval_vals = {}          
            for idx, val in enumerate(sites_ids): 
                meanv, lbound, ubound = _mean_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
                medianv, interval_median = _median_confidence_interval(recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;Protocol ID&#39;] == val][&#39;IVTPA&#39;].tolist())
                interval_vals[str(idx)] = [val, &#34;({0:.2f}-{1:.2f})&#34;.format(lbound, ubound), &#34;{0}&#34;.format(interval_median)]
            
            interval_vals_df = pd.DataFrame.from_dict(interval_vals, orient=&#39;index&#39;, columns=[&#39;Protocol ID&#39;, &#39;Confidence interval DTG (Mean)&#39;, &#39;Confidence interval DTG (Median)&#39;])
            &#34;&#34;&#34;
            #recanalization_procedure_tby[&#39;TBY&#39;] = recanalization_procedure_tby.loc[:, [&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;, &#39;TBY_ONLY_GROIN_PUNCTURE_TIME_MIN&#39;, &#39;IVT_TBY_GROIN_TIME&#39;, &#39;IVT_TBY_GROIN_TIME_MIN&#39;]].sum(1).reset_index()[0].tolist()

        tmp = recanalization_procedure_tby_dtg.groupby([&#39;Protocol ID&#39;]).TBY.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median DTG (minutes)&#39;}).reset_index()
        #print(tmp)
        self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
        self.statsDf.fillna(0, inplace=True)

        #self.statsDf = self.statsDf.merge(interval_vals_df, how=&#39;outer&#39;)

        ###############
        # MEDIAN DIDO #
        ###############
        if country_code == &#39;CZ&#39;:
            # Get patients receiving dido
            #self.statsDf.loc[:, &#39;# DIDO TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;], axis=1)
            self.statsDf.loc[:, &#39;# DIDO TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)

            # Get patients receiving TBY %
            #self.statsDf[&#39;% DIDO TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# DIDO TBY&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;]) &gt; 0 else 0, axis=1)
            

            # Get only patients recanalized TBY
            # recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6, 7, 8])].copy()
            # For CZ remove referred for endovascular treatment from DIDO time because they are taking it as the patient was referred to them for TBY
            #recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6])].copy()
            recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6, 7, 8])].copy()
            recanalization_procedure_tby_dido.fillna(0, inplace=True)

            # Get DIDO in minutes
            #recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;]
            #recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;]
            recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;]


            # Create temporary dataframe with calculated median value
            tmp = recanalization_procedure_tby_dido.groupby([&#39;Protocol ID&#39;]).DIDO.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median TBY DIDO (minutes)&#39;}).reset_index()
            self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
            self.statsDf.fillna(0, inplace=True)
        else:
            # Get patients receiving dido
            self.statsDf.loc[:, &#39;# DIDO TBY&#39;] = self.statsDf.apply(lambda x: x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment&#39;] + x[&#39;# recanalization procedures - Referred to another centre for endovascular treatment and hospitalization continues at the referred to centre&#39;] + x[&#39;# recanalization procedures - Referred for endovascular treatment and patient is returned to the initial centre&#39;], axis=1)

            # Get patients receiving TBY %
            #self.statsDf[&#39;% DIDO TBY&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# DIDO TBY&#39;]/(x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;])) * 100), 2) if (x[&#39;isch_patients&#39;] - x[&#39;# recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;] - x[&#39;# recanalization procedures - Not done&#39;]) &gt; 0 else 0, axis=1)

            # Get only patients recanalized TBY
            recanalization_procedure_tby_dido = isch[isch[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5, 6, 7, 8])].copy()
            recanalization_procedure_tby_dido.fillna(0, inplace=True)

            # Get DIDO in minutes
            # 
            recanalization_procedure_tby_dido[&#39;DIDO&#39;] = recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME&#39;] + recanalization_procedure_tby_dido[&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;]

            # Create temporary dataframe with calculated median value
            tmp = recanalization_procedure_tby_dido.groupby([&#39;Protocol ID&#39;]).DIDO.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median TBY DIDO (minutes)&#39;}).reset_index()
            self.statsDf = self.statsDf.merge(tmp, how=&#39;outer&#39;)
            self.statsDf.fillna(0, inplace=True)
        

        #######################
        # DYPSHAGIA SCREENING #
        #######################
        if country_code == &#39;CZ&#39;:
            self.tmp = is_ich.groupby([&#39;Protocol ID&#39;, &#39;DYSPHAGIA_SCREENING&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients dysphagia screening - not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=6, new_column_name=&#39;# dysphagia screening - not known&#39;)

            # Get % patients dysphagia screening - not known
            self.statsDf[&#39;% dysphagia screening - not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - not known&#39;]/x[&#39;is_ich_patients&#39;]) * 100), 2) if x[&#39;is_ich_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Guss test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=1, new_column_name=&#39;# dysphagia screening - Guss test&#39;)

            # Get % patients dysphagia screening - Guss test
            self.statsDf[&#39;% dysphagia screening - Guss test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Guss test&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Other test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=2, new_column_name=&#39;# dysphagia screening - Other test&#39;)

            # Get % patients dysphagia screening - Other test
            self.statsDf[&#39;% dysphagia screening - Other test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Other test&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Another centre
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=3, new_column_name=&#39;# dysphagia screening - Another centre&#39;)

            # Get % patients dysphagia screening - Another centre
            self.statsDf[&#39;% dysphagia screening - Another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Another centre&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Not done
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=4, new_column_name=&#39;# dysphagia screening - Not done&#39;)

            # Get % patients dysphagia screening - Not done
            self.statsDf[&#39;% dysphagia screening - Not done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Not done&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Unable to test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=5, new_column_name=&#39;# dysphagia screening - Unable to test&#39;)

            # Get % patients dysphagia screening - Unable to test
            self.statsDf[&#39;% dysphagia screening - Unable to test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Unable to test&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            #self.statsDf[&#39;# dysphagia screening done&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;] + self.statsDf[&#39;# dysphagia screening - Another centre&#39;]
            self.statsDf[&#39;# dysphagia screening done&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;]
            #self.statsDf[&#39;% dysphagia screening done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening done&#39;]/(x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)
            self.statsDf[&#39;% dysphagia screening done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening done&#39;]/(x[&#39;# dysphagia screening done&#39;] + x[&#39;# dysphagia screening - Not done&#39;])) * 100), 2) if (x[&#39;# dysphagia screening done&#39;] + x[&#39;# dysphagia screening - Not done&#39;]) &gt; 0 else 0, axis=1)
        else:
            self.tmp = is_ich_cvt.groupby([&#39;Protocol ID&#39;, &#39;DYSPHAGIA_SCREENING&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients dysphagia screening - not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=6, new_column_name=&#39;# dysphagia screening - not known&#39;)

            # Get % patients dysphagia screening - not known
            self.statsDf[&#39;% dysphagia screening - not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - not known&#39;]/x[&#39;is_ich_cvt_patients&#39;]) * 100), 2) if x[&#39;is_ich_cvt_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Guss test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=1, new_column_name=&#39;# dysphagia screening - Guss test&#39;)

            # Get % patients dysphagia screening - Guss test
            self.statsDf[&#39;% dysphagia screening - Guss test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Guss test&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Other test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=2, new_column_name=&#39;# dysphagia screening - Other test&#39;)

            # Get % patients dysphagia screening - Other test
            self.statsDf[&#39;% dysphagia screening - Other test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Other test&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Another centre
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=3, new_column_name=&#39;# dysphagia screening - Another centre&#39;)

            # Get % patients dysphagia screening - Another centre
            self.statsDf[&#39;% dysphagia screening - Another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Another centre&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Not done
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=4, new_column_name=&#39;# dysphagia screening - Not done&#39;)

            # Get % patients dysphagia screening - Not done
            self.statsDf[&#39;% dysphagia screening - Not done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Not done&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            # Get patients dysphagia screening - Unable to test
            self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING&#34;, value=5, new_column_name=&#39;# dysphagia screening - Unable to test&#39;)

            # Get % patients dysphagia screening - Unable to test
            self.statsDf[&#39;% dysphagia screening - Unable to test&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening - Unable to test&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

            self.statsDf[&#39;# dysphagia screening done&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;] + self.statsDf[&#39;# dysphagia screening - Another centre&#39;]
            self.statsDf[&#39;% dysphagia screening done&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening done&#39;]/(x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;])) * 100), 2) if (x[&#39;is_ich_cvt_patients&#39;] - x[&#39;# dysphagia screening - not known&#39;]) &gt; 0 else 0, axis=1)

        ############################
        # DYPSHAGIA SCREENING TIME #
        ############################
        self.tmp = self.df.groupby([&#39;Protocol ID&#39;, &#39;DYSPHAGIA_SCREENING_TIME&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients dysphagia screening time - Within first 24 hours
        self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING_TIME&#34;, value=1, new_column_name=&#39;# dysphagia screening time - Within first 24 hours&#39;)

        # Get patients dysphagia screening time - After first 24 hours
        self.statsDf = self._get_values_for_factors(column_name=&#34;DYSPHAGIA_SCREENING_TIME&#34;, value=2, new_column_name=&#39;# dysphagia screening time - After first 24 hours&#39;)

        # Get % patients dysphagia screening time - Within first 24 hours
        self.statsDf[&#39;% dysphagia screening time - Within first 24 hours&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening time - Within first 24 hours&#39;]/(x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;])) * 100), 2) if (x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;]) &gt; 0 else 0, axis=1)

        # Get % patients dysphagia screening time - After first 24 hours
        self.statsDf[&#39;% dysphagia screening time - After first 24 hours&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# dysphagia screening time - After first 24 hours&#39;]/(x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;])) * 100), 2) if (x[&#39;# dysphagia screening time - Within first 24 hours&#39;] + x[&#39;# dysphagia screening time - After first 24 hours&#39;]) &gt; 0 else 0, axis=1)

        ###################
        # HEMICRANIECTOMY #
        ###################
        self.tmp = isch.groupby([&#39;Protocol ID&#39;, &#39;HEMICRANIECTOMY&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients hemicraniectomy - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;HEMICRANIECTOMY&#34;, value=1, new_column_name=&#39;# hemicraniectomy - Yes&#39;)
    
        # Get % patients hemicraniectomy - Yes
        self.statsDf[&#39;% hemicraniectomy - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# hemicraniectomy - Yes&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients hemicraniectomy - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;HEMICRANIECTOMY&#34;, value=2, new_column_name=&#39;# hemicraniectomy - No&#39;)
    
        # Get % patients hemicraniectomy - No
        self.statsDf[&#39;% hemicraniectomy - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# hemicraniectomy - No&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients hemicraniectomy - Referred to another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;HEMICRANIECTOMY&#34;, value=3, new_column_name=&#39;# hemicraniectomy - Referred to another centre&#39;)
    
        # Get % patients hemicraniectomy - Referred to another centre
        self.statsDf[&#39;% hemicraniectomy - Referred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# hemicraniectomy - Referred to another centre&#39;]/x[&#39;isch_patients&#39;]) * 100), 2) if x[&#39;isch_patients&#39;] &gt; 0 else 0, axis=1)

        ################
        # NEUROSURGERY #
        ################
        self.tmp = ich.groupby([&#39;Protocol ID&#39;, &#39;NEUROSURGERY&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        #print(self.tmp)

        # Get patients neurosurgery - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY&#34;, value=3, new_column_name=&#39;# neurosurgery - Not known&#39;)
    
        # Get % patients neurosurgery - Not known
        self.statsDf[&#39;% neurosurgery - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery - Not known&#39;]/x[&#39;ich_patients&#39;]) * 100), 2) if x[&#39;ich_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients neurosurgery - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY&#34;, value=1, new_column_name=&#39;# neurosurgery - Yes&#39;)
    
        # Get % patients neurosurgery - Yes
        self.statsDf[&#39;% neurosurgery - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery - Yes&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;]) &gt; 0 else 0, axis=1)

        # Get patients neurosurgery - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY&#34;, value=2, new_column_name=&#39;# neurosurgery - No&#39;)
    
        # Get % patients neurosurgery - No
        self.statsDf[&#39;% neurosurgery - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery - No&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;# neurosurgery - Not known&#39;]) &gt; 0 else 0, axis=1)

        #####################
        # NEUROSURGERY TYPE #
        #####################
        # Get temporary dataframe of patients who have undergone neurosurgery 
        neurosurgery = ich[ich[&#39;NEUROSURGERY&#39;].isin([1])].copy()

        if neurosurgery.empty:
            # Get neurosurgery patients
            self.statsDf[&#39;neurosurgery_patients&#39;] = 0
        
            # Get # patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf[&#39;# neurosurgery type - intracranial hematoma evacuation&#39;] = 0

            # Get % patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf[&#39;% neurosurgery type - intracranial hematoma evacuation&#39;] = 0

            # Get # patients neurosurgery type - external ventricular drainage
            self.statsDf[&#39;# neurosurgery type - external ventricular drainage&#39;] = 0

            # Get % patients neurosurgery type - external ventricular drainage
            self.statsDf[&#39;% neurosurgery type - external ventricular drainage&#39;] = 0

            # Get # patients neurosurgery type - decompressive craniectomy
            self.statsDf[&#39;# neurosurgery type - decompressive craniectomy&#39;] = 0

            # Get % patients neurosurgery type - decompressive craniectomy
            self.statsDf[&#39;% neurosurgery type - decompressive craniectomy&#39;] = 0
        
            # Get # patients neurosurgery type - Referred to another centre
            self.statsDf[&#39;# neurosurgery type - Referred to another centre&#39;] = 0

            # Get % patients neurosurgery type - Referred to another centre
            self.statsDf[&#39;% neurosurgery type - Referred to another centre&#39;] = 0
        else:
            self.tmp = neurosurgery.groupby([&#39;Protocol ID&#39;, &#39;NEUROSURGERY_TYPE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get neurosurgery patients
            self.statsDf[&#39;neurosurgery_patients&#39;] = self._count_patients(dataframe=neurosurgery)

            # Get patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=1, new_column_name=&#39;# neurosurgery type - intracranial hematoma evacuation&#39;)
        
            # Get % patients neurosurgery type - intracranial hematoma evacuation
            self.statsDf[&#39;% neurosurgery type - intracranial hematoma evacuation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - intracranial hematoma evacuation&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients neurosurgery type - external ventricular drainage
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=2, new_column_name=&#39;# neurosurgery type - external ventricular drainage&#39;)
        
            # Get % patients neurosurgery type - external ventricular drainage
            self.statsDf[&#39;% neurosurgery type - external ventricular drainage&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - external ventricular drainage&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients neurosurgery type - decompressive craniectomy
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=3, new_column_name=&#39;# neurosurgery type - decompressive craniectomy&#39;)
        
            # Get % patients neurosurgery type - decompressive craniectomy
            self.statsDf[&#39;% neurosurgery type - decompressive craniectomy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - decompressive craniectomy&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients neurosurgery type - Referred to another centre
            self.statsDf = self._get_values_for_factors(column_name=&#34;NEUROSURGERY_TYPE&#34;, value=4, new_column_name=&#39;# neurosurgery type - Referred to another centre&#39;)
        
            # Get % patients neurosurgery type - Referred to another centre
            self.statsDf[&#39;% neurosurgery type - Referred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# neurosurgery type - Referred to another centre&#39;]/x[&#39;neurosurgery_patients&#39;]) * 100), 2) if x[&#39;neurosurgery_patients&#39;] &gt; 0 else 0, axis=1)

        ###################
        # BLEEDING REASON #
        ###################
        self.tmp = ich.groupby([&#39;Protocol ID&#39;, &#39;BLEEDING_REASON&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[&#39;BLEEDING_REASON&#39;] = self.tmp[&#39;BLEEDING_REASON&#39;].astype(str)

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_REASON&#34;, value=&#39;-999&#39;, new_column_name=&#39;tmp&#39;)

        # Get patients bleeding reason - arterial hypertension
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#39;1&#39;, new_column_name=&#39;# bleeding reason - arterial hypertension&#39;)

        # Get % patients bleeding reason - arterial hypertension
        self.statsDf[&#39;% bleeding reason - arterial hypertension&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - arterial hypertension&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - aneurysm
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;2&#34;, new_column_name=&#39;# bleeding reason - aneurysm&#39;)

        # Get % patients bleeding reason - aneurysm
        self.statsDf[&#39;% bleeding reason - aneurysm&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - aneurysm&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - arterio-venous malformation
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;3&#34;, new_column_name=&#39;# bleeding reason - arterio-venous malformation&#39;)

        # Get % patients bleeding reason - arterio-venous malformation
        self.statsDf[&#39;% bleeding reason - arterio-venous malformation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - arterio-venous malformation&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - anticoagulation therapy
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;4&#34;, new_column_name=&#39;# bleeding reason - anticoagulation therapy&#39;)

        # Get % patients bleeding reason - anticoagulation therapy
        self.statsDf[&#39;% bleeding reason - anticoagulation therapy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - anticoagulation therapy&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - amyloid angiopathy
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;5&#34;, new_column_name=&#39;# bleeding reason - amyloid angiopathy&#39;)

        # Get % patients bleeding reason - amyloid angiopathy
        self.statsDf[&#39;% bleeding reason - amyloid angiopathy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - amyloid angiopathy&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding reason - Other
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;6&#34;, new_column_name=&#39;# bleeding reason - Other&#39;)

        # Get % patients bleeding reason - Other
        self.statsDf[&#39;% bleeding reason - Other&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - Other&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% bleeding reason - arterial hypertension&#39;, &#39;% bleeding reason - aneurysm&#39;, &#39;% bleeding reason - arterio-venous malformation&#39;, &#39;% bleeding reason - anticoagulation therapy&#39;, &#39;% bleeding reason - amyloid angiopathy&#39;, &#39;% bleeding reason - Other&#39;]].copy()

        norm_tmp.loc[:, &#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;bleeding_arterial_hypertension_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - arterial hypertension&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_aneurysm_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - aneurysm&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_arterio_venous_malformation_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - arterio-venous malformation&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_anticoagulation_therapy_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - anticoagulation therapy&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_amyloid_angiopathy_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - amyloid angiopathy&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;bleeding_other_perc_norm&#39;] = ((norm_tmp[&#39;% bleeding reason - Other&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        # MORE THAN ONE POSIBILITY
        # Get patients bleeding reason - more than one
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_REASON&#34;, value=&#34;,&#34;, new_column_name=&#39;# bleeding reason - more than one&#39;)

        # Get % patients bleeding reason - more than one
        self.statsDf[&#39;% bleeding reason - more than one&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# bleeding reason - more than one&#39;]/(x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;ich_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ###################
        # BLEEDING SOURCE #
        ###################

        self.tmp = sah.groupby([&#39;Protocol ID&#39;, &#39;BLEEDING_SOURCE&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[&#39;BLEEDING_SOURCE&#39;] = self.tmp[&#39;BLEEDING_SOURCE&#39;].astype(str)

        # Get patients from old version
        #self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;-999&#39;, new_column_name=&#39;tmp&#39;)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;-999&#39;, new_column_name=&#39;tmp&#39;)

        # Get patients bleeding source - known
        #self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;1&#39;, new_column_name=&#39;# bleeding source - Known&#39;)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;1&#39;, new_column_name=&#39;# bleeding source - Known&#39;)


        # Get % patients bleeding source - known
        self.statsDf[&#39;% bleeding source - Known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding source - Known&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get patients bleeding source - Not known
        #self.statsDf = self._get_values_for_factors(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;2&#39;, new_column_name=&#39;# bleeding source - Not known&#39;)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;BLEEDING_SOURCE&#34;, value=&#39;2&#39;, new_column_name=&#39;# bleeding source - Not known&#39;)
        
        # Get % patients bleeding source - Not known
        self.statsDf[&#39;% bleeding source - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# bleeding source - Not known&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ################
        # INTERVENTION #
        ################
        self.tmp = sah.groupby([&#39;Protocol ID&#39;, &#39;INTERVENTION&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[&#39;INTERVENTION&#39;] = self.tmp[&#39;INTERVENTION&#39;].astype(str)

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;INTERVENTION&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get patients intervention - endovascular (coiling)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;1&#34;, new_column_name=&#39;# intervention - endovascular (coiling)&#39;)

        # Get % patients intervention - endovascular (coiling)
        self.statsDf[&#39;% intervention - endovascular (coiling)&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - endovascular (coiling)&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - neurosurgical (clipping)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;2&#34;, new_column_name=&#39;# intervention - neurosurgical (clipping)&#39;)

        # Get % patients intervention - neurosurgical (clipping)
        self.statsDf[&#39;% intervention - neurosurgical (clipping)&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - neurosurgical (clipping)&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - Other neurosurgical treatment (decompression, drainage)
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;3&#34;, new_column_name=&#39;# intervention - Other neurosurgical treatment (decompression, drainage)&#39;)

        # Get % patients intervention - Other neurosurgical treatment (decompression, drainage)
        self.statsDf[&#39;% intervention - Other neurosurgical treatment (decompression, drainage)&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - Other neurosurgical treatment (decompression, drainage)&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - Referred to another hospital for intervention
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;4&#34;, new_column_name=&#39;# intervention - Referred to another hospital for intervention&#39;)

        # Get % patients intervention - Referred to another hospital for intervention
        self.statsDf[&#39;% intervention - Referred to another hospital for intervention&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - Referred to another hospital for intervention&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients intervention - None/no intervention
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;5|6&#34;, new_column_name=&#39;# intervention - None / no intervention&#39;)

        # Get % patients intervention - None/no intervention
        self.statsDf[&#39;% intervention - None / no intervention&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - None / no intervention&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% intervention - endovascular (coiling)&#39;, &#39;% intervention - neurosurgical (clipping)&#39;, &#39;% intervention - Other neurosurgical treatment (decompression, drainage)&#39;, &#39;% intervention - Referred to another hospital for intervention&#39;, &#39;% intervention - None / no intervention&#39;]].copy()

        norm_tmp.loc[:, &#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;intervention_endovascular_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - endovascular (coiling)&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_neurosurgical_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - neurosurgical (clipping)&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_other_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - Other neurosurgical treatment (decompression, drainage)&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_referred_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - Referred to another hospital for intervention&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;intervention_none_perc_norm&#39;] = ((norm_tmp[&#39;% intervention - None / no intervention&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        # Get patients intervention - more than one
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;INTERVENTION&#34;, value=&#34;,&#34;, new_column_name=&#39;# intervention - more than one&#39;)

        # Get % patients intervention - more than one
        self.statsDf[&#39;% intervention - more than one&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# intervention - more than one&#39;]/(x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;sah_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1) 

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        ################
        # VT TREATMENT #
        ################
        if (&#39;VT_TREATMENT&#39; not in cvt.columns):
            cvt[&#39;VT_TREATMENT&#39;] = np.nan
            
        self.tmp = cvt.groupby([&#39;Protocol ID&#39;, &#39;VT_TREATMENT&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        self.tmp[[&#39;VT_TREATMENT&#39;]] = self.tmp[[&#39;VT_TREATMENT&#39;]].astype(str)

        # Get patients VT treatment - anticoagulation
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;1&#34;, new_column_name=&#39;# VT treatment - anticoagulation&#39;)

        # Get % patients VT treatment - anticoagulation
        self.statsDf[&#39;% VT treatment - anticoagulation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - anticoagulation&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - thrombectomy
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;2&#34;, new_column_name=&#39;# VT treatment - thrombectomy&#39;)

        # Get % patients VT treatment - thrombectomy
        self.statsDf[&#39;% VT treatment - thrombectomy&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - thrombectomy&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - local thrombolysis
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;3&#34;, new_column_name=&#39;# VT treatment - local thrombolysis&#39;)

        # Get % patients VT treatment - local thrombolysis
        self.statsDf[&#39;% VT treatment - local thrombolysis&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - local thrombolysis&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - local neurological treatment
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;4&#34;, new_column_name=&#39;# VT treatment - local neurological treatment&#39;)

        # Get % patients VT treatment - local neurological treatment
        self.statsDf[&#39;% VT treatment - local neurological treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - local neurological treatment&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients VT treatment - more than one treatment
        self.statsDf = self._get_values_for_factors_containing(column_name=&#34;VT_TREATMENT&#34;, value=&#34;,&#34;, new_column_name=&#39;# VT treatment - more than one treatment&#39;)

        # Get % patients VT treatment - more than one treatment
        self.statsDf[&#39;% VT treatment - more than one treatment&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# VT treatment - more than one treatment&#39;]/x[&#39;cvt_patients&#39;]) * 100), 2) if x[&#39;cvt_patients&#39;] &gt; 0 else 0, axis=1)

        ### DATA NORMLAIZATION
        norm_tmp = self.statsDf[[&#39;% VT treatment - anticoagulation&#39;, &#39;% VT treatment - thrombectomy&#39;, &#39;% VT treatment - local thrombolysis&#39;, &#39;% VT treatment - local neurological treatment&#39;]].copy()

        norm_tmp.loc[:, &#39;rowsums&#39;] = norm_tmp.sum(axis=1)

        self.statsDf[&#39;vt_treatment_anticoagulation_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - anticoagulation&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vt_treatment_thrombectomy_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - thrombectomy&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vt_treatment_local_thrombolysis_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - local thrombolysis&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)

        self.statsDf[&#39;vt_treatment_local_neurological_treatment_perc_norm&#39;] = ((norm_tmp[&#39;% VT treatment - local neurological treatment&#39;]/norm_tmp[&#39;rowsums&#39;]) * 100).round(decimals=2)


        ########
        # AFIB #
        ########
        # patients not reffered 
        not_reffered = is_tia[~is_tia[&#39;RECANALIZATION_PROCEDURES&#39;].isin([7])].copy()
        self.statsDf[&#39;not_reffered_patients&#39;] = self._count_patients(dataframe=not_reffered)

        # patients referred to another hospital
        reffered = is_tia[is_tia[&#39;RECANALIZATION_PROCEDURES&#39;].isin([7])].copy()
        self.statsDf[&#39;reffered_patients&#39;] = self._count_patients(dataframe=reffered)

        # 
        self.tmp = not_reffered.groupby([&#39;Protocol ID&#39;, &#39;AFIB_FLUTTER&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients afib/flutter - Known
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=1, new_column_name=&#39;# afib/flutter - Known&#39;)

        # Get % patients afib/flutter - Known
        self.statsDf[&#39;% afib/flutter - Known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Known&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients afib/flutter - Newly-detected at admission
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=2, new_column_name=&#39;# afib/flutter - Newly-detected at admission&#39;)

        # Get % patients afib/flutter - Newly-detected at admission
        self.statsDf[&#39;% afib/flutter - Newly-detected at admission&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Newly-detected at admission&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1) 

        # Get patients afib/flutter - Detected during hospitalization
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=3, new_column_name=&#39;# afib/flutter - Detected during hospitalization&#39;)

        # Get % patients afib/flutter - Detected during hospitalization
        self.statsDf[&#39;% afib/flutter - Detected during hospitalization&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Detected during hospitalization&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1) 
        # Get patients afib/flutter - Not detected
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=4, new_column_name=&#39;# afib/flutter - Not detected&#39;)

        # Get % patients afib/flutter - Not detected
        self.statsDf[&#39;% afib/flutter - Not detected&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Not detected&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients afib/flutter - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_FLUTTER&#34;, value=5, new_column_name=&#39;# afib/flutter - Not known&#39;)

        # Get % patients afib/flutter - Not known
        self.statsDf[&#39;% afib/flutter - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib/flutter - Not known&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;reffered_patients&#39;]) &gt; 0 else 0, axis=1)

        #########################
        # AFIB DETECTION METHOD #
        #########################
        if country_code == &#39;CZ&#39;:
            # patients referred to another hospital
            afib_detected_during_hospitalization = not_reffered[not_reffered[&#39;AFIB_FLUTTER&#39;].isin([3])].copy()
            self.statsDf[&#39;afib_detected_during_hospitalization_patients&#39;] = self._count_patients(dataframe=afib_detected_during_hospitalization)

            afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;] = afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;].astype(str)
            # 
            self.tmp = afib_detected_during_hospitalization.groupby([&#39;Protocol ID&#39;, &#39;AFIB_DETECTION_METHOD&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;1&#34;, new_column_name=&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;2&#34;, new_column_name=&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Holter-type monitoring
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;3&#34;, new_column_name=&#39;# afib detection method - Holter-type monitoring&#39;)

            # Get % patients afib detection method - Holter-type monitoring
            self.statsDf[&#39;% afib detection method - Holter-type monitoring&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Holter-type monitoring&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;4&#34;, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;)

            # Get % patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf = self._get_values_for_factors_containing(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=&#34;5&#34;, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;)
            
            # Get % patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)
        else:
            # patients referred to another hospital
            afib_detected_during_hospitalization = not_reffered[not_reffered[&#39;AFIB_FLUTTER&#39;].isin([3])].copy()
            self.statsDf[&#39;afib_detected_during_hospitalization_patients&#39;] = self._count_patients(dataframe=afib_detected_during_hospitalization)

            afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;] = afib_detected_during_hospitalization[&#39;AFIB_DETECTION_METHOD&#39;].astype(str)
            # 
            self.tmp = afib_detected_during_hospitalization.groupby([&#39;Protocol ID&#39;, &#39;AFIB_DETECTION_METHOD&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=1, new_column_name=&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry with monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=2, new_column_name=&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;)

            # Get % patients afib detection method - Telemetry without monitor allowing automatic detection of aFib
            self.statsDf[&#39;% afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Telemetry without monitor allowing automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - Holter-type monitoring
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=3, new_column_name=&#39;# afib detection method - Holter-type monitoring&#39;)

            # Get % patients afib detection method - Holter-type monitoring
            self.statsDf[&#39;% afib detection method - Holter-type monitoring&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - Holter-type monitoring&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=4, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;)

            # Get % patients afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed with automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_DETECTION_METHOD&#34;, value=5, new_column_name=&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;)
            
            # Get % patients afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib
            self.statsDf[&#39;% afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib detection method - EKG monitoring in an ICU bed without automatic detection of aFib&#39;]/x[&#39;afib_detected_during_hospitalization_patients&#39;]) * 100), 2) if x[&#39;afib_detected_during_hospitalization_patients&#39;] &gt; 0 else 0, axis=1)

        ###############################
        # AFIB OTHER DETECTION METHOD #
        ###############################
        # patients referred to another hospital
        afib_not_detected_or_not_known = not_reffered[not_reffered[&#39;AFIB_FLUTTER&#39;].isin([4, 5])].copy()
        self.statsDf[&#39;afib_not_detected_or_not_known_patients&#39;] = self._count_patients(dataframe=afib_not_detected_or_not_known)

        # 
        self.tmp = afib_not_detected_or_not_known.groupby([&#39;Protocol ID&#39;, &#39;AFIB_OTHER_RECS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients other afib detection method - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_OTHER_RECS&#34;, value=1, new_column_name=&#39;# other afib detection method - Yes&#39;)

        # Get % patients other afib detection method - Yes
        self.statsDf[&#39;% other afib detection method - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# other afib detection method - Yes&#39;]/x[&#39;afib_not_detected_or_not_known_patients&#39;]) * 100), 2) if x[&#39;afib_not_detected_or_not_known_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients other afib detection method - Not detected or not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;AFIB_OTHER_RECS&#34;, value=2, new_column_name=&#39;# other afib detection method - Not detected or not known&#39;)

        # Get % patients other afib detection method - Not detected or not known
        self.statsDf[&#39;% other afib detection method - Not detected or not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# other afib detection method - Not detected or not known&#39;]/x[&#39;afib_not_detected_or_not_known_patients&#39;]) * 100), 2) if x[&#39;afib_not_detected_or_not_known_patients&#39;] &gt; 0 else 0, axis=1)

        ############################
        # CAROTID ARTERIES IMAGING #
        ############################
        # 
        self.tmp = is_tia.groupby([&#39;Protocol ID&#39;, &#39;CAROTID_ARTERIES_IMAGING&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients carotid arteries imaging - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_ARTERIES_IMAGING&#34;, value=3, new_column_name=&#39;# carotid arteries imaging - Not known&#39;)

        # Get % patients carotid arteries imaging - Not known
        self.statsDf[&#39;% carotid arteries imaging - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid arteries imaging - Not known&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get patients carotid arteries imaging - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_ARTERIES_IMAGING&#34;, value=1, new_column_name=&#39;# carotid arteries imaging - Yes&#39;)

        # Get % patients carotid arteries imaging - Yes
        self.statsDf[&#39;% carotid arteries imaging - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid arteries imaging - Yes&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;]) &gt; 0 else 0, axis=1)

        # Get patients carotid arteries imaging - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_ARTERIES_IMAGING&#34;, value=2, new_column_name=&#39;# carotid arteries imaging - No&#39;)

        # Get % patients carotid arteries imaging - No
        self.statsDf[&#39;% carotid arteries imaging - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid arteries imaging - No&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;# carotid arteries imaging - Not known&#39;]) &gt; 0 else 0, axis=1)

        ############################
        # ANTITHROMBOTICS WITH CVT #
        ############################

        # patients not referred 
        antithrombotics_with_cvt = is_tia_cvt[~is_tia_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;antithrombotics_patients_with_cvt&#39;] = self._count_patients(dataframe=antithrombotics_with_cvt)

        ischemic_transient_cerebral_dead = is_tia_cvt[is_tia_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;ischemic_transient_cerebral_dead_patients&#39;] = self._count_patients(dataframe=ischemic_transient_cerebral_dead)

        self.tmp = antithrombotics_with_cvt.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        

        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients receiving antiplatelets with CVT&#39;)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients receiving antiplatelets with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving antiplatelets with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving Vit. K antagonist
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=2, new_column_name=&#39;# patients receiving Vit. K antagonist with CVT&#39;)

        # Get % patients receiving Vit. K antagonist
        self.statsDf[&#39;% patients receiving Vit. K antagonist with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving dabigatran
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=3, new_column_name=&#39;# patients receiving dabigatran with CVT&#39;)

        # Get % patients receiving dabigatran
        self.statsDf[&#39;% patients receiving dabigatran with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving rivaroxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=4, new_column_name=&#39;# patients receiving rivaroxaban with CVT&#39;)

        # Get % patients receiving rivaroxaban
        self.statsDf[&#39;% patients receiving rivaroxaban with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving apixaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=5, new_column_name=&#39;# patients receiving apixaban with CVT&#39;)

        # Get % patients receiving apixaban
        self.statsDf[&#39;% patients receiving apixaban with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving edoxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=6, new_column_name=&#39;# patients receiving edoxaban with CVT&#39;)

        # Get % patients receiving edoxaban
        self.statsDf[&#39;% patients receiving edoxaban with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in prophylactic dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=7, new_column_name=&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;)

        # Get % patients receiving LMWH or heparin in prophylactic dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=8, new_column_name=&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;)

        # Get % patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients not prescribed antithrombotics, but recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=9, new_column_name=&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;)

        # Get % patients not prescribed antithrombotics, but recommended
        self.statsDf[&#39;% patients not prescribed antithrombotics, but recommended with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients neither receiving antithrombotics nor recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=10, new_column_name=&#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;)

        # Get % patients neither receiving antithrombotics nor recommended
        self.statsDf[&#39;% patients neither receiving antithrombotics nor recommended with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        ## ANTITHROMBOTICS - PATIENTS PRESCRIBED + RECOMMENDED
        # patients prescribed antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets with CVT&#39;] + x[&#39;# patients receiving Vit. K antagonist with CVT&#39;] + x[&#39;# patients receiving dabigatran with CVT&#39;] + x[&#39;# patients receiving rivaroxaban with CVT&#39;] + x[&#39;# patients receiving apixaban with CVT&#39;] + x[&#39;# patients receiving edoxaban with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;], axis=1)

        # Get % patients prescribed antithrombotics
        #self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% patients prescribed antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics with CVT&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        #  patients prescribed or recommended antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed or recommended antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets with CVT&#39;] + x[&#39;# patients receiving Vit. K antagonist with CVT&#39;] + x[&#39;# patients receiving dabigatran with CVT&#39;] + x[&#39;# patients receiving rivaroxaban with CVT&#39;] + x[&#39;# patients receiving apixaban with CVT&#39;] + x[&#39;# patients receiving edoxaban with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;] + x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;], axis=1)

        # Get % patients prescribed or recommended antithrombotics
        self.statsDf[&#39;% patients prescribed or recommended antithrombotics with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics with CVT&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;])/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;])) * 100, 2) if ((x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_cerebral_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;]) &gt; 0) else 0, axis=1)

        #.round(decimals=2)) 

        self.statsDf.fillna(0, inplace=True)

        ###########################################
        # ANTIPLATELETS - PRESCRIBED WITHOUT AFIB #
        ###########################################
    
        # patients not referred                         
        afib_flutter_not_detected_or_not_known_with_cvt = is_tia_cvt[is_tia_cvt[&#39;AFIB_FLUTTER&#39;].isin([4, 5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known_with_cvt)

        afib_flutter_not_detected_or_not_known_with_cvt_dead = afib_flutter_not_detected_or_not_known_with_cvt[afib_flutter_not_detected_or_not_known_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known_with_cvt_dead)

        prescribed_antiplatelets_no_afib_with_cvt = afib_flutter_not_detected_or_not_known_with_cvt[afib_flutter_not_detected_or_not_known_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([1])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_patients_with_cvt&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib_with_cvt)

        prescribed_antiplatelets_no_afib_dead_with_cvt = prescribed_antiplatelets_no_afib_with_cvt[prescribed_antiplatelets_no_afib_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib_dead_with_cvt)

        self.tmp = afib_flutter_not_detected_or_not_known_with_cvt.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        
        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients prescribed antiplatelets without aFib with CVT&#39;)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antiplatelets without aFib with CVT&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antiplatelets without aFib with CVT&#39;] - x[&#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;])/(x[&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;])) * 100, 2) if ((x[&#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;]) &gt; 0) else 0, axis=1)

        #########################################
        # ANTICOAGULANTS - PRESCRIBED WITH AFIB #
        #########################################
        # patients not referred 
        
        afib_flutter_detected_with_cvt = is_tia_cvt[is_tia_cvt[&#39;AFIB_FLUTTER&#39;].isin([1, 2, 3])].copy()
        self.statsDf[&#39;afib_flutter_detected_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_detected_with_cvt)

        anticoagulants_prescribed_with_cvt = afib_flutter_detected_with_cvt[~afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([1, 10, 9]) &amp; ~afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed anticoagulants with aFib with CVT&#39;] = self._count_patients(dataframe=anticoagulants_prescribed_with_cvt)
        
        anticoagulants_recommended_with_cvt = afib_flutter_detected_with_cvt[afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([9])].copy()
        self.statsDf[&#39;anticoagulants_recommended_patients_with_cvt&#39;] = self._count_patients(dataframe=anticoagulants_recommended_with_cvt)

        afib_flutter_detected_dead_with = afib_flutter_detected_with_cvt[afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] = self._count_patients(dataframe=afib_flutter_detected_dead_with)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed anticoagulants with aFib with CVT&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed anticoagulants with aFib with CVT&#39;]/(x[&#39;afib_flutter_detected_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;]) &gt; 0 else 0, axis=1)

        ##########################################
        # ANTITHROMBOTICS - PRESCRIBED WITH AFIB #
        ##########################################
    
        # patients not referred 
        antithrombotics_prescribed_with_cvt = afib_flutter_detected_with_cvt[~afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([9, 10]) &amp; ~afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed antithrombotics with aFib with CVT&#39;] = self._count_patients(dataframe=antithrombotics_prescribed_with_cvt)

        recommended_antithrombotics_with_afib_alive_with_cvt = afib_flutter_detected_with_cvt[afib_flutter_detected_with_cvt[&#39;ANTITHROMBOTICS&#39;].isin([9]) &amp; ~afib_flutter_detected_with_cvt[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;] = self._count_patients(dataframe=recommended_antithrombotics_with_afib_alive_with_cvt)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antithrombotics with aFib with CVT&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics with aFib with CVT&#39;]/(x[&#39;afib_flutter_detected_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] - x[&#39;afib_flutter_detected_dead_patients_with_cvt&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;]) &gt; 0 else 0, axis=1)
        
        
        ###############################
        # ANTITHROMBOTICS WITHOUT CVT #
        ###############################
        # patients not reffered
        antithrombotics = is_tia[~is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;antithrombotics_patients&#39;] = self._count_patients(dataframe=antithrombotics)

        ischemic_transient_dead = is_tia[is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;ischemic_transient_dead_patients&#39;] = self._count_patients(dataframe=ischemic_transient_dead)

        ischemic_transient_dead_prescribed = is_tia[is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([5]) &amp; ~is_tia[&#39;ANTITHROMBOTICS&#39;].isin([10])].copy()
        self.statsDf[&#39;ischemic_transient_dead_patients_prescribed&#39;] = self._count_patients(dataframe=ischemic_transient_dead_prescribed)
        
        self.tmp = antithrombotics.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients receiving antiplatelets&#39;)

        
        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients receiving antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving antiplatelets&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        
        # Get patients receiving Vit. K antagonist
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=2, new_column_name=&#39;# patients receiving Vit. K antagonist&#39;)

        # Get % patients receiving Vit. K antagonist
        #self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving dabigatran
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=3, new_column_name=&#39;# patients receiving dabigatran&#39;)

        # Get % patients receiving dabigatran
        #self.statsDf[&#39;% patients receiving dabigatran&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving rivaroxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=4, new_column_name=&#39;# patients receiving rivaroxaban&#39;)

        # Get % patients receiving rivaroxaban
        #self.statsDf[&#39;% patients receiving rivaroxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving apixaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=5, new_column_name=&#39;# patients receiving apixaban&#39;)

        # Get % patients receiving apixaban
        #self.statsDf[&#39;% patients receiving apixaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving edoxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=6, new_column_name=&#39;# patients receiving edoxaban&#39;)

        # Get % patients receiving edoxaban
        #self.statsDf[&#39;% patients receiving edoxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in prophylactic dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=7, new_column_name=&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;)

        # Get % patients receiving LMWH or heparin in prophylactic dose
        #self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=8, new_column_name=&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;)

        # Get % patients receiving LMWH or heparin in full anticoagulant dose
        #self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)
        
        # Get patients not prescribed antithrombotics, but recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=9, new_column_name=&#39;# patients not prescribed antithrombotics, but recommended&#39;)

        # Get % patients not prescribed antithrombotics, but recommended
        self.statsDf[&#39;% patients not prescribed antithrombotics, but recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        # Get patients neither receiving antithrombotics nor recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=10, new_column_name=&#39;# patients neither receiving antithrombotics nor recommended&#39;)

        # Get % patients neither receiving antithrombotics nor recommended
        self.statsDf[&#39;% patients neither receiving antithrombotics nor recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients neither receiving antithrombotics nor recommended&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        ## ANTITHROMBOTICS - PATIENTS PRESCRIBED + RECOMMENDED
        # patients prescribed antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets&#39;] + x[&#39;# patients receiving Vit. K antagonist&#39;] + x[&#39;# patients receiving dabigatran&#39;] + x[&#39;# patients receiving rivaroxaban&#39;] + x[&#39;# patients receiving apixaban&#39;] + x[&#39;# patients receiving edoxaban&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;], axis=1)

        # Get % patients prescribed antithrombotics
        #self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100), 2) if (x[&#39;is_tia_cvt_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% patients prescribed antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics&#39;]/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100), 2) if (x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        
        #  patients prescribed or recommended antithrombotics
        self.statsDf.loc[:, &#39;# patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: x[&#39;# patients receiving antiplatelets&#39;] + x[&#39;# patients receiving Vit. K antagonist&#39;] + x[&#39;# patients receiving dabigatran&#39;] + x[&#39;# patients receiving rivaroxaban&#39;] + x[&#39;# patients receiving apixaban&#39;] + x[&#39;# patients receiving edoxaban&#39;] + x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;] + x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;] + x[&#39;# patients not prescribed antithrombotics, but recommended&#39;], axis=1)

        # Get % patients prescribed or recommended antithrombotics
        # From patients prescribed or recommended antithrombotics remove patient who had prescribed antithrombotics and were dead (nominator)
        #self.statsDf[&#39;% patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics&#39;] - x[&#39;ischemic_transient_dead_patients_prescribed&#39;])/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;])) * 100, 2) if ((x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;] - x[&#39;# patients not prescribed antithrombotics, but recommended&#39;]) &gt; 0) else 0, axis=1)
        self.statsDf[&#39;% patients prescribed or recommended antithrombotics&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed or recommended antithrombotics&#39;] - x[&#39;ischemic_transient_dead_patients_prescribed&#39;])/(x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;])) * 100, 2) if ((x[&#39;is_tia_patients&#39;] - x[&#39;ischemic_transient_dead_patients&#39;]) &gt; 0) else 0, axis=1)
        
        #.round(decimals=2)) 
        self.statsDf.drop([&#39;# patients receiving Vit. K antagonist&#39;, &#39;# patients receiving dabigatran&#39;, &#39;# patients receiving rivaroxaban&#39;, &#39;# patients receiving apixaban&#39;, &#39;# patients receiving edoxaban&#39;, &#39;# patients receiving LMWH or heparin in prophylactic dose&#39;,&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;], axis=1, inplace=True)

        self.statsDf.fillna(0, inplace=True)
        ###########################################
        # ANTIPLATELETS - PRESCRIBED WITHOUT AFIB #
        ###########################################
        
        # patients not referred
        afib_flutter_not_detected_or_not_known = is_tia[is_tia[&#39;AFIB_FLUTTER&#39;].isin([4, 5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_patients&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known)

        afib_flutter_not_detected_or_not_known_dead = afib_flutter_not_detected_or_not_known[afib_flutter_not_detected_or_not_known[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;] = self._count_patients(dataframe=afib_flutter_not_detected_or_not_known_dead)

        prescribed_antiplatelets_no_afib = afib_flutter_not_detected_or_not_known[afib_flutter_not_detected_or_not_known[&#39;ANTITHROMBOTICS&#39;].isin([1])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_patients&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib)

        prescribed_antiplatelets_no_afib_dead = prescribed_antiplatelets_no_afib[prescribed_antiplatelets_no_afib[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;] = self._count_patients(dataframe=prescribed_antiplatelets_no_afib_dead)

        self.tmp = afib_flutter_not_detected_or_not_known.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        
        # Get patients receiving antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# patients prescribed antiplatelets without aFib&#39;)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antiplatelets without aFib&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antiplatelets without aFib&#39;] - x[&#39;prescribed_antiplatelets_no_afib_dead_patients&#39;])/(x[&#39;afib_flutter_not_detected_or_not_known_patients&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;])) * 100, 2) if ((x[&#39;afib_flutter_not_detected_or_not_known_patients&#39;] - x[&#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;]) &gt; 0) else 0, axis=1)

        #########################################
        # ANTICOAGULANTS - PRESCRIBED WITH AFIB #
        #########################################
    
        # patients not referred 
        afib_flutter_detected = is_tia[is_tia[&#39;AFIB_FLUTTER&#39;].isin([1, 2, 3])].copy()
        self.statsDf[&#39;afib_flutter_detected_patients&#39;] = self._count_patients(dataframe=afib_flutter_detected)

        afib_flutter_detected_not_dead = afib_flutter_detected[~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_detected_patients_not_dead&#39;] = self._count_patients(dataframe=afib_flutter_detected_not_dead)

        anticoagulants_prescribed = afib_flutter_detected[~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1, 10, 9]) &amp; ~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed anticoagulants with aFib&#39;] = self._count_patients(dataframe=anticoagulants_prescribed)

        self.tmp = anticoagulants_prescribed.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        # Additional calculation 
        # Get patients receiving Vit. K antagonist
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=2, new_column_name=&#39;# patients receiving Vit. K antagonist&#39;)

        # Get % patients receiving Vit. K antagonist
        #self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/x[&#39;# patients prescribed anticoagulants with aFib&#39;]) * 100), 2) if x[&#39;# patients prescribed anticoagulants with aFib&#39;] &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% patients receiving Vit. K antagonist&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving Vit. K antagonist&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving dabigatran
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=3, new_column_name=&#39;# patients receiving dabigatran&#39;)

        # Get % patients receiving dabigatran
        self.statsDf[&#39;% patients receiving dabigatran&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving dabigatran&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving rivaroxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=4, new_column_name=&#39;# patients receiving rivaroxaban&#39;)

        # Get % patients receiving rivaroxaban
        self.statsDf[&#39;% patients receiving rivaroxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving rivaroxaban&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving apixaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=5, new_column_name=&#39;# patients receiving apixaban&#39;)

        # Get % patients receiving apixaban
        self.statsDf[&#39;% patients receiving apixaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving apixaban&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving edoxaban
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=6, new_column_name=&#39;# patients receiving edoxaban&#39;)

        # Get % patients receiving edoxaban
        self.statsDf[&#39;% patients receiving edoxaban&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving edoxaban&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)
        # Get patients receiving LMWH or heparin in prophylactic dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=7, new_column_name=&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;)

        # Get % patients receiving LMWH or heparin in prophylactic dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in prophylactic dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in prophylactic dose&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        # Get patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=8, new_column_name=&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;)

        # Get % patients receiving LMWH or heparin in full anticoagulant dose
        self.statsDf[&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients receiving LMWH or heparin in full anticoagulant dose&#39;]/x[&#39;afib_flutter_detected_patients_not_dead&#39;]) * 100), 2) if x[&#39;afib_flutter_detected_patients_not_dead&#39;] &gt; 0 else 0, axis=1)

        
        anticoagulants_recommended = afib_flutter_detected[afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9])].copy()
        self.statsDf[&#39;anticoagulants_recommended_patients&#39;] = self._count_patients(dataframe=anticoagulants_recommended)

        afib_flutter_detected_dead = afib_flutter_detected[afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;afib_flutter_detected_dead_patients&#39;] = self._count_patients(dataframe=afib_flutter_detected_dead)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed anticoagulants with aFib&#39;] =  self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed anticoagulants with aFib&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;]) &gt; 0 else 0, axis=1)

        ##########################################
        # ANTITHROMBOTICS - PRESCRIBED WITH AFIB #
        ##########################################
        # patients not reffered 
        antithrombotics_prescribed = afib_flutter_detected[~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9, 10]) &amp; ~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;# patients prescribed antithrombotics with aFib&#39;] = self._count_patients(dataframe=antithrombotics_prescribed)

        recommended_antithrombotics_with_afib_alive = afib_flutter_detected[afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9]) &amp; ~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])].copy()
        self.statsDf[&#39;recommended_antithrombotics_with_afib_alive_patients&#39;] = self._count_patients(dataframe=recommended_antithrombotics_with_afib_alive)

        # Get % patients receiving antiplatelets
        self.statsDf[&#39;% patients prescribed antithrombotics with aFib&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed antithrombotics with aFib&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;] - x[&#39;recommended_antithrombotics_with_afib_alive_patients&#39;]) &gt; 0 else 0, axis=1)
        
        ###########
        # STATINS #
        ###########
        if country_code == &#39;CZ&#39;:
            is_tia_discharged_home = is_tia[is_tia[&#39;DISCHARGE_DESTINATION&#39;].isin([1])].copy()
            self.statsDf[&#39;is_tia_discharged_home_patients&#39;] = self._count_patients(dataframe=is_tia_discharged_home)
            
            self.tmp = is_tia_discharged_home.groupby([&#39;Protocol ID&#39;, &#39;STATIN&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients prescribed statins - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=1, new_column_name=&#39;# patients prescribed statins - Yes&#39;)

            # Get % patients prescribed statins - Yes
            self.statsDf[&#39;% patients prescribed statins - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Yes&#39;]/x[&#39;is_tia_discharged_home_patients&#39;]) * 100), 2) if x[&#39;is_tia_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=2, new_column_name=&#39;# patients prescribed statins - No&#39;)

            # Get % patients prescribed statins - No
            self.statsDf[&#39;% patients prescribed statins - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - No&#39;]/x[&#39;is_tia_discharged_home_patients&#39;]) * 100), 2) if x[&#39;is_tia_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=3, new_column_name=&#39;# patients prescribed statins - Not known&#39;)

            # Get % patients prescribed statins - Not known
            self.statsDf[&#39;% patients prescribed statins - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Not known&#39;]/x[&#39;is_tia_discharged_home_patients&#39;]) * 100), 2) if x[&#39;is_tia_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)
        else:
            self.tmp = is_tia.groupby([&#39;Protocol ID&#39;, &#39;STATIN&#39;]).size().to_frame(&#39;count&#39;).reset_index()

            # Get patients prescribed statins - Yes
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=1, new_column_name=&#39;# patients prescribed statins - Yes&#39;)

            # Get % patients prescribed statins - Yes
            self.statsDf[&#39;% patients prescribed statins - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Yes&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - No
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=2, new_column_name=&#39;# patients prescribed statins - No&#39;)

            # Get % patients prescribed statins - No
            self.statsDf[&#39;% patients prescribed statins - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - No&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

            # Get patients prescribed statins - Not known
            self.statsDf = self._get_values_for_factors(column_name=&#34;STATIN&#34;, value=3, new_column_name=&#39;# patients prescribed statins - Not known&#39;)

            # Get % patients prescribed statins - Not known
            self.statsDf[&#39;% patients prescribed statins - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients prescribed statins - Not known&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        ####################
        # CAROTID STENOSIS #
        ####################
        self.tmp = is_tia.groupby([&#39;Protocol ID&#39;, &#39;CAROTID_STENOSIS&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get carotid stenosis - 50%-70%
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=1, new_column_name=&#39;# carotid stenosis - 50%-70%&#39;)

        # Get % carotid stenosis - 50%-70%
        self.statsDf[&#39;% carotid stenosis - 50%-70%&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - 50%-70%&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis - &gt;70%
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=2, new_column_name=&#39;# carotid stenosis - &gt;70%&#39;)

        # Get % carotid stenosis - &gt;70%
        self.statsDf[&#39;% carotid stenosis - &gt;70%&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - &gt;70%&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=3, new_column_name=&#39;# carotid stenosis - No&#39;)

        # Get % carotid stenosis - No
        self.statsDf[&#39;% carotid stenosis - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - No&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS&#34;, value=4, new_column_name=&#39;# carotid stenosis - Not known&#39;)

        # Get % carotid stenosis - Not known
        self.statsDf[&#39;% carotid stenosis - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis - Not known&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        ##############################
        # CAROTID STENOSIS FOLLOW-UP #
        ##############################
        #carotid_stenosis = is_tia[is_tia[&#39;CAROTID_STENOSIS&#39;].isin([1, 2])]
        # Change to &gt;70% patients
        carotid_stenosis = is_tia[is_tia[&#39;CAROTID_STENOSIS&#39;].isin([1, 2])] 

        self.tmp = carotid_stenosis.groupby([&#39;Protocol ID&#39;, &#39;CAROTID_STENOSIS_FOLLOWUP&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get carotid stenosis followup - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=1, new_column_name=&#39;# carotid stenosis followup - Yes&#39;)

        # Get % carotid stenosis followup - Yes
        self.statsDf[&#39;% carotid stenosis followup - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - Yes&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=2, new_column_name=&#39;# carotid stenosis followup - No&#39;)

        # Get % carotid stenosis followup - No
        self.statsDf[&#39;% carotid stenosis followup - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - No&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - No, but planned later
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=3, new_column_name=&#39;# carotid stenosis followup - No, but planned later&#39;)

        # Get % carotid stenosis followup - No, but planned later
        self.statsDf[&#39;% carotid stenosis followup - No, but planned later&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - No, but planned later&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - Yes, but planned
        carotid_stenosis_followup = carotid_stenosis[carotid_stenosis[&#39;CAROTID_STENOSIS_FOLLOWUP&#39;].isin([1, 3])].copy()
        self.statsDf[&#39;# carotid stenosis followup - Yes, but planned&#39;] = self._count_patients(dataframe=carotid_stenosis_followup)

        # Get % carotid stenosis followup - Yes, but planned
        self.statsDf[&#39;% carotid stenosis followup - Yes, but planned&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - Yes, but planned&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        # Get carotid stenosis followup - Referred to another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;CAROTID_STENOSIS_FOLLOWUP&#34;, value=4, new_column_name=&#39;# carotid stenosis followup - Referred to another centre&#39;)

        # Get % carotid stenosis followup - Referred to another centre
        self.statsDf[&#39;% carotid stenosis followup - Referred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# carotid stenosis followup - Referred to another centre&#39;]/x[&#39;is_tia_patients&#39;]) * 100), 2) if x[&#39;is_tia_patients&#39;] &gt; 0 else 0, axis=1)

        #####################
        # ANTIHYPERTENSIVES #
        #####################
        self.tmp = discharge_subset_alive.groupby([&#39;Protocol ID&#39;, &#39;ANTIHYPERTENSIVE&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get prescribed antihypertensives - Not known
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTIHYPERTENSIVE&#34;, value=3, new_column_name=&#39;# prescribed antihypertensives - Not known&#39;)

        # Get % prescribed antihypertensives - Not known
        self.statsDf[&#39;% prescribed antihypertensives - Not known&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# prescribed antihypertensives - Not known&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        # Get prescribed antihypertensives - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTIHYPERTENSIVE&#34;, value=1, new_column_name=&#39;# prescribed antihypertensives - Yes&#39;)

        # Get % prescribed antihypertensives - Yes
        self.statsDf[&#39;% prescribed antihypertensives - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# prescribed antihypertensives - Yes&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;]) &gt; 0 else 0, axis=1)
        
        # Get prescribed antihypertensives - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTIHYPERTENSIVE&#34;, value=2, new_column_name=&#39;# prescribed antihypertensives - No&#39;)

        # Get % prescribed antihypertensives - No
        self.statsDf[&#39;% prescribed antihypertensives - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# prescribed antihypertensives - No&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;# prescribed antihypertensives - Not known&#39;]) &gt; 0 else 0, axis=1)

        #####################
        # SMOKING CESSATION #
        #####################
        self.tmp = discharge_subset_alive.groupby([&#39;Protocol ID&#39;, &#39;SMOKING_CESSATION&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get recommended to a smoking cessation program - not a smoker
        self.statsDf = self._get_values_for_factors(column_name=&#34;SMOKING_CESSATION&#34;, value=3, new_column_name=&#39;# recommended to a smoking cessation program - not a smoker&#39;)

        # Get % recommended to a smoking cessation program - not a smoker
        self.statsDf[&#39;% recommended to a smoking cessation program - not a smoker&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a smoking cessation program - not a smoker&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        # Get recommended to a smoking cessation program - Yes
        self.statsDf = self._get_values_for_factors(column_name=&#34;SMOKING_CESSATION&#34;, value=1, new_column_name=&#39;# recommended to a smoking cessation program - Yes&#39;)

        # Get % recommended to a smoking cessation program - Yes
        self.statsDf[&#39;% recommended to a smoking cessation program - Yes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a smoking cessation program - Yes&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        # Get recommended to a smoking cessation program - No
        self.statsDf = self._get_values_for_factors(column_name=&#34;SMOKING_CESSATION&#34;, value=2, new_column_name=&#39;# recommended to a smoking cessation program - No&#39;)

        # Get % recommended to a smoking cessation program - No
        self.statsDf[&#39;% recommended to a smoking cessation program - No&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a smoking cessation program - No&#39;]/x[&#39;discharge_subset_alive_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_alive_patients&#39;] &gt; 0 else 0, axis=1)

        ##########################
        # CEREBROVASCULAR EXPERT #
        ##########################
        self.tmp = discharge_subset_alive.groupby([&#39;Protocol ID&#39;, &#39;CEREBROVASCULAR_EXPERT&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get recommended to a cerebrovascular expert - Recommended, and appointment was made
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=1, new_column_name=&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;)

        # Get % recommended to a cerebrovascular expert - Recommended, and appointment was made
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get recommended to a cerebrovascular expert - Recommended, but appointment was not made
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=2, new_column_name=&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;)

        # Get % recommended to a cerebrovascular expert - Recommended, but appointment was not made
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get recommended to a cerebrovascular expert - Recommended
        self.statsDf.loc[:, &#39;# recommended to a cerebrovascular expert - Recommended&#39;] = self.statsDf.apply(lambda x: x[&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;] + x[&#39;# recommended to a cerebrovascular expert - Recommended, but appointment was not made&#39;], axis=1)

        # Get % recommended to a cerebrovascular expert - Recommended
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Recommended&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get recommended to a cerebrovascular expert - Not recommended
        self.statsDf = self._get_values_for_factors(column_name=&#34;CEREBROVASCULAR_EXPERT&#34;, value=3, new_column_name=&#39;# recommended to a cerebrovascular expert - Not recommended&#39;)

        # Get % recommended to a cerebrovascular expert - Not recommended
        self.statsDf[&#39;% recommended to a cerebrovascular expert - Not recommended&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# recommended to a cerebrovascular expert - Not recommended&#39;]/(x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_alive_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        #########################
        # DISCHARGE DESTINATION #
        #########################
        self.tmp = discharge_subset.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_DESTINATION&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get discharge destination - Home
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=1, new_column_name=&#39;# discharge destination - Home&#39;)

        # Get % discharge destination - Home
        self.statsDf[&#39;% discharge destination - Home&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Home&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Transferred within the same centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=2, new_column_name=&#39;# discharge destination - Transferred within the same centre&#39;)

        # Get % discharge destination - Transferred within the same centre
        self.statsDf[&#39;% discharge destination - Transferred within the same centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Transferred within the same centre&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Transferred to another centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=3, new_column_name=&#39;# discharge destination - Transferred to another centre&#39;)

        # Get % discharge destination - Transferred to another centre
        self.statsDf[&#39;% discharge destination - Transferred to another centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Transferred to another centre&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Social care facility
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=4, new_column_name=&#39;# discharge destination - Social care facility&#39;)

        # Get % discharge destination - Social care facility
        self.statsDf[&#39;% discharge destination - Social care facility&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Social care facility&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        # Get discharge destination - Dead
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_DESTINATION&#34;, value=5, new_column_name=&#39;# discharge destination - Dead&#39;)

        # Get % discharge destination - Dead
        self.statsDf[&#39;% discharge destination - Dead&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# discharge destination - Dead&#39;]/x[&#39;discharge_subset_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_patients&#39;] &gt; 0 else 0, axis=1)

        #######################################
        # DISCHARGE DESTINATION - SAME CENTRE #
        #######################################
        discharge_subset_same_centre = discharge_subset[discharge_subset[&#39;DISCHARGE_DESTINATION&#39;].isin([2])].copy()
        self.statsDf[&#39;discharge_subset_same_centre_patients&#39;] = self._count_patients(dataframe=discharge_subset_same_centre)

        self.tmp = discharge_subset_same_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_SAME_FACILITY&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get transferred within the same centre - Acute rehabilitation
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_SAME_FACILITY&#34;, value=1, new_column_name=&#39;# transferred within the same centre - Acute rehabilitation&#39;)

        # Get % transferred within the same centre - Acute rehabilitation
        self.statsDf[&#39;% transferred within the same centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred within the same centre - Acute rehabilitation&#39;]/x[&#39;discharge_subset_same_centre_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_same_centre_patients&#39;] &gt; 0 else 0, axis=1)

        # Get transferred within the same centre - Post-care bed
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_SAME_FACILITY&#34;, value=2, new_column_name=&#39;# transferred within the same centre - Post-care bed&#39;)

        # Get % transferred within the same centre - Post-care bed
        self.statsDf[&#39;% transferred within the same centre - Post-care bed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred within the same centre - Post-care bed&#39;]/x[&#39;discharge_subset_same_centre_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_same_centre_patients&#39;] &gt; 0 else 0, axis=1)

        # Get transferred within the same centre - Another department
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_SAME_FACILITY&#34;, value=3, new_column_name=&#39;# transferred within the same centre - Another department&#39;)

        # Get % transferred within the same centre - Another department
        self.statsDf[&#39;% transferred within the same centre - Another department&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred within the same centre - Another department&#39;]/x[&#39;discharge_subset_same_centre_patients&#39;]) * 100), 2) if x[&#39;discharge_subset_same_centre_patients&#39;] &gt; 0 else 0, axis=1)

        # Check if sum of % is &gt; 100 (100.01)
        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% transferred within the same centre - Acute rehabilitation&#39;] + self.statsDf[&#39;% transferred within the same centre - Post-care bed&#39;] + self.statsDf[&#39;% transferred within the same centre - Another department&#39;]
        #self.statsDf[&#39;% transferred within the same centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: x[&#39;% transferred within the same centre - Acute rehabilitation&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% transferred within the same centre - Acute rehabilitation&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)

        ############################################
        # DISCHARGE DESTINATION - ANOTHER FACILITY #
        ############################################
        discharge_subset_another_centre = discharge_subset[discharge_subset[&#39;DISCHARGE_DESTINATION&#39;].isin([3])].copy()
        self.statsDf[&#39;discharge_subset_another_centre_patients&#39;] = self._count_patients(dataframe=discharge_subset_another_centre)

        self.tmp = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get transferred to another centre - Stroke centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=1, new_column_name=&#39;# transferred to another centre - Stroke centre&#39;)

        # Get % transferred to another centre - Stroke centre
        self.statsDf[&#39;% transferred to another centre - Stroke centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred to another centre - Stroke centre&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get transferred to another centre - Comprehensive stroke centre
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=2, new_column_name=&#39;# transferred to another centre - Comprehensive stroke centre&#39;)

        # Get % transferred to another centre - Comprehensive stroke centre
        self.statsDf[&#39;% transferred to another centre - Comprehensive stroke centre&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred to another centre - Comprehensive stroke centre&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get transferred to another centre - Another hospital
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY&#34;, value=3, new_column_name=&#39;# transferred to another centre - Another hospital&#39;)

        # Get % transferred to another centre - Another hospital
        self.statsDf[&#39;% transferred to another centre - Another hospital&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# transferred to another centre - Another hospital&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        #########################################################
        # DISCHARGE DESTINATION - ANOTHER FACILITY - DEPARTMENT #
        #########################################################
        self.tmp = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY_O1&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        tmp_o2 = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY_O2&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        tmp_o3 = discharge_subset_another_centre.groupby([&#39;Protocol ID&#39;, &#39;DISCHARGE_OTHER_FACILITY_O3&#39;]).size().to_frame(&#39;count&#39;).reset_index()

        # Get patients from old version
        self.statsDf = self._get_values_for_factors(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=-999, new_column_name=&#39;tmp&#39;)

        # Get department transferred to within another centre - Acute rehabilitation
        self.statsDf[&#39;# department transferred to within another centre - Acute rehabilitation&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=1, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=1, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=1, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Acute rehabilitation
        self.statsDf[&#39;% department transferred to within another centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Acute rehabilitation&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get department transferred to within another centre - Post-care bed
        self.statsDf[&#39;# department transferred to within another centre - Post-care bed&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=2, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=2, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=2, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Post-care bed
        self.statsDf[&#39;% department transferred to within another centre - Post-care bed&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Post-care bed&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get department transferred to within another centre - Neurology
        self.statsDf[&#39;# department transferred to within another centre - Neurology&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=3, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=3, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=3, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Neurology
        self.statsDf[&#39;% department transferred to within another centre - Neurology&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Neurology&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Get department transferred to within another centre - Another department
        self.statsDf[&#39;# department transferred to within another centre - Another department&#39;] = self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O1&#34;, value=4, dataframe=self.tmp) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O2&#34;, value=4, dataframe=tmp_o2) + self._get_values_only_columns(column_name=&#34;DISCHARGE_OTHER_FACILITY_O3&#34;, value=4, dataframe=tmp_o3)

        # Get % department transferred to within another centre - Another department
        self.statsDf[&#39;% department transferred to within another centre - Another department&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# department transferred to within another centre - Another department&#39;]/(x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;])) * 100), 2) if (x[&#39;discharge_subset_another_centre_patients&#39;] - x[&#39;tmp&#39;]) &gt; 0 else 0, axis=1)

        # Drop tmp column 
        self.statsDf.drop([&#39;tmp&#39;], inplace=True, axis=1)

        # Check if sum of % is &gt; 100 (100.01)
        #self.statsDf[&#39;sum&#39;] = self.statsDf[&#39;% department transferred to within another centre - Acute rehabilitation&#39;] + self.statsDf[&#39;% department transferred to within another centre - Post-care bed&#39;] + self.statsDf[&#39;% department transferred to within another centre - Neurology&#39;] + self.statsDf[&#39;% department transferred to within another centre - Another department&#39;]
        #self.statsDf[&#39;% department transferred to within another centre - Acute rehabilitation&#39;] = self.statsDf.apply(lambda x: x[&#39;% department transferred to within another centre - Acute rehabilitation&#39;]-0.01 if x[&#39;sum&#39;] &gt; 100.00 else x[&#39;% department transferred to within another centre - Acute rehabilitation&#39;], axis=1)

        # Drop tmp column 
        #self.statsDf.drop([&#39;sum&#39;], inplace=True, axis=1)

        ############################################
        # DISCHARGE DESTINATION - ANOTHER FACILITY #
        ############################################
        discharge_subset.fillna(0, inplace=True)
        discharge_subset_mrs = discharge_subset[~discharge_subset[&#39;DISCHARGE_MRS&#39;].isin([0])].copy()
        #discharge_subset_mrs[&#39;DISCHARGE_MRS&#39;] = discharge_subset_mrs[&#39;DISCHARGE_MRS&#39;].astype(float)

        def function(x):
            x = float(x)
            if (x == 1):
                x = x - 1
            else: 
                x = x - 2 

            return x

        if discharge_subset_mrs.empty:
            self.statsDf[&#39;Median discharge mRS&#39;] = 0
            self.statsDf.fillna(0, inplace=True)
        else: 
            discharge_subset_mrs[&#39;DISCHARGE_MRS_ADJUSTED&#39;] = discharge_subset_mrs.apply(lambda row: function(row[&#39;DISCHARGE_MRS&#39;]), axis=1)
            discharge_subset_mrs[&#39;DISCHARGE_MRS_ADDED&#39;] = discharge_subset_mrs[&#39;DISCHARGE_MRS_ADJUSTED&#39;] + discharge_subset_mrs[&#39;D_MRS_SCORE&#39;]
            discharge_subset_mrs.fillna(0, inplace=True)

            self.statsDf = self.statsDf.merge(discharge_subset_mrs.groupby([&#39;Protocol ID&#39;]).DISCHARGE_MRS_ADDED.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median discharge mRS&#39;})[&#39;Median discharge mRS&#39;].reset_index(), how=&#39;outer&#39;)
            self.statsDf.fillna(0, inplace=True)

        ########################
        # MEDIAN HOSPITAL STAY #
        ########################
        positive_hospital_days = self.df[self.df[&#39;HOSPITAL_DAYS&#39;] &gt; 0]
        self.statsDf = self.statsDf.merge(positive_hospital_days.groupby([&#39;Protocol ID&#39;]).HOSPITAL_DAYS.agg([&#39;median&#39;]).rename(columns={&#39;median&#39;: &#39;Median hospital stay (days)&#39;})[&#39;Median hospital stay (days)&#39;].reset_index(), how=&#39;outer&#39;)
        self.statsDf.fillna(0, inplace=True)

        wrong_ivtpa = recanalization_procedure_iv_tpa[recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 0]

        self.statsDf[&#39;wrong_ivtpa&#39;] = self._count_patients(dataframe=wrong_ivtpa)
        #print(self.statsDf[&#39;wrong_ivtpa&#39;])

        self.statsDf.loc[:, &#39;# patients eligible thrombolysis&#39;] = self.statsDf.apply(lambda x: (x[&#39;# recanalization procedures - IV tPa&#39;] + x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - IV tPa + referred to another centre for endovascular treatment&#39;]) - x[&#39;wrong_ivtpa&#39;], axis=1)
        self.statsDf.drop([&#39;wrong_ivtpa&#39;], inplace=True, axis=1)

        wrong_tby = recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;TBY&#39;] &lt;= 0]

        self.statsDf[&#39;wrong_tby&#39;] = self._count_patients(dataframe=wrong_tby)

        self.statsDf.loc[:, &#39;# patients eligible thrombectomy&#39;] = self.statsDf.apply(lambda x: (x[&#39;# recanalization procedures - IV tPa + endovascular treatment&#39;] + x[&#39;# recanalization procedures - Endovascular treatment alone&#39;]) - x[&#39;wrong_tby&#39;], axis=1)
        self.statsDf.drop([&#39;wrong_tby&#39;], inplace=True, axis=1)

        ################
        # ANGEL AWARDS #
        ################
        #### TOTAL PATIENTS #####
        self.total_patient_column = &#39;# total patients &gt;= {0}&#39;.format(self.patient_limit)
        self.statsDf[self.total_patient_column] = self.statsDf[&#39;Total Patients&#39;] &gt;= self.patient_limit

        #### DOOR TO THROMBOLYSIS THERAPY - MINUTES ####
        # TO DO:
        # THROMBOLYSIS - UNDER 60
        # THROMBOLYSIS - UNDER 45
        # THROMBECTOMY - UNDER 90
        # THROMBECTOMY - UNDER 60
        # If thrombectomy done not at all, take the possible lowest award they can get
        # Create temporary dataframe only with rows where thrombolysis was performed under 60 minute
        recanalization_procedure_iv_tpa_under_60 = recanalization_procedure_iv_tpa.loc[(recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &gt; 0) &amp; (recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 60)]
        # Create temporary dataframe only with rows where thrombolysis was performed under 45 minute
        recanalization_procedure_iv_tpa_under_45 = recanalization_procedure_iv_tpa.loc[(recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &gt; 0) &amp; (recanalization_procedure_iv_tpa[&#39;IVTPA&#39;] &lt;= 45)]

        self.statsDf[&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_iv_tpa_under_60)

        self.statsDf[&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;]/x[&#39;# patients eligible thrombolysis&#39;]) * 100), 2) if x[&#39;# patients eligible thrombolysis&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_iv_tpa_under_45)

        self.statsDf[&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;]/x[&#39;# patients eligible thrombolysis&#39;]) * 100), 2) if x[&#39;# patients eligible thrombolysis&#39;] &gt; 0 else 0, axis=1)

        # for tby, we are only looking at patients that have had ONLY tby, not tpa + tby, as we awould be counting those patients twice (penalizing twice)
        recanalization_procedure_tby_only_dtg =  recanalization_procedure_tby_dtg[recanalization_procedure_tby_dtg[&#39;RECANALIZATION_PROCEDURES&#39;].isin([3, 4])]

        # Create temporary dataframe only with rows where trombectomy was performed under 90 minutes
        recanalization_procedure_tby_only_dtg_under_90 = recanalization_procedure_tby_only_dtg.loc[(recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &gt; 0) &amp; (recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &lt;= 90)]
        # Create temporary dataframe only with rows where trombectomy was performed under 60 minutes
        recanalization_procedure_tby_only_dtg_under_60 = recanalization_procedure_tby_only_dtg.loc[(recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &gt; 0) &amp; (recanalization_procedure_tby_only_dtg[&#39;TBY&#39;] &lt;= 60)]
        
        self.statsDf[&#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_tby_only_dtg_under_90)

        self.statsDf[&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;]/x[&#39;# patients eligible thrombectomy&#39;]) * 100), 2) if x[&#39;# patients eligible thrombectomy&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;] = self._count_patients(dataframe=recanalization_procedure_tby_only_dtg_under_60)

        self.statsDf[&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;]/x[&#39;# patients eligible thrombectomy&#39;]) * 100), 2) if x[&#39;# patients eligible thrombectomy&#39;] &gt; 0 else 0, axis=1)

        #### RECANALIZATION RATE ####
        # recanalization rate out of total ischemic incidence
        self.statsDf[&#39;# recanalization rate out of total ischemic incidence&#39;] = self.statsDf[&#39;# patients recanalized&#39;]

        # % recanalization rate out of total ischemic incidence
        self.statsDf[&#39;% recanalization rate out of total ischemic incidence&#39;] = self.statsDf[&#39;% patients recanalized&#39;]

        #### CT/MRI ####
        # suspected stroke patients undergoing CT/MRI
        self.statsDf[&#39;# suspected stroke patients undergoing CT/MRI&#39;] = self.statsDf[&#39;# CT/MRI - performed&#39;]

        # % suspected stroke patients undergoing CT/MRI
        self.statsDf[&#39;% suspected stroke patients undergoing CT/MRI&#39;] = self.statsDf[&#39;% CT/MRI - performed&#39;]

        #### DYSPHAGIA SCREENING ####
        # all stroke patients undergoing dysphagia screening
        self.statsDf[&#39;# all stroke patients undergoing dysphagia screening&#39;] = self.statsDf[&#39;# dysphagia screening - Guss test&#39;] + self.statsDf[&#39;# dysphagia screening - Other test&#39;]

        # % all stroke patients undergoing dysphagia screening
        self.statsDf[&#39;% all stroke patients undergoing dysphagia screening&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# all stroke patients undergoing dysphagia screening&#39;]/(x[&#39;# all stroke patients undergoing dysphagia screening&#39;] + x[&#39;# dysphagia screening - Not done&#39;])) * 100), 2) if (x[&#39;# all stroke patients undergoing dysphagia screening&#39;] + x[&#39;# dysphagia screening - Not done&#39;]) &gt; 0 else 0, axis=1)

        #### ISCHEMIC STROKE + NO AFIB + ANTIPLATELETS ####
        non_transferred_antiplatelets = antithrombotics[~antithrombotics[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5,6])]
        #antithrombotics_discharged_home = antithrombotics[antithrombotics[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        # Get temporary dataframe with patients who have prescribed antithrombotics and ischemic stroke
        antiplatelets = non_transferred_antiplatelets[non_transferred_antiplatelets[&#39;STROKE_TYPE&#39;].isin([1])]
        #antiplatelets = antithrombotics[antithrombotics[&#39;STROKE_TYPE&#39;].isin([1])]
        #antiplatelets = antithrombotics_discharged_home[antithrombotics_discharged_home[&#39;STROKE_TYPE&#39;].isin([1])]
        # Filter temporary dataframe and get only patients who have not been detected or not known for aFib flutter. 
        antiplatelets = antiplatelets[antiplatelets[&#39;AFIB_FLUTTER&#39;].isin([4, 5])]
        # Get patients who have prescribed antithrombotics 
        except_recommended = antiplatelets[~antiplatelets[&#39;ANTITHROMBOTICS&#39;].isin([9])]

        # Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.
        self.statsDf[&#39;except_recommended_patients&#39;] = self._count_patients(dataframe=except_recommended)
        # Get temporary dataframe groupby protocol ID and antithrombotics column
        self.tmp = antiplatelets.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
        # ischemic stroke patients discharged with antiplatelets
        self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# ischemic stroke patients discharged with antiplatelets&#39;)
        # % ischemic stroke patients discharged with antiplatelets
        self.statsDf[&#39;% ischemic stroke patients discharged with antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# ischemic stroke patients discharged with antiplatelets&#39;]/x[&#39;except_recommended_patients&#39;]) * 100), 2) if x[&#39;except_recommended_patients&#39;] &gt; 0 else 0, axis=1)

        # discharged home
        antiplatelets_discharged_home = antiplatelets[antiplatelets[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        
        if (antiplatelets_discharged_home.empty):
            # Get temporary dataframe groupby protocol ID and antithrombotics column
            self.tmp = antiplatelets.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
            # ischemic stroke patients discharged with antiplatelets
            self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# ischemic stroke patients discharged home with antiplatelets&#39;)
            # % ischemic stroke patients discharged with antiplatelets
            self.statsDf[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;]/x[&#39;except_recommended_patients&#39;]) * 100), 2) if x[&#39;except_recommended_patients&#39;] &gt; 0 else 0, axis=1)
            self.statsDf[&#39;except_recommended_discharged_home_patients&#39;] = self.statsDf[&#39;except_recommended_patients&#39;]
        else:
            # Get temporary dataframe groupby protocol ID and antithrombotics column
            self.tmp = antiplatelets_discharged_home.groupby([&#39;Protocol ID&#39;, &#39;ANTITHROMBOTICS&#39;]).size().to_frame(&#39;count&#39;).reset_index()
            # Get patients who have prescribed antithrombotics 
            except_recommended_discharged_home = except_recommended[except_recommended[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]

            # Get number of patients who have prescribed antithrombotics and ischemic stroke, have not been detected or not known for aFib flutter.
            self.statsDf[&#39;except_recommended_discharged_home_patients&#39;] = self._count_patients(dataframe=except_recommended_discharged_home)
            # ischemic stroke patients discharged with antiplatelets
            self.statsDf = self._get_values_for_factors(column_name=&#34;ANTITHROMBOTICS&#34;, value=1, new_column_name=&#39;# ischemic stroke patients discharged home with antiplatelets&#39;)
            # % ischemic stroke patients discharged with antiplatelets
            self.statsDf[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;]/x[&#39;except_recommended_discharged_home_patients&#39;]) * 100), 2) if x[&#39;except_recommended_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# ischemic stroke patients discharged (home) with antiplatelets&#39;] = self.statsDf.apply(lambda x: x[&#39;# ischemic stroke patients discharged with antiplatelets&#39;] if x[&#39;# ischemic stroke patients discharged with antiplatelets&#39;] &gt; x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;] else x[&#39;# ischemic stroke patients discharged home with antiplatelets&#39;], axis=1)
        self.statsDf[&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;] = self.statsDf.apply(lambda x: x[&#39;% ischemic stroke patients discharged with antiplatelets&#39;] if x[&#39;% ischemic stroke patients discharged with antiplatelets&#39;] &gt; x[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;] else x[&#39;% ischemic stroke patients discharged home with antiplatelets&#39;], axis=1)

        # afib patients discharged with anticoagulants
        self.statsDf[&#39;# afib patients discharged with anticoagulants&#39;] = self._count_patients(dataframe=anticoagulants_prescribed)
        # Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics or with nothign (ANTITHROMBOTICS = 10)
        afib_detected_discharged_home = afib_flutter_detected[(~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1, 9]))]
        # Get afib patients discharged and not dead
        self.statsDf[&#39;afib_detected_discharged_patients&#39;] = self._count_patients(dataframe=afib_detected_discharged_home)
        # % afib patients discharged with anticoagulants        
        #self.statsDf[&#39;% afib patients discharged with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged with anticoagulants&#39;]/(x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;])) * 100), 2) if (x[&#39;afib_flutter_detected_patients&#39;] - x[&#39;afib_flutter_detected_dead_patients&#39;]) &gt; 0 else 0, axis=1)
        self.statsDf[&#39;% afib patients discharged with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged with anticoagulants&#39;]/x[&#39;afib_detected_discharged_patients&#39;]) * 100), 2) if (x[&#39;afib_detected_discharged_patients&#39;]) &gt; 0 else 0, axis=1)
        
        # Get temporary dataframe with patients who have prescribed anticoagulats and were discharged home 
        non_trasferred_anticoagulants = anticoagulants_prescribed[~anticoagulants_prescribed[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5,6])]
        anticoagulants_prescribed_discharged_home = non_trasferred_anticoagulants[non_trasferred_anticoagulants[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        #anticoagulants_prescribed_discharged_home = anticoagulants_prescribed[anticoagulants_prescribed[&#39;DISCHARGE_DESTINATION&#39;].isin([1])]
        # Get temporary dataframe with patients who have been discharge at home with detected aFib flutter and with prescribed antithrombotics
        #afib_detected_discharged_home = afib_flutter_detected[(afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([1])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([9]))]
        afib_detected_discharged_home = afib_flutter_detected[(afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([1])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1,9])) &amp; (~afib_flutter_detected[&#39;RECANALIZATION_PROCEDURES&#39;].isin([5,6]))]

        # Check if temporary dataframe is empty. If yes, the value is calculated not only for discharged home, but only dead patients are excluded
        if (anticoagulants_prescribed_discharged_home.empty):
            # afib patients discharged home with anticoagulants 
            anticoagulants_prescribed_discharged_home = anticoagulants_prescribed[~anticoagulants_prescribed[&#39;DISCHARGE_DESTINATION&#39;].isin([5])]
            # Get temporary dataframe with patients who are not dead with detected aFib flutter and with prescribed antithrombotics 
            afib_detected_discharged_home = afib_flutter_detected[(~afib_flutter_detected[&#39;DISCHARGE_DESTINATION&#39;].isin([5])) &amp; (~afib_flutter_detected[&#39;ANTITHROMBOTICS&#39;].isin([1,9]))]
            # Get # afib patients discharged home with anticoagulants
            self.statsDf[&#39;# afib patients discharged home with anticoagulants&#39;] = self._count_patients(dataframe=anticoagulants_prescribed_discharged_home)
            # Get afib patients discharged and not dead
            self.statsDf[&#39;afib_detected_discharged_home_patients&#39;] = self._count_patients(dataframe=afib_detected_discharged_home)
            # Get % afib patients discharge with anticoagulants and not dead
            self.statsDf[&#39;% afib patients discharged home with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged home with anticoagulants&#39;]/x[&#39;afib_detected_discharged_home_patients&#39;]) * 100), 2) if x[&#39;afib_detected_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)
        else:
            # Get # afib patients discharged home with anticoagulants   
            self.statsDf[&#39;# afib patients discharged home with anticoagulants&#39;] = self._count_patients(dataframe=anticoagulants_prescribed_discharged_home)
            # Get afib patients discharged home 
            self.statsDf[&#39;afib_detected_discharged_home_patients&#39;] = self._count_patients(dataframe=afib_detected_discharged_home)
            # Get % afib patients discharged home with anticoagulants
            self.statsDf[&#39;% afib patients discharged home with anticoagulants&#39;] = self.statsDf.apply(lambda x: round(((x[&#39;# afib patients discharged home with anticoagulants&#39;]/x[&#39;afib_detected_discharged_home_patients&#39;]) * 100), 2) if x[&#39;afib_detected_discharged_home_patients&#39;] &gt; 0 else 0, axis=1)

        self.statsDf[&#39;# afib patients discharged (home) with anticoagulants&#39;] = self.statsDf.apply(lambda x: x[&#39;# afib patients discharged with anticoagulants&#39;] if x[&#39;% afib patients discharged with anticoagulants&#39;] &gt; x[&#39;% afib patients discharged home with anticoagulants&#39;] else x[&#39;# afib patients discharged home with anticoagulants&#39;], axis=1)
        self.statsDf[&#39;% afib patients discharged (home) with anticoagulants&#39;] = self.statsDf.apply(lambda x: x[&#39;% afib patients discharged with anticoagulants&#39;] if x[&#39;% afib patients discharged with anticoagulants&#39;] &gt; x[&#39;% afib patients discharged home with anticoagulants&#39;] else x[&#39;% afib patients discharged home with anticoagulants&#39;], axis=1)

        #### STROKE UNIT ####
        # stroke patients treated in a dedicated stroke unit / ICU
        self.statsDf[&#39;# stroke patients treated in a dedicated stroke unit / ICU&#39;] = self.statsDf[&#39;# patients hospitalized in stroke unit / ICU&#39;]

        # % stroke patients treated in a dedicated stroke unit / ICU    
        self.statsDf[&#39;% stroke patients treated in a dedicated stroke unit / ICU&#39;] = self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;]

        # % stroke patients treated in a dedicated stroke unit / ICU (2nd)
        self.statsDf[&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;] = self.statsDf[&#39;% patients hospitalized in stroke unit / ICU&#39;]

        # Create temporary dataframe to calculate final award 
        self.angels_awards_tmp = self.statsDf[[self.total_patient_column, &#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;, &#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;, &#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;, &#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;, &#39;% recanalization rate out of total ischemic incidence&#39;, &#39;% suspected stroke patients undergoing CT/MRI&#39;, &#39;% all stroke patients undergoing dysphagia screening&#39;, &#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;, &#39;% afib patients discharged (home) with anticoagulants&#39;, &#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;, &#39;# patients eligible thrombectomy&#39;, &#39;# patients eligible thrombolysis&#39;]]
        self.statsDf.fillna(0, inplace=True)

        self.angels_awards_tmp[&#39;Proposed Award&#39;] = self.angels_awards_tmp.apply(lambda x: self._get_final_award(x), axis=1)
        self.statsDf[&#39;Proposed Award&#39;] = self.angels_awards_tmp[&#39;Proposed Award&#39;] 

        self.statsDf.rename(columns={&#34;Protocol ID&#34;: &#34;Site ID&#34;}, inplace=True)

        self.sites = self._get_sites(self.statsDf)

    def _get_final_award(self, x):
        &#39;&#39;&#39; Get the final award. Based on values in the given columns calculate the proposed award for each row in the resulted statistics. 
        
        Args:
            x: the row from the dataframe (self.angels_awards_tmp)
        Returns:
            award: the proposed award (NONE, DIAMOND, PLATINUM, GOLD)
        &#39;&#39;&#39;
        # Check if site gets some award
        if x[self.total_patient_column] == False:
            award = &#34;NONE&#34;
        else:
            award = &#34;TRUE&#34;

        thrombolysis_pts = x[&#39;# patients eligible thrombolysis&#39;]
        
        thrombolysis_therapy_lt_60min = x[&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;]
        

        if award == &#34;TRUE&#34;:
            if thrombolysis_pts == 0:
                award = &#34;DIAMOND&#34;
            else:
                if (float(thrombolysis_therapy_lt_60min) &gt;= 50 and float(thrombolysis_therapy_lt_60min) &lt;= 74.99):
                    award = &#34;GOLD&#34;
                elif (float(thrombolysis_therapy_lt_60min) &gt;= 75):
                    award = &#34;DIAMOND&#34;
                else: 
                    award = &#34;NONE&#34;

        thrombolysis_therapy_lt_45min = x[&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;]

        if award != &#34;NONE&#34;:
            if thrombolysis_pts == 0:
                award = &#34;DIAMOND&#34;
            else:
                if (float(thrombolysis_therapy_lt_45min) &lt;= 49.99):
                    if (award != &#34;GOLD&#34; or award == &#34;DIAMOND&#34;):
                        award = &#34;PLATINUM&#34;
                elif (float(thrombolysis_therapy_lt_45min) &gt;= 50):
                    if (award != &#34;GOLD&#34;):
                        award = &#34;DIAMOND&#34;
                else:
                    award = &#34;NONE&#34;

        thrombectomy_pts = x[&#39;# patients eligible thrombectomy&#39;]
        if thrombectomy_pts != 0:
            thrombectomy_therapy_lt_90min = x[&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;]
            if award != &#34;NONE&#34;:
                if (float(thrombectomy_therapy_lt_90min) &gt;= 50 and float(thrombectomy_therapy_lt_90min) &lt;= 74.99):
                    if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                        award = &#34;GOLD&#34;
                elif (float(thrombectomy_therapy_lt_90min) &gt;= 75):
                    if (award == &#34;DIAMOND&#34;):
                        award = &#34;DIAMOND&#34;
                else: 
                    award = &#34;NONE&#34;

            thrombectomy_therapy_lt_60min = x[&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;]
            if award != &#34;NONE&#34;:
                if (float(thrombectomy_therapy_lt_60min) &lt;= 49.99):
                    if (award != &#34;GOLD&#34; or award == &#34;DIAMOND&#34;):
                        award = &#34;PLATINUM&#34;
                elif (float(thrombectomy_therapy_lt_60min) &gt;= 50):
                    if (award == &#34;DIAMOND&#34;):
                        award = &#34;DIAMOND&#34;
                else:
                    award = &#34;NONE&#34;

        recan_rate = x[&#39;% recanalization rate out of total ischemic incidence&#39;]
        if award != &#34;NONE&#34;:
            if (float(recan_rate) &gt;= 5 and float(recan_rate) &lt;= 14.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(recan_rate) &gt;= 15 and float(recan_rate) &lt;= 24.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(recan_rate) &gt;= 25):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        ct_mri = x[&#39;% suspected stroke patients undergoing CT/MRI&#39;]
        if award != &#34;NONE&#34;:
            if (float(ct_mri) &gt;= 80 and float(ct_mri) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(ct_mri) &gt;= 85 and float(ct_mri) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(ct_mri) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        dysphagia_screening = x[&#39;% all stroke patients undergoing dysphagia screening&#39;]
        if award != &#34;NONE&#34;:
            if (float(dysphagia_screening) &gt;= 80 and float(dysphagia_screening) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(dysphagia_screening) &gt;= 85 and float(dysphagia_screening) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(dysphagia_screening) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        discharged_with_antiplatelets_final = x[&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;]
        if award != &#34;NONE&#34;:
            if (float(discharged_with_antiplatelets_final) &gt;= 80 and float(discharged_with_antiplatelets_final) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(discharged_with_antiplatelets_final) &gt;= 85 and float(discharged_with_antiplatelets_final) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(discharged_with_antiplatelets_final) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        discharged_with_anticoagulants_final = x[&#39;% afib patients discharged (home) with anticoagulants&#39;]
        if award != &#34;NONE&#34;:
            if (float(discharged_with_anticoagulants_final) &gt;= 80 and float(discharged_with_anticoagulants_final) &lt;= 84.99):
                if (award == &#34;PLATINUM&#34; or award == &#34;DIAMOND&#34;):
                    award = &#34;GOLD&#34;
            elif (float(discharged_with_anticoagulants_final) &gt;= 85 and float(discharged_with_anticoagulants_final) &lt;= 89.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(discharged_with_anticoagulants_final) &gt;= 90):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        stroke_unit = x[&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;]
        if award != &#34;NONE&#34;:
            if (float(stroke_unit) &lt;= 0.99):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;PLATINUM&#34;
            elif (float(stroke_unit) &gt;= 1):
                if (award == &#34;DIAMOND&#34;):
                    award = &#34;DIAMOND&#34;
            else:
                award = &#34;NONE&#34;

        return award

    def _count_patients(self, dataframe):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            dataframe (dataframe): The dataframe with raw data. 

        Returns:
            dataframe (dataframe): The column with number of patients. 
        &#34;&#34;&#34;

        tmpDf = dataframe.groupby([&#39;Protocol ID&#39;]).size().reset_index(name=&#39;count_patients&#39;)
        factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
        factorDf.fillna(0, inplace=True)

        return factorDf[&#39;count_patients&#39;]

    def _get_values_only_columns(self, column_name, value, dataframe):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (string): The name of column for which we are want calculate number of patients. 
            dataframe (dataframe): The dataframe with raw data. 
            value (int): The integers value represents specific value from the dataframe[column_name]. 

        Returns:
            dataframe (dataframe): The column with number of patients. 
        &#34;&#34;&#34;

        tmpDf = dataframe[dataframe[column_name] == value].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
        factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
        factorDf.fillna(0, inplace=True)

        return factorDf[&#39;count&#39;]

    def _get_values_for_factors(self, column_name, value, new_column_name, df=None):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (str): The name of column for which we are want calculate number of patients. 
            value (int): The integers value represents specific value from the dataframe[column_name]. 
            new_column_name (str): The name of new column name. 

        Returns:
            dataframe (dataframe): The statsDf to which new created column was appended. 
        &#34;&#34;&#34;             
        if (self.tmp[column_name].dtype != np.number):
            value = str(value)
        else:
            value = value 

        tmpDf = self.tmp[self.tmp[column_name] == value].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
        factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
        factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
        factorDf.fillna(0, inplace=True)

        &#34;&#34;&#34;
        else:
            if (df[column_name].dtype != np.number):
                value = str(value)
            else:
                value = value 

            tmpDf = df[df[column_name] == value].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)
        &#34;&#34;&#34;
        return factorDf

    def _get_values_for_factors_more_values(self, column_name, value, new_column_name, df=None):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (str): The name of column for which we are want calculate number of patients. 
            value (list): The list of integers representing specific values from the dataframe[column_name]. 
            new_column_name (str): The name of new column name. 

        Returns:
            dataframe (dataframe): The statsDf to which new created column was appended. 
        &#34;&#34;&#34;
        if df is None:
            tmpDf = self.tmp[self.tmp[column_name].isin(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)
        else:
            tmpDf = df[df[column_name].isin(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)

        return factorDf

    def _get_values_for_factors_containing(self, column_name, value, new_column_name, df=None):
        &#34;&#34;&#34; Returns the column with number of patients group by Protocol ID. 

        Keyword arguments:
            column_name (str): The name of column for which we are want calculate number of patients. 
            value (str): The str of integers representing specific values from the dataframe[column_name]. 
            new_column_name (str): The name of new column name. 

        Returns:
            dataframe (dataframe): The statsDf to which new created column was appended. 
        &#34;&#34;&#34;
        if df is None:
            tmpDf = self.tmp[self.tmp[column_name].str.contains(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)
        else:
            tmpDf = df[df[column_name].str.contains(value)].reset_index()[[&#39;Protocol ID&#39;, &#39;count&#39;]]
            tmpDf = tmpDf.groupby(&#39;Protocol ID&#39;).sum().reset_index()
            factorDf = self.statsDf.merge(tmpDf, how=&#39;outer&#39;)
            factorDf.rename(columns={&#39;count&#39;: new_column_name}, inplace=True)
            factorDf.fillna(0, inplace=True)

        return factorDf

    def _get_ctmri_delta(self, hosp_time, ct_time):
        &#34;&#34;&#34; Calculate difference between two times. 

        Args:
            hospital_time: The time of hospitalization
            ct_time: The time when CT has been perfrmed. 
        Returns:
            The calculated difference in minutes.
        &#34;&#34;&#34;
        timeformat = &#39;%H:%M:%S&#39;

        #print(&#39;Hosp time: {0}/{1}, CT_TIME: {2}/{3}&#39;.format(hosp_time, type(hosp_time), ct_time, type(ct_time)))
        # print(ct_time, hosp_time)
        # Check if both time are not None if yes, return 0 else return tdelta
        if hosp_time is None or ct_time is None or pd.isnull(hosp_time) or pd.isnull(ct_time):
            tdeltaMin = 0
        elif hosp_time == 0 or ct_time == 0:
            tdeltaMin = 0
        else:
            if isinstance(ct_time, time) and isinstance(hosp_time, time):
                tdelta = datetime.combine(date.today(), ct_time) - datetime.combine(date.today(), hosp_time)
            elif isinstance(ct_time, time):
                tdelta = datetime.combine(date.today(), ct_time) - datetime.strptime(hosp_time, timeformat)
            elif isinstance(hosp_time, time):
                tdelta = datetime.strptime(ct_time, timeformat) - datetime.strptime(hosp_time, timeformat)
            else:
                tdelta = datetime.strptime(ct_time, timeformat) - datetime.strptime(hosp_time, timeformat)      
            tdeltaMin = tdelta.total_seconds()/60.0

        if tdeltaMin &gt; 60:
            res = 2
        elif tdeltaMin &lt;= 60 and tdeltaMin &gt; 0:
            res = 1
        else:
            res = -2
        return res

    
    def _return_dataset(self):
        &#34;&#34;&#34;Return the raw dataframe.&#34;&#34;&#34;

        return self.df

    def _return_stats(self):
        &#34;&#34;&#34;Return the dataframe with calculated statistics.&#34;&#34;&#34;

        return self.statsDf

    def _get_sites(self, df):
        &#34;&#34;&#34;Return list of sites in the dataframes.&#34;&#34;&#34;

        site_ids = df[&#39;Site ID&#39;].tolist()
        siteSet = set(site_ids)
        siteList = list(siteSet)
        return siteList

    def _return_sites(self):

        return self.sites</code></pre>
</details>
</dd>
<dt id="resqdb.Calculation.FilterDataset"><code class="flex name class">
<span>class <span class="ident">FilterDataset</span></span>
<span>(</span><span>df, country=None, date1=None, date2=None)</span>
</code></dt>
<dd>
<section class="desc"><p>Filter dataset by country and the time period. </p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>df</code></strong></dt>
<dd>The preprocessed dataframe</dd>
<dt><strong><code>country</code></strong></dt>
<dd>The country code of country which should be included in the resulted calculation (default: None)</dd>
<dt><strong><code>date1</code></strong></dt>
<dd>The first daate included in the filtered dataframe (default: None)</dd>
<dt><strong><code>date2</code></strong></dt>
<dd>The last date included in the filtered dataframe (default: None)</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>The filtered dataframe.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class FilterDataset:
    &#34;&#34;&#34; Filter dataset by country and the time period. 

    Args:
        df: The preprocessed dataframe
        country: The country code of country which should be included in the resulted calculation (default: None)
        date1: The first daate included in the filtered dataframe (default: None)
        date2: The last date included in the filtered dataframe (default: None)
    Returns:
        The filtered dataframe. 
    &#34;&#34;&#34;

    def __init__(self, df, country=None, date1=None, date2=None):

        # Create log file in the working folder
        log_file = os.path.join(os.getcwd(), &#39;debug.log&#39;)
        logging.basicConfig(filename=log_file,
                            filemode=&#39;a&#39;,
                            format=&#39;%(asctime)s,%(msecs)d %(name)s %(levelname)s %(message)s&#39;,
                            datefmt=&#39;%H:%M:%S&#39;,
                            level=logging.DEBUG)

        self.fdf = df.copy()
        self.country = country
        self.date1 = date1
        self.date2 = date2

        if self.country is not None:
            # Append &#34;_&#34; to the country code, because e.g. ES_MD was included in dataset for MD as well.
            country = self.country + &#34;_&#34; 

            self.fdf = self._filter_by_country(country=country)
            logging.info(&#39;FilterDataset: Data have been filtered for country {0}!&#39;.format(self.country)) 
        
        if self.date1 is not None and self.date2 is not None:

            self.fdf = self._filter_by_date()
            logging.info(&#39;FilterDataset: Data have been filtered for date {0} - {1}!&#39;.format(self.date1, self.date2))
        
        
    def _filter_by_country(self, country):
        &#34;&#34;&#34; Return dataframe containing only rows for the given country. 
        
        Args:
            country: The changed country code.
        Returns:
            The filtered dataframe. 
        &#34;&#34;&#34;
        df = self.fdf[self.fdf[&#39;Protocol ID&#39;].str.startswith(self.country) == True]

        return df

    def _filter_by_date(self):
        &#34;&#34;&#34; Return dataframe containing only rows where discharge date is between these two dates. 

        Args: 
            date1: The first date included in the filtered dataframe
            date2: The last date included in the filtered dataframe
        Returns: 
            The filtered dataframe
        &#34;&#34;&#34;
        if isinstance(self.date1, datetime):
            self.date1 = self.date1.date()
        if isinstance(self.date2, datetime):
            self.date2 = self.date2.date()

        df = self.fdf[(self.fdf[&#39;DISCHARGE_DATE&#39;] &gt;= self.date1) &amp; (self.fdf[&#39;DISCHARGE_DATE&#39;] &lt;= self.date2)]

        return df</code></pre>
</details>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="resqdb" href="index.html">resqdb</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="resqdb.Calculation.ComputeStats" href="#resqdb.Calculation.ComputeStats">ComputeStats</a></code></h4>
</li>
<li>
<h4><code><a title="resqdb.Calculation.FilterDataset" href="#resqdb.Calculation.FilterDataset">FilterDataset</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.6.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>