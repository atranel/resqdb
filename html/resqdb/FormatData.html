<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.6.2" />
<title>resqdb.FormatData API documentation</title>
<meta name="description" content="File name: FormatData.py
Package: resq
Written by: Marie Jankujova - jankujova.marie@fnusa.cz on 03/2019
Version: v1.0
Version comment: This script is â€¦" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>resqdb.FormatData</code></h1>
</header>
<section id="section-intro">
<p>File name: FormatData.py
Package: resq
Written by: Marie Jankujova - jankujova.marie@fnusa.cz on 03/2019
Version: v1.0
Version comment: This script is used to generate formatted preprocessed data, presentations or excel files.</p>
<details class="source">
<summary>Source code</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
&#34;&#34;&#34;
File name: FormatData.py
Package: resq
Written by: Marie Jankujova - jankujova.marie@fnusa.cz on 03/2019
Version: v1.0
Version comment: This script is used to generate formatted preprocessed data, presentations or excel files. 
&#34;&#34;&#34;

# Import default packages
import os
import sys
from datetime import datetime, date
import zipfile
import sqlite3
import csv
import pandas as pd
import numpy as np
import xlsxwriter
from xlsxwriter.utility import xl_rowcol_to_cell, xl_col_to_name
import logging
from collections import defaultdict
import pytz

class GeneratePreprocessedData:
    &#34;&#34;&#34;
    Generate preprocessed data as table. One sheet are preprocessed data, 2nd sheet are legend data.    
    &#34;&#34;&#34;

    def __init__(self, df, split_sites=False, site=None, report=None, quarter=None, country_code=None, csv=False):
        &#34;&#34;&#34;Create object of preprocessed data. 

        Args:
            df: preprocessed data in datafraem
            split_sites: True if preprocessed data has to be generated per site (default: False)
            site: Protocol ID of site (default: None)
            country_code: country code (default: None)
            report: type of the report, eg. quarter (default: None)
            period: type of the period, eg. H1_2018 (default: None)
        &#34;&#34;&#34;
        # Create log file in the working folder
        log_file = os.path.join(os.getcwd(), &#39;debug.log&#39;)
        logging.basicConfig(filename=log_file,
                            filemode=&#39;a&#39;,
                            format=&#39;%(asctime)s,%(msecs)d %(name)s %(levelname)s %(message)s&#39;,
                            datefmt=&#39;%H:%M:%S&#39;,
                            level=logging.DEBUG)

        self.df = df
        self.split_sites = split_sites
        self.report = report
        self.quarter = quarter
        self.country_code = country_code
        self.csv = csv

        # If Site is not None, filter dataset according to site code
        if site is not None:
            self.country_code = site.split(&#34;_&#34;)[0]
            df = self.df[self.df[&#39;Protocol ID&#39;].str.contains(site) == True]
            # Generate preprocessed data for site
            self._generate_preprocessed_data(df=df, site_code=site)
            logging.info(&#39;Preprocessed data: The preprocessed data were generated for site {0}&#39;.format(site))
        
        # Generate formatted statistics per site + country as site is included
        if (split_sites) and site is None:
            logging.info(&#39;Preprocessed data: Generate preprocessed data per site.&#39;)
            # Get set of all site ids
            site_ids = set(self.df[&#39;Protocol ID&#39;].tolist())
            #site_ids = set(site_ids)  
            for i in site_ids:
                df = self.df[self.df[&#39;Protocol ID&#39;].str.contains(i) == True]
                self._generate_preprocessed_data(df=df, site_code=i)
                logging.info(&#39;Preprocessed data: The preprocessed data were generated for site {0}&#39;.format(site))

        self._generate_preprocessed_data(self.df, site_code=None)
        logging.info(&#39;Preprocessed data: The preprocessed data were generate for all data.&#39;)

    def _generate_preprocessed_data(self, df, site_code):
        &#34;&#34;&#34;
        Generate preprocessed data with legend. 

        Keyword arguments: 
            df = filtered dataframe
            site_code = code of site included in the dataframe
        &#34;&#34;&#34;
        
        if site_code is not None:
            output_file = self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;_preprocessed_data.xlsx&#34;
        elif site_code is None and self.report is None and self.country_code is None and self.quarter is None:
            output_file = &#34;preprocessed_data.xlsx&#34;
        else:
            output_file = self.report + &#34;_&#34; + self.country_code + &#34;_&#34; + self.quarter + &#34;_preprocessed_data.xlsx&#34;
        
        #output_file = &#34;preprocessed_data.xlsx&#34;
        
        df = df.copy()
        
        # Convert dates to strings
        dateformat = &#34;%m/%d/%Y&#34;
        timeformat = &#34;%H:%M&#34;
        def convert_to_string(datetime, format):
            if datetime is None or datetime is np.nan:
                return datetime
            else:
                return datetime.strftime(format)
        
        print(csv)
        if not csv:
            #if df[&#39;VISIT_DATE&#39;].dtype != np.object:
            print(df[&#39;VISIT_DATE&#39;].dtype)
            df[&#39;VISIT_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;VISIT_DATE&#39;], dateformat), axis=1)
            # if df[&#39;VISIT_DATE_OLD&#39;].dtype != np.object:
            df[&#39;VISIT_DATE_OLD&#39;] = df.apply(lambda x: convert_to_string(x[&#39;VISIT_DATE_OLD&#39;], dateformat), axis=1)
            #if df[&#39;VISIT_TIME&#39;].dtype != np.object:
            df[&#39;VISIT_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;VISIT_TIME&#39;], timeformat), axis=1)
            df[&#39;HOSPITAL_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_DATE&#39;], dateformat), axis=1)
            #if df[&#39;HOSPITAL_DATE_OLD&#39;].dtype != np.object:
            df[&#39;HOSPITAL_DATE_OLD&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_DATE_OLD&#39;], dateformat), axis=1)
            #if df[&#39;HOSPITAL_TIME&#39;].dtype != np.object:
            df[&#39;HOSPITAL_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_TIME&#39;], timeformat), axis=1)
            print(df[&#39;DISCHARGE_DATE&#39;].dtype)
            df[&#39;DISCHARGE_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;DISCHARGE_DATE&#39;], dateformat), axis=1)
            #if df[&#39;DISCHARGE_DATE_OLD&#39;].dtype != np.object:
            df[&#39;DISCHARGE_DATE_OLD&#39;] = df.apply(lambda x: convert_to_string(x[&#39;DISCHARGE_DATE_OLD&#39;], dateformat), axis=1)
            #if df[&#39;IVT_ONLY_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;IVT_ONLY_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_ONLY_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_ONLY_BOLUS_TIME&#39;].dtype != np.object:
            df[&#39;IVT_ONLY_BOLUS_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_ONLY_BOLUS_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_TBY_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_TBY_BOLUS_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_BOLUS_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_BOLUS_TIME&#39;], timeformat), axis=1)
            # if df[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_ONLY_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;TBY_ONLY_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_ONLY_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_ONLY_PUNCTURE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_ONLY_PUNCTURE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_ONLY_PUNCTURE_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_TBY_REFER_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_REFER_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_REFER_ADMISSION_TIME&#39;], timeformat), axis=1)
            #  if df[&#39;IVT_TBY_REFER_BOLUS_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_REFER_BOLUS_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_REFER_BOLUS_TIME&#39;], timeformat), axis=1)
            #  if df[&#39;IVT_TBY_REFER_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_REFER_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_REFER_DISCHARGE_TIME&#39;], timeformat), axis=1)
            # if df[&#39;TBY_REFER_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_DISCHARGE_TIME&#39;], timeformat), axis=1)
            # if df[&#39;TBY_REFER_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_ADMISSION_TIME&#39;], timeformat), axis=1)
             # if df[&#39;TBY_REFER_ALL_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_ALL_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_ALL_DISCHARGE_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_REFER_ALL_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_ALL_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_ALL_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_REFER_LIM_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_LIM_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_LIM_DISCHARGE_TIME&#39;], timeformat), axis=1)
            # if df[&#39;TBY_REFER_LIM_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_LIM_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_LIM_ADMISSION_TIME&#39;], timeformat), axis=1)
            df[&#39;CT_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;CT_TIME&#39;], timeformat), axis=1)
        else:
            df[&#39;HOSPITAL_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_DATE&#39;], dateformat), axis=1)
            df[&#39;DISCHARGE_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;DISCHARGE_DATE&#39;], dateformat), axis=1)

        # Replace NAN values with 0
        df.fillna(value=&#34;&#34;, inplace=True)

        # Create workbook
        workbook = xlsxwriter.Workbook(output_file)
        logging.info(&#39;Preprocessed data: The workbook was created.&#39;)
        # Create worksheets
        preprocessed_data_sheet = workbook.add_worksheet(&#39;Preprocessed_raw_data&#39;)
        legend_sheet = workbook.add_worksheet(&#39;Legend_v2.0&#39;)
        additional_desc_sheet = workbook.add_worksheet(&#39;Additional_description&#39;)

        ### PREPROCESSED DATA
        preprocessed_data = df.values.tolist()
        # Set width of columns
        preprocessed_data_sheet.set_column(0, 150, 30)
        # Number of columns/rows
        ncol = len(df.columns) - 1
        nrow = len(df)

        # Create header
        col = []
        for j in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = df.columns.tolist()[j]
            col.append(tmp)

        options = {&#39;data&#39;: preprocessed_data,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 1&#39;
                   }
        preprocessed_data_sheet.add_table(0, 0, nrow, ncol, options)
        logging.info(&#39;Preprocessed data: The sheet &#34;Preprocessed data&#34; was added.&#39;)

        ### LEGEND
        legend = pd.read_csv(os.path.join(os.path.dirname(__file__), &#39;tmp&#39;, &#39;legend.csv&#39;), sep=&#34;,&#34;, encoding=&#34;utf-8&#34;)
        legend.fillna(value=&#34;&#34;, inplace=True)
        legend_list = legend.values.tolist()

        labels = [&#39;Variable Name&#39;, &#39;Description&#39;, &#39;UNITS&#39;, &#39;Response Type&#39;, &#39;Response Options - text&#39;,
                  &#39;Response Options - value&#39;]

        legend_df = pd.DataFrame(legend_list, columns=labels)
        
        # set width of columns
        legend_sheet.set_column(0, 150, 30)
        # number of columns
        # add table into worksheet
        ncol = len(legend_df.columns) - 1
        nrow = len(legend_df)
        col = []
        for k in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = legend_df.columns.tolist()[k]
            # if (i &gt;= 2):
            #    tmp[&#39;total_function&#39;: &#39;sum&#39;]
            col.append(tmp)

        options = {&#39;data&#39;: legend_list,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 1&#39;
                   }
        legend_sheet.add_table(0, 0, nrow, ncol, options)
        logging.info(&#39;Preprocessed data: The sheet &#34;Legend&#34; was added.&#39;)

        ### ADDITIONAL INFO
        # Add table with changed column names and description
        labels = [&#39;Column names after preprocessing&#39;, &#39;Description&#39;]
        addition_list = [
            [&#39;VISIT_DATE_OLD&#39;, &#39;The original visit date.&#39;], 
            [&#39;HOSPITAL_DATE_OLD&#39;, &#39;The original hospital date.&#39;], 
            [&#39;DISCHARGE_DATE_OLD&#39;, &#39;The original discharge date.&#39;],
            [&#39;HOSPITAL_DAYS_OLD&#39;, &#39;The hospital days calculated from original hospital and discharge date.&#39;],
            [&#39;VISIT_DATE&#39;, &#39;The fixed visit date.&#39;],
            [&#39;HOSPITAL_DATE&#39;, &#39;The fixed hospital date (fixed in the case that hospital days were negative or greater than 300 days).&#39;],
            [&#39;DISCHARGE_DATE&#39;, &#39;The fixed discharge date (fixed in the case that hospital days were negative or greater than 300 days).&#39;],
            [&#39;HOSPITAL_DAYS&#39;, &#39;The hospital days calculated from fixed hospital and discharge dates.&#39;],
            [&#39;HOSPITAL_DAYS_FIXED&#39;, &#39;TRUE for fixed dates, FALSE for original dates.&#39;],
            [&#39;IVT_ONLY_NEEDLE_TIME_MIN&#39;, &#39;The column which contains needle time in minutes (bolus time - admission time).&#39;],
            [&#39;IVT_ONLY_NEEDLE_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 400, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_NEEDLE_TIME_MIN&#39;, &#39;The column which contains needle time in minutes (bolus time - admission time).&#39;],
            [&#39;IVT_TBY_NEEDLE_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 400, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_REFER_NEEDLE_TIME_MIN&#39;, &#39;The column which contains needle time in minutes (bolus time - admission time).&#39;],
            [&#39;IVT_TBY_REFER_NEEDLE_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 400, FALSE for unchanged values.&#39;],
            [&#39;TBY_ONLY_GROIN_TIME_MIN&#39;, &#39;The column which contains groin time in minutes (groin time - admission time).&#39;],
            [&#39;TBY_ONLY_GROIN_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_GROIN_TIME_MIN&#39;, &#39;The column which contains groin time in minutes (groin time - admission time).&#39;],
            [&#39;IVT_TBY_GROIN_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;IVT_TBY_REFER_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;TBY_REFER_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;TBY_REFER_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;TBY_REFER_ALL_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;TBY_REFER_LIM_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;]
        ]

        # set width of columns
        additional_desc_sheet.set_column(0, 10, 60)

        addition_df = pd.DataFrame(addition_list, columns=labels)
        ncol = len(addition_df.columns) - 1
        nrow = len(addition_df)
        col = []
        for k in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = addition_df.columns.tolist()[k]
            # if (i &gt;= 2):
            #    tmp[&#39;total_function&#39;: &#39;sum&#39;]
            col.append(tmp)

        options = {&#39;data&#39;: addition_list,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 1&#39;
                   }

        additional_desc_sheet.add_table(0, 0, nrow, ncol, options)
        logging.info(&#39;Preprocessed data: The sheet &#34;Additional info&#34; was added.&#39;)
    
        workbook.close()


class GenerateFormattedAngelsAwards:
    &#34;&#34;&#34;
    This class generate formatted statistics only for angels awards. 
    &#34;&#34;&#34;
    def __init__(self, df, report=None, quarter=None, minimum_patients=0):

        self.df = df
        self.report = report
        self.quarter = quarter
        self.minimum_patients = minimum_patients

        self.formate(self.df)

    def formate(self, df):

        if self.report is None and self.quarter is None:
            output_file = &#34;angels_awards.xslx&#34;
        else:
            output_file = self.report + &#34;_&#34; + self.quarter + &#34;_angels_awards.xlsx&#34;
            

        workbook1 = xlsxwriter.Workbook(output_file, {&#39;strings_to_numbers&#39;: True})
        # create worksheet
        worksheet = workbook1.add_worksheet()

        # set width of columns
        worksheet.set_column(0, 2, 15)
        worksheet.set_column(2, 20, 40)

        ncol = len(df.columns) - 1
        nrow = len(df) + 2

        col = []
        column_names = df.columns.tolist()
        for i in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] =column_names[i]
            col.append(tmp)

        statistics = df.values.tolist()
        colors = {
            &#34;angel_awards&#34;: &#34;#B87333&#34;,
            &#34;angel_resq_awards&#34;: &#34;#341885&#34;,
            &#34;columns&#34;: &#34;#3378B8&#34;,
            &#34;green&#34;: &#34;#A1CCA1&#34;,
            &#34;orange&#34;: &#34;#DF7401&#34;,
            &#34;gold&#34;: &#34;#FFDF00&#34;,
            &#34;platinum&#34;: &#34;#c0c0c0&#34;,
            &#34;black&#34;: &#34;#ffffff&#34;,
            &#34;red&#34;: &#34;#F45D5D&#34;
        }

        ################
        # angel awards #
        ################
        awards = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        awards_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        first_cell = xl_rowcol_to_cell(0, 2)
        last_cell = xl_rowcol_to_cell(0, ncol)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ESO ANGELS AWARDS&#39;, awards)
        for i in range(2, ncol + 1):
            cell = xl_rowcol_to_cell(1, i)
            worksheet.write(cell, &#39;&#39;, awards_color)

        # format for green color
        green = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;green&#34;)})

        # format for gold color
        gold = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;gold&#34;)})

        # format for platinum color
        plat = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;platinum&#34;)})

        # format for gold black
        black = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: &#39;#000000&#39;,
            &#39;color&#39;: colors.get(&#34;black&#34;)})

        # format for red color
        red = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;red&#34;)})


        # add table into worksheet
        options = {&#39;data&#39;: statistics,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 8&#39;
                   }

        first_col = xl_col_to_name(0)
        last_col = xl_col_to_name(ncol + 1)
        worksheet.set_column(first_col + &#34;:&#34; + last_col, 30)

        worksheet.add_table(2, 0, nrow, ncol, options)

        # total number of rows
        number_of_rows = len(statistics) + 2

        self.total_patients_column = &#39;# total patients &gt;= {0}&#39;.format(self.minimum_patients)
        # if cell contain TRUE in column &gt; 30 patients (DR) it will be colored to green
        awards = []
        row = 4
        while row &lt; nrow + 2:
            index = column_names.index(self.total_patients_column)
            cell_n = xl_col_to_name(index) + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                &#39;criteria&#39;: &#39;containing&#39;,
                                                &#39;value&#39;: &#39;TRUE&#39;,
                                                &#39;format&#39;: green})
            row += 1


        def angels_awards_ivt_60(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 60.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 50,
                                                    &#39;maximum&#39;: 74.99,
                                                    &#39;format&#39;: gold})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 75,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_60(column, coln=index)

        index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_60(column, coln=index)

        # angels_awards_ivt_60(&#39;D&#39;)


        def angels_awards_ivt_45(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 45.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                    &#39;value&#39;: 49.99,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 50,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_45(column, coln=index)

        index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_45(column, coln=index)

        # setting colors of cells according to their values
        def angels_awards_recan(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for recaalization procedures.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 5,
                                                    &#39;maximum&#39;: 14.99,
                                                    &#39;format&#39;: gold})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 15,
                                                    &#39;maximum&#39;: 24.99,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 25,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% recanalization rate out of total ischemic incidence&#39;)
        angels_awards_recan(column_name=xl_col_to_name(index), coln=index)
        #angels_awards_recan(&#39;F&#39;)


        def angels_awards_processes(column_name, coln, count=True):
            &#34;&#34;&#34;Add conditional formatting to angels awards for processes.&#34;&#34;&#34;
            count = count
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 80,
                                                    &#39;maximum&#39;: 84.99,
                                                    &#39;format&#39;: gold})

                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 85,
                                                    &#39;maximum&#39;: 89.99,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 90,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% suspected stroke patients undergoing CT/MRI&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
        index = column_names.index(&#39;% all stroke patients undergoing dysphagia screening&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
        index = column_names.index(&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
        index = column_names.index(&#39;% afib patients discharged (home) with anticoagulants&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)

        #angels_awards_processes(&#39;G&#39;, 4)
        #angels_awards_processes(&#39;H&#39;, 5)
        #angels_awards_processes(&#39;I&#39;, 6)
        #angels_awards_processes(&#39;J&#39;, 7)

        # setting colors of cells according to their values
        def angels_awards_hosp(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for hospitalization.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                    &#39;value&#39;: 0,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 0.99,
                                                    &#39;format&#39;: black})
                row += 1

        
        index = column_names.index(&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;)
        angels_awards_hosp(column_name=xl_col_to_name(index), coln=index)

        
        # set color for proposed angel award
        def proposed_award(column_name, coln):
            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;NONE&#39;,
                                                    &#39;format&#39;: green})
                row += 1

            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;GOLD&#39;,
                                                    &#39;format&#39;: gold})
                row += 1

            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;PLATINUM&#39;,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;DIAMOND&#39;,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;Proposed Award&#39;)
        column = xl_col_to_name(index)
        proposed_award(column, coln=index)
        #worksheet.write_column(3, index, awards)

        workbook1.close()


class GenerateFormattedStats:
    &#34;&#34;&#34;
    This class generate formatted statistics in .xslx file. For angel awards are set colored conditions. 
    
    Keyword arguments:
        df: the dataframe with statistcs
        country: True if country should be included as site (default: False)
        country_code: the code of country (default: None)
        split_sites: True if you want to generate individual file fo each site (default: False)
        site: the site code (default: None)
        report: the report name (default: None)
        quarter: the quarter name (default: None)
    &#34;&#34;&#34;
    def __init__(self, df, country=False, country_code=None, split_sites=False, site=None, report=None, quarter=None, comp=False, minimum_patients=0):

        self.df_unformatted = df.copy()
        self.df = df.copy()
        self.country_code = country_code
        self.report = report
        self.quarter = quarter
        self.comp = comp
        self.minimum_patients = minimum_patients
        self.total_patients_column = &#39;# total patients &gt;= {0}&#39;.format(self.minimum_patients)

        def delete_columns(columns):
            for i in columns:
                if i in self.df.columns:
                    self.df.drop([i], inplace=True, axis=1)
        # Drop tmp column 
        delete_columns([&#39;isch_patients&#39;, &#39;is_ich_patients&#39;, &#39;is_ich_tia_cvt_patients&#39;, &#39;is_ich_cvt_patients&#39;, &#39;is_tia_patients&#39;, &#39;is_ich_sah_cvt_patients&#39;, &#39;is_tia_cvt_patients&#39;, &#39;cvt_patients&#39;, &#39;ich_sah_patients&#39;, &#39;ich_patients&#39;,  &#39;sah_patients&#39;, &#39;discharge_subset_patients&#39;,&#39;discharge_subset_alive_patients&#39;, &#39;neurosurgery_patients&#39;, &#39;not_reffered_patients&#39;, &#39;reffered_patients&#39;, &#39;afib_detected_during_hospitalization_patients&#39;, &#39;afib_not_detected_or_not_known_patients&#39;, &#39;antithrombotics_patients&#39;, &#39;ischemic_transient_dead_patients&#39;, &#39;afib_flutter_not_detected_or_not_known_patients&#39;, &#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;, &#39;prescribed_antiplatelets_no_afib_patients&#39;, &#39;prescribed_antiplatelets_no_afib_dead_patients&#39;, &#39;afib_flutter_detected_patients&#39;, &#39;anticoagulants_recommended_patients&#39;, &#39;afib_flutter_detected_dead_patients&#39;, &#39;recommended_antithrombotics_with_afib_alive_patients&#39;, &#39;discharge_subset_same_centre_patients&#39;, &#39;discharge_subset_another_centre_patients&#39;, &#39;patients_eligible_recanalization&#39;, &#39;# patients having stroke in the hospital - No&#39;, &#39;% patients having stroke in the hospital - No&#39;, &#39;# recurrent stroke - No&#39;, &#39;% recurrent stroke - No&#39;, &#39;# patients assessed for rehabilitation - Not known&#39;, &#39;% patients assessed for rehabilitation - Not known&#39;, &#39;# level of consciousness - not known&#39;, &#39;% level of consciousness - not known&#39;, &#39;# CT/MRI - Performed later than 1 hour after admission&#39;, &#39;% CT/MRI - Performed later than 1 hour after admission&#39;, &#39;# patients put on ventilator - Not known&#39;, &#39;% patients put on ventilator - Not known&#39;, &#39;# patients put on ventilator - No&#39;, &#39;% patients put on ventilator - No&#39;, &#39;# IV tPa&#39;, &#39;% IV tPa&#39;, &#39;# TBY&#39;, &#39;% TBY&#39;, &#39;# DIDO TBY&#39;, &#39;# dysphagia screening - not known&#39;, &#39;% dysphagia screening - not known&#39;, &#39;# dysphagia screening time - After first 24 hours&#39;, &#39;% dysphagia screening time - After first 24 hours&#39;, &#39;# other afib detection method - Not detected or not known&#39;, &#39;% other afib detection method - Not detected or not known&#39;, &#39;# carotid arteries imaging - Not known&#39;, &#39;% carotid arteries imaging - Not known&#39;, &#39;# carotid arteries imaging - No&#39;, &#39;% carotid arteries imaging - No&#39;, &#39;vascular_imaging_cta_norm&#39;, &#39;vascular_imaging_mra_norm&#39;, &#39;vascular_imaging_dsa_norm&#39;, &#39;vascular_imaging_none_norm&#39;, &#39;bleeding_arterial_hypertension_perc_norm&#39;, &#39;bleeding_aneurysm_perc_norm&#39;, &#39;bleeding_arterio_venous_malformation_perc_norm&#39;, &#39;bleeding_anticoagulation_therapy_perc_norm&#39;, &#39;bleeding_amyloid_angiopathy_perc_norm&#39;, &#39;bleeding_other_perc_norm&#39;, &#39;intervention_endovascular_perc_norm&#39;, &#39;intervention_neurosurgical_perc_norm&#39;, &#39;intervention_other_perc_norm&#39;, &#39;intervention_referred_perc_norm&#39;, &#39;intervention_none_perc_norm&#39;, &#39;vt_treatment_anticoagulation_perc_norm&#39;, &#39;vt_treatment_thrombectomy_perc_norm&#39;, &#39;vt_treatment_local_thrombolysis_perc_norm&#39;, &#39;vt_treatment_local_neurological_treatment_perc_norm&#39;, &#39;except_recommended_patients&#39;, &#39;afib_detected_discharged_home_patients&#39;, &#39;% dysphagia screening done&#39;, &#39;# dysphagia screening done&#39;, &#39;alert_all&#39;, &#39;alert_all_perc&#39;, &#39;drowsy_all&#39;, &#39;drowsy_all_perc&#39;, &#39;comatose_all&#39;, &#39;comatose_all_perc&#39;, &#39;antithrombotics_patients_with_cvt&#39;, &#39;ischemic_transient_cerebral_dead_patients&#39;, &#39;# patients receiving antiplatelets with CVT&#39;, &#39;% patients receiving antiplatelets with CVT&#39;, &#39;# patients receiving Vit. K antagonist with CVT&#39;, &#39;% patients receiving Vit. K antagonist with CVT&#39;, &#39;# patients receiving dabigatran with CVT&#39;, &#39;% patients receiving dabigatran with CVT&#39;, &#39;# patients receiving rivaroxaban with CVT&#39;, &#39;% patients receiving rivaroxaban with CVT&#39;, &#39;# patients receiving apixaban with CVT&#39;, &#39;% patients receiving apixaban with CVT&#39;, &#39;# patients receiving edoxaban with CVT&#39;, &#39;% patients receiving edoxaban with CVT&#39;, &#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;, &#39;% patients receiving LMWH or heparin in prophylactic dose with CVT&#39;, &#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;, &#39;% patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;, &#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;, &#39;% patients not prescribed antithrombotics, but recommended with CVT&#39;, &#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;, &#39;% patients neither receiving antithrombotics nor recommended with CVT&#39;, &#39;# patients prescribed antithrombotics with CVT&#39;, &#39;% patients prescribed antithrombotics with CVT&#39;, &#39;# patients prescribed or recommended antithrombotics with CVT&#39;, &#39;% patients prescribed or recommended antithrombotics with CVT&#39;, &#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;, &#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;, &#39;prescribed_antiplatelets_no_afib_patients_with_cvt&#39;, &#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;, &#39;# patients prescribed antiplatelets without aFib with CVT&#39;, &#39;% patients prescribed antiplatelets without aFib with CVT&#39;, &#39;afib_flutter_detected_patients_with_cvt&#39;, &#39;# patients prescribed anticoagulants with aFib with CVT&#39;, &#39;anticoagulants_recommended_patients_with_cvt&#39;, &#39;afib_flutter_detected_dead_patients_with_cvt&#39;, &#39;% patients prescribed anticoagulants with aFib with CVT&#39;, &#39;# patients prescribed antithrombotics with aFib with CVT&#39;, &#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;, &#39;% patients prescribed antithrombotics with aFib with CVT&#39;, &#39;afib_flutter_detected_patients_not_dead&#39;, &#39;except_recommended_discharged_home_patients&#39;, &#39;afib_detected_discharged_patients&#39;, &#39;ischemic_transient_dead_patients_prescribed&#39;, &#39;is_tia_discharged_home_patients&#39;])

        # Connect to database and get country name according to country code.
        def select_country(value):
            country_name = pytz.country_names[value]
            return country_name

        # If country is used as site, the country name is selected from countries dictionary by country code. :) 
        if (country):
            if self.country_code == &#39;UZB&#39;:
                self.country_code = &#39;UZ&#39;
            self.country_name = select_country(self.country_code)
        else:
            self.country_name = None

        # If split_sites is True, then go through dataframe and generate graphs for each site (the country will be included as site in each file).
        site_ids = self.df[&#39;Site ID&#39;].tolist()
        # Delete country name from side ids list.
        try:
            site_ids.remove(self.country_name)
        except:
            pass
       
        if site is not None:
            df = self.df[self.df[&#39;Site ID&#39;].isin([site, self.country_name])].copy()
            df_unformatted = self.df_unformatted[self.df_unformatted[&#39;Site ID&#39;].isin([site, self.country_name])].copy()
            self._generate_formatted_statistics(df=df, df_tmp=df_unformatted, site_code=site)

        # Generate formatted statistics for all sites individualy + country as site is included
        if (split_sites) and site is None:
            for i in site_ids:
                df = self.df[self.df[&#39;Site ID&#39;].isin([i, self.country_name])].copy()
                df_unformatted = self.df_unformatted[self.df_unformatted[&#39;Site ID&#39;].isin([i, self.country_name])].copy()
                self._generate_formatted_statistics(df=df, df_tmp=df_unformatted, site_code=i)
    
        # Produce formatted statistics for all sites + country as site
        if site is None:
            self._generate_formatted_statistics(df=self.df, df_tmp=self.df_unformatted)

    def _generate_formatted_statistics(self, df, df_tmp, site_code=None):
        &#34;&#34;&#34;Generate formatted statistics in xlsx file.
        
        Keyword arguments:
            df: the dataframe with statistics containing only necessary columns
            df_tmp: the dataframe with statistics containing all calculation
            site_code: the code of site (default: NOne)
        &#34;&#34;&#34;

        if self.country_code is None and site_code is None:
            name_of_unformatted_stats = self.report + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            name_of_output_file = self.report + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;
        elif site_code is None:
            name_of_unformatted_stats = self.report + &#34;_&#34; + self.country_code + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            name_of_output_file = self.report + &#34;_&#34; + self.country_code + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;
        else:
            # self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            # self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;
            name_of_unformatted_stats = self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            name_of_output_file = self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;

        df_tmp.to_csv(name_of_unformatted_stats, sep=&#34;,&#34;, encoding=&#39;utf-8&#39;, index=False)
        workbook1 = xlsxwriter.Workbook(name_of_output_file, {&#39;strings_to_numbers&#39;: True})
        # create worksheet
        worksheet = workbook1.add_worksheet()

        # set width of columns
        worksheet.set_column(0, 4, 15)
        worksheet.set_column(4, 350, 60)
        # number of columns
        
        ncol = len(df.columns) - 1
       # print(ncol)

        # number of rows
        nrow = len(df) + 2

        column_names = df.columns.tolist()
        col = []
        for i in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = column_names[i]
            col.append(tmp)

        #df = statistics[0:nrow]
        # print(statistics)

        statistics = df.values.tolist()

        ########################
        # DICTIONARY OF COLORS #
        ########################
        colors = {
            &#34;gender&#34;: &#34;#477187&#34;,
            &#34;stroke_hosp&#34;: &#34;#535993&#34;,
            &#34;recurrent_stroke&#34;: &#34;#D4B86A&#34;,
            &#34;department_type&#34;: &#34;#D4A46A&#34;,
            &#34;hospitalization&#34;: &#34;#D4916A&#34;,
            &#34;rehab&#34;: &#34;#D4BA6A&#34;,
            &#34;stroke&#34;: &#34;#565595&#34;,
            &#34;consciousness&#34;: &#34;#468B78&#34;,
            &#34;gcs&#34;: &#34;#B9D6C1&#34;,
            &#34;nihss&#34;: &#34;#C5D068&#34;,
            &#34;ct_mri&#34;: &#34;#AA8739&#34;,
            &#34;vasc_img&#34;: &#34;#277650&#34;,
            &#34;ventilator&#34;: &#34;#AA5039&#34;,
            &#34;recanalization_procedure&#34;: &#34;#7F4C91&#34;,
            &#34;median_times&#34;: &#34;#BEBCBC&#34;,
            &#34;dysphagia&#34;: &#34;#F49B5B&#34;,
            &#34;hemicraniectomy&#34;: &#34;#A3E4D7&#34;,
            &#34;neurosurgery&#34;: &#34;#F8C471&#34;,
            &#34;neurosurgery_type&#34;: &#34;#CACFD2&#34;,
            &#34;bleeding_reason&#34;: &#34;#CB4335&#34;,
            &#34;bleeding_source&#34;: &#34;#9B59B6&#34;,
            &#34;intervention&#34;: &#34;#5DADE2&#34;,
            &#34;vt_treatment&#34;: &#34;#F5CBA7&#34;,
            &#34;afib&#34;: &#34;#A2C3F3&#34;,
            &#34;carot&#34;: &#34;#F1C40F&#34;,
            &#34;antithrombotics&#34;: &#34;#B5E59F&#34;,
            &#34;statin&#34;: &#34;#28B463&#34;,
            &#34;carotid_stenosis&#34;: &#34;#B9D6C1&#34;,
            &#34;carot_foll&#34;: &#34;#BFC9CA&#34;,
            &#34;antihypertensive&#34;: &#34;#7C7768&#34;,
            &#34;smoking&#34;: &#34;#F9C991&#34;,
            &#34;cerebrovascular&#34;: &#34;#91C09E&#34;,
            &#34;discharge_destination&#34;: &#34;#C0EFF5&#34;,
            &#34;discharge_destination_same_centre&#34;: &#34;#56A3A6&#34;,
            &#34;discharge_destination_another_centre&#34;: &#34;#E8DF9C&#34;,
            &#34;discharge_destination_within_another_centre&#34;: &#34;#538083&#34;,
            &#34;angel_awards&#34;: &#34;#B87333&#34;,
            &#34;angel_resq_awards&#34;: &#34;#341885&#34;,
            &#34;columns&#34;: &#34;#3378B8&#34;,
            &#34;green&#34;: &#34;#A1CCA1&#34;,
            &#34;orange&#34;: &#34;#DF7401&#34;,
            &#34;gold&#34;: &#34;#FFDF00&#34;,
            &#34;platinum&#34;: &#34;#c0c0c0&#34;,
            &#34;black&#34;: &#34;#ffffff&#34;,
            &#34;red&#34;: &#34;#F45D5D&#34;
        }

        #statistics = statistics[1:nrow]

        ##########
        # GENDER #
        ##########
        # set formatting for gender
        gender = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;gender&#34;)})

        gender_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;gender&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients female&#39;)
        last_index = column_names.index(&#39;% patients male&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        #worksheet.merge_range(&#39;E1:H1&#39;, &#39;GENDER&#39;, gender)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;GENDER&#39;, gender)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, gender_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, gender_color)

        ##########################
        # STROKE IN THE HOSPITAL #
        ##########################
        stroke_hosp = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;stroke_hosp&#34;)})

        stroke_hosp_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;stroke_hosp&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients having stroke in the hospital - Yes&#39;)
        last_index = column_names.index(&#39;% patients having stroke in the hospital - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;STROKE IN THE HOSPITAL&#39;, stroke_hosp)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, stroke_hosp_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, stroke_hosp_color)

        ####################
        # RECURRENT STROKE #
        ####################
        # set formatting for recurrent stroke
        recurrent_stroke = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;recurrent_stroke&#34;)})

        recurrent_stroke_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;recurrent_stroke&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# recurrent stroke - Yes&#39;)
        last_index = column_names.index(&#39;% recurrent stroke - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;RECURRENT STROKE&#39;, recurrent_stroke)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, recurrent_stroke_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, recurrent_stroke_color)

        ###################
        # DEPARTMENT TYPE #
        ###################

        department_type = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;department_type&#34;)})

        department_type_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;department_type&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# department type - neurology&#39;)
        last_index = column_names.index(&#39;% department type - Other&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DEPARTMENT TYPE&#39;, department_type)
        
        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, department_type_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, department_type_color)
        
        ###################
        # HOSPITALIZATION #
        ###################

        hospitalization = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;hospitalization&#34;)})

        hospitalization_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;hospitalization&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients hospitalized in stroke unit / ICU&#39;)
        last_index = column_names.index(&#39;% patients hospitalized in standard bed&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;HOSPITALIZATION&#39;, hospitalization)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, hospitalization_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, hospitalization_color)

        #############################
        # REHABILITATION ASSESSMENT #
        #############################

        rehab_assess = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;rehab&#34;)})

        rehab_assess_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;rehab&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients assessed for rehabilitation - Yes&#39;)
        last_index = column_names.index(&#39;% patients assessed for rehabilitation - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;REHABILITATION ASSESSMENT&#39;, rehab_assess)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, rehab_assess_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, rehab_assess_color)

        ###############
        # STROKE TYPE #
        ###############
        stroke_type = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;stroke&#34;)})

        stroke_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;stroke&#34;),
            &#39;text_wrap&#39;: True})


        first_index = column_names.index(&#39;# stroke type - ischemic stroke&#39;)
        last_index = column_names.index(&#39;% stroke type - undetermined stroke&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;STROKE TYPE&#39;, stroke_type)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, stroke_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, stroke_color)

        #######################
        # CONSCIOUSNESS LEVEL #
        #######################

        consciousness_level = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;consciousness&#34;)})

        consciousness_level_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;consciousness&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# level of consciousness - alert&#39;)
        last_index = column_names.index(&#39;% level of consciousness - GCS&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CONSCIOUSNESS LEVEL&#39;, consciousness_level)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + ICH&#39;, consciousness_level_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, consciousness_level_color)

        #######
        # GCS #
        #######

        gcs = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;gcs&#34;)})

        gcs_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;gcs&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# GCS - 15-13&#39;)
        last_index = column_names.index(&#39;% GCS - &lt;8&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;GLASGOW COMA SCALE&#39;, gcs)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + ICH&#39;, gcs_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, gcs_color)

        #########
        # NIHSS #
        #########
        nihss = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;nihss&#34;)})

        nihss_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;nihss&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# NIHSS - Not performed&#39;)
        last_index = column_names.index(&#39;NIHSS median score&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;NIHSS&#39;, nihss)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + ICH + CVT&#39;, nihss_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, nihss_color)

        ##########
        # CT/MRI #
        ##########
        ct_mri = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;ct_mri&#34;)})

        ct_mri_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;ct_mri&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# CT/MRI - Not performed&#39;)
        last_index = column_names.index(&#39;% CT/MRI - Performed within 1 hour after admission&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CT/MRI&#39;, ct_mri)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # CT/MRI performed&#39;, ct_mri_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, ct_mri_color)

        ####################
        # VASCULAR IMAGING #
        ####################
        vascular_imaging = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;vasc_img&#34;)})

        vascular_imaging_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;vasc_img&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# vascular imaging - CTA&#39;)
        last_index = column_names.index(&#39;% vascular imaging - two modalities&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;VASCULAR IMAGING&#39;, vascular_imaging)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH + SAH&#39;, vascular_imaging_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, vascular_imaging_color)

        ##############
        # VENTILATOR #
        ##############
        ventilator = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;ventilator&#34;)})

        ventilator_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;ventilator&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients put on ventilator - Yes&#39;)
        last_index = column_names.index(&#39;% patients put on ventilator - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;VENTILATOR&#39;, ventilator)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + ICH + CVT&#39;, ventilator_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, ventilator_color)

        #############################
        # RECANALIZATION PROCEDURES #
        #############################
        recanalization_procedures = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;recanalization_procedure&#34;)})

        recanalization_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;recanalization_procedure&#34;),
            &#39;text_wrap&#39;: True})


        first_index = column_names.index(&#39;# recanalization procedures - Not done&#39;)
        last_index = column_names.index(&#39;% recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;RECANALIZATION PROCEDURES&#39;, recanalization_procedures)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic stroke&#39;, recanalization_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, recanalization_color)

        ################
        # MEDIAN TIMES #
        ################
        median_times = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;median_times&#34;)})

        median_times_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;median_times&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;Median DTN (minutes)&#39;)
        last_index = column_names.index(&#39;Median TBY DIDO (minutes)&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;MEDIAN TIMES (minutes)&#39;, median_times)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, median_times_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, median_times_color)

        #############
        # DYSPHAGIA #
        #############
        dysphagia = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;)})

        dysphagia_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# dysphagia screening - Guss test&#39;)
        last_index = column_names.index(&#39;% dysphagia screening - Unable to test&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DYSPHAGIA SCREENING&#39;, dysphagia)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + ICH + CVT&#39;, dysphagia_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, dysphagia_color)

        #############
        # DYSPHAGIA #
        #############
        dysphagia = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;)})

        dysphagia_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# dysphagia screening time - Within first 24 hours&#39;)
        last_index = column_names.index(&#39;% dysphagia screening time - Within first 24 hours&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DYSPHAGIA TIMES&#39;, dysphagia)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # Guss test + other test&#39;, dysphagia_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, dysphagia_color)

        ###################
        # HEMICRANIECTOMY #
        ###################
        hemicraniectomy = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;hemicraniectomy&#34;)})

        hemicraniectomy_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;hemicraniectomy&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# hemicraniectomy - Yes&#39;)
        last_index = column_names.index(&#39;% hemicraniectomy - Referred to another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;HEMICRANIECTOMY&#39;, hemicraniectomy)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS&#39;, hemicraniectomy_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, hemicraniectomy_color)

        ################
        # NEUROSURGERY #
        ################
        neurosurgery = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery&#34;)})

        neurosurgery_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# neurosurgery - Not known&#39;)
        last_index = column_names.index(&#39;% neurosurgery - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;NEUROSURGERY&#39;, neurosurgery)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, neurosurgery_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, neurosurgery_color)


        #####################
        # NEUROSURGERY TYPE #
        #####################
        neurosurgery_type = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery_type&#34;)})

        neurosurgery_type_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery_type&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# neurosurgery type - intracranial hematoma evacuation&#39;)
        last_index = column_names.index(&#39;% neurosurgery type - Referred to another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;NEUROSURGERY TYPE&#39;, neurosurgery_type)


        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, neurosurgery_type_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, neurosurgery_type_color)


        ###################
        # BLEEDING REASON #
        ###################
        bleeding_reason = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;bleeding_reason&#34;)})

        bleeding_reason_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;bleeding_reason&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# bleeding reason - arterial hypertension&#39;)
        last_index = column_names.index(&#39;% bleeding reason - more than one&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;BLEEDING REASON&#39;, bleeding_reason)


        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, bleeding_reason_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, bleeding_reason_color)

        ###################
        # BLEEDING SOURCE #
        ###################
        bleeding_source = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;bleeding_source&#34;)})

        bleeding_source_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;bleeding_source&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# bleeding source - Known&#39;)
        last_index = column_names.index(&#39;% bleeding source - Not known&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;BLEEDING SOURCE&#39;, bleeding_source)


        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, bleeding_source_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, bleeding_source_color)

        ################
        # INTERVENTION #
        ################
        intervention = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;intervention&#34;)})

        intervention_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;intervention&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# intervention - endovascular (coiling)&#39;)
        last_index = column_names.index(&#39;% intervention - more than one&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;INTERVENTION&#39;, intervention)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # SAH&#39;, intervention_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, intervention_color)

        ################
        # VT TREATMENT #
        ################
        vt_treatment = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;vt_treatment&#34;)})

        vt_treatment_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;vt_treatment&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# VT treatment - anticoagulation&#39;)
        last_index = column_names.index(&#39;% VT treatment - more than one treatment&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;VENOUS THROMBOSIS TREATMENT&#39;, vt_treatment)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # CVT&#39;, intervention_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, intervention_color)

        #######################
        # ATRIAL FIBRILLATION #
        #######################
        atrial_fibrillation = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;afib&#34;)})

        afib_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;afib&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# afib/flutter - Known&#39;)
        last_index = column_names.index(&#39;% other afib detection method - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ATRIAL FIBRILLATION&#39;, atrial_fibrillation)

        first_index = column_names.index(&#39;# afib/flutter - Known&#39;)
        last_index = column_names.index(&#39;% afib/flutter - Not known&#39;)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + TIA&#39;, afib_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, afib_color)

        first_index = column_names.index(&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;)
        last_index = column_names.index(&#39;# other afib detection method - Yes&#39;)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # detected during hospitalization&#39;, afib_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, afib_color)

        worksheet.write(xl_rowcol_to_cell(1, column_names.index(&#39;% other afib detection method - Yes&#39;)), &#39;out of # not detected + not known&#39;, afib_color)


        ####################
        # CAROTID ARTERIES #
        ####################
        carot = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;carot&#34;)})

        carot_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;carot&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# carotid arteries imaging - Yes&#39;)
        last_index = column_names.index(&#39;% carotid arteries imaging - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CAROTID ARTERIES IMAGING&#39;, carot)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # alive ischemic + TIA&#39;, carot_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, carot_color)


        ###################
        # ANTITHROMBOTICS #
        ###################
        antithrombotics = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;antithrombotics&#34;)})

        antithrombotics_colors = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;antithrombotics&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients receiving antiplatelets&#39;)
        last_index = column_names.index(&#39;% patients prescribed antithrombotics with aFib&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ANTITHROMBOTICS&#39;, antithrombotics)

        first_index = column_names.index(&#39;# patients receiving antiplatelets&#39;)
        last_index = column_names.index(&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;)
        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # alive ischemic + TIA + CVT&#39;, antithrombotics_colors)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, antithrombotics_colors)

        first_index = column_names.index(&#39;% patients prescribed anticoagulants with aFib&#39;)
        last_index = column_names.index(&#39;% patients prescribed antithrombotics with aFib&#39;)
        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # alive with AF+&#39;, antithrombotics_colors)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, antithrombotics_colors)

        ##########
        # STATIN #
        ##########
        statin = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;statin&#34;)})

        statin_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;statin&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients prescribed statins - Yes&#39;)
        last_index = column_names.index(&#39;% patients prescribed statins - Not known&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;STATINS&#39;, statin)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + TIA&#39;, statin_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, statin_color)


        ####################
        # CAROTID STENOSIS #
        ####################
        carotid_stenosis = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;carotid_stenosis&#34;)})

        carotid_stenosis_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;carotid_stenosis&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# carotid stenosis - 50%-70%&#39;)
        last_index = column_names.index(&#39;% carotid stenosis - Not known&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CAROTID STENOSIS&#39;, carotid_stenosis)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + TIA&#39;, carotid_stenosis_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, carotid_stenosis_color)

        ##############################
        # CAROTID STENOSIS FOLLOW UP #
        ##############################
        carotid_stenosis_foll = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;carot_foll&#34;)})

        carotid_stenosis_foll_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;carot_foll&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# carotid stenosis followup - Yes&#39;)
        last_index = column_names.index(&#39;% carotid stenosis followup - Referred to another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CAROTID STENOSIS FOLLOW UP&#39;, carotid_stenosis_foll)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + TIA&#39;, carotid_stenosis_foll_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, carotid_stenosis_foll_color)

        ###############################
        # ANTIHYPERTENSIVE MEDICATION #
        ###############################
        antihypertensive = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;antihypertensive&#34;)})

        antihypertensive_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;antihypertensive&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# prescribed antihypertensives - Not known&#39;)
        last_index = column_names.index(&#39;% prescribed antihypertensives - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ANTIHYPERTENSIVE MEDICATION&#39;, antihypertensive)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, antihypertensive_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, antihypertensive_color)


        #####################
        # SMOKING CESSATION #
        #####################
        smoking = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;smoking&#34;)})

        smoking_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;smoking&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# recommended to a smoking cessation program - not a smoker&#39;)
        last_index = column_names.index(&#39;% recommended to a smoking cessation program - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;SMOKING CESSATION&#39;, smoking)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, smoking_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, smoking_color)


        ##########################
        # Cerebrovascular expert #
        ##########################
        cerebrovascular = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;cerebrovascular&#34;)})

        cerebrovascular_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;cerebrovascular&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;)
        last_index = column_names.index(&#39;% recommended to a cerebrovascular expert - Not recommended&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CEREBROVASCULAR EXPERT&#39;, cerebrovascular)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, cerebrovascular_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, cerebrovascular_color)

        #########################
        # DISCHARGE DESTINATION #
        #########################

        discharge_destination = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination&#34;)})

        destination_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# discharge destination - Home&#39;)
        last_index = column_names.index(&#39;% discharge destination - Dead&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION&#39;, discharge_destination)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, destination_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, destination_color)

        ##################################################
        # DISCHARGE DESTINATION - WITHIN THE SAME CENTRE #
        ##################################################

        discharge_destination_same_centre = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_same_centre&#34;)})

        discharge_destination_same_centre_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_same_centre&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# transferred within the same centre - Acute rehabilitation&#39;)
        last_index = column_names.index(&#39;% transferred within the same centre - Another department&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION WITHIN THE SAME CENTRE&#39;, discharge_destination_same_centre)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # transferred within the same centre&#39;, discharge_destination_same_centre_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, discharge_destination_same_centre_color)

        #########################################################
        # DISCHARGE DESTINATION - TRANSFERRED TO ANOTHER CENTRE #
        #########################################################

        discharge_destination_another_centre = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_another_centre&#34;)})

        discharge_destination_another_centre_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_another_centre&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# transferred to another centre - Stroke centre&#39;)
        last_index = column_names.index(&#39;% transferred to another centre - Another hospital&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION TRANSFERRED TO ANOTHER CENTRE&#39;, discharge_destination_another_centre)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # transferred to another centre&#39;, discharge_destination_another_centre_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, discharge_destination_another_centre_color)

        ################################################################
        # DISCHARGE DESTINATION - TRANSFERRED TO WITHIN ANOTHER CENTRE #
        ################################################################

        discharge_destination_within_another_centre = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_within_another_centre&#34;)})

        discharge_destination_within_another_centre_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_within_another_centre&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# department transferred to within another centre - Acute rehabilitation&#39;)
        last_index = column_names.index(&#39;% department transferred to within another centre - Another department&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION TRANSFERRED WITHIN TO ANOTHER CENTRE&#39;, discharge_destination_within_another_centre)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # transferred to another centre&#39;, discharge_destination_within_another_centre_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, discharge_destination_within_another_centre_color)

        ################
        # angel awards #
        ################
        awards = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        awards_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        first_index = column_names.index(self.total_patients_column)
        last_index = column_names.index(&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ESO ANGELS AWARDS&#39;, awards)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, awards_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, awards_color)

        hidden_columns = [&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;, &#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;, &#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;, &#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;, &#39;# recanalization rate out of total ischemic incidence&#39;, &#39;# suspected stroke patients undergoing CT/MRI&#39;, &#39;# all stroke patients undergoing dysphagia screening&#39;, &#39;# ischemic stroke patients discharged with antiplatelets&#39;, &#39;% ischemic stroke patients discharged with antiplatelets&#39;, &#39;# ischemic stroke patients discharged home with antiplatelets&#39;, &#39;% ischemic stroke patients discharged home with antiplatelets&#39;, &#39;# ischemic stroke patients discharged (home) with antiplatelets&#39;, &#39;# afib patients discharged with anticoagulants&#39;, &#39;% afib patients discharged with anticoagulants&#39;, &#39;# afib patients discharged home with anticoagulants&#39;, &#39;% afib patients discharged home with anticoagulants&#39;, &#39;# afib patients discharged (home) with anticoagulants&#39;, &#39;# stroke patients treated in a dedicated stroke unit / ICU&#39;, &#39;% stroke patients treated in a dedicated stroke unit / ICU&#39;]
                                        
        for i in hidden_columns:
            index = column_names.index(i)
            column = xl_col_to_name(index)
            worksheet.set_column(column + &#34;:&#34; + column, None, None, {&#39;hidden&#39;: True})

        # format for green color
        green = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;green&#34;)})

        # format for gold color
        gold = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;gold&#34;)})

        # format for platinum color
        plat = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;platinum&#34;)})

        # format for gold black
        black = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: &#39;#000000&#39;,
            &#39;color&#39;: colors.get(&#34;black&#34;)})

        # format for red color
        red = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;red&#34;)})


        # add table into worksheet
        options = {&#39;data&#39;: statistics,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 8&#39;
                   }

        worksheet.add_table(2, 0, nrow, ncol, options)

        # total number of rows
        number_of_rows = len(statistics) + 2

        if not self.comp:    
            # if cell contain TRUE in column &gt; 30 patients (DR) it will be colored to green
            awards = []
            row = 4
            index = column_names.index(self.total_patients_column)
            while row &lt; nrow + 2:
                cell_n = xl_col_to_name(index) + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;TRUE&#39;,
                                                    &#39;format&#39;: green})
                row += 1

            def angels_awards_ivt_60(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 60.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 50,
                                                        &#39;maximum&#39;: 74.99,
                                                        &#39;format&#39;: gold})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 75,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_60(column, coln=index)

            index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_60(column, coln=index)


            def angels_awards_ivt_45(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 45.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                        &#39;value&#39;: 49.99,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 50,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_45(column, coln=index)

            index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_45(column, coln=index)

            # setting colors of cells according to their values
            def angels_awards_recan(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for recaalization procedures.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 5,
                                                        &#39;maximum&#39;: 14.99,
                                                        &#39;format&#39;: gold})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 15,
                                                        &#39;maximum&#39;: 24.99,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 25,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% recanalization rate out of total ischemic incidence&#39;)
            column = xl_col_to_name(index)
            angels_awards_recan(column, coln=index)

            def angels_awards_processes(column_name, coln, count=True):
                &#34;&#34;&#34;Add conditional formatting to angels awards for processes.&#34;&#34;&#34;
                count = count
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 80,
                                                        &#39;maximum&#39;: 84.99,
                                                        &#39;format&#39;: gold})

                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 85,
                                                        &#39;maximum&#39;: 89.99,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 90,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% suspected stroke patients undergoing CT/MRI&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            index = column_names.index(&#39;% all stroke patients undergoing dysphagia screening&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            index = column_names.index(&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            index = column_names.index(&#39;% afib patients discharged (home) with anticoagulants&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            # setting colors of cells according to their values
            def angels_awards_hosp(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for hospitalization.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                        &#39;value&#39;: 0,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 0.99,
                                                        &#39;format&#39;: black})
                    row += 1

            index = column_names.index(&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;)
            column = xl_col_to_name(index)
            angels_awards_hosp(column, coln=index)

            # set color for proposed angel award
            def proposed_award(column_name, coln):
                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;NONE&#39;,
                                                        &#39;format&#39;: green})
                    row += 1

                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;GOLD&#39;,
                                                        &#39;format&#39;: gold})
                    row += 1

                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;PLATINUM&#39;,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;DIAMOND&#39;,
                                                        &#39;format&#39;: black})
                    row += 1

            index = column_names.index(&#39;Proposed Award&#39;)
            column = xl_col_to_name(index)
            proposed_award(column, coln=index)
            #worksheet.write_column(3, index, awards)

            
        else:
            pass

        workbook1.close()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="resqdb.FormatData.GenerateFormattedAngelsAwards"><code class="flex name class">
<span>class <span class="ident">GenerateFormattedAngelsAwards</span></span>
<span>(</span><span>df, report=None, quarter=None, minimum_patients=0)</span>
</code></dt>
<dd>
<section class="desc"><p>This class generate formatted statistics only for angels awards.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class GenerateFormattedAngelsAwards:
    &#34;&#34;&#34;
    This class generate formatted statistics only for angels awards. 
    &#34;&#34;&#34;
    def __init__(self, df, report=None, quarter=None, minimum_patients=0):

        self.df = df
        self.report = report
        self.quarter = quarter
        self.minimum_patients = minimum_patients

        self.formate(self.df)

    def formate(self, df):

        if self.report is None and self.quarter is None:
            output_file = &#34;angels_awards.xslx&#34;
        else:
            output_file = self.report + &#34;_&#34; + self.quarter + &#34;_angels_awards.xlsx&#34;
            

        workbook1 = xlsxwriter.Workbook(output_file, {&#39;strings_to_numbers&#39;: True})
        # create worksheet
        worksheet = workbook1.add_worksheet()

        # set width of columns
        worksheet.set_column(0, 2, 15)
        worksheet.set_column(2, 20, 40)

        ncol = len(df.columns) - 1
        nrow = len(df) + 2

        col = []
        column_names = df.columns.tolist()
        for i in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] =column_names[i]
            col.append(tmp)

        statistics = df.values.tolist()
        colors = {
            &#34;angel_awards&#34;: &#34;#B87333&#34;,
            &#34;angel_resq_awards&#34;: &#34;#341885&#34;,
            &#34;columns&#34;: &#34;#3378B8&#34;,
            &#34;green&#34;: &#34;#A1CCA1&#34;,
            &#34;orange&#34;: &#34;#DF7401&#34;,
            &#34;gold&#34;: &#34;#FFDF00&#34;,
            &#34;platinum&#34;: &#34;#c0c0c0&#34;,
            &#34;black&#34;: &#34;#ffffff&#34;,
            &#34;red&#34;: &#34;#F45D5D&#34;
        }

        ################
        # angel awards #
        ################
        awards = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        awards_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        first_cell = xl_rowcol_to_cell(0, 2)
        last_cell = xl_rowcol_to_cell(0, ncol)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ESO ANGELS AWARDS&#39;, awards)
        for i in range(2, ncol + 1):
            cell = xl_rowcol_to_cell(1, i)
            worksheet.write(cell, &#39;&#39;, awards_color)

        # format for green color
        green = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;green&#34;)})

        # format for gold color
        gold = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;gold&#34;)})

        # format for platinum color
        plat = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;platinum&#34;)})

        # format for gold black
        black = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: &#39;#000000&#39;,
            &#39;color&#39;: colors.get(&#34;black&#34;)})

        # format for red color
        red = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;red&#34;)})


        # add table into worksheet
        options = {&#39;data&#39;: statistics,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 8&#39;
                   }

        first_col = xl_col_to_name(0)
        last_col = xl_col_to_name(ncol + 1)
        worksheet.set_column(first_col + &#34;:&#34; + last_col, 30)

        worksheet.add_table(2, 0, nrow, ncol, options)

        # total number of rows
        number_of_rows = len(statistics) + 2

        self.total_patients_column = &#39;# total patients &gt;= {0}&#39;.format(self.minimum_patients)
        # if cell contain TRUE in column &gt; 30 patients (DR) it will be colored to green
        awards = []
        row = 4
        while row &lt; nrow + 2:
            index = column_names.index(self.total_patients_column)
            cell_n = xl_col_to_name(index) + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                &#39;criteria&#39;: &#39;containing&#39;,
                                                &#39;value&#39;: &#39;TRUE&#39;,
                                                &#39;format&#39;: green})
            row += 1


        def angels_awards_ivt_60(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 60.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 50,
                                                    &#39;maximum&#39;: 74.99,
                                                    &#39;format&#39;: gold})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 75,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_60(column, coln=index)

        index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_60(column, coln=index)

        # angels_awards_ivt_60(&#39;D&#39;)


        def angels_awards_ivt_45(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 45.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                    &#39;value&#39;: 49.99,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 50,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_45(column, coln=index)

        index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;)
        column = xl_col_to_name(index)
        angels_awards_ivt_45(column, coln=index)

        # setting colors of cells according to their values
        def angels_awards_recan(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for recaalization procedures.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 5,
                                                    &#39;maximum&#39;: 14.99,
                                                    &#39;format&#39;: gold})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 15,
                                                    &#39;maximum&#39;: 24.99,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 25,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% recanalization rate out of total ischemic incidence&#39;)
        angels_awards_recan(column_name=xl_col_to_name(index), coln=index)
        #angels_awards_recan(&#39;F&#39;)


        def angels_awards_processes(column_name, coln, count=True):
            &#34;&#34;&#34;Add conditional formatting to angels awards for processes.&#34;&#34;&#34;
            count = count
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 80,
                                                    &#39;maximum&#39;: 84.99,
                                                    &#39;format&#39;: gold})

                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;between&#39;,
                                                    &#39;minimum&#39;: 85,
                                                    &#39;maximum&#39;: 89.99,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 90,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;% suspected stroke patients undergoing CT/MRI&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
        index = column_names.index(&#39;% all stroke patients undergoing dysphagia screening&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
        index = column_names.index(&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
        index = column_names.index(&#39;% afib patients discharged (home) with anticoagulants&#39;)
        angels_awards_processes(column_name=xl_col_to_name(index), coln=index)

        #angels_awards_processes(&#39;G&#39;, 4)
        #angels_awards_processes(&#39;H&#39;, 5)
        #angels_awards_processes(&#39;I&#39;, 6)
        #angels_awards_processes(&#39;J&#39;, 7)

        # setting colors of cells according to their values
        def angels_awards_hosp(column_name, coln):
            &#34;&#34;&#34;Add conditional formatting to angels awards for hospitalization.&#34;&#34;&#34;
            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                    &#39;value&#39;: 0,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; number_of_rows + 2:
                cell_n = column_name + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                    &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                    &#39;value&#39;: 0.99,
                                                    &#39;format&#39;: black})
                row += 1

        
        index = column_names.index(&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;)
        angels_awards_hosp(column_name=xl_col_to_name(index), coln=index)

        
        # set color for proposed angel award
        def proposed_award(column_name, coln):
            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;NONE&#39;,
                                                    &#39;format&#39;: green})
                row += 1

            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;GOLD&#39;,
                                                    &#39;format&#39;: gold})
                row += 1

            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;PLATINUM&#39;,
                                                    &#39;format&#39;: plat})
                row += 1

            row = 4
            while row &lt; nrow + 2:
                cell_n = column + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;DIAMOND&#39;,
                                                    &#39;format&#39;: black})
                row += 1

        index = column_names.index(&#39;Proposed Award&#39;)
        column = xl_col_to_name(index)
        proposed_award(column, coln=index)
        #worksheet.write_column(3, index, awards)

        workbook1.close()</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="resqdb.FormatData.GenerateFormattedAngelsAwards.formate"><code class="name flex">
<span>def <span class="ident">formate</span></span>(<span>self, df)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def formate(self, df):

    if self.report is None and self.quarter is None:
        output_file = &#34;angels_awards.xslx&#34;
    else:
        output_file = self.report + &#34;_&#34; + self.quarter + &#34;_angels_awards.xlsx&#34;
        

    workbook1 = xlsxwriter.Workbook(output_file, {&#39;strings_to_numbers&#39;: True})
    # create worksheet
    worksheet = workbook1.add_worksheet()

    # set width of columns
    worksheet.set_column(0, 2, 15)
    worksheet.set_column(2, 20, 40)

    ncol = len(df.columns) - 1
    nrow = len(df) + 2

    col = []
    column_names = df.columns.tolist()
    for i in range(0, ncol + 1):
        tmp = {}
        tmp[&#39;header&#39;] =column_names[i]
        col.append(tmp)

    statistics = df.values.tolist()
    colors = {
        &#34;angel_awards&#34;: &#34;#B87333&#34;,
        &#34;angel_resq_awards&#34;: &#34;#341885&#34;,
        &#34;columns&#34;: &#34;#3378B8&#34;,
        &#34;green&#34;: &#34;#A1CCA1&#34;,
        &#34;orange&#34;: &#34;#DF7401&#34;,
        &#34;gold&#34;: &#34;#FFDF00&#34;,
        &#34;platinum&#34;: &#34;#c0c0c0&#34;,
        &#34;black&#34;: &#34;#ffffff&#34;,
        &#34;red&#34;: &#34;#F45D5D&#34;
    }

    ################
    # angel awards #
    ################
    awards = workbook1.add_format({
        &#39;bold&#39;: 2,
        &#39;border&#39;: 0,
        &#39;align&#39;: &#39;center&#39;,
        &#39;valign&#39;: &#39;vcenter&#39;,
        &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

    awards_color = workbook1.add_format({
        &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

    first_cell = xl_rowcol_to_cell(0, 2)
    last_cell = xl_rowcol_to_cell(0, ncol)
    worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ESO ANGELS AWARDS&#39;, awards)
    for i in range(2, ncol + 1):
        cell = xl_rowcol_to_cell(1, i)
        worksheet.write(cell, &#39;&#39;, awards_color)

    # format for green color
    green = workbook1.add_format({
        &#39;bold&#39;: 2,
        &#39;align&#39;: &#39;center&#39;,
        &#39;valign&#39;: &#39;vcenter&#39;,
        &#39;bg_color&#39;: colors.get(&#34;green&#34;)})

    # format for gold color
    gold = workbook1.add_format({
        &#39;bold&#39;: 1,
        &#39;align&#39;: &#39;center&#39;,
        &#39;valign&#39;: &#39;vcenter&#39;,
        &#39;bg_color&#39;: colors.get(&#34;gold&#34;)})

    # format for platinum color
    plat = workbook1.add_format({
        &#39;bold&#39;: 1,
        &#39;align&#39;: &#39;center&#39;,
        &#39;valign&#39;: &#39;vcenter&#39;,
        &#39;bg_color&#39;: colors.get(&#34;platinum&#34;)})

    # format for gold black
    black = workbook1.add_format({
        &#39;bold&#39;: 1,
        &#39;align&#39;: &#39;center&#39;,
        &#39;valign&#39;: &#39;vcenter&#39;,
        &#39;bg_color&#39;: &#39;#000000&#39;,
        &#39;color&#39;: colors.get(&#34;black&#34;)})

    # format for red color
    red = workbook1.add_format({
        &#39;bold&#39;: 1,
        &#39;align&#39;: &#39;center&#39;,
        &#39;valign&#39;: &#39;vcenter&#39;,
        &#39;bg_color&#39;: colors.get(&#34;red&#34;)})


    # add table into worksheet
    options = {&#39;data&#39;: statistics,
               &#39;header_row&#39;: True,
               &#39;columns&#39;: col,
               &#39;style&#39;: &#39;Table Style Light 8&#39;
               }

    first_col = xl_col_to_name(0)
    last_col = xl_col_to_name(ncol + 1)
    worksheet.set_column(first_col + &#34;:&#34; + last_col, 30)

    worksheet.add_table(2, 0, nrow, ncol, options)

    # total number of rows
    number_of_rows = len(statistics) + 2

    self.total_patients_column = &#39;# total patients &gt;= {0}&#39;.format(self.minimum_patients)
    # if cell contain TRUE in column &gt; 30 patients (DR) it will be colored to green
    awards = []
    row = 4
    while row &lt; nrow + 2:
        index = column_names.index(self.total_patients_column)
        cell_n = xl_col_to_name(index) + str(row)
        worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                            &#39;criteria&#39;: &#39;containing&#39;,
                                            &#39;value&#39;: &#39;TRUE&#39;,
                                            &#39;format&#39;: green})
        row += 1


    def angels_awards_ivt_60(column_name, coln):
        &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 60.&#34;&#34;&#34;
        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;between&#39;,
                                                &#39;minimum&#39;: 50,
                                                &#39;maximum&#39;: 74.99,
                                                &#39;format&#39;: gold})
            row += 1

        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                &#39;value&#39;: 75,
                                                &#39;format&#39;: black})
            row += 1

    index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;)
    column = xl_col_to_name(index)
    angels_awards_ivt_60(column, coln=index)

    index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;)
    column = xl_col_to_name(index)
    angels_awards_ivt_60(column, coln=index)

    # angels_awards_ivt_60(&#39;D&#39;)


    def angels_awards_ivt_45(column_name, coln):
        &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 45.&#34;&#34;&#34;
        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                &#39;value&#39;: 49.99,
                                                &#39;format&#39;: plat})
            row += 1

        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                &#39;value&#39;: 50,
                                                &#39;format&#39;: black})
            row += 1

    index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;)
    column = xl_col_to_name(index)
    angels_awards_ivt_45(column, coln=index)

    index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;)
    column = xl_col_to_name(index)
    angels_awards_ivt_45(column, coln=index)

    # setting colors of cells according to their values
    def angels_awards_recan(column_name, coln):
        &#34;&#34;&#34;Add conditional formatting to angels awards for recaalization procedures.&#34;&#34;&#34;
        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;between&#39;,
                                                &#39;minimum&#39;: 5,
                                                &#39;maximum&#39;: 14.99,
                                                &#39;format&#39;: gold})
            row += 1

        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;between&#39;,
                                                &#39;minimum&#39;: 15,
                                                &#39;maximum&#39;: 24.99,
                                                &#39;format&#39;: plat})
            row += 1

        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                &#39;value&#39;: 25,
                                                &#39;format&#39;: black})
            row += 1

    index = column_names.index(&#39;% recanalization rate out of total ischemic incidence&#39;)
    angels_awards_recan(column_name=xl_col_to_name(index), coln=index)
    #angels_awards_recan(&#39;F&#39;)


    def angels_awards_processes(column_name, coln, count=True):
        &#34;&#34;&#34;Add conditional formatting to angels awards for processes.&#34;&#34;&#34;
        count = count
        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;between&#39;,
                                                &#39;minimum&#39;: 80,
                                                &#39;maximum&#39;: 84.99,
                                                &#39;format&#39;: gold})

            row += 1

        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;between&#39;,
                                                &#39;minimum&#39;: 85,
                                                &#39;maximum&#39;: 89.99,
                                                &#39;format&#39;: plat})
            row += 1

        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                &#39;value&#39;: 90,
                                                &#39;format&#39;: black})
            row += 1

    index = column_names.index(&#39;% suspected stroke patients undergoing CT/MRI&#39;)
    angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
    index = column_names.index(&#39;% all stroke patients undergoing dysphagia screening&#39;)
    angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
    index = column_names.index(&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;)
    angels_awards_processes(column_name=xl_col_to_name(index), coln=index)
    index = column_names.index(&#39;% afib patients discharged (home) with anticoagulants&#39;)
    angels_awards_processes(column_name=xl_col_to_name(index), coln=index)

    #angels_awards_processes(&#39;G&#39;, 4)
    #angels_awards_processes(&#39;H&#39;, 5)
    #angels_awards_processes(&#39;I&#39;, 6)
    #angels_awards_processes(&#39;J&#39;, 7)

    # setting colors of cells according to their values
    def angels_awards_hosp(column_name, coln):
        &#34;&#34;&#34;Add conditional formatting to angels awards for hospitalization.&#34;&#34;&#34;
        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                &#39;value&#39;: 0,
                                                &#39;format&#39;: plat})
            row += 1

        row = 4
        while row &lt; number_of_rows + 2:
            cell_n = column_name + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                &#39;value&#39;: 0.99,
                                                &#39;format&#39;: black})
            row += 1

    
    index = column_names.index(&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;)
    angels_awards_hosp(column_name=xl_col_to_name(index), coln=index)

    
    # set color for proposed angel award
    def proposed_award(column_name, coln):
        row = 4
        while row &lt; nrow + 2:
            cell_n = column + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                &#39;criteria&#39;: &#39;containing&#39;,
                                                &#39;value&#39;: &#39;NONE&#39;,
                                                &#39;format&#39;: green})
            row += 1

        row = 4
        while row &lt; nrow + 2:
            cell_n = column + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                &#39;criteria&#39;: &#39;containing&#39;,
                                                &#39;value&#39;: &#39;GOLD&#39;,
                                                &#39;format&#39;: gold})
            row += 1

        row = 4
        while row &lt; nrow + 2:
            cell_n = column + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                &#39;criteria&#39;: &#39;containing&#39;,
                                                &#39;value&#39;: &#39;PLATINUM&#39;,
                                                &#39;format&#39;: plat})
            row += 1

        row = 4
        while row &lt; nrow + 2:
            cell_n = column + str(row)
            worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                &#39;criteria&#39;: &#39;containing&#39;,
                                                &#39;value&#39;: &#39;DIAMOND&#39;,
                                                &#39;format&#39;: black})
            row += 1

    index = column_names.index(&#39;Proposed Award&#39;)
    column = xl_col_to_name(index)
    proposed_award(column, coln=index)
    #worksheet.write_column(3, index, awards)

    workbook1.close()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="resqdb.FormatData.GenerateFormattedStats"><code class="flex name class">
<span>class <span class="ident">GenerateFormattedStats</span></span>
<span>(</span><span>df, country=False, country_code=None, split_sites=False, site=None, report=None, quarter=None, comp=False, minimum_patients=0)</span>
</code></dt>
<dd>
<section class="desc"><p>This class generate formatted statistics in .xslx file. For angel awards are set colored conditions. </p>
<p>Keyword arguments:
df: the dataframe with statistcs
country: True if country should be included as site (default: False)
country_code: the code of country (default: None)
split_sites: True if you want to generate individual file fo each site (default: False)
site: the site code (default: None)
report: the report name (default: None)
quarter: the quarter name (default: None)</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class GenerateFormattedStats:
    &#34;&#34;&#34;
    This class generate formatted statistics in .xslx file. For angel awards are set colored conditions. 
    
    Keyword arguments:
        df: the dataframe with statistcs
        country: True if country should be included as site (default: False)
        country_code: the code of country (default: None)
        split_sites: True if you want to generate individual file fo each site (default: False)
        site: the site code (default: None)
        report: the report name (default: None)
        quarter: the quarter name (default: None)
    &#34;&#34;&#34;
    def __init__(self, df, country=False, country_code=None, split_sites=False, site=None, report=None, quarter=None, comp=False, minimum_patients=0):

        self.df_unformatted = df.copy()
        self.df = df.copy()
        self.country_code = country_code
        self.report = report
        self.quarter = quarter
        self.comp = comp
        self.minimum_patients = minimum_patients
        self.total_patients_column = &#39;# total patients &gt;= {0}&#39;.format(self.minimum_patients)

        def delete_columns(columns):
            for i in columns:
                if i in self.df.columns:
                    self.df.drop([i], inplace=True, axis=1)
        # Drop tmp column 
        delete_columns([&#39;isch_patients&#39;, &#39;is_ich_patients&#39;, &#39;is_ich_tia_cvt_patients&#39;, &#39;is_ich_cvt_patients&#39;, &#39;is_tia_patients&#39;, &#39;is_ich_sah_cvt_patients&#39;, &#39;is_tia_cvt_patients&#39;, &#39;cvt_patients&#39;, &#39;ich_sah_patients&#39;, &#39;ich_patients&#39;,  &#39;sah_patients&#39;, &#39;discharge_subset_patients&#39;,&#39;discharge_subset_alive_patients&#39;, &#39;neurosurgery_patients&#39;, &#39;not_reffered_patients&#39;, &#39;reffered_patients&#39;, &#39;afib_detected_during_hospitalization_patients&#39;, &#39;afib_not_detected_or_not_known_patients&#39;, &#39;antithrombotics_patients&#39;, &#39;ischemic_transient_dead_patients&#39;, &#39;afib_flutter_not_detected_or_not_known_patients&#39;, &#39;afib_flutter_not_detected_or_not_known_dead_patients&#39;, &#39;prescribed_antiplatelets_no_afib_patients&#39;, &#39;prescribed_antiplatelets_no_afib_dead_patients&#39;, &#39;afib_flutter_detected_patients&#39;, &#39;anticoagulants_recommended_patients&#39;, &#39;afib_flutter_detected_dead_patients&#39;, &#39;recommended_antithrombotics_with_afib_alive_patients&#39;, &#39;discharge_subset_same_centre_patients&#39;, &#39;discharge_subset_another_centre_patients&#39;, &#39;patients_eligible_recanalization&#39;, &#39;# patients having stroke in the hospital - No&#39;, &#39;% patients having stroke in the hospital - No&#39;, &#39;# recurrent stroke - No&#39;, &#39;% recurrent stroke - No&#39;, &#39;# patients assessed for rehabilitation - Not known&#39;, &#39;% patients assessed for rehabilitation - Not known&#39;, &#39;# level of consciousness - not known&#39;, &#39;% level of consciousness - not known&#39;, &#39;# CT/MRI - Performed later than 1 hour after admission&#39;, &#39;% CT/MRI - Performed later than 1 hour after admission&#39;, &#39;# patients put on ventilator - Not known&#39;, &#39;% patients put on ventilator - Not known&#39;, &#39;# patients put on ventilator - No&#39;, &#39;% patients put on ventilator - No&#39;, &#39;# IV tPa&#39;, &#39;% IV tPa&#39;, &#39;# TBY&#39;, &#39;% TBY&#39;, &#39;# DIDO TBY&#39;, &#39;# dysphagia screening - not known&#39;, &#39;% dysphagia screening - not known&#39;, &#39;# dysphagia screening time - After first 24 hours&#39;, &#39;% dysphagia screening time - After first 24 hours&#39;, &#39;# other afib detection method - Not detected or not known&#39;, &#39;% other afib detection method - Not detected or not known&#39;, &#39;# carotid arteries imaging - Not known&#39;, &#39;% carotid arteries imaging - Not known&#39;, &#39;# carotid arteries imaging - No&#39;, &#39;% carotid arteries imaging - No&#39;, &#39;vascular_imaging_cta_norm&#39;, &#39;vascular_imaging_mra_norm&#39;, &#39;vascular_imaging_dsa_norm&#39;, &#39;vascular_imaging_none_norm&#39;, &#39;bleeding_arterial_hypertension_perc_norm&#39;, &#39;bleeding_aneurysm_perc_norm&#39;, &#39;bleeding_arterio_venous_malformation_perc_norm&#39;, &#39;bleeding_anticoagulation_therapy_perc_norm&#39;, &#39;bleeding_amyloid_angiopathy_perc_norm&#39;, &#39;bleeding_other_perc_norm&#39;, &#39;intervention_endovascular_perc_norm&#39;, &#39;intervention_neurosurgical_perc_norm&#39;, &#39;intervention_other_perc_norm&#39;, &#39;intervention_referred_perc_norm&#39;, &#39;intervention_none_perc_norm&#39;, &#39;vt_treatment_anticoagulation_perc_norm&#39;, &#39;vt_treatment_thrombectomy_perc_norm&#39;, &#39;vt_treatment_local_thrombolysis_perc_norm&#39;, &#39;vt_treatment_local_neurological_treatment_perc_norm&#39;, &#39;except_recommended_patients&#39;, &#39;afib_detected_discharged_home_patients&#39;, &#39;% dysphagia screening done&#39;, &#39;# dysphagia screening done&#39;, &#39;alert_all&#39;, &#39;alert_all_perc&#39;, &#39;drowsy_all&#39;, &#39;drowsy_all_perc&#39;, &#39;comatose_all&#39;, &#39;comatose_all_perc&#39;, &#39;antithrombotics_patients_with_cvt&#39;, &#39;ischemic_transient_cerebral_dead_patients&#39;, &#39;# patients receiving antiplatelets with CVT&#39;, &#39;% patients receiving antiplatelets with CVT&#39;, &#39;# patients receiving Vit. K antagonist with CVT&#39;, &#39;% patients receiving Vit. K antagonist with CVT&#39;, &#39;# patients receiving dabigatran with CVT&#39;, &#39;% patients receiving dabigatran with CVT&#39;, &#39;# patients receiving rivaroxaban with CVT&#39;, &#39;% patients receiving rivaroxaban with CVT&#39;, &#39;# patients receiving apixaban with CVT&#39;, &#39;% patients receiving apixaban with CVT&#39;, &#39;# patients receiving edoxaban with CVT&#39;, &#39;% patients receiving edoxaban with CVT&#39;, &#39;# patients receiving LMWH or heparin in prophylactic dose with CVT&#39;, &#39;% patients receiving LMWH or heparin in prophylactic dose with CVT&#39;, &#39;# patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;, &#39;% patients receiving LMWH or heparin in full anticoagulant dose with CVT&#39;, &#39;# patients not prescribed antithrombotics, but recommended with CVT&#39;, &#39;% patients not prescribed antithrombotics, but recommended with CVT&#39;, &#39;# patients neither receiving antithrombotics nor recommended with CVT&#39;, &#39;% patients neither receiving antithrombotics nor recommended with CVT&#39;, &#39;# patients prescribed antithrombotics with CVT&#39;, &#39;% patients prescribed antithrombotics with CVT&#39;, &#39;# patients prescribed or recommended antithrombotics with CVT&#39;, &#39;% patients prescribed or recommended antithrombotics with CVT&#39;, &#39;afib_flutter_not_detected_or_not_known_patients_with_cvt&#39;, &#39;afib_flutter_not_detected_or_not_known_dead_patients_with_cvt&#39;, &#39;prescribed_antiplatelets_no_afib_patients_with_cvt&#39;, &#39;prescribed_antiplatelets_no_afib_dead_patients_with_cvt&#39;, &#39;# patients prescribed antiplatelets without aFib with CVT&#39;, &#39;% patients prescribed antiplatelets without aFib with CVT&#39;, &#39;afib_flutter_detected_patients_with_cvt&#39;, &#39;# patients prescribed anticoagulants with aFib with CVT&#39;, &#39;anticoagulants_recommended_patients_with_cvt&#39;, &#39;afib_flutter_detected_dead_patients_with_cvt&#39;, &#39;% patients prescribed anticoagulants with aFib with CVT&#39;, &#39;# patients prescribed antithrombotics with aFib with CVT&#39;, &#39;recommended_antithrombotics_with_afib_alive_patients_with_cvt&#39;, &#39;% patients prescribed antithrombotics with aFib with CVT&#39;, &#39;afib_flutter_detected_patients_not_dead&#39;, &#39;except_recommended_discharged_home_patients&#39;, &#39;afib_detected_discharged_patients&#39;, &#39;ischemic_transient_dead_patients_prescribed&#39;, &#39;is_tia_discharged_home_patients&#39;])

        # Connect to database and get country name according to country code.
        def select_country(value):
            country_name = pytz.country_names[value]
            return country_name

        # If country is used as site, the country name is selected from countries dictionary by country code. :) 
        if (country):
            if self.country_code == &#39;UZB&#39;:
                self.country_code = &#39;UZ&#39;
            self.country_name = select_country(self.country_code)
        else:
            self.country_name = None

        # If split_sites is True, then go through dataframe and generate graphs for each site (the country will be included as site in each file).
        site_ids = self.df[&#39;Site ID&#39;].tolist()
        # Delete country name from side ids list.
        try:
            site_ids.remove(self.country_name)
        except:
            pass
       
        if site is not None:
            df = self.df[self.df[&#39;Site ID&#39;].isin([site, self.country_name])].copy()
            df_unformatted = self.df_unformatted[self.df_unformatted[&#39;Site ID&#39;].isin([site, self.country_name])].copy()
            self._generate_formatted_statistics(df=df, df_tmp=df_unformatted, site_code=site)

        # Generate formatted statistics for all sites individualy + country as site is included
        if (split_sites) and site is None:
            for i in site_ids:
                df = self.df[self.df[&#39;Site ID&#39;].isin([i, self.country_name])].copy()
                df_unformatted = self.df_unformatted[self.df_unformatted[&#39;Site ID&#39;].isin([i, self.country_name])].copy()
                self._generate_formatted_statistics(df=df, df_tmp=df_unformatted, site_code=i)
    
        # Produce formatted statistics for all sites + country as site
        if site is None:
            self._generate_formatted_statistics(df=self.df, df_tmp=self.df_unformatted)

    def _generate_formatted_statistics(self, df, df_tmp, site_code=None):
        &#34;&#34;&#34;Generate formatted statistics in xlsx file.
        
        Keyword arguments:
            df: the dataframe with statistics containing only necessary columns
            df_tmp: the dataframe with statistics containing all calculation
            site_code: the code of site (default: NOne)
        &#34;&#34;&#34;

        if self.country_code is None and site_code is None:
            name_of_unformatted_stats = self.report + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            name_of_output_file = self.report + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;
        elif site_code is None:
            name_of_unformatted_stats = self.report + &#34;_&#34; + self.country_code + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            name_of_output_file = self.report + &#34;_&#34; + self.country_code + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;
        else:
            # self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            # self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;
            name_of_unformatted_stats = self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.csv&#34;
            name_of_output_file = self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;.xlsx&#34;

        df_tmp.to_csv(name_of_unformatted_stats, sep=&#34;,&#34;, encoding=&#39;utf-8&#39;, index=False)
        workbook1 = xlsxwriter.Workbook(name_of_output_file, {&#39;strings_to_numbers&#39;: True})
        # create worksheet
        worksheet = workbook1.add_worksheet()

        # set width of columns
        worksheet.set_column(0, 4, 15)
        worksheet.set_column(4, 350, 60)
        # number of columns
        
        ncol = len(df.columns) - 1
       # print(ncol)

        # number of rows
        nrow = len(df) + 2

        column_names = df.columns.tolist()
        col = []
        for i in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = column_names[i]
            col.append(tmp)

        #df = statistics[0:nrow]
        # print(statistics)

        statistics = df.values.tolist()

        ########################
        # DICTIONARY OF COLORS #
        ########################
        colors = {
            &#34;gender&#34;: &#34;#477187&#34;,
            &#34;stroke_hosp&#34;: &#34;#535993&#34;,
            &#34;recurrent_stroke&#34;: &#34;#D4B86A&#34;,
            &#34;department_type&#34;: &#34;#D4A46A&#34;,
            &#34;hospitalization&#34;: &#34;#D4916A&#34;,
            &#34;rehab&#34;: &#34;#D4BA6A&#34;,
            &#34;stroke&#34;: &#34;#565595&#34;,
            &#34;consciousness&#34;: &#34;#468B78&#34;,
            &#34;gcs&#34;: &#34;#B9D6C1&#34;,
            &#34;nihss&#34;: &#34;#C5D068&#34;,
            &#34;ct_mri&#34;: &#34;#AA8739&#34;,
            &#34;vasc_img&#34;: &#34;#277650&#34;,
            &#34;ventilator&#34;: &#34;#AA5039&#34;,
            &#34;recanalization_procedure&#34;: &#34;#7F4C91&#34;,
            &#34;median_times&#34;: &#34;#BEBCBC&#34;,
            &#34;dysphagia&#34;: &#34;#F49B5B&#34;,
            &#34;hemicraniectomy&#34;: &#34;#A3E4D7&#34;,
            &#34;neurosurgery&#34;: &#34;#F8C471&#34;,
            &#34;neurosurgery_type&#34;: &#34;#CACFD2&#34;,
            &#34;bleeding_reason&#34;: &#34;#CB4335&#34;,
            &#34;bleeding_source&#34;: &#34;#9B59B6&#34;,
            &#34;intervention&#34;: &#34;#5DADE2&#34;,
            &#34;vt_treatment&#34;: &#34;#F5CBA7&#34;,
            &#34;afib&#34;: &#34;#A2C3F3&#34;,
            &#34;carot&#34;: &#34;#F1C40F&#34;,
            &#34;antithrombotics&#34;: &#34;#B5E59F&#34;,
            &#34;statin&#34;: &#34;#28B463&#34;,
            &#34;carotid_stenosis&#34;: &#34;#B9D6C1&#34;,
            &#34;carot_foll&#34;: &#34;#BFC9CA&#34;,
            &#34;antihypertensive&#34;: &#34;#7C7768&#34;,
            &#34;smoking&#34;: &#34;#F9C991&#34;,
            &#34;cerebrovascular&#34;: &#34;#91C09E&#34;,
            &#34;discharge_destination&#34;: &#34;#C0EFF5&#34;,
            &#34;discharge_destination_same_centre&#34;: &#34;#56A3A6&#34;,
            &#34;discharge_destination_another_centre&#34;: &#34;#E8DF9C&#34;,
            &#34;discharge_destination_within_another_centre&#34;: &#34;#538083&#34;,
            &#34;angel_awards&#34;: &#34;#B87333&#34;,
            &#34;angel_resq_awards&#34;: &#34;#341885&#34;,
            &#34;columns&#34;: &#34;#3378B8&#34;,
            &#34;green&#34;: &#34;#A1CCA1&#34;,
            &#34;orange&#34;: &#34;#DF7401&#34;,
            &#34;gold&#34;: &#34;#FFDF00&#34;,
            &#34;platinum&#34;: &#34;#c0c0c0&#34;,
            &#34;black&#34;: &#34;#ffffff&#34;,
            &#34;red&#34;: &#34;#F45D5D&#34;
        }

        #statistics = statistics[1:nrow]

        ##########
        # GENDER #
        ##########
        # set formatting for gender
        gender = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;gender&#34;)})

        gender_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;gender&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients female&#39;)
        last_index = column_names.index(&#39;% patients male&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        #worksheet.merge_range(&#39;E1:H1&#39;, &#39;GENDER&#39;, gender)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;GENDER&#39;, gender)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, gender_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, gender_color)

        ##########################
        # STROKE IN THE HOSPITAL #
        ##########################
        stroke_hosp = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;stroke_hosp&#34;)})

        stroke_hosp_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;stroke_hosp&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients having stroke in the hospital - Yes&#39;)
        last_index = column_names.index(&#39;% patients having stroke in the hospital - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;STROKE IN THE HOSPITAL&#39;, stroke_hosp)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, stroke_hosp_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, stroke_hosp_color)

        ####################
        # RECURRENT STROKE #
        ####################
        # set formatting for recurrent stroke
        recurrent_stroke = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;recurrent_stroke&#34;)})

        recurrent_stroke_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;recurrent_stroke&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# recurrent stroke - Yes&#39;)
        last_index = column_names.index(&#39;% recurrent stroke - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;RECURRENT STROKE&#39;, recurrent_stroke)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, recurrent_stroke_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, recurrent_stroke_color)

        ###################
        # DEPARTMENT TYPE #
        ###################

        department_type = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;department_type&#34;)})

        department_type_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;department_type&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# department type - neurology&#39;)
        last_index = column_names.index(&#39;% department type - Other&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DEPARTMENT TYPE&#39;, department_type)
        
        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, department_type_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, department_type_color)
        
        ###################
        # HOSPITALIZATION #
        ###################

        hospitalization = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;hospitalization&#34;)})

        hospitalization_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;hospitalization&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients hospitalized in stroke unit / ICU&#39;)
        last_index = column_names.index(&#39;% patients hospitalized in standard bed&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;HOSPITALIZATION&#39;, hospitalization)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, hospitalization_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, hospitalization_color)

        #############################
        # REHABILITATION ASSESSMENT #
        #############################

        rehab_assess = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;rehab&#34;)})

        rehab_assess_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;rehab&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients assessed for rehabilitation - Yes&#39;)
        last_index = column_names.index(&#39;% patients assessed for rehabilitation - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;REHABILITATION ASSESSMENT&#39;, rehab_assess)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, rehab_assess_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, rehab_assess_color)

        ###############
        # STROKE TYPE #
        ###############
        stroke_type = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;stroke&#34;)})

        stroke_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;stroke&#34;),
            &#39;text_wrap&#39;: True})


        first_index = column_names.index(&#39;# stroke type - ischemic stroke&#39;)
        last_index = column_names.index(&#39;% stroke type - undetermined stroke&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;STROKE TYPE&#39;, stroke_type)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients&#39;, stroke_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, stroke_color)

        #######################
        # CONSCIOUSNESS LEVEL #
        #######################

        consciousness_level = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;consciousness&#34;)})

        consciousness_level_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;consciousness&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# level of consciousness - alert&#39;)
        last_index = column_names.index(&#39;% level of consciousness - GCS&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CONSCIOUSNESS LEVEL&#39;, consciousness_level)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + ICH&#39;, consciousness_level_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, consciousness_level_color)

        #######
        # GCS #
        #######

        gcs = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;gcs&#34;)})

        gcs_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;gcs&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# GCS - 15-13&#39;)
        last_index = column_names.index(&#39;% GCS - &lt;8&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;GLASGOW COMA SCALE&#39;, gcs)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + ICH&#39;, gcs_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, gcs_color)

        #########
        # NIHSS #
        #########
        nihss = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;nihss&#34;)})

        nihss_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;nihss&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# NIHSS - Not performed&#39;)
        last_index = column_names.index(&#39;NIHSS median score&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;NIHSS&#39;, nihss)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + ICH + CVT&#39;, nihss_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, nihss_color)

        ##########
        # CT/MRI #
        ##########
        ct_mri = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;ct_mri&#34;)})

        ct_mri_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;ct_mri&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# CT/MRI - Not performed&#39;)
        last_index = column_names.index(&#39;% CT/MRI - Performed within 1 hour after admission&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CT/MRI&#39;, ct_mri)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # CT/MRI performed&#39;, ct_mri_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, ct_mri_color)

        ####################
        # VASCULAR IMAGING #
        ####################
        vascular_imaging = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;vasc_img&#34;)})

        vascular_imaging_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;vasc_img&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# vascular imaging - CTA&#39;)
        last_index = column_names.index(&#39;% vascular imaging - two modalities&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)
        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;VASCULAR IMAGING&#39;, vascular_imaging)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH + SAH&#39;, vascular_imaging_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, vascular_imaging_color)

        ##############
        # VENTILATOR #
        ##############
        ventilator = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;ventilator&#34;)})

        ventilator_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;ventilator&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients put on ventilator - Yes&#39;)
        last_index = column_names.index(&#39;% patients put on ventilator - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;VENTILATOR&#39;, ventilator)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + ICH + CVT&#39;, ventilator_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, ventilator_color)

        #############################
        # RECANALIZATION PROCEDURES #
        #############################
        recanalization_procedures = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;recanalization_procedure&#34;)})

        recanalization_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;recanalization_procedure&#34;),
            &#39;text_wrap&#39;: True})


        first_index = column_names.index(&#39;# recanalization procedures - Not done&#39;)
        last_index = column_names.index(&#39;% recanalization procedures - Returned to the initial centre after recanalization procedures were performed at another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;RECANALIZATION PROCEDURES&#39;, recanalization_procedures)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic stroke&#39;, recanalization_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, recanalization_color)

        ################
        # MEDIAN TIMES #
        ################
        median_times = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;median_times&#34;)})

        median_times_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;median_times&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;Median DTN (minutes)&#39;)
        last_index = column_names.index(&#39;Median TBY DIDO (minutes)&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;MEDIAN TIMES (minutes)&#39;, median_times)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, median_times_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, median_times_color)

        #############
        # DYSPHAGIA #
        #############
        dysphagia = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;)})

        dysphagia_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# dysphagia screening - Guss test&#39;)
        last_index = column_names.index(&#39;% dysphagia screening - Unable to test&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DYSPHAGIA SCREENING&#39;, dysphagia)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + ICH + CVT&#39;, dysphagia_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, dysphagia_color)

        #############
        # DYSPHAGIA #
        #############
        dysphagia = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;)})

        dysphagia_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;dysphagia&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# dysphagia screening time - Within first 24 hours&#39;)
        last_index = column_names.index(&#39;% dysphagia screening time - Within first 24 hours&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DYSPHAGIA TIMES&#39;, dysphagia)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # Guss test + other test&#39;, dysphagia_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, dysphagia_color)

        ###################
        # HEMICRANIECTOMY #
        ###################
        hemicraniectomy = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;hemicraniectomy&#34;)})

        hemicraniectomy_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;hemicraniectomy&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# hemicraniectomy - Yes&#39;)
        last_index = column_names.index(&#39;% hemicraniectomy - Referred to another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;HEMICRANIECTOMY&#39;, hemicraniectomy)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS&#39;, hemicraniectomy_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, hemicraniectomy_color)

        ################
        # NEUROSURGERY #
        ################
        neurosurgery = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery&#34;)})

        neurosurgery_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# neurosurgery - Not known&#39;)
        last_index = column_names.index(&#39;% neurosurgery - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;NEUROSURGERY&#39;, neurosurgery)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, neurosurgery_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, neurosurgery_color)


        #####################
        # NEUROSURGERY TYPE #
        #####################
        neurosurgery_type = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery_type&#34;)})

        neurosurgery_type_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;neurosurgery_type&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# neurosurgery type - intracranial hematoma evacuation&#39;)
        last_index = column_names.index(&#39;% neurosurgery type - Referred to another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;NEUROSURGERY TYPE&#39;, neurosurgery_type)


        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, neurosurgery_type_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, neurosurgery_type_color)


        ###################
        # BLEEDING REASON #
        ###################
        bleeding_reason = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;bleeding_reason&#34;)})

        bleeding_reason_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;bleeding_reason&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# bleeding reason - arterial hypertension&#39;)
        last_index = column_names.index(&#39;% bleeding reason - more than one&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;BLEEDING REASON&#39;, bleeding_reason)


        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, bleeding_reason_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, bleeding_reason_color)

        ###################
        # BLEEDING SOURCE #
        ###################
        bleeding_source = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;bleeding_source&#34;)})

        bleeding_source_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;bleeding_source&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# bleeding source - Known&#39;)
        last_index = column_names.index(&#39;% bleeding source - Not known&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;BLEEDING SOURCE&#39;, bleeding_source)


        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ICH&#39;, bleeding_source_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, bleeding_source_color)

        ################
        # INTERVENTION #
        ################
        intervention = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;intervention&#34;)})

        intervention_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;intervention&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# intervention - endovascular (coiling)&#39;)
        last_index = column_names.index(&#39;% intervention - more than one&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;INTERVENTION&#39;, intervention)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # SAH&#39;, intervention_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, intervention_color)

        ################
        # VT TREATMENT #
        ################
        vt_treatment = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;vt_treatment&#34;)})

        vt_treatment_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;vt_treatment&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# VT treatment - anticoagulation&#39;)
        last_index = column_names.index(&#39;% VT treatment - more than one treatment&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;VENOUS THROMBOSIS TREATMENT&#39;, vt_treatment)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # CVT&#39;, intervention_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, intervention_color)

        #######################
        # ATRIAL FIBRILLATION #
        #######################
        atrial_fibrillation = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;afib&#34;)})

        afib_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;afib&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# afib/flutter - Known&#39;)
        last_index = column_names.index(&#39;% other afib detection method - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ATRIAL FIBRILLATION&#39;, atrial_fibrillation)

        first_index = column_names.index(&#39;# afib/flutter - Known&#39;)
        last_index = column_names.index(&#39;% afib/flutter - Not known&#39;)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # ischemic + TIA&#39;, afib_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, afib_color)

        first_index = column_names.index(&#39;# afib detection method - Telemetry with monitor allowing automatic detection of aFib&#39;)
        last_index = column_names.index(&#39;# other afib detection method - Yes&#39;)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # detected during hospitalization&#39;, afib_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, afib_color)

        worksheet.write(xl_rowcol_to_cell(1, column_names.index(&#39;% other afib detection method - Yes&#39;)), &#39;out of # not detected + not known&#39;, afib_color)


        ####################
        # CAROTID ARTERIES #
        ####################
        carot = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;carot&#34;)})

        carot_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;carot&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# carotid arteries imaging - Yes&#39;)
        last_index = column_names.index(&#39;% carotid arteries imaging - Yes&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CAROTID ARTERIES IMAGING&#39;, carot)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # alive ischemic + TIA&#39;, carot_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, carot_color)


        ###################
        # ANTITHROMBOTICS #
        ###################
        antithrombotics = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;antithrombotics&#34;)})

        antithrombotics_colors = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;antithrombotics&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients receiving antiplatelets&#39;)
        last_index = column_names.index(&#39;% patients prescribed antithrombotics with aFib&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ANTITHROMBOTICS&#39;, antithrombotics)

        first_index = column_names.index(&#39;# patients receiving antiplatelets&#39;)
        last_index = column_names.index(&#39;% patients receiving LMWH or heparin in full anticoagulant dose&#39;)
        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # alive ischemic + TIA + CVT&#39;, antithrombotics_colors)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, antithrombotics_colors)

        first_index = column_names.index(&#39;% patients prescribed anticoagulants with aFib&#39;)
        last_index = column_names.index(&#39;% patients prescribed antithrombotics with aFib&#39;)
        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # alive with AF+&#39;, antithrombotics_colors)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, antithrombotics_colors)

        ##########
        # STATIN #
        ##########
        statin = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;statin&#34;)})

        statin_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;statin&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# patients prescribed statins - Yes&#39;)
        last_index = column_names.index(&#39;% patients prescribed statins - Not known&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;STATINS&#39;, statin)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + TIA&#39;, statin_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, statin_color)


        ####################
        # CAROTID STENOSIS #
        ####################
        carotid_stenosis = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;carotid_stenosis&#34;)})

        carotid_stenosis_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;carotid_stenosis&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# carotid stenosis - 50%-70%&#39;)
        last_index = column_names.index(&#39;% carotid stenosis - Not known&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CAROTID STENOSIS&#39;, carotid_stenosis)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + TIA&#39;, carotid_stenosis_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, carotid_stenosis_color)

        ##############################
        # CAROTID STENOSIS FOLLOW UP #
        ##############################
        carotid_stenosis_foll = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;carot_foll&#34;)})

        carotid_stenosis_foll_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;carot_foll&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# carotid stenosis followup - Yes&#39;)
        last_index = column_names.index(&#39;% carotid stenosis followup - Referred to another centre&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CAROTID STENOSIS FOLLOW UP&#39;, carotid_stenosis_foll)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # IS + TIA&#39;, carotid_stenosis_foll_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, carotid_stenosis_foll_color)

        ###############################
        # ANTIHYPERTENSIVE MEDICATION #
        ###############################
        antihypertensive = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;antihypertensive&#34;)})

        antihypertensive_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;antihypertensive&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# prescribed antihypertensives - Not known&#39;)
        last_index = column_names.index(&#39;% prescribed antihypertensives - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ANTIHYPERTENSIVE MEDICATION&#39;, antihypertensive)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, antihypertensive_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, antihypertensive_color)


        #####################
        # SMOKING CESSATION #
        #####################
        smoking = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;smoking&#34;)})

        smoking_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;smoking&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# recommended to a smoking cessation program - not a smoker&#39;)
        last_index = column_names.index(&#39;% recommended to a smoking cessation program - No&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;SMOKING CESSATION&#39;, smoking)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, smoking_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, smoking_color)


        ##########################
        # Cerebrovascular expert #
        ##########################
        cerebrovascular = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;cerebrovascular&#34;)})

        cerebrovascular_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;cerebrovascular&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# recommended to a cerebrovascular expert - Recommended, and appointment was made&#39;)
        last_index = column_names.index(&#39;% recommended to a cerebrovascular expert - Not recommended&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;CEREBROVASCULAR EXPERT&#39;, cerebrovascular)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, cerebrovascular_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, cerebrovascular_color)

        #########################
        # DISCHARGE DESTINATION #
        #########################

        discharge_destination = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination&#34;)})

        destination_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# discharge destination - Home&#39;)
        last_index = column_names.index(&#39;% discharge destination - Dead&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION&#39;, discharge_destination)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # total patients - # ichemic reffered to another centre&#39;, destination_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, destination_color)

        ##################################################
        # DISCHARGE DESTINATION - WITHIN THE SAME CENTRE #
        ##################################################

        discharge_destination_same_centre = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_same_centre&#34;)})

        discharge_destination_same_centre_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_same_centre&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# transferred within the same centre - Acute rehabilitation&#39;)
        last_index = column_names.index(&#39;% transferred within the same centre - Another department&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION WITHIN THE SAME CENTRE&#39;, discharge_destination_same_centre)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # transferred within the same centre&#39;, discharge_destination_same_centre_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, discharge_destination_same_centre_color)

        #########################################################
        # DISCHARGE DESTINATION - TRANSFERRED TO ANOTHER CENTRE #
        #########################################################

        discharge_destination_another_centre = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_another_centre&#34;)})

        discharge_destination_another_centre_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_another_centre&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# transferred to another centre - Stroke centre&#39;)
        last_index = column_names.index(&#39;% transferred to another centre - Another hospital&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION TRANSFERRED TO ANOTHER CENTRE&#39;, discharge_destination_another_centre)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # transferred to another centre&#39;, discharge_destination_another_centre_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, discharge_destination_another_centre_color)

        ################################################################
        # DISCHARGE DESTINATION - TRANSFERRED TO WITHIN ANOTHER CENTRE #
        ################################################################

        discharge_destination_within_another_centre = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_within_another_centre&#34;)})

        discharge_destination_within_another_centre_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;discharge_destination_within_another_centre&#34;),
            &#39;text_wrap&#39;: True})

        first_index = column_names.index(&#39;# department transferred to within another centre - Acute rehabilitation&#39;)
        last_index = column_names.index(&#39;% department transferred to within another centre - Another department&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;DISCHARGE DESTINATION TRANSFERRED WITHIN TO ANOTHER CENTRE&#39;, discharge_destination_within_another_centre)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;out of # transferred to another centre&#39;, discharge_destination_within_another_centre_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, discharge_destination_within_another_centre_color)

        ################
        # angel awards #
        ################
        awards = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;border&#39;: 0,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        awards_color = workbook1.add_format({
            &#39;fg_color&#39;: colors.get(&#34;angel_awards&#34;)})

        first_index = column_names.index(self.total_patients_column)
        last_index = column_names.index(&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;)
        first_cell = xl_rowcol_to_cell(0, first_index)
        last_cell = xl_rowcol_to_cell(0, last_index)

        worksheet.merge_range(first_cell + &#34;:&#34; + last_cell, &#39;ESO ANGELS AWARDS&#39;, awards)

        for i in range(first_index, last_index+1):
            if column_names[i].startswith(&#39;%&#39;):
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, awards_color)
            else:
                worksheet.write(xl_rowcol_to_cell(1, i), &#39;&#39;, awards_color)

        hidden_columns = [&#39;# patients treated with door to thrombolysis &lt; 60 minutes&#39;, &#39;# patients treated with door to thrombolysis &lt; 45 minutes&#39;, &#39;# patients treated with door to thrombectomy &lt; 90 minutes&#39;, &#39;# patients treated with door to thrombectomy &lt; 60 minutes&#39;, &#39;# recanalization rate out of total ischemic incidence&#39;, &#39;# suspected stroke patients undergoing CT/MRI&#39;, &#39;# all stroke patients undergoing dysphagia screening&#39;, &#39;# ischemic stroke patients discharged with antiplatelets&#39;, &#39;% ischemic stroke patients discharged with antiplatelets&#39;, &#39;# ischemic stroke patients discharged home with antiplatelets&#39;, &#39;% ischemic stroke patients discharged home with antiplatelets&#39;, &#39;# ischemic stroke patients discharged (home) with antiplatelets&#39;, &#39;# afib patients discharged with anticoagulants&#39;, &#39;% afib patients discharged with anticoagulants&#39;, &#39;# afib patients discharged home with anticoagulants&#39;, &#39;% afib patients discharged home with anticoagulants&#39;, &#39;# afib patients discharged (home) with anticoagulants&#39;, &#39;# stroke patients treated in a dedicated stroke unit / ICU&#39;, &#39;% stroke patients treated in a dedicated stroke unit / ICU&#39;]
                                        
        for i in hidden_columns:
            index = column_names.index(i)
            column = xl_col_to_name(index)
            worksheet.set_column(column + &#34;:&#34; + column, None, None, {&#39;hidden&#39;: True})

        # format for green color
        green = workbook1.add_format({
            &#39;bold&#39;: 2,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;green&#34;)})

        # format for gold color
        gold = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;gold&#34;)})

        # format for platinum color
        plat = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;platinum&#34;)})

        # format for gold black
        black = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: &#39;#000000&#39;,
            &#39;color&#39;: colors.get(&#34;black&#34;)})

        # format for red color
        red = workbook1.add_format({
            &#39;bold&#39;: 1,
            &#39;align&#39;: &#39;center&#39;,
            &#39;valign&#39;: &#39;vcenter&#39;,
            &#39;bg_color&#39;: colors.get(&#34;red&#34;)})


        # add table into worksheet
        options = {&#39;data&#39;: statistics,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 8&#39;
                   }

        worksheet.add_table(2, 0, nrow, ncol, options)

        # total number of rows
        number_of_rows = len(statistics) + 2

        if not self.comp:    
            # if cell contain TRUE in column &gt; 30 patients (DR) it will be colored to green
            awards = []
            row = 4
            index = column_names.index(self.total_patients_column)
            while row &lt; nrow + 2:
                cell_n = xl_col_to_name(index) + str(row)
                worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                    &#39;criteria&#39;: &#39;containing&#39;,
                                                    &#39;value&#39;: &#39;TRUE&#39;,
                                                    &#39;format&#39;: green})
                row += 1

            def angels_awards_ivt_60(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 60.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 50,
                                                        &#39;maximum&#39;: 74.99,
                                                        &#39;format&#39;: gold})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 75,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 60 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_60(column, coln=index)

            index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 90 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_60(column, coln=index)


            def angels_awards_ivt_45(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for ivt &lt; 45.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                        &#39;value&#39;: 49.99,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 50,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% patients treated with door to thrombolysis &lt; 45 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_45(column, coln=index)

            index = column_names.index(&#39;% patients treated with door to thrombectomy &lt; 60 minutes&#39;)
            column = xl_col_to_name(index)
            angels_awards_ivt_45(column, coln=index)

            # setting colors of cells according to their values
            def angels_awards_recan(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for recaalization procedures.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 5,
                                                        &#39;maximum&#39;: 14.99,
                                                        &#39;format&#39;: gold})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 15,
                                                        &#39;maximum&#39;: 24.99,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 25,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% recanalization rate out of total ischemic incidence&#39;)
            column = xl_col_to_name(index)
            angels_awards_recan(column, coln=index)

            def angels_awards_processes(column_name, coln, count=True):
                &#34;&#34;&#34;Add conditional formatting to angels awards for processes.&#34;&#34;&#34;
                count = count
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 80,
                                                        &#39;maximum&#39;: 84.99,
                                                        &#39;format&#39;: gold})

                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;between&#39;,
                                                        &#39;minimum&#39;: 85,
                                                        &#39;maximum&#39;: 89.99,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 90,
                                                        &#39;format&#39;: black})
                    row += 1


            index = column_names.index(&#39;% suspected stroke patients undergoing CT/MRI&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            index = column_names.index(&#39;% all stroke patients undergoing dysphagia screening&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            index = column_names.index(&#39;% ischemic stroke patients discharged (home) with antiplatelets&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            index = column_names.index(&#39;% afib patients discharged (home) with anticoagulants&#39;)
            column = xl_col_to_name(index)
            angels_awards_processes(column, coln=index)

            # setting colors of cells according to their values
            def angels_awards_hosp(column_name, coln):
                &#34;&#34;&#34;Add conditional formatting to angels awards for hospitalization.&#34;&#34;&#34;
                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&lt;=&#39;,
                                                        &#39;value&#39;: 0,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; number_of_rows + 2:
                    cell_n = column_name + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;cell&#39;,
                                                        &#39;criteria&#39;: &#39;&gt;=&#39;,
                                                        &#39;value&#39;: 0.99,
                                                        &#39;format&#39;: black})
                    row += 1

            index = column_names.index(&#39;% stroke patients treated in a dedicated stroke unit / ICU (2nd)&#39;)
            column = xl_col_to_name(index)
            angels_awards_hosp(column, coln=index)

            # set color for proposed angel award
            def proposed_award(column_name, coln):
                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;NONE&#39;,
                                                        &#39;format&#39;: green})
                    row += 1

                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;GOLD&#39;,
                                                        &#39;format&#39;: gold})
                    row += 1

                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;PLATINUM&#39;,
                                                        &#39;format&#39;: plat})
                    row += 1

                row = 4
                while row &lt; nrow + 2:
                    cell_n = column + str(row)
                    worksheet.conditional_format(cell_n, {&#39;type&#39;: &#39;text&#39;,
                                                        &#39;criteria&#39;: &#39;containing&#39;,
                                                        &#39;value&#39;: &#39;DIAMOND&#39;,
                                                        &#39;format&#39;: black})
                    row += 1

            index = column_names.index(&#39;Proposed Award&#39;)
            column = xl_col_to_name(index)
            proposed_award(column, coln=index)
            #worksheet.write_column(3, index, awards)

            
        else:
            pass

        workbook1.close()</code></pre>
</details>
</dd>
<dt id="resqdb.FormatData.GeneratePreprocessedData"><code class="flex name class">
<span>class <span class="ident">GeneratePreprocessedData</span></span>
<span>(</span><span>df, split_sites=False, site=None, report=None, quarter=None, country_code=None, csv=False)</span>
</code></dt>
<dd>
<section class="desc"><p>Generate preprocessed data as table. One sheet are preprocessed data, 2nd sheet are legend data.
</p>
<p>Create object of preprocessed data. </p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>df</code></strong></dt>
<dd>preprocessed data in datafraem</dd>
<dt><strong><code>split_sites</code></strong></dt>
<dd>True if preprocessed data has to be generated per site (default: False)</dd>
<dt><strong><code>site</code></strong></dt>
<dd>Protocol ID of site (default: None)</dd>
<dt><strong><code>country_code</code></strong></dt>
<dd>country code (default: None)</dd>
<dt><strong><code>report</code></strong></dt>
<dd>type of the report, eg. quarter (default: None)</dd>
<dt><strong><code>period</code></strong></dt>
<dd>type of the period, eg. H1_2018 (default: None)</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class GeneratePreprocessedData:
    &#34;&#34;&#34;
    Generate preprocessed data as table. One sheet are preprocessed data, 2nd sheet are legend data.    
    &#34;&#34;&#34;

    def __init__(self, df, split_sites=False, site=None, report=None, quarter=None, country_code=None, csv=False):
        &#34;&#34;&#34;Create object of preprocessed data. 

        Args:
            df: preprocessed data in datafraem
            split_sites: True if preprocessed data has to be generated per site (default: False)
            site: Protocol ID of site (default: None)
            country_code: country code (default: None)
            report: type of the report, eg. quarter (default: None)
            period: type of the period, eg. H1_2018 (default: None)
        &#34;&#34;&#34;
        # Create log file in the working folder
        log_file = os.path.join(os.getcwd(), &#39;debug.log&#39;)
        logging.basicConfig(filename=log_file,
                            filemode=&#39;a&#39;,
                            format=&#39;%(asctime)s,%(msecs)d %(name)s %(levelname)s %(message)s&#39;,
                            datefmt=&#39;%H:%M:%S&#39;,
                            level=logging.DEBUG)

        self.df = df
        self.split_sites = split_sites
        self.report = report
        self.quarter = quarter
        self.country_code = country_code
        self.csv = csv

        # If Site is not None, filter dataset according to site code
        if site is not None:
            self.country_code = site.split(&#34;_&#34;)[0]
            df = self.df[self.df[&#39;Protocol ID&#39;].str.contains(site) == True]
            # Generate preprocessed data for site
            self._generate_preprocessed_data(df=df, site_code=site)
            logging.info(&#39;Preprocessed data: The preprocessed data were generated for site {0}&#39;.format(site))
        
        # Generate formatted statistics per site + country as site is included
        if (split_sites) and site is None:
            logging.info(&#39;Preprocessed data: Generate preprocessed data per site.&#39;)
            # Get set of all site ids
            site_ids = set(self.df[&#39;Protocol ID&#39;].tolist())
            #site_ids = set(site_ids)  
            for i in site_ids:
                df = self.df[self.df[&#39;Protocol ID&#39;].str.contains(i) == True]
                self._generate_preprocessed_data(df=df, site_code=i)
                logging.info(&#39;Preprocessed data: The preprocessed data were generated for site {0}&#39;.format(site))

        self._generate_preprocessed_data(self.df, site_code=None)
        logging.info(&#39;Preprocessed data: The preprocessed data were generate for all data.&#39;)

    def _generate_preprocessed_data(self, df, site_code):
        &#34;&#34;&#34;
        Generate preprocessed data with legend. 

        Keyword arguments: 
            df = filtered dataframe
            site_code = code of site included in the dataframe
        &#34;&#34;&#34;
        
        if site_code is not None:
            output_file = self.report + &#34;_&#34; + site_code + &#34;_&#34; + self.quarter + &#34;_preprocessed_data.xlsx&#34;
        elif site_code is None and self.report is None and self.country_code is None and self.quarter is None:
            output_file = &#34;preprocessed_data.xlsx&#34;
        else:
            output_file = self.report + &#34;_&#34; + self.country_code + &#34;_&#34; + self.quarter + &#34;_preprocessed_data.xlsx&#34;
        
        #output_file = &#34;preprocessed_data.xlsx&#34;
        
        df = df.copy()
        
        # Convert dates to strings
        dateformat = &#34;%m/%d/%Y&#34;
        timeformat = &#34;%H:%M&#34;
        def convert_to_string(datetime, format):
            if datetime is None or datetime is np.nan:
                return datetime
            else:
                return datetime.strftime(format)
        
        print(csv)
        if not csv:
            #if df[&#39;VISIT_DATE&#39;].dtype != np.object:
            print(df[&#39;VISIT_DATE&#39;].dtype)
            df[&#39;VISIT_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;VISIT_DATE&#39;], dateformat), axis=1)
            # if df[&#39;VISIT_DATE_OLD&#39;].dtype != np.object:
            df[&#39;VISIT_DATE_OLD&#39;] = df.apply(lambda x: convert_to_string(x[&#39;VISIT_DATE_OLD&#39;], dateformat), axis=1)
            #if df[&#39;VISIT_TIME&#39;].dtype != np.object:
            df[&#39;VISIT_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;VISIT_TIME&#39;], timeformat), axis=1)
            df[&#39;HOSPITAL_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_DATE&#39;], dateformat), axis=1)
            #if df[&#39;HOSPITAL_DATE_OLD&#39;].dtype != np.object:
            df[&#39;HOSPITAL_DATE_OLD&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_DATE_OLD&#39;], dateformat), axis=1)
            #if df[&#39;HOSPITAL_TIME&#39;].dtype != np.object:
            df[&#39;HOSPITAL_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_TIME&#39;], timeformat), axis=1)
            print(df[&#39;DISCHARGE_DATE&#39;].dtype)
            df[&#39;DISCHARGE_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;DISCHARGE_DATE&#39;], dateformat), axis=1)
            #if df[&#39;DISCHARGE_DATE_OLD&#39;].dtype != np.object:
            df[&#39;DISCHARGE_DATE_OLD&#39;] = df.apply(lambda x: convert_to_string(x[&#39;DISCHARGE_DATE_OLD&#39;], dateformat), axis=1)
            #if df[&#39;IVT_ONLY_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;IVT_ONLY_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_ONLY_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_ONLY_BOLUS_TIME&#39;].dtype != np.object:
            df[&#39;IVT_ONLY_BOLUS_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_ONLY_BOLUS_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_TBY_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_TBY_BOLUS_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_BOLUS_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_BOLUS_TIME&#39;], timeformat), axis=1)
            # if df[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_ONLY_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;TBY_ONLY_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_ONLY_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_ONLY_PUNCTURE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_ONLY_PUNCTURE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_ONLY_PUNCTURE_TIME&#39;], timeformat), axis=1)
            #if df[&#39;IVT_TBY_REFER_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_REFER_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_REFER_ADMISSION_TIME&#39;], timeformat), axis=1)
            #  if df[&#39;IVT_TBY_REFER_BOLUS_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_REFER_BOLUS_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_REFER_BOLUS_TIME&#39;], timeformat), axis=1)
            #  if df[&#39;IVT_TBY_REFER_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;IVT_TBY_REFER_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;IVT_TBY_REFER_DISCHARGE_TIME&#39;], timeformat), axis=1)
            # if df[&#39;TBY_REFER_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_DISCHARGE_TIME&#39;], timeformat), axis=1)
            # if df[&#39;TBY_REFER_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_ADMISSION_TIME&#39;], timeformat), axis=1)
             # if df[&#39;TBY_REFER_ALL_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_ALL_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_ALL_DISCHARGE_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_REFER_ALL_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_ALL_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_ALL_ADMISSION_TIME&#39;], timeformat), axis=1)
            #if df[&#39;TBY_REFER_LIM_DISCHARGE_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_LIM_DISCHARGE_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_LIM_DISCHARGE_TIME&#39;], timeformat), axis=1)
            # if df[&#39;TBY_REFER_LIM_ADMISSION_TIME&#39;].dtype != np.object:
            df[&#39;TBY_REFER_LIM_ADMISSION_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;TBY_REFER_LIM_ADMISSION_TIME&#39;], timeformat), axis=1)
            df[&#39;CT_TIME&#39;] = df.apply(lambda x: convert_to_string(x[&#39;CT_TIME&#39;], timeformat), axis=1)
        else:
            df[&#39;HOSPITAL_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;HOSPITAL_DATE&#39;], dateformat), axis=1)
            df[&#39;DISCHARGE_DATE&#39;] = df.apply(lambda x: convert_to_string(x[&#39;DISCHARGE_DATE&#39;], dateformat), axis=1)

        # Replace NAN values with 0
        df.fillna(value=&#34;&#34;, inplace=True)

        # Create workbook
        workbook = xlsxwriter.Workbook(output_file)
        logging.info(&#39;Preprocessed data: The workbook was created.&#39;)
        # Create worksheets
        preprocessed_data_sheet = workbook.add_worksheet(&#39;Preprocessed_raw_data&#39;)
        legend_sheet = workbook.add_worksheet(&#39;Legend_v2.0&#39;)
        additional_desc_sheet = workbook.add_worksheet(&#39;Additional_description&#39;)

        ### PREPROCESSED DATA
        preprocessed_data = df.values.tolist()
        # Set width of columns
        preprocessed_data_sheet.set_column(0, 150, 30)
        # Number of columns/rows
        ncol = len(df.columns) - 1
        nrow = len(df)

        # Create header
        col = []
        for j in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = df.columns.tolist()[j]
            col.append(tmp)

        options = {&#39;data&#39;: preprocessed_data,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 1&#39;
                   }
        preprocessed_data_sheet.add_table(0, 0, nrow, ncol, options)
        logging.info(&#39;Preprocessed data: The sheet &#34;Preprocessed data&#34; was added.&#39;)

        ### LEGEND
        legend = pd.read_csv(os.path.join(os.path.dirname(__file__), &#39;tmp&#39;, &#39;legend.csv&#39;), sep=&#34;,&#34;, encoding=&#34;utf-8&#34;)
        legend.fillna(value=&#34;&#34;, inplace=True)
        legend_list = legend.values.tolist()

        labels = [&#39;Variable Name&#39;, &#39;Description&#39;, &#39;UNITS&#39;, &#39;Response Type&#39;, &#39;Response Options - text&#39;,
                  &#39;Response Options - value&#39;]

        legend_df = pd.DataFrame(legend_list, columns=labels)
        
        # set width of columns
        legend_sheet.set_column(0, 150, 30)
        # number of columns
        # add table into worksheet
        ncol = len(legend_df.columns) - 1
        nrow = len(legend_df)
        col = []
        for k in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = legend_df.columns.tolist()[k]
            # if (i &gt;= 2):
            #    tmp[&#39;total_function&#39;: &#39;sum&#39;]
            col.append(tmp)

        options = {&#39;data&#39;: legend_list,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 1&#39;
                   }
        legend_sheet.add_table(0, 0, nrow, ncol, options)
        logging.info(&#39;Preprocessed data: The sheet &#34;Legend&#34; was added.&#39;)

        ### ADDITIONAL INFO
        # Add table with changed column names and description
        labels = [&#39;Column names after preprocessing&#39;, &#39;Description&#39;]
        addition_list = [
            [&#39;VISIT_DATE_OLD&#39;, &#39;The original visit date.&#39;], 
            [&#39;HOSPITAL_DATE_OLD&#39;, &#39;The original hospital date.&#39;], 
            [&#39;DISCHARGE_DATE_OLD&#39;, &#39;The original discharge date.&#39;],
            [&#39;HOSPITAL_DAYS_OLD&#39;, &#39;The hospital days calculated from original hospital and discharge date.&#39;],
            [&#39;VISIT_DATE&#39;, &#39;The fixed visit date.&#39;],
            [&#39;HOSPITAL_DATE&#39;, &#39;The fixed hospital date (fixed in the case that hospital days were negative or greater than 300 days).&#39;],
            [&#39;DISCHARGE_DATE&#39;, &#39;The fixed discharge date (fixed in the case that hospital days were negative or greater than 300 days).&#39;],
            [&#39;HOSPITAL_DAYS&#39;, &#39;The hospital days calculated from fixed hospital and discharge dates.&#39;],
            [&#39;HOSPITAL_DAYS_FIXED&#39;, &#39;TRUE for fixed dates, FALSE for original dates.&#39;],
            [&#39;IVT_ONLY_NEEDLE_TIME_MIN&#39;, &#39;The column which contains needle time in minutes (bolus time - admission time).&#39;],
            [&#39;IVT_ONLY_NEEDLE_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 400, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_NEEDLE_TIME_MIN&#39;, &#39;The column which contains needle time in minutes (bolus time - admission time).&#39;],
            [&#39;IVT_TBY_NEEDLE_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 400, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_REFER_NEEDLE_TIME_MIN&#39;, &#39;The column which contains needle time in minutes (bolus time - admission time).&#39;],
            [&#39;IVT_TBY_REFER_NEEDLE_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 400, FALSE for unchanged values.&#39;],
            [&#39;TBY_ONLY_GROIN_TIME_MIN&#39;, &#39;The column which contains groin time in minutes (groin time - admission time).&#39;],
            [&#39;TBY_ONLY_GROIN_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_GROIN_TIME_MIN&#39;, &#39;The column which contains groin time in minutes (groin time - admission time).&#39;],
            [&#39;IVT_TBY_GROIN_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;IVT_TBY_REFER_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;IVT_TBY_REFER_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;TBY_REFER_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;TBY_REFER_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;TBY_REFER_ALL_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;TBY_REFER_ALL_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;],
            [&#39;TBY_REFER_LIM_DIDO_TIME_MIN&#39;, &#39;The column which contains DIDO time in minutes (discharge time - admission time).&#39;],
            [&#39;TBY_REFER_LIM_DIDO_TIME_CHANGED&#39;, &#39;TRUE for changed times (if difference was &gt; 700, FALSE for unchanged values.&#39;]
        ]

        # set width of columns
        additional_desc_sheet.set_column(0, 10, 60)

        addition_df = pd.DataFrame(addition_list, columns=labels)
        ncol = len(addition_df.columns) - 1
        nrow = len(addition_df)
        col = []
        for k in range(0, ncol + 1):
            tmp = {}
            tmp[&#39;header&#39;] = addition_df.columns.tolist()[k]
            # if (i &gt;= 2):
            #    tmp[&#39;total_function&#39;: &#39;sum&#39;]
            col.append(tmp)

        options = {&#39;data&#39;: addition_list,
                   &#39;header_row&#39;: True,
                   &#39;columns&#39;: col,
                   &#39;style&#39;: &#39;Table Style Light 1&#39;
                   }

        additional_desc_sheet.add_table(0, 0, nrow, ncol, options)
        logging.info(&#39;Preprocessed data: The sheet &#34;Additional info&#34; was added.&#39;)
    
        workbook.close()</code></pre>
</details>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="resqdb" href="index.html">resqdb</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="resqdb.FormatData.GenerateFormattedAngelsAwards" href="#resqdb.FormatData.GenerateFormattedAngelsAwards">GenerateFormattedAngelsAwards</a></code></h4>
<ul class="">
<li><code><a title="resqdb.FormatData.GenerateFormattedAngelsAwards.formate" href="#resqdb.FormatData.GenerateFormattedAngelsAwards.formate">formate</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="resqdb.FormatData.GenerateFormattedStats" href="#resqdb.FormatData.GenerateFormattedStats">GenerateFormattedStats</a></code></h4>
</li>
<li>
<h4><code><a title="resqdb.FormatData.GeneratePreprocessedData" href="#resqdb.FormatData.GeneratePreprocessedData">GeneratePreprocessedData</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.6.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>