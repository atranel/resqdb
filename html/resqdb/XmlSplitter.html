<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.6.2" />
<title>resqdb.XmlSplitter API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>resqdb.XmlSplitter</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">import xml.etree.ElementTree as ET
import sys, os
import logging
import pandas as pd
import time
from multiprocessing import Process
from threading import Thread
import itertools

class XmlSplitter:
    &#34;&#34;&#34; Call this module to convert XML file with data from forms in the combined csv file. &#34;&#34;&#34;

    def __init__(self, xml_file, nprocess = 1):

        self.xml_file = xml_file

        # Create log file in the working folder
        log_file = os.path.join(os.getcwd(), &#39;debug.log&#39;)
        logging.basicConfig(filename=log_file,
                            filemode=&#39;a&#39;,
                            format=&#39;%(asctime)s,%(msecs)d %(name)s %(levelname)s %(message)s&#39;,
                            datefmt=&#39;%H:%M:%S&#39;,
                            level=logging.DEBUG)
        logging.info(&#39;XMLSplitter&#39;)  

        self.skiped_study_oids = [&#39;S_RESQ&#39;, &#39;S_DEMO_SIT&#39;, &#39;S_UA_DEMO&#39;, &#39;S_UA_DEMO_5834&#39;, &#39;S_CZ_DEMO&#39;, &#39;S_QASC_DEM&#39;]

        self.root, self.xmlns, self.openclinica, self.date = self.get_root(self.xml_file)

        self.studies = self.get_studies(self.root, self.xmlns)
        study_ids = self.get_study_oids(self.root, self.xmlns)

        self.items, self.column_names = self.get_items(self.root, self.xmlns, self.openclinica)

        sort_pts, total_patients = self.get_number_of_patient_per_site(self.root, self.xmlns, study_ids)

        # Create number of lists with sites based on number of processes
        if nprocess != 1:
            lstudies = self.split_list(sort_pts, total_patients, parts=nprocess)
            names = list(lstudies.keys())
        else:
            lstudies = study_ids
              
        
        # Create empty dataframe with column names
        if nprocess &gt; 0:
            self.df1 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 1:
            self.df2 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 2:
            self.df3 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 3:
            self.df4 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 4:
            self.df5 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 5:
            self.df6 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 6:
            self.df7 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 7:
            self.df8 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 8:
            self.df9 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 9:
            self.df10 = pd.DataFrame(columns=self.column_names)

        
        # Run subprocesses
        threads = []
        if nprocess == 1:
            self.convert_xml_to_df(self.root, self.xmlns, self.openclinica, study_ids, &#39;Process&#39;) 
        else:
            for i in range(0, nprocess):
                process = Thread(target=self.convert_xml_to_df, args=(self.root, self.xmlns, self.openclinica, lstudies[names[i]], i))
                process.start()
                threads.append(process)
            
            for process in threads:
                process.join()
            
        
        logging.info(&#34;All threads completed.&#34;)
        print(&#34;All thread completed&#34;)
        
        # Create one dataframe by appending all dataframes to one
        if nprocess == 1:
            self.df = self.df1
        if nprocess &gt; 1:
            self.df = self.df1.append(self.df2, sort=False)
        if nprocess &gt; 2:
            self.df = self.df.append(self.df3, sort=False)
        if nprocess &gt; 3:
            self.df = self.df.append(self.df4, sort=False)
        if nprocess &gt; 4:
            self.df = self.df.append(self.df5, sort=False)
        if nprocess &gt; 5:
            self.df = self.df.append(self.df6, sort=False)
        if nprocess &gt; 6:
            self.df = self.df.append(self.df7, sort=False)
        if nprocess &gt; 7:
            self.df = self.df.append(self.df8, sort=False)
        if nprocess &gt; 8:
            self.df = self.df.append(self.df9, sort=False)
        if nprocess &gt; 9:
            self.df = self.df.append(self.df10, sort=False)
        self.df.reset_index(inplace=True)
        
    def get_root(self, xml_file):
        &#34;&#34;&#34; Get root of xml file and additional necessary values (schema and openclinica link). &#34;&#34;&#34;
        file = open(xml_file, &#39;r&#39;)
        tree = ET.parse(file)

        root = tree.getroot()
        date = root.get(&#39;CreationDateTime&#39;)
        xmlns = &#34;{http://www.cdisc.org/ns/odm/v1.3}&#34;
        openclinica = &#34;{http://www.openclinica.org/ns/odm_ext_v130/v3.1}&#34;

        logging.info(&#39;Date: {0}, xmlns: {1}, openclinica: {2}&#39;.format(date, xmlns, openclinica))

        return root, xmlns, openclinica, date

    def trim_name(self, val):
        &#34;&#34;&#34; Remove RES-Q from text if present. 
        
        Params: 
            val: string 
        Returns: 
            Shorten string if RES-Q was in the value.
        &#34;&#34;&#34;
        if val.startswith(&#34;RES-Q&#34;):
            return val[8:]
        else:
            return val

    def trim_var_name(self, var):
        &#34;&#34;&#34; Cut language variation, eg. EN, CS from the name of variable. &#34;&#34;&#34;
        if var.endswith(&#39;RU_2&#39;) or var.endswith(&#39;CS_2&#39;) or var.endswith(&#39;HY_2&#39;) or var.endswith(&#39;RU_2&#39;) or var.endswith(&#39;CZ_2&#39;):
            return var[:-5]
        elif var.endswith(&#34;CZ&#34;) or var.endswith(&#34;EN&#34;) or var.endswith(&#34;HY&#34;) or var.endswith(&#34;ES&#34;) or var.endswith(&#34;CS&#34;) or var.endswith(&#34;RO&#34;) or var.endswith(&#34;UA&#34;) or var.endswith(&#34;RU&#34;):
            return var[:-3]
        else:
            return var

    def get_studies(self, root, xmlns):
        &#34;&#34;&#34; Get all studies in xml file, to each study also assign study name and protocol ID. 

        Params:
            root: The root of xml file.
            xmlns: The base schema.
        Returns:
            New dictionary with all studies as keyword. 
        &#34;&#34;&#34;
        studies = {}
        for study in root.findall(xmlns + &#39;Study&#39;):
            study_item = {}
            for global_variables in study.iter(xmlns + &#39;GlobalVariables&#39;):
                for study_name in global_variables.iter(xmlns + &#39;StudyName&#39;):
                    study_item[&#39;study_name&#39;] = self.trim_name(study_name.text)
                for protocol_name in global_variables.iter(xmlns + &#39;ProtocolName&#39;):
                    study_item[&#39;protocol_name&#39;] = self.trim_name(protocol_name.text)
            studies[study.get(&#39;OID&#39;)] = study_item
        
        logging.info(&#39;Study names and Protocol IDs were shorten.&#39;)
        return studies

    def get_number_of_patient_per_site(self, root, xmlns, study_ids):
        &#34;&#34;&#34; Get list of sites sorted by number of sites. &#34;&#34;&#34;
        pts = {}
        total_patients = 0
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            if clinical_data.get(&#39;StudyOID&#39;) in study_ids:
                total_patients += len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
                pts[clinical_data.get(&#39;StudyOID&#39;)] = len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
        
        sort_pts = sorted(pts.items(), key=lambda x: x[1], reverse=True)
        return sort_pts, total_patients
        
    def get_study_oids(self, root, xmlns):
        &#34;&#34;&#34; Get all Study OIDs present in data. 

        Params: 
            root: The root of xml file.
            xmlns: The base schema.
        Returns: 
            List of available IDs.
        &#34;&#34;&#34;
        study_oids = []
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            study_oid = clinical_data.get(&#39;StudyOID&#39;)
            if study_oid not in self.skiped_study_oids:
                study_oids.append(study_oid)

        return study_oids
    
    def split_list(self, data, total_patients, parts=2):
        &#34;&#34;&#34; Return number of lists equaled to processes and site ids in the list. Each process will get some sites. &#34;&#34;&#34;
        pts_per_parts = []
        for i in range(1, parts + 1):
            pts_per_parts.append(total_patients//parts*i)
        
        count = 0
        index = 0
        p_ix = 0
        res = {}

        site_ids = list(list(zip(*data))[0])
        total_patients = list(list(zip(*data))[1])

        for i in range(0, len(total_patients)):
            count += total_patients[i]
            if count &gt; pts_per_parts[index]:
                name = &#34;list&#34; + str(index)
                index += 1
                res[name] = site_ids[p_ix:i+1]
                p_ix = i+1
            if i == (len(total_patients) - 1):
                name = &#34;list&#34; + str(index)
                res[name] = site_ids[p_ix:]
            else:
                continue
        
        return res

    def get_items(self, root, xmlns, openclinica):
        &#34;&#34;&#34; Get all columns names in the xml file, to each column name get shorten name, version of form and comment. 
        
        Params:
            root: The root of xml file.
            xmlns: The base schema.
            openclinica: The base schema for openclinica.
        Returns:
            New dictionary with all columns as keyword.     
        &#34;&#34;&#34;
        items = {}
        column_names = [&#39;Subject ID&#39;, &#39;Protocol ID&#39;, &#39;Site Name&#39;, &#39;StartDate&#39;, &#39;EndDate&#39;, &#39;FormOID&#39;]
        for study in root.findall(xmlns + &#39;Study&#39;):
            if study.get(&#39;OID&#39;) == &#34;S_RESQ&#34;:
                for metadata in study.iter(xmlns + &#39;MetaDataVersion&#39;):
                    for item_def in metadata.iter(xmlns + &#39;ItemDef&#39;):
                        item = {}
                        item[&#39;name&#39;] = item_def.get(&#39;Name&#39;)
                        shorten_name = self.trim_var_name(item_def.get(&#39;Name&#39;))
                        item[&#39;shorten_name&#39;] = shorten_name
                       # form_oids = item_def.get(openclinica + &#39;FormOID&#39;)
                       # print(form_oids)
                        #item[&#39;form_oid&#39;] = item_def.get(openclinica + &#39;FormOIDs&#39;)
                        #if shorten_name not in column_names and &#34;RESQV12&#34; not in form_oids and &#34;ATALAIA&#34; not in form_oids:
                          #  column_names.append(shorten_name)
                        item[&#39;comment&#39;] = item_def.get(&#39;Comment&#39;)
                        items[item_def.get(&#39;OID&#39;)] = item
        return items, column_names

    
    def refactor_values(self, row):

        res = {}
        res[&#39;RECURRENT_STROKE&#39;] = &#39;-999&#39;
        res[&#39;DEPARTMENT_TYPE&#39;] = &#39;-999&#39;
        res[&#39;VENTILATOR&#39;] = &#39;-999&#39;
        res[&#39;BLEEDING_REASON&#39;] = &#39;-999&#39;
        res[&#39;BLEEDING_SOURCE&#39;] = &#39;-999&#39;
        res[&#39;INTERVENTION&#39;] = &#39;-999&#39;
        res[&#39;CEREBROVASCULAR_EXPERT&#39;] = &#39;-999&#39;
        res[&#39;DISCHARGE_OTHER_FACILITY_O1&#39;] = &#39;-999&#39;
        res[&#39;DISCHARGE_OTHER_FACILITY_O2&#39;] = &#39;-999&#39;
        
        for key, value in row.items():
            if key == &#39;Site Name&#39;:
                res[&#39;Site Name&#39;] = value
            elif key == &#39;Subject ID&#39;:
                res[&#39;Subject ID&#39;] = value
            elif key == &#39;EndDate&#39;:
                res[&#39;EndDate&#39;] = value
            elif key == &#39;StartDate&#39;:
                res[&#39;StartDate&#39;] = value
            elif key == &#39;Protocol ID&#39;:
                res[&#39;Protocol ID&#39;] = value
            elif key == &#39;FormOID&#39;:
                res[&#39;FormOID&#39;] = value
            elif key == &#34;SEX&#34;:
                res[&#39;SEX&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;1&#39;
            elif key == &#39;VISDAT&#39;:
                res[&#39;VISIT_DATE&#39;] = value
            elif key == &#39;VISTIM&#39;:
                res[&#39;VISIT_TIME&#39;] = value
            elif key == &#39;HOSDAT&#39;:
                res[&#39;HOSPITAL_DATE&#39;] = value
            elif key == &#39;HOSTIM&#39;:
                res[&#39;HOSPITAL_TIME&#39;] = value
            elif key == &#39;HOSSTRK&#39;:
                res[&#39;HOSPITAL_STROKE&#39;] = value
            elif key == &#39;HOSP&#39;:
                res[&#39;HOSPITALIZED_IN&#39;] = &#39;3&#39; if value == &#39;2&#39; else value
            elif key == &#39;PTASS&#39;:
                res[&#39;ASSESSED_FOR_REHAB&#39;] = value
            elif key == &#39;STRKTYP&#39;:
                if value == &#39;1&#39;:
                    value = &#39;4&#39;
                elif value == &#39;2&#39;:
                    value = &#39;1&#39;
                elif value == &#39;3&#39;:
                    value = &#39;2&#39;
                    res[&#39;NEUROSURGERY&#39;] = &#39;3&#39;
                elif value == &#39;4&#39;:
                    value = &#39;6&#39;
                else:
                    value = value
                res[&#39;STROKE_TYPE&#39;] = value
            elif key == &#39;CONSLVL&#39;:
                res[&#39;CONSCIOUSNESS_LEVEL&#39;] = &#39;5&#39; if value == &#39;4&#39; else value
            elif key == &#39;NIHSSSCR&#39;:
                res[&#39;NIHSS_SCORE&#39;] = value
            elif key == &#39;CT&#39;:
                res[&#39;CT_MRI&#39;] = value
            elif key == &#39;CTTIM&#39;:
                res[&#39;CT_TIME&#39;] = value
            elif key == &#39;RECANPROC&#39;:
                res[&#39;RECANALIZATION_PROCEDURES&#39;] = value
            elif key == &#39;IVTPA1&#39;:
                res[&#39;IVT_ONLY&#39;] = value
            elif key == &#39;NDLTIM1&#39;:
                res[&#39;IVT_ONLY_NEEDLE_TIME&#39;] = value
            elif key == &#39;ADM1&#39;:
                res[&#39;IVT_ONLY_ADMISSION_TIME&#39;] = value
            elif key == &#39;BOLUS1&#39;:
                res[&#39;IVT_ONLY_BOLUS_TIME&#39;] = value
            elif key == &#39;IVTPA2&#39;:
                res[&#39;IVT_TBY&#39;] = value
            elif key == &#39;NDLTIM2&#39;:
                res[&#39;IVT_TBY_NEEDLE_TIME&#39;] = value
            elif key == &#39;GROIN2&#39;:
                res[&#39;IVT_TBY_GROIN_TIME&#39;] = value
            elif key == &#39;ADM2&#39;:
                res[&#39;IVT_TBY_ADMISSION_TIME&#39;] = value
            elif key == &#39;BOLUS2&#39;:
                res[&#39;IVT_TBY_BOLUS_TIME&#39;] = value
            elif key == &#39;GROINTIM2&#39;:
                res[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;] = value
            elif key == &#39;GROIN3&#39;:
                res[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] = value
            elif key == &#39;DYPSH&#39;:
                if value == &#39;1&#39;:
                    value = &#39;4&#39;
                elif value == &#39;3&#39;:
                    value = &#39;6&#39;
                else:
                    value = value
                res[&#39;DYSPHAGIA_SCREENING&#39;] = value
            elif key == &#39;DYSPHTIM&#39;:
                res[&#39;DYSPHAGIA_SCREENING_TIME&#39;] = value
            elif key == &#39;FIBRTIM&#39;:
                if value == &#39;1&#39; or value == &#39;2&#39;:
                    value = &#39;3&#39;
                res[&#39;AFIB_DETECTION_METHOD&#39;] = value
            elif key == &#39;FIBR&#39;:
                if value == &#39;3&#39;:
                    value = &#39;5&#39;
                res[&#39;AFIB_FLUTTER&#39;] = value
            elif key == &#39;AFIB&#39;:
                if value == &#39;1&#39;:
                    value = &#39;3&#39;
                elif value == &#39;2&#39;:
                    value = &#39;4&#39;
                elif value == &#39;3&#39;:
                    value = &#39;5&#39;
                else:
                    value = value
                res[&#39;AFIB_FLUTTER&#39;] = value
            elif key == &#39;CRTD&#39;:
                res[&#39;CAROTID_ARTERIES_IMAGING&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;1&#39;
            elif key == &#39;HMCRN&#39;:
                if value == &#39;3&#39;:
                    value = &#39;2&#39;
                else: 
                    value = value
                res[&#39;HEMICRANIECTOMY&#39;] = value
            elif key == &#39;THRMBTST&#39;:
                if value == &#39;6&#39;:
                    value = &#39;9&#39;
                elif value == &#39;7&#39;:
                    value = &#39;10&#39;
                else:
                    value = value
                res[&#39;ANTITHROMBOTICS&#39;] = value
            elif key == &#39;STTN&#39;:
                res[&#39;STATIN&#39;] = value
            elif key == &#39;STNSS&#39;:
                res[&#39;CAROTID_STENOSIS&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;3&#39;
            elif key == &#39;STNSSTIM&#39;: 
                res[&#39;CAROTID_STENOSIS_FOLLOWUP&#39;] = value
            elif key == &#39;TNSV&#39;:
                res[&#39;ANTIHYPERTENSIVE&#39;] = value
            elif key == &#39;SMKR&#39; or key == &#39;SMKR_2&#39;:
                res[&#39;SMOKING_CESSATION&#39;] = value
            elif key == &#39;DEST&#39;:
                if value == &#39;3&#39;:
                    value = &#39;4&#39;
                elif value == &#39;4&#39;:
                    value = &#39;3&#39;
                else:
                    value = value
                res[&#39;DISCHARGE_DESTINATION&#39;] = value
                res[&#39;DISCHARGE_SAME_FACILITY&#39;] = &#39;1&#39; if value == &#39;2&#39; else &#39;-999&#39;
                res[&#39;DISCHARGE_OTHER_FACILITY&#39;] = &#39;3&#39; if value == &#39;3&#39; else &#39;-999&#39;
                res[&#39;DISCHARGE_OTHER_FACILITY_O3&#39;] = &#39;4&#39; if value == &#39;3&#39; else &#39;-999&#39;
            elif key == &#39;DISCDAT&#39;:
                res[&#39;DISCHARGE_DATE&#39;] = value
            else:
                continue
        return res
            


    def convert_xml_to_df(self, root, xmlns, openclinica, lstudy, n):
        &#34;&#34;&#34; Find each element &#34;ClinicalData&#34; in xml file and converted each subject to the row in the dataframe. If two versions of the form was filled, select IVT_TBY instead of RESQv2.0, and select RESQv2.0 instead of RESQv1.2. 

        Params: 
            root: The root of xml file.
            xmlns: The base schema.
            openclinica: The base schema for openclinica.
        Returns:
            A new converted dataframe. 
        &#34;&#34;&#34;
        process =&#39;Process&#39; + str(n)

        # Total number of patients
        total_patients = 0
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            if clinical_data.get(&#39;StudyOID&#39;) in lstudy:
                total_patients += len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))

        count = 0
        LOG_EVERY_N = 100
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            study_oid = clinical_data.get(&#39;StudyOID&#39;)
            &#34;&#34;&#34;
            if study_oid in self.skiped_study_oids:
                study_pts = len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
                count += study_pts
                logging.info(&#39;{0}: {1} patients were skipped due to belonging to the demo site - {2}&#39;.format(process, study_pts, study_oid))
            &#34;&#34;&#34;
            if study_oid in lstudy:
                logging.info(&#39;{0}: Adding patients for study: {1}&#39;.format(process, study_oid))
                # Get study name and protocol ID
                study = self.studies[clinical_data.get(&#39;StudyOID&#39;)]
                study_name = study[&#34;study_name&#34;]
                protocol_id = study[&#34;protocol_name&#34;]
                # Go through each subject in study
                for subject_data in clinical_data.iter(xmlns + &#39;SubjectData&#39;):
                    subject_id = subject_data.get(openclinica + &#39;StudySubjectID&#39;)
                    row = {&#39;Subject ID&#39; : subject_id, &#39;Protocol ID&#39;: protocol_id, &#39;Site Name&#39;: study_name}
                    # Get StartDate and EndData
                    for study_event in subject_data.iter(xmlns + &#39;StudyEventData&#39;):
                        start_date = study_event.get(openclinica + &#39;StartDate&#39;)
                        row[&#39;StartDate&#39;] = start_date
                        end_date = study_event.get(openclinica + &#39;EndDate&#39;)
                        row[&#39;EndDate&#39;] = end_date
                    # Get all forms, if both v1.2 and v2.0 are filled, select v2.0
                    form_oids = []
                    for form_data in subject_data.iter(xmlns + &#39;FormData&#39;):
                        form_oids.append(form_data.get(&#39;FormOID&#39;))
                    
                    # If more than one form is filled in, select v2.0
                    if len(form_oids) &gt; 1:
                        for form_data in subject_data.iter(xmlns + &#39;FormData&#39;):
                            form_oid = form_data.get(&#39;FormOID&#39;)
                            if &#34;RESQV20&#34; in form_oid and any(&#34;IVT_TBY&#34; in val for val in form_oids) == False:
                                row[&#39;FormOID&#39;] = form_oid
                                for item_data in form_data.iter(xmlns + &#39;ItemData&#39;):
                                    shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                    row[shorten_name] = item_data.get(&#39;Value&#39;)
                            elif &#34;IVT_TBY&#34; in form_oid:
                                row[&#39;FormOID&#39;] = form_oid
                                for item_data in form_data.iter(xmlns + &#39;ItemData&#39;):
                                    shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                    row[shorten_name] = item_data.get(&#39;Value&#39;)
                    else:
                        row[&#39;FormOID&#39;] = form_oids[0]
                        if &#34;RESQV12&#34; in form_oids[0]:
                            for item_data in subject_data.iter(xmlns + &#39;ItemData&#39;):
                                shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                row[shorten_name] = item_data.get(&#39;Value&#39;)
                            row = self.refactor_values(row)
                        else:
                            for item_data in subject_data.iter(xmlns + &#39;ItemData&#39;):
                                shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                row[shorten_name] = item_data.get(&#39;Value&#39;)
                        
                    
                    if n == 0:
                        self.df1 = self.df1.append(row, ignore_index=True)
                    elif n == 1:
                        self.df2 = self.df2.append(row, ignore_index=True)
                    elif n == 2:
                        self.df3 = self.df3.append(row, ignore_index=True)
                    elif n == 3:
                        self.df4 = self.df4.append(row, ignore_index=True)
                    elif n == 4:
                        self.df5 = self.df5.append(row, ignore_index=True)
                    elif n == 5:
                        self.df6 = self.df6.append(row, ignore_index=True)
                    elif n == 6:
                        self.df7 = self.df7.append(row, ignore_index=True)
                    elif n == 7:
                        self.df8 = self.df8.append(row, ignore_index=True)
                    elif n == 8:
                        self.df9 = self.df9.append(row, ignore_index=True)
                    elif n == 9:
                        self.df10 = self.df10.append(row, ignore_index=True)
                    
                    count += 1

                    if (count % LOG_EVERY_N) == 0:
                        percentage = round(count/total_patients*100, 2)
                        logging.info(&#39;{0}: Number of already converted patients: {1}/{2} - {3}%&#39;.format(process,count, total_patients, percentage))
                    if count == total_patients:
                        percentage = count/total_patients*100
                        logging.info(&#39;{0}: The conversion has been finished: {1}/{2} - {3}%&#39;.format(process, count, total_patients, percentage))
                    
                else:
                    pass
            
        return True

    </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="resqdb.XmlSplitter.XmlSplitter"><code class="flex name class">
<span>class <span class="ident">XmlSplitter</span></span>
<span>(</span><span>xml_file, nprocess=1)</span>
</code></dt>
<dd>
<section class="desc"><p>Call this module to convert XML file with data from forms in the combined csv file.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class XmlSplitter:
    &#34;&#34;&#34; Call this module to convert XML file with data from forms in the combined csv file. &#34;&#34;&#34;

    def __init__(self, xml_file, nprocess = 1):

        self.xml_file = xml_file

        # Create log file in the working folder
        log_file = os.path.join(os.getcwd(), &#39;debug.log&#39;)
        logging.basicConfig(filename=log_file,
                            filemode=&#39;a&#39;,
                            format=&#39;%(asctime)s,%(msecs)d %(name)s %(levelname)s %(message)s&#39;,
                            datefmt=&#39;%H:%M:%S&#39;,
                            level=logging.DEBUG)
        logging.info(&#39;XMLSplitter&#39;)  

        self.skiped_study_oids = [&#39;S_RESQ&#39;, &#39;S_DEMO_SIT&#39;, &#39;S_UA_DEMO&#39;, &#39;S_UA_DEMO_5834&#39;, &#39;S_CZ_DEMO&#39;, &#39;S_QASC_DEM&#39;]

        self.root, self.xmlns, self.openclinica, self.date = self.get_root(self.xml_file)

        self.studies = self.get_studies(self.root, self.xmlns)
        study_ids = self.get_study_oids(self.root, self.xmlns)

        self.items, self.column_names = self.get_items(self.root, self.xmlns, self.openclinica)

        sort_pts, total_patients = self.get_number_of_patient_per_site(self.root, self.xmlns, study_ids)

        # Create number of lists with sites based on number of processes
        if nprocess != 1:
            lstudies = self.split_list(sort_pts, total_patients, parts=nprocess)
            names = list(lstudies.keys())
        else:
            lstudies = study_ids
              
        
        # Create empty dataframe with column names
        if nprocess &gt; 0:
            self.df1 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 1:
            self.df2 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 2:
            self.df3 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 3:
            self.df4 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 4:
            self.df5 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 5:
            self.df6 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 6:
            self.df7 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 7:
            self.df8 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 8:
            self.df9 = pd.DataFrame(columns=self.column_names)
        if nprocess &gt; 9:
            self.df10 = pd.DataFrame(columns=self.column_names)

        
        # Run subprocesses
        threads = []
        if nprocess == 1:
            self.convert_xml_to_df(self.root, self.xmlns, self.openclinica, study_ids, &#39;Process&#39;) 
        else:
            for i in range(0, nprocess):
                process = Thread(target=self.convert_xml_to_df, args=(self.root, self.xmlns, self.openclinica, lstudies[names[i]], i))
                process.start()
                threads.append(process)
            
            for process in threads:
                process.join()
            
        
        logging.info(&#34;All threads completed.&#34;)
        print(&#34;All thread completed&#34;)
        
        # Create one dataframe by appending all dataframes to one
        if nprocess == 1:
            self.df = self.df1
        if nprocess &gt; 1:
            self.df = self.df1.append(self.df2, sort=False)
        if nprocess &gt; 2:
            self.df = self.df.append(self.df3, sort=False)
        if nprocess &gt; 3:
            self.df = self.df.append(self.df4, sort=False)
        if nprocess &gt; 4:
            self.df = self.df.append(self.df5, sort=False)
        if nprocess &gt; 5:
            self.df = self.df.append(self.df6, sort=False)
        if nprocess &gt; 6:
            self.df = self.df.append(self.df7, sort=False)
        if nprocess &gt; 7:
            self.df = self.df.append(self.df8, sort=False)
        if nprocess &gt; 8:
            self.df = self.df.append(self.df9, sort=False)
        if nprocess &gt; 9:
            self.df = self.df.append(self.df10, sort=False)
        self.df.reset_index(inplace=True)
        
    def get_root(self, xml_file):
        &#34;&#34;&#34; Get root of xml file and additional necessary values (schema and openclinica link). &#34;&#34;&#34;
        file = open(xml_file, &#39;r&#39;)
        tree = ET.parse(file)

        root = tree.getroot()
        date = root.get(&#39;CreationDateTime&#39;)
        xmlns = &#34;{http://www.cdisc.org/ns/odm/v1.3}&#34;
        openclinica = &#34;{http://www.openclinica.org/ns/odm_ext_v130/v3.1}&#34;

        logging.info(&#39;Date: {0}, xmlns: {1}, openclinica: {2}&#39;.format(date, xmlns, openclinica))

        return root, xmlns, openclinica, date

    def trim_name(self, val):
        &#34;&#34;&#34; Remove RES-Q from text if present. 
        
        Params: 
            val: string 
        Returns: 
            Shorten string if RES-Q was in the value.
        &#34;&#34;&#34;
        if val.startswith(&#34;RES-Q&#34;):
            return val[8:]
        else:
            return val

    def trim_var_name(self, var):
        &#34;&#34;&#34; Cut language variation, eg. EN, CS from the name of variable. &#34;&#34;&#34;
        if var.endswith(&#39;RU_2&#39;) or var.endswith(&#39;CS_2&#39;) or var.endswith(&#39;HY_2&#39;) or var.endswith(&#39;RU_2&#39;) or var.endswith(&#39;CZ_2&#39;):
            return var[:-5]
        elif var.endswith(&#34;CZ&#34;) or var.endswith(&#34;EN&#34;) or var.endswith(&#34;HY&#34;) or var.endswith(&#34;ES&#34;) or var.endswith(&#34;CS&#34;) or var.endswith(&#34;RO&#34;) or var.endswith(&#34;UA&#34;) or var.endswith(&#34;RU&#34;):
            return var[:-3]
        else:
            return var

    def get_studies(self, root, xmlns):
        &#34;&#34;&#34; Get all studies in xml file, to each study also assign study name and protocol ID. 

        Params:
            root: The root of xml file.
            xmlns: The base schema.
        Returns:
            New dictionary with all studies as keyword. 
        &#34;&#34;&#34;
        studies = {}
        for study in root.findall(xmlns + &#39;Study&#39;):
            study_item = {}
            for global_variables in study.iter(xmlns + &#39;GlobalVariables&#39;):
                for study_name in global_variables.iter(xmlns + &#39;StudyName&#39;):
                    study_item[&#39;study_name&#39;] = self.trim_name(study_name.text)
                for protocol_name in global_variables.iter(xmlns + &#39;ProtocolName&#39;):
                    study_item[&#39;protocol_name&#39;] = self.trim_name(protocol_name.text)
            studies[study.get(&#39;OID&#39;)] = study_item
        
        logging.info(&#39;Study names and Protocol IDs were shorten.&#39;)
        return studies

    def get_number_of_patient_per_site(self, root, xmlns, study_ids):
        &#34;&#34;&#34; Get list of sites sorted by number of sites. &#34;&#34;&#34;
        pts = {}
        total_patients = 0
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            if clinical_data.get(&#39;StudyOID&#39;) in study_ids:
                total_patients += len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
                pts[clinical_data.get(&#39;StudyOID&#39;)] = len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
        
        sort_pts = sorted(pts.items(), key=lambda x: x[1], reverse=True)
        return sort_pts, total_patients
        
    def get_study_oids(self, root, xmlns):
        &#34;&#34;&#34; Get all Study OIDs present in data. 

        Params: 
            root: The root of xml file.
            xmlns: The base schema.
        Returns: 
            List of available IDs.
        &#34;&#34;&#34;
        study_oids = []
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            study_oid = clinical_data.get(&#39;StudyOID&#39;)
            if study_oid not in self.skiped_study_oids:
                study_oids.append(study_oid)

        return study_oids
    
    def split_list(self, data, total_patients, parts=2):
        &#34;&#34;&#34; Return number of lists equaled to processes and site ids in the list. Each process will get some sites. &#34;&#34;&#34;
        pts_per_parts = []
        for i in range(1, parts + 1):
            pts_per_parts.append(total_patients//parts*i)
        
        count = 0
        index = 0
        p_ix = 0
        res = {}

        site_ids = list(list(zip(*data))[0])
        total_patients = list(list(zip(*data))[1])

        for i in range(0, len(total_patients)):
            count += total_patients[i]
            if count &gt; pts_per_parts[index]:
                name = &#34;list&#34; + str(index)
                index += 1
                res[name] = site_ids[p_ix:i+1]
                p_ix = i+1
            if i == (len(total_patients) - 1):
                name = &#34;list&#34; + str(index)
                res[name] = site_ids[p_ix:]
            else:
                continue
        
        return res

    def get_items(self, root, xmlns, openclinica):
        &#34;&#34;&#34; Get all columns names in the xml file, to each column name get shorten name, version of form and comment. 
        
        Params:
            root: The root of xml file.
            xmlns: The base schema.
            openclinica: The base schema for openclinica.
        Returns:
            New dictionary with all columns as keyword.     
        &#34;&#34;&#34;
        items = {}
        column_names = [&#39;Subject ID&#39;, &#39;Protocol ID&#39;, &#39;Site Name&#39;, &#39;StartDate&#39;, &#39;EndDate&#39;, &#39;FormOID&#39;]
        for study in root.findall(xmlns + &#39;Study&#39;):
            if study.get(&#39;OID&#39;) == &#34;S_RESQ&#34;:
                for metadata in study.iter(xmlns + &#39;MetaDataVersion&#39;):
                    for item_def in metadata.iter(xmlns + &#39;ItemDef&#39;):
                        item = {}
                        item[&#39;name&#39;] = item_def.get(&#39;Name&#39;)
                        shorten_name = self.trim_var_name(item_def.get(&#39;Name&#39;))
                        item[&#39;shorten_name&#39;] = shorten_name
                       # form_oids = item_def.get(openclinica + &#39;FormOID&#39;)
                       # print(form_oids)
                        #item[&#39;form_oid&#39;] = item_def.get(openclinica + &#39;FormOIDs&#39;)
                        #if shorten_name not in column_names and &#34;RESQV12&#34; not in form_oids and &#34;ATALAIA&#34; not in form_oids:
                          #  column_names.append(shorten_name)
                        item[&#39;comment&#39;] = item_def.get(&#39;Comment&#39;)
                        items[item_def.get(&#39;OID&#39;)] = item
        return items, column_names

    
    def refactor_values(self, row):

        res = {}
        res[&#39;RECURRENT_STROKE&#39;] = &#39;-999&#39;
        res[&#39;DEPARTMENT_TYPE&#39;] = &#39;-999&#39;
        res[&#39;VENTILATOR&#39;] = &#39;-999&#39;
        res[&#39;BLEEDING_REASON&#39;] = &#39;-999&#39;
        res[&#39;BLEEDING_SOURCE&#39;] = &#39;-999&#39;
        res[&#39;INTERVENTION&#39;] = &#39;-999&#39;
        res[&#39;CEREBROVASCULAR_EXPERT&#39;] = &#39;-999&#39;
        res[&#39;DISCHARGE_OTHER_FACILITY_O1&#39;] = &#39;-999&#39;
        res[&#39;DISCHARGE_OTHER_FACILITY_O2&#39;] = &#39;-999&#39;
        
        for key, value in row.items():
            if key == &#39;Site Name&#39;:
                res[&#39;Site Name&#39;] = value
            elif key == &#39;Subject ID&#39;:
                res[&#39;Subject ID&#39;] = value
            elif key == &#39;EndDate&#39;:
                res[&#39;EndDate&#39;] = value
            elif key == &#39;StartDate&#39;:
                res[&#39;StartDate&#39;] = value
            elif key == &#39;Protocol ID&#39;:
                res[&#39;Protocol ID&#39;] = value
            elif key == &#39;FormOID&#39;:
                res[&#39;FormOID&#39;] = value
            elif key == &#34;SEX&#34;:
                res[&#39;SEX&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;1&#39;
            elif key == &#39;VISDAT&#39;:
                res[&#39;VISIT_DATE&#39;] = value
            elif key == &#39;VISTIM&#39;:
                res[&#39;VISIT_TIME&#39;] = value
            elif key == &#39;HOSDAT&#39;:
                res[&#39;HOSPITAL_DATE&#39;] = value
            elif key == &#39;HOSTIM&#39;:
                res[&#39;HOSPITAL_TIME&#39;] = value
            elif key == &#39;HOSSTRK&#39;:
                res[&#39;HOSPITAL_STROKE&#39;] = value
            elif key == &#39;HOSP&#39;:
                res[&#39;HOSPITALIZED_IN&#39;] = &#39;3&#39; if value == &#39;2&#39; else value
            elif key == &#39;PTASS&#39;:
                res[&#39;ASSESSED_FOR_REHAB&#39;] = value
            elif key == &#39;STRKTYP&#39;:
                if value == &#39;1&#39;:
                    value = &#39;4&#39;
                elif value == &#39;2&#39;:
                    value = &#39;1&#39;
                elif value == &#39;3&#39;:
                    value = &#39;2&#39;
                    res[&#39;NEUROSURGERY&#39;] = &#39;3&#39;
                elif value == &#39;4&#39;:
                    value = &#39;6&#39;
                else:
                    value = value
                res[&#39;STROKE_TYPE&#39;] = value
            elif key == &#39;CONSLVL&#39;:
                res[&#39;CONSCIOUSNESS_LEVEL&#39;] = &#39;5&#39; if value == &#39;4&#39; else value
            elif key == &#39;NIHSSSCR&#39;:
                res[&#39;NIHSS_SCORE&#39;] = value
            elif key == &#39;CT&#39;:
                res[&#39;CT_MRI&#39;] = value
            elif key == &#39;CTTIM&#39;:
                res[&#39;CT_TIME&#39;] = value
            elif key == &#39;RECANPROC&#39;:
                res[&#39;RECANALIZATION_PROCEDURES&#39;] = value
            elif key == &#39;IVTPA1&#39;:
                res[&#39;IVT_ONLY&#39;] = value
            elif key == &#39;NDLTIM1&#39;:
                res[&#39;IVT_ONLY_NEEDLE_TIME&#39;] = value
            elif key == &#39;ADM1&#39;:
                res[&#39;IVT_ONLY_ADMISSION_TIME&#39;] = value
            elif key == &#39;BOLUS1&#39;:
                res[&#39;IVT_ONLY_BOLUS_TIME&#39;] = value
            elif key == &#39;IVTPA2&#39;:
                res[&#39;IVT_TBY&#39;] = value
            elif key == &#39;NDLTIM2&#39;:
                res[&#39;IVT_TBY_NEEDLE_TIME&#39;] = value
            elif key == &#39;GROIN2&#39;:
                res[&#39;IVT_TBY_GROIN_TIME&#39;] = value
            elif key == &#39;ADM2&#39;:
                res[&#39;IVT_TBY_ADMISSION_TIME&#39;] = value
            elif key == &#39;BOLUS2&#39;:
                res[&#39;IVT_TBY_BOLUS_TIME&#39;] = value
            elif key == &#39;GROINTIM2&#39;:
                res[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;] = value
            elif key == &#39;GROIN3&#39;:
                res[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] = value
            elif key == &#39;DYPSH&#39;:
                if value == &#39;1&#39;:
                    value = &#39;4&#39;
                elif value == &#39;3&#39;:
                    value = &#39;6&#39;
                else:
                    value = value
                res[&#39;DYSPHAGIA_SCREENING&#39;] = value
            elif key == &#39;DYSPHTIM&#39;:
                res[&#39;DYSPHAGIA_SCREENING_TIME&#39;] = value
            elif key == &#39;FIBRTIM&#39;:
                if value == &#39;1&#39; or value == &#39;2&#39;:
                    value = &#39;3&#39;
                res[&#39;AFIB_DETECTION_METHOD&#39;] = value
            elif key == &#39;FIBR&#39;:
                if value == &#39;3&#39;:
                    value = &#39;5&#39;
                res[&#39;AFIB_FLUTTER&#39;] = value
            elif key == &#39;AFIB&#39;:
                if value == &#39;1&#39;:
                    value = &#39;3&#39;
                elif value == &#39;2&#39;:
                    value = &#39;4&#39;
                elif value == &#39;3&#39;:
                    value = &#39;5&#39;
                else:
                    value = value
                res[&#39;AFIB_FLUTTER&#39;] = value
            elif key == &#39;CRTD&#39;:
                res[&#39;CAROTID_ARTERIES_IMAGING&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;1&#39;
            elif key == &#39;HMCRN&#39;:
                if value == &#39;3&#39;:
                    value = &#39;2&#39;
                else: 
                    value = value
                res[&#39;HEMICRANIECTOMY&#39;] = value
            elif key == &#39;THRMBTST&#39;:
                if value == &#39;6&#39;:
                    value = &#39;9&#39;
                elif value == &#39;7&#39;:
                    value = &#39;10&#39;
                else:
                    value = value
                res[&#39;ANTITHROMBOTICS&#39;] = value
            elif key == &#39;STTN&#39;:
                res[&#39;STATIN&#39;] = value
            elif key == &#39;STNSS&#39;:
                res[&#39;CAROTID_STENOSIS&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;3&#39;
            elif key == &#39;STNSSTIM&#39;: 
                res[&#39;CAROTID_STENOSIS_FOLLOWUP&#39;] = value
            elif key == &#39;TNSV&#39;:
                res[&#39;ANTIHYPERTENSIVE&#39;] = value
            elif key == &#39;SMKR&#39; or key == &#39;SMKR_2&#39;:
                res[&#39;SMOKING_CESSATION&#39;] = value
            elif key == &#39;DEST&#39;:
                if value == &#39;3&#39;:
                    value = &#39;4&#39;
                elif value == &#39;4&#39;:
                    value = &#39;3&#39;
                else:
                    value = value
                res[&#39;DISCHARGE_DESTINATION&#39;] = value
                res[&#39;DISCHARGE_SAME_FACILITY&#39;] = &#39;1&#39; if value == &#39;2&#39; else &#39;-999&#39;
                res[&#39;DISCHARGE_OTHER_FACILITY&#39;] = &#39;3&#39; if value == &#39;3&#39; else &#39;-999&#39;
                res[&#39;DISCHARGE_OTHER_FACILITY_O3&#39;] = &#39;4&#39; if value == &#39;3&#39; else &#39;-999&#39;
            elif key == &#39;DISCDAT&#39;:
                res[&#39;DISCHARGE_DATE&#39;] = value
            else:
                continue
        return res
            


    def convert_xml_to_df(self, root, xmlns, openclinica, lstudy, n):
        &#34;&#34;&#34; Find each element &#34;ClinicalData&#34; in xml file and converted each subject to the row in the dataframe. If two versions of the form was filled, select IVT_TBY instead of RESQv2.0, and select RESQv2.0 instead of RESQv1.2. 

        Params: 
            root: The root of xml file.
            xmlns: The base schema.
            openclinica: The base schema for openclinica.
        Returns:
            A new converted dataframe. 
        &#34;&#34;&#34;
        process =&#39;Process&#39; + str(n)

        # Total number of patients
        total_patients = 0
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            if clinical_data.get(&#39;StudyOID&#39;) in lstudy:
                total_patients += len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))

        count = 0
        LOG_EVERY_N = 100
        for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
            study_oid = clinical_data.get(&#39;StudyOID&#39;)
            &#34;&#34;&#34;
            if study_oid in self.skiped_study_oids:
                study_pts = len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
                count += study_pts
                logging.info(&#39;{0}: {1} patients were skipped due to belonging to the demo site - {2}&#39;.format(process, study_pts, study_oid))
            &#34;&#34;&#34;
            if study_oid in lstudy:
                logging.info(&#39;{0}: Adding patients for study: {1}&#39;.format(process, study_oid))
                # Get study name and protocol ID
                study = self.studies[clinical_data.get(&#39;StudyOID&#39;)]
                study_name = study[&#34;study_name&#34;]
                protocol_id = study[&#34;protocol_name&#34;]
                # Go through each subject in study
                for subject_data in clinical_data.iter(xmlns + &#39;SubjectData&#39;):
                    subject_id = subject_data.get(openclinica + &#39;StudySubjectID&#39;)
                    row = {&#39;Subject ID&#39; : subject_id, &#39;Protocol ID&#39;: protocol_id, &#39;Site Name&#39;: study_name}
                    # Get StartDate and EndData
                    for study_event in subject_data.iter(xmlns + &#39;StudyEventData&#39;):
                        start_date = study_event.get(openclinica + &#39;StartDate&#39;)
                        row[&#39;StartDate&#39;] = start_date
                        end_date = study_event.get(openclinica + &#39;EndDate&#39;)
                        row[&#39;EndDate&#39;] = end_date
                    # Get all forms, if both v1.2 and v2.0 are filled, select v2.0
                    form_oids = []
                    for form_data in subject_data.iter(xmlns + &#39;FormData&#39;):
                        form_oids.append(form_data.get(&#39;FormOID&#39;))
                    
                    # If more than one form is filled in, select v2.0
                    if len(form_oids) &gt; 1:
                        for form_data in subject_data.iter(xmlns + &#39;FormData&#39;):
                            form_oid = form_data.get(&#39;FormOID&#39;)
                            if &#34;RESQV20&#34; in form_oid and any(&#34;IVT_TBY&#34; in val for val in form_oids) == False:
                                row[&#39;FormOID&#39;] = form_oid
                                for item_data in form_data.iter(xmlns + &#39;ItemData&#39;):
                                    shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                    row[shorten_name] = item_data.get(&#39;Value&#39;)
                            elif &#34;IVT_TBY&#34; in form_oid:
                                row[&#39;FormOID&#39;] = form_oid
                                for item_data in form_data.iter(xmlns + &#39;ItemData&#39;):
                                    shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                    row[shorten_name] = item_data.get(&#39;Value&#39;)
                    else:
                        row[&#39;FormOID&#39;] = form_oids[0]
                        if &#34;RESQV12&#34; in form_oids[0]:
                            for item_data in subject_data.iter(xmlns + &#39;ItemData&#39;):
                                shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                row[shorten_name] = item_data.get(&#39;Value&#39;)
                            row = self.refactor_values(row)
                        else:
                            for item_data in subject_data.iter(xmlns + &#39;ItemData&#39;):
                                shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                row[shorten_name] = item_data.get(&#39;Value&#39;)
                        
                    
                    if n == 0:
                        self.df1 = self.df1.append(row, ignore_index=True)
                    elif n == 1:
                        self.df2 = self.df2.append(row, ignore_index=True)
                    elif n == 2:
                        self.df3 = self.df3.append(row, ignore_index=True)
                    elif n == 3:
                        self.df4 = self.df4.append(row, ignore_index=True)
                    elif n == 4:
                        self.df5 = self.df5.append(row, ignore_index=True)
                    elif n == 5:
                        self.df6 = self.df6.append(row, ignore_index=True)
                    elif n == 6:
                        self.df7 = self.df7.append(row, ignore_index=True)
                    elif n == 7:
                        self.df8 = self.df8.append(row, ignore_index=True)
                    elif n == 8:
                        self.df9 = self.df9.append(row, ignore_index=True)
                    elif n == 9:
                        self.df10 = self.df10.append(row, ignore_index=True)
                    
                    count += 1

                    if (count % LOG_EVERY_N) == 0:
                        percentage = round(count/total_patients*100, 2)
                        logging.info(&#39;{0}: Number of already converted patients: {1}/{2} - {3}%&#39;.format(process,count, total_patients, percentage))
                    if count == total_patients:
                        percentage = count/total_patients*100
                        logging.info(&#39;{0}: The conversion has been finished: {1}/{2} - {3}%&#39;.format(process, count, total_patients, percentage))
                    
                else:
                    pass
            
        return True</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="resqdb.XmlSplitter.XmlSplitter.convert_xml_to_df"><code class="name flex">
<span>def <span class="ident">convert_xml_to_df</span></span>(<span>self, root, xmlns, openclinica, lstudy, n)</span>
</code></dt>
<dd>
<section class="desc"><p>Find each element "ClinicalData" in xml file and converted each subject to the row in the dataframe. If two versions of the form was filled, select IVT_TBY instead of RESQv2.0, and select RESQv2.0 instead of RESQv1.2. </p>
<p>Params:
root: The root of xml file.
xmlns: The base schema.
openclinica: The base schema for openclinica.</p>
<h2 id="returns">Returns</h2>
<p>A new converted dataframe.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def convert_xml_to_df(self, root, xmlns, openclinica, lstudy, n):
    &#34;&#34;&#34; Find each element &#34;ClinicalData&#34; in xml file and converted each subject to the row in the dataframe. If two versions of the form was filled, select IVT_TBY instead of RESQv2.0, and select RESQv2.0 instead of RESQv1.2. 

    Params: 
        root: The root of xml file.
        xmlns: The base schema.
        openclinica: The base schema for openclinica.
    Returns:
        A new converted dataframe. 
    &#34;&#34;&#34;
    process =&#39;Process&#39; + str(n)

    # Total number of patients
    total_patients = 0
    for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
        if clinical_data.get(&#39;StudyOID&#39;) in lstudy:
            total_patients += len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))

    count = 0
    LOG_EVERY_N = 100
    for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
        study_oid = clinical_data.get(&#39;StudyOID&#39;)
        &#34;&#34;&#34;
        if study_oid in self.skiped_study_oids:
            study_pts = len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
            count += study_pts
            logging.info(&#39;{0}: {1} patients were skipped due to belonging to the demo site - {2}&#39;.format(process, study_pts, study_oid))
        &#34;&#34;&#34;
        if study_oid in lstudy:
            logging.info(&#39;{0}: Adding patients for study: {1}&#39;.format(process, study_oid))
            # Get study name and protocol ID
            study = self.studies[clinical_data.get(&#39;StudyOID&#39;)]
            study_name = study[&#34;study_name&#34;]
            protocol_id = study[&#34;protocol_name&#34;]
            # Go through each subject in study
            for subject_data in clinical_data.iter(xmlns + &#39;SubjectData&#39;):
                subject_id = subject_data.get(openclinica + &#39;StudySubjectID&#39;)
                row = {&#39;Subject ID&#39; : subject_id, &#39;Protocol ID&#39;: protocol_id, &#39;Site Name&#39;: study_name}
                # Get StartDate and EndData
                for study_event in subject_data.iter(xmlns + &#39;StudyEventData&#39;):
                    start_date = study_event.get(openclinica + &#39;StartDate&#39;)
                    row[&#39;StartDate&#39;] = start_date
                    end_date = study_event.get(openclinica + &#39;EndDate&#39;)
                    row[&#39;EndDate&#39;] = end_date
                # Get all forms, if both v1.2 and v2.0 are filled, select v2.0
                form_oids = []
                for form_data in subject_data.iter(xmlns + &#39;FormData&#39;):
                    form_oids.append(form_data.get(&#39;FormOID&#39;))
                
                # If more than one form is filled in, select v2.0
                if len(form_oids) &gt; 1:
                    for form_data in subject_data.iter(xmlns + &#39;FormData&#39;):
                        form_oid = form_data.get(&#39;FormOID&#39;)
                        if &#34;RESQV20&#34; in form_oid and any(&#34;IVT_TBY&#34; in val for val in form_oids) == False:
                            row[&#39;FormOID&#39;] = form_oid
                            for item_data in form_data.iter(xmlns + &#39;ItemData&#39;):
                                shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                row[shorten_name] = item_data.get(&#39;Value&#39;)
                        elif &#34;IVT_TBY&#34; in form_oid:
                            row[&#39;FormOID&#39;] = form_oid
                            for item_data in form_data.iter(xmlns + &#39;ItemData&#39;):
                                shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                                row[shorten_name] = item_data.get(&#39;Value&#39;)
                else:
                    row[&#39;FormOID&#39;] = form_oids[0]
                    if &#34;RESQV12&#34; in form_oids[0]:
                        for item_data in subject_data.iter(xmlns + &#39;ItemData&#39;):
                            shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                            row[shorten_name] = item_data.get(&#39;Value&#39;)
                        row = self.refactor_values(row)
                    else:
                        for item_data in subject_data.iter(xmlns + &#39;ItemData&#39;):
                            shorten_name = self.items[item_data.get(&#39;ItemOID&#39;)][&#39;shorten_name&#39;]
                            row[shorten_name] = item_data.get(&#39;Value&#39;)
                    
                
                if n == 0:
                    self.df1 = self.df1.append(row, ignore_index=True)
                elif n == 1:
                    self.df2 = self.df2.append(row, ignore_index=True)
                elif n == 2:
                    self.df3 = self.df3.append(row, ignore_index=True)
                elif n == 3:
                    self.df4 = self.df4.append(row, ignore_index=True)
                elif n == 4:
                    self.df5 = self.df5.append(row, ignore_index=True)
                elif n == 5:
                    self.df6 = self.df6.append(row, ignore_index=True)
                elif n == 6:
                    self.df7 = self.df7.append(row, ignore_index=True)
                elif n == 7:
                    self.df8 = self.df8.append(row, ignore_index=True)
                elif n == 8:
                    self.df9 = self.df9.append(row, ignore_index=True)
                elif n == 9:
                    self.df10 = self.df10.append(row, ignore_index=True)
                
                count += 1

                if (count % LOG_EVERY_N) == 0:
                    percentage = round(count/total_patients*100, 2)
                    logging.info(&#39;{0}: Number of already converted patients: {1}/{2} - {3}%&#39;.format(process,count, total_patients, percentage))
                if count == total_patients:
                    percentage = count/total_patients*100
                    logging.info(&#39;{0}: The conversion has been finished: {1}/{2} - {3}%&#39;.format(process, count, total_patients, percentage))
                
            else:
                pass
        
    return True</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.get_items"><code class="name flex">
<span>def <span class="ident">get_items</span></span>(<span>self, root, xmlns, openclinica)</span>
</code></dt>
<dd>
<section class="desc"><p>Get all columns names in the xml file, to each column name get shorten name, version of form and comment. </p>
<h2 id="params">Params</h2>
<dl>
<dt><strong><code>root</code></strong></dt>
<dd>The root of xml file.</dd>
<dt><strong><code>xmlns</code></strong></dt>
<dd>The base schema.</dd>
<dt><strong><code>openclinica</code></strong></dt>
<dd>The base schema for openclinica.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>New dictionary with all columns as keyword.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_items(self, root, xmlns, openclinica):
    &#34;&#34;&#34; Get all columns names in the xml file, to each column name get shorten name, version of form and comment. 
    
    Params:
        root: The root of xml file.
        xmlns: The base schema.
        openclinica: The base schema for openclinica.
    Returns:
        New dictionary with all columns as keyword.     
    &#34;&#34;&#34;
    items = {}
    column_names = [&#39;Subject ID&#39;, &#39;Protocol ID&#39;, &#39;Site Name&#39;, &#39;StartDate&#39;, &#39;EndDate&#39;, &#39;FormOID&#39;]
    for study in root.findall(xmlns + &#39;Study&#39;):
        if study.get(&#39;OID&#39;) == &#34;S_RESQ&#34;:
            for metadata in study.iter(xmlns + &#39;MetaDataVersion&#39;):
                for item_def in metadata.iter(xmlns + &#39;ItemDef&#39;):
                    item = {}
                    item[&#39;name&#39;] = item_def.get(&#39;Name&#39;)
                    shorten_name = self.trim_var_name(item_def.get(&#39;Name&#39;))
                    item[&#39;shorten_name&#39;] = shorten_name
                   # form_oids = item_def.get(openclinica + &#39;FormOID&#39;)
                   # print(form_oids)
                    #item[&#39;form_oid&#39;] = item_def.get(openclinica + &#39;FormOIDs&#39;)
                    #if shorten_name not in column_names and &#34;RESQV12&#34; not in form_oids and &#34;ATALAIA&#34; not in form_oids:
                      #  column_names.append(shorten_name)
                    item[&#39;comment&#39;] = item_def.get(&#39;Comment&#39;)
                    items[item_def.get(&#39;OID&#39;)] = item
    return items, column_names</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.get_number_of_patient_per_site"><code class="name flex">
<span>def <span class="ident">get_number_of_patient_per_site</span></span>(<span>self, root, xmlns, study_ids)</span>
</code></dt>
<dd>
<section class="desc"><p>Get list of sites sorted by number of sites.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_number_of_patient_per_site(self, root, xmlns, study_ids):
    &#34;&#34;&#34; Get list of sites sorted by number of sites. &#34;&#34;&#34;
    pts = {}
    total_patients = 0
    for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
        if clinical_data.get(&#39;StudyOID&#39;) in study_ids:
            total_patients += len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
            pts[clinical_data.get(&#39;StudyOID&#39;)] = len(clinical_data.findall(xmlns + &#39;SubjectData&#39;))
    
    sort_pts = sorted(pts.items(), key=lambda x: x[1], reverse=True)
    return sort_pts, total_patients</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.get_root"><code class="name flex">
<span>def <span class="ident">get_root</span></span>(<span>self, xml_file)</span>
</code></dt>
<dd>
<section class="desc"><p>Get root of xml file and additional necessary values (schema and openclinica link).</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_root(self, xml_file):
    &#34;&#34;&#34; Get root of xml file and additional necessary values (schema and openclinica link). &#34;&#34;&#34;
    file = open(xml_file, &#39;r&#39;)
    tree = ET.parse(file)

    root = tree.getroot()
    date = root.get(&#39;CreationDateTime&#39;)
    xmlns = &#34;{http://www.cdisc.org/ns/odm/v1.3}&#34;
    openclinica = &#34;{http://www.openclinica.org/ns/odm_ext_v130/v3.1}&#34;

    logging.info(&#39;Date: {0}, xmlns: {1}, openclinica: {2}&#39;.format(date, xmlns, openclinica))

    return root, xmlns, openclinica, date</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.get_studies"><code class="name flex">
<span>def <span class="ident">get_studies</span></span>(<span>self, root, xmlns)</span>
</code></dt>
<dd>
<section class="desc"><p>Get all studies in xml file, to each study also assign study name and protocol ID. </p>
<h2 id="params">Params</h2>
<dl>
<dt><strong><code>root</code></strong></dt>
<dd>The root of xml file.</dd>
<dt><strong><code>xmlns</code></strong></dt>
<dd>The base schema.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>New dictionary with all studies as keyword.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_studies(self, root, xmlns):
    &#34;&#34;&#34; Get all studies in xml file, to each study also assign study name and protocol ID. 

    Params:
        root: The root of xml file.
        xmlns: The base schema.
    Returns:
        New dictionary with all studies as keyword. 
    &#34;&#34;&#34;
    studies = {}
    for study in root.findall(xmlns + &#39;Study&#39;):
        study_item = {}
        for global_variables in study.iter(xmlns + &#39;GlobalVariables&#39;):
            for study_name in global_variables.iter(xmlns + &#39;StudyName&#39;):
                study_item[&#39;study_name&#39;] = self.trim_name(study_name.text)
            for protocol_name in global_variables.iter(xmlns + &#39;ProtocolName&#39;):
                study_item[&#39;protocol_name&#39;] = self.trim_name(protocol_name.text)
        studies[study.get(&#39;OID&#39;)] = study_item
    
    logging.info(&#39;Study names and Protocol IDs were shorten.&#39;)
    return studies</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.get_study_oids"><code class="name flex">
<span>def <span class="ident">get_study_oids</span></span>(<span>self, root, xmlns)</span>
</code></dt>
<dd>
<section class="desc"><p>Get all Study OIDs present in data. </p>
<p>Params:
root: The root of xml file.
xmlns: The base schema.
Returns:
List of available IDs.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_study_oids(self, root, xmlns):
    &#34;&#34;&#34; Get all Study OIDs present in data. 

    Params: 
        root: The root of xml file.
        xmlns: The base schema.
    Returns: 
        List of available IDs.
    &#34;&#34;&#34;
    study_oids = []
    for clinical_data in root.findall(xmlns + &#39;ClinicalData&#39;):
        study_oid = clinical_data.get(&#39;StudyOID&#39;)
        if study_oid not in self.skiped_study_oids:
            study_oids.append(study_oid)

    return study_oids</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.refactor_values"><code class="name flex">
<span>def <span class="ident">refactor_values</span></span>(<span>self, row)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def refactor_values(self, row):

    res = {}
    res[&#39;RECURRENT_STROKE&#39;] = &#39;-999&#39;
    res[&#39;DEPARTMENT_TYPE&#39;] = &#39;-999&#39;
    res[&#39;VENTILATOR&#39;] = &#39;-999&#39;
    res[&#39;BLEEDING_REASON&#39;] = &#39;-999&#39;
    res[&#39;BLEEDING_SOURCE&#39;] = &#39;-999&#39;
    res[&#39;INTERVENTION&#39;] = &#39;-999&#39;
    res[&#39;CEREBROVASCULAR_EXPERT&#39;] = &#39;-999&#39;
    res[&#39;DISCHARGE_OTHER_FACILITY_O1&#39;] = &#39;-999&#39;
    res[&#39;DISCHARGE_OTHER_FACILITY_O2&#39;] = &#39;-999&#39;
    
    for key, value in row.items():
        if key == &#39;Site Name&#39;:
            res[&#39;Site Name&#39;] = value
        elif key == &#39;Subject ID&#39;:
            res[&#39;Subject ID&#39;] = value
        elif key == &#39;EndDate&#39;:
            res[&#39;EndDate&#39;] = value
        elif key == &#39;StartDate&#39;:
            res[&#39;StartDate&#39;] = value
        elif key == &#39;Protocol ID&#39;:
            res[&#39;Protocol ID&#39;] = value
        elif key == &#39;FormOID&#39;:
            res[&#39;FormOID&#39;] = value
        elif key == &#34;SEX&#34;:
            res[&#39;SEX&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;1&#39;
        elif key == &#39;VISDAT&#39;:
            res[&#39;VISIT_DATE&#39;] = value
        elif key == &#39;VISTIM&#39;:
            res[&#39;VISIT_TIME&#39;] = value
        elif key == &#39;HOSDAT&#39;:
            res[&#39;HOSPITAL_DATE&#39;] = value
        elif key == &#39;HOSTIM&#39;:
            res[&#39;HOSPITAL_TIME&#39;] = value
        elif key == &#39;HOSSTRK&#39;:
            res[&#39;HOSPITAL_STROKE&#39;] = value
        elif key == &#39;HOSP&#39;:
            res[&#39;HOSPITALIZED_IN&#39;] = &#39;3&#39; if value == &#39;2&#39; else value
        elif key == &#39;PTASS&#39;:
            res[&#39;ASSESSED_FOR_REHAB&#39;] = value
        elif key == &#39;STRKTYP&#39;:
            if value == &#39;1&#39;:
                value = &#39;4&#39;
            elif value == &#39;2&#39;:
                value = &#39;1&#39;
            elif value == &#39;3&#39;:
                value = &#39;2&#39;
                res[&#39;NEUROSURGERY&#39;] = &#39;3&#39;
            elif value == &#39;4&#39;:
                value = &#39;6&#39;
            else:
                value = value
            res[&#39;STROKE_TYPE&#39;] = value
        elif key == &#39;CONSLVL&#39;:
            res[&#39;CONSCIOUSNESS_LEVEL&#39;] = &#39;5&#39; if value == &#39;4&#39; else value
        elif key == &#39;NIHSSSCR&#39;:
            res[&#39;NIHSS_SCORE&#39;] = value
        elif key == &#39;CT&#39;:
            res[&#39;CT_MRI&#39;] = value
        elif key == &#39;CTTIM&#39;:
            res[&#39;CT_TIME&#39;] = value
        elif key == &#39;RECANPROC&#39;:
            res[&#39;RECANALIZATION_PROCEDURES&#39;] = value
        elif key == &#39;IVTPA1&#39;:
            res[&#39;IVT_ONLY&#39;] = value
        elif key == &#39;NDLTIM1&#39;:
            res[&#39;IVT_ONLY_NEEDLE_TIME&#39;] = value
        elif key == &#39;ADM1&#39;:
            res[&#39;IVT_ONLY_ADMISSION_TIME&#39;] = value
        elif key == &#39;BOLUS1&#39;:
            res[&#39;IVT_ONLY_BOLUS_TIME&#39;] = value
        elif key == &#39;IVTPA2&#39;:
            res[&#39;IVT_TBY&#39;] = value
        elif key == &#39;NDLTIM2&#39;:
            res[&#39;IVT_TBY_NEEDLE_TIME&#39;] = value
        elif key == &#39;GROIN2&#39;:
            res[&#39;IVT_TBY_GROIN_TIME&#39;] = value
        elif key == &#39;ADM2&#39;:
            res[&#39;IVT_TBY_ADMISSION_TIME&#39;] = value
        elif key == &#39;BOLUS2&#39;:
            res[&#39;IVT_TBY_BOLUS_TIME&#39;] = value
        elif key == &#39;GROINTIM2&#39;:
            res[&#39;IVT_TBY_GROIN_PUNCTURE_TIME&#39;] = value
        elif key == &#39;GROIN3&#39;:
            res[&#39;TBY_ONLY_GROIN_PUNCTURE_TIME&#39;] = value
        elif key == &#39;DYPSH&#39;:
            if value == &#39;1&#39;:
                value = &#39;4&#39;
            elif value == &#39;3&#39;:
                value = &#39;6&#39;
            else:
                value = value
            res[&#39;DYSPHAGIA_SCREENING&#39;] = value
        elif key == &#39;DYSPHTIM&#39;:
            res[&#39;DYSPHAGIA_SCREENING_TIME&#39;] = value
        elif key == &#39;FIBRTIM&#39;:
            if value == &#39;1&#39; or value == &#39;2&#39;:
                value = &#39;3&#39;
            res[&#39;AFIB_DETECTION_METHOD&#39;] = value
        elif key == &#39;FIBR&#39;:
            if value == &#39;3&#39;:
                value = &#39;5&#39;
            res[&#39;AFIB_FLUTTER&#39;] = value
        elif key == &#39;AFIB&#39;:
            if value == &#39;1&#39;:
                value = &#39;3&#39;
            elif value == &#39;2&#39;:
                value = &#39;4&#39;
            elif value == &#39;3&#39;:
                value = &#39;5&#39;
            else:
                value = value
            res[&#39;AFIB_FLUTTER&#39;] = value
        elif key == &#39;CRTD&#39;:
            res[&#39;CAROTID_ARTERIES_IMAGING&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;1&#39;
        elif key == &#39;HMCRN&#39;:
            if value == &#39;3&#39;:
                value = &#39;2&#39;
            else: 
                value = value
            res[&#39;HEMICRANIECTOMY&#39;] = value
        elif key == &#39;THRMBTST&#39;:
            if value == &#39;6&#39;:
                value = &#39;9&#39;
            elif value == &#39;7&#39;:
                value = &#39;10&#39;
            else:
                value = value
            res[&#39;ANTITHROMBOTICS&#39;] = value
        elif key == &#39;STTN&#39;:
            res[&#39;STATIN&#39;] = value
        elif key == &#39;STNSS&#39;:
            res[&#39;CAROTID_STENOSIS&#39;] = &#39;2&#39; if value == &#39;1&#39; else &#39;3&#39;
        elif key == &#39;STNSSTIM&#39;: 
            res[&#39;CAROTID_STENOSIS_FOLLOWUP&#39;] = value
        elif key == &#39;TNSV&#39;:
            res[&#39;ANTIHYPERTENSIVE&#39;] = value
        elif key == &#39;SMKR&#39; or key == &#39;SMKR_2&#39;:
            res[&#39;SMOKING_CESSATION&#39;] = value
        elif key == &#39;DEST&#39;:
            if value == &#39;3&#39;:
                value = &#39;4&#39;
            elif value == &#39;4&#39;:
                value = &#39;3&#39;
            else:
                value = value
            res[&#39;DISCHARGE_DESTINATION&#39;] = value
            res[&#39;DISCHARGE_SAME_FACILITY&#39;] = &#39;1&#39; if value == &#39;2&#39; else &#39;-999&#39;
            res[&#39;DISCHARGE_OTHER_FACILITY&#39;] = &#39;3&#39; if value == &#39;3&#39; else &#39;-999&#39;
            res[&#39;DISCHARGE_OTHER_FACILITY_O3&#39;] = &#39;4&#39; if value == &#39;3&#39; else &#39;-999&#39;
        elif key == &#39;DISCDAT&#39;:
            res[&#39;DISCHARGE_DATE&#39;] = value
        else:
            continue
    return res</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.split_list"><code class="name flex">
<span>def <span class="ident">split_list</span></span>(<span>self, data, total_patients, parts=2)</span>
</code></dt>
<dd>
<section class="desc"><p>Return number of lists equaled to processes and site ids in the list. Each process will get some sites.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def split_list(self, data, total_patients, parts=2):
    &#34;&#34;&#34; Return number of lists equaled to processes and site ids in the list. Each process will get some sites. &#34;&#34;&#34;
    pts_per_parts = []
    for i in range(1, parts + 1):
        pts_per_parts.append(total_patients//parts*i)
    
    count = 0
    index = 0
    p_ix = 0
    res = {}

    site_ids = list(list(zip(*data))[0])
    total_patients = list(list(zip(*data))[1])

    for i in range(0, len(total_patients)):
        count += total_patients[i]
        if count &gt; pts_per_parts[index]:
            name = &#34;list&#34; + str(index)
            index += 1
            res[name] = site_ids[p_ix:i+1]
            p_ix = i+1
        if i == (len(total_patients) - 1):
            name = &#34;list&#34; + str(index)
            res[name] = site_ids[p_ix:]
        else:
            continue
    
    return res</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.trim_name"><code class="name flex">
<span>def <span class="ident">trim_name</span></span>(<span>self, val)</span>
</code></dt>
<dd>
<section class="desc"><p>Remove RES-Q from text if present. </p>
<p>Params:
val: string
Returns:
Shorten string if RES-Q was in the value.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def trim_name(self, val):
    &#34;&#34;&#34; Remove RES-Q from text if present. 
    
    Params: 
        val: string 
    Returns: 
        Shorten string if RES-Q was in the value.
    &#34;&#34;&#34;
    if val.startswith(&#34;RES-Q&#34;):
        return val[8:]
    else:
        return val</code></pre>
</details>
</dd>
<dt id="resqdb.XmlSplitter.XmlSplitter.trim_var_name"><code class="name flex">
<span>def <span class="ident">trim_var_name</span></span>(<span>self, var)</span>
</code></dt>
<dd>
<section class="desc"><p>Cut language variation, eg. EN, CS from the name of variable.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def trim_var_name(self, var):
    &#34;&#34;&#34; Cut language variation, eg. EN, CS from the name of variable. &#34;&#34;&#34;
    if var.endswith(&#39;RU_2&#39;) or var.endswith(&#39;CS_2&#39;) or var.endswith(&#39;HY_2&#39;) or var.endswith(&#39;RU_2&#39;) or var.endswith(&#39;CZ_2&#39;):
        return var[:-5]
    elif var.endswith(&#34;CZ&#34;) or var.endswith(&#34;EN&#34;) or var.endswith(&#34;HY&#34;) or var.endswith(&#34;ES&#34;) or var.endswith(&#34;CS&#34;) or var.endswith(&#34;RO&#34;) or var.endswith(&#34;UA&#34;) or var.endswith(&#34;RU&#34;):
        return var[:-3]
    else:
        return var</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="resqdb" href="index.html">resqdb</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="resqdb.XmlSplitter.XmlSplitter" href="#resqdb.XmlSplitter.XmlSplitter">XmlSplitter</a></code></h4>
<ul class="">
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.convert_xml_to_df" href="#resqdb.XmlSplitter.XmlSplitter.convert_xml_to_df">convert_xml_to_df</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.get_items" href="#resqdb.XmlSplitter.XmlSplitter.get_items">get_items</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.get_number_of_patient_per_site" href="#resqdb.XmlSplitter.XmlSplitter.get_number_of_patient_per_site">get_number_of_patient_per_site</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.get_root" href="#resqdb.XmlSplitter.XmlSplitter.get_root">get_root</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.get_studies" href="#resqdb.XmlSplitter.XmlSplitter.get_studies">get_studies</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.get_study_oids" href="#resqdb.XmlSplitter.XmlSplitter.get_study_oids">get_study_oids</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.refactor_values" href="#resqdb.XmlSplitter.XmlSplitter.refactor_values">refactor_values</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.split_list" href="#resqdb.XmlSplitter.XmlSplitter.split_list">split_list</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.trim_name" href="#resqdb.XmlSplitter.XmlSplitter.trim_name">trim_name</a></code></li>
<li><code><a title="resqdb.XmlSplitter.XmlSplitter.trim_var_name" href="#resqdb.XmlSplitter.XmlSplitter.trim_var_name">trim_var_name</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.6.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>